!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).d3po=e()}(this,function(){"use strict";function t(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function e(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function n(n){let i,o,a;function s(t,e,n=0,r=t.length){if(n<r){if(0!==i(e,e))return r;do{const i=n+r>>>1;o(t[i],e)<0?n=i+1:r=i}while(n<r)}return n}return 2!==n.length?(i=t,o=(e,r)=>t(n(e),r),a=(t,e)=>n(t)-e):(i=n===t||n===e?n:r,o=n,a=n),{left:s,center:function(t,e,n=0,r=t.length){const i=s(t,e,n,r-1);return i>n&&a(t[i-1],e)>-a(t[i],e)?i-1:i},right:function(t,e,n=0,r=t.length){if(n<r){if(0!==i(e,e))return r;do{const i=n+r>>>1;o(t[i],e)<=0?n=i+1:r=i}while(n<r)}return n}}}function r(){return 0}function i(t){return null===t?NaN:+t}const o=n(t).right;function a(t,e){let n,r;if(void 0===e)for(const i of t)null!=i&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}n(i).center;class s{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=e[r],o=t+i,a=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(e=o,n=t[--i],o=e+n,r=n-(o-e),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(n=2*r,e=o+n,n==e-o&&(o=e))}return o}}class l extends Map{constructor(t,e=u){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[n,r]of t)this.set(n,r)}get(t){return super.get(c(this,t))}has(t){return super.has(c(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);t.has(r)&&(n=t.get(r),t.delete(r));return n}(this,t))}}function c({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function u(t){return null!==t&&"object"==typeof t?t.valueOf():t}function h(t){return t}function f(t,...e){return function(t,e,n,r){return function t(i,o){if(o>=r.length)return n(i);const a=new l,s=r[o++];let c=-1;for(const e of i){const t=s(e,++c,i),n=a.get(t);n?n.push(e):a.set(t,[e])}for(const[e,n]of a)a.set(e,t(n,o));return e(a)}(t,0)}(t,h,h,e)}const d=Math.sqrt(50),p=Math.sqrt(10),g=Math.sqrt(2);function y(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=d?10:o>=p?5:o>=g?2:1;let s,l,c;return i<0?(c=Math.pow(10,-i)/a,s=Math.round(t*c),l=Math.round(e*c),s/c<t&&++s,l/c>e&&--l,c=-c):(c=Math.pow(10,i)*a,s=Math.round(t/c),l=Math.round(e/c),s*c<t&&++s,l*c>e&&--l),l<s&&.5<=n&&n<2?y(t,e,2*n):[s,l,c]}function m(t,e,n){return y(t=+t,e=+e,n=+n)[2]}function x(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function v(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function b(t,e,n=i){if((r=t.length)&&!isNaN(e=+e)){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,o=(r-1)*e,a=Math.floor(o),s=+n(t[a],a,t);return s+(+n(t[a+1],a+1,t)-s)*(o-a)}}function w(t,e){let n=0;if(void 0===e)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function _(t){return t}var F=1e-6;function k(t){return"translate("+t+",0)"}function M(t){return"translate(0,"+t+")"}function A(t){return e=>+t(e)}function $(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function S(){return!this.__axis}function N(t,e){var n=[],r=null,i=null,o=6,a=6,s=3,l="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===t||4===t?-1:1,u=4===t||2===t?"x":"y",h=1===t||3===t?k:M;function f(f){var d=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,p=null==i?e.tickFormat?e.tickFormat.apply(e,n):_:i,g=Math.max(o,0)+s,y=e.range(),m=+y[0]+l,x=+y[y.length-1]+l,v=(e.bandwidth?$:A)(e.copy(),l),b=f.selection?f.selection():f,w=b.selectAll(".domain").data([null]),k=b.selectAll(".tick").data(d,e).order(),M=k.exit(),N=k.enter().append("g").attr("class","tick"),z=k.select("line"),E=k.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),k=k.merge(N),z=z.merge(N.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),E=E.merge(N.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),f!==b&&(w=w.transition(f),k=k.transition(f),z=z.transition(f),E=E.transition(f),M=M.transition(f).attr("opacity",F).attr("transform",function(t){return isFinite(t=v(t))?h(t+l):this.getAttribute("transform")}),N.attr("opacity",F).attr("transform",function(t){var e=this.parentNode.__axis;return h((e&&isFinite(e=e(t))?e:v(t))+l)})),M.remove(),w.attr("d",4===t||2===t?a?"M"+c*a+","+m+"H"+l+"V"+x+"H"+c*a:"M"+l+","+m+"V"+x:a?"M"+m+","+c*a+"V"+l+"H"+x+"V"+c*a:"M"+m+","+l+"H"+x),k.attr("opacity",1).attr("transform",function(t){return h(v(t)+l)}),z.attr(u+"2",c*o),E.attr(u,c*g).text(p),b.filter(S).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),b.each(function(){this.__axis=v})}return f.scale=function(t){return arguments.length?(e=t,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(t){return arguments.length?(n=null==t?[]:Array.from(t),f):n.slice()},f.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),f):r&&r.slice()},f.tickFormat=function(t){return arguments.length?(i=t,f):i},f.tickSize=function(t){return arguments.length?(o=a=+t,f):o},f.tickSizeInner=function(t){return arguments.length?(o=+t,f):o},f.tickSizeOuter=function(t){return arguments.length?(a=+t,f):a},f.tickPadding=function(t){return arguments.length?(s=+t,f):s},f.offset=function(t){return arguments.length?(l=+t,f):l},f}function z(t){return N(3,t)}function E(t){return N(4,t)}var T={value:()=>{}};function C(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new P(r)}function P(t){this._=t}function I(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function L(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=T,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}P.prototype=C.prototype={constructor:P,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=L(i[n],t.name,e);else if(null==e)for(n in i)i[n]=L(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=I(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new P(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var q="http://www.w3.org/1999/xhtml";const B={svg:"http://www.w3.org/2000/svg",xhtml:q,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function O(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),B.hasOwnProperty(e)?{space:B[e],local:t}:t}function j(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===q&&e.documentElement.namespaceURI===q?e.createElement(t):e.createElementNS(n,t)}}function R(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function G(t){var e=O(t);return(e.local?R:j)(e)}function H(){}function D(t){return null==t?H:function(){return this.querySelector(t)}}function V(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function X(){return[]}function Y(t){return null==t?X:function(){return this.querySelectorAll(t)}}function W(t){return function(){return this.matches(t)}}function U(t){return function(e){return e.matches(t)}}var J=Array.prototype.find;function K(){return this.firstElementChild}var Z=Array.prototype.filter;function Q(){return Array.from(this.children)}function tt(t){return new Array(t.length)}function et(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function nt(t,e,n,r,i,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new et(t,o[s]);for(;s<l;++s)(a=e[s])&&(i[s]=a)}function rt(t,e,n,r,i,o,a){var s,l,c,u=new Map,h=e.length,f=o.length,d=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(d[s]=c=a.call(l,l.__data__,s,e)+"",u.has(c)?i[s]=l:u.set(c,l));for(s=0;s<f;++s)c=a.call(t,o[s],s,o)+"",(l=u.get(c))?(r[s]=l,l.__data__=o[s],u.delete(c)):n[s]=new et(t,o[s]);for(s=0;s<h;++s)(l=e[s])&&u.get(d[s])===l&&(i[s]=l)}function it(t){return t.__data__}function ot(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function at(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function st(t){return function(){this.removeAttribute(t)}}function lt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ct(t,e){return function(){this.setAttribute(t,e)}}function ut(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ht(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function ft(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function dt(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function pt(t){return function(){this.style.removeProperty(t)}}function gt(t,e,n){return function(){this.style.setProperty(t,e,n)}}function yt(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function mt(t,e){return t.style.getPropertyValue(e)||dt(t).getComputedStyle(t,null).getPropertyValue(e)}function xt(t){return function(){delete this[t]}}function vt(t,e){return function(){this[t]=e}}function bt(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function wt(t){return t.trim().split(/^|\s+/)}function _t(t){return t.classList||new Ft(t)}function Ft(t){this._node=t,this._names=wt(t.getAttribute("class")||"")}function kt(t,e){for(var n=_t(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Mt(t,e){for(var n=_t(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function At(t){return function(){kt(this,t)}}function $t(t){return function(){Mt(this,t)}}function St(t,e){return function(){(e.apply(this,arguments)?kt:Mt)(this,t)}}function Nt(){this.textContent=""}function zt(t){return function(){this.textContent=t}}function Et(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Tt(){this.innerHTML=""}function Ct(t){return function(){this.innerHTML=t}}function Pt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function It(){this.nextSibling&&this.parentNode.appendChild(this)}function Lt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qt(){return null}function Bt(){var t=this.parentNode;t&&t.removeChild(this)}function Ot(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function jt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Rt(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function Gt(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Ht(t,e,n){var r=dt(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Dt(t,e){return function(){return Ht(this,t,e)}}function Vt(t,e){return function(){return Ht(this,t,e.apply(this,arguments))}}et.prototype={constructor:et,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},Ft.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Xt=[null];function Yt(t,e){this._groups=t,this._parents=e}function Wt(){return new Yt([[document.documentElement]],Xt)}function Ut(t){return"string"==typeof t?new Yt([[document.querySelector(t)]],[document.documentElement]):new Yt([[t]],Xt)}function Jt(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function Kt(t){return"string"==typeof t?new Yt([document.querySelectorAll(t)],[document.documentElement]):new Yt([V(t)],Xt)}Yt.prototype=Wt.prototype={constructor:Yt,select:function(t){"function"!=typeof t&&(t=D(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=e[i],l=s.length,c=r[i]=new Array(l),u=0;u<l;++u)(o=s[u])&&(a=t.call(o,o.__data__,u,s))&&("__data__"in o&&(a.__data__=o.__data__),c[u]=a);return new Yt(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return V(t.apply(this,arguments))}}(t):Y(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(r.push(t.call(a,a.__data__,c,s)),i.push(a));return new Yt(r,i)},selectChild:function(t){return this.select(null==t?K:function(t){return function(){return J.call(this.children,t)}}("function"==typeof t?t:U(t)))},selectChildren:function(t){return this.selectAll(null==t?Q:function(t){return function(){return Z.call(this.children,t)}}("function"==typeof t?t:U(t)))},filter:function(t){"function"!=typeof t&&(t=W(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,l=r[i]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new Yt(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,it);var n,r=e?rt:nt,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),l=new Array(a),c=new Array(a),u=0;u<a;++u){var h=i[u],f=o[u],d=f.length,p=ot(t.call(h,h&&h.__data__,u,i)),g=p.length,y=l[u]=new Array(g),m=s[u]=new Array(g);r(h,f,y,m,c[u]=new Array(d),p,e);for(var x,v,b=0,w=0;b<g;++b)if(x=y[b]){for(b>=w&&(w=b+1);!(v=m[w])&&++w<g;);x._next=v||null}}return(s=new Yt(s,i))._enter=l,s._exit=c,s},enter:function(){return new Yt(this._enter||this._groups.map(tt),this._parents)},exit:function(){return new Yt(this._exit||this._groups.map(tt),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),s=new Array(i),l=0;l<a;++l)for(var c,u=n[l],h=r[l],f=u.length,d=s[l]=new Array(f),p=0;p<f;++p)(c=u[p]||h[p])&&(d[p]=c);for(;l<i;++l)s[l]=n[l];return new Yt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=at);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],l=s.length,c=i[o]=new Array(l),u=0;u<l;++u)(a=s[u])&&(c[u]=a);c.sort(e)}return new Yt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=O(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?lt:st:"function"==typeof e?n.local?ft:ht:n.local?ut:ct)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?pt:"function"==typeof e?yt:gt)(t,e,null==n?"":n)):mt(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?xt:"function"==typeof e?bt:vt)(t,e)):this.node()[t]},classed:function(t,e){var n=wt(t+"");if(arguments.length<2){for(var r=_t(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?St:e?At:$t)(n,e))},text:function(t){return arguments.length?this.each(null==t?Nt:("function"==typeof t?Et:zt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Tt:("function"==typeof t?Pt:Ct)(t)):this.node().innerHTML},raise:function(){return this.each(It)},lower:function(){return this.each(Lt)},append:function(t){var e="function"==typeof t?t:G(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:G(t),r=null==e?qt:"function"==typeof e?e:D(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(Bt)},clone:function(t){return this.select(t?jt:Ot)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Gt:Rt,r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(r=0,l=s[c];r<a;++r)if((i=o[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Vt:Dt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};const Zt={passive:!1},Qt={capture:!0,passive:!1};function te(t){t.stopImmediatePropagation()}function ee(t){t.preventDefault(),t.stopImmediatePropagation()}function ne(t){var e=t.document.documentElement,n=Ut(t).on("dragstart.drag",ee,Qt);"onselectstart"in e?n.on("selectstart.drag",ee,Qt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function re(t,e){var n=t.document.documentElement,r=Ut(t).on("dragstart.drag",null);e&&(r.on("click.drag",ee,Qt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const ie=t=>()=>t;function oe(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:a,y:s,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function ae(t){return!t.ctrlKey&&!t.button}function se(){return this.parentNode}function le(t,e){return null==e?{x:t.x,y:t.y}:e}function ce(){return navigator.maxTouchPoints||"ontouchstart"in this}function ue(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function he(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function fe(){}oe.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var de=.7,pe=1/de,ge="\\s*([+-]?\\d+)\\s*",ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",me="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xe=/^#([0-9a-f]{3,8})$/,ve=new RegExp(`^rgb\\(${ge},${ge},${ge}\\)$`),be=new RegExp(`^rgb\\(${me},${me},${me}\\)$`),we=new RegExp(`^rgba\\(${ge},${ge},${ge},${ye}\\)$`),_e=new RegExp(`^rgba\\(${me},${me},${me},${ye}\\)$`),Fe=new RegExp(`^hsl\\(${ye},${me},${me}\\)$`),ke=new RegExp(`^hsla\\(${ye},${me},${me},${ye}\\)$`),Me={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ae(){return this.rgb().formatHex()}function $e(){return this.rgb().formatRgb()}function Se(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=xe.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ne(e):3===n?new Te(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ze(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ze(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ve.exec(t))?new Te(e[1],e[2],e[3],1):(e=be.exec(t))?new Te(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=we.exec(t))?ze(e[1],e[2],e[3],e[4]):(e=_e.exec(t))?ze(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Fe.exec(t))?Be(e[1],e[2]/100,e[3]/100,1):(e=ke.exec(t))?Be(e[1],e[2]/100,e[3]/100,e[4]):Me.hasOwnProperty(t)?Ne(Me[t]):"transparent"===t?new Te(NaN,NaN,NaN,0):null}function Ne(t){return new Te(t>>16&255,t>>8&255,255&t,1)}function ze(t,e,n,r){return r<=0&&(t=e=n=NaN),new Te(t,e,n,r)}function Ee(t,e,n,r){return 1===arguments.length?((i=t)instanceof fe||(i=Se(i)),i?new Te((i=i.rgb()).r,i.g,i.b,i.opacity):new Te):new Te(t,e,n,null==r?1:r);var i}function Te(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Ce(){return`#${qe(this.r)}${qe(this.g)}${qe(this.b)}`}function Pe(){const t=Ie(this.opacity);return`${1===t?"rgb(":"rgba("}${Le(this.r)}, ${Le(this.g)}, ${Le(this.b)}${1===t?")":`, ${t})`}`}function Ie(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Le(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function qe(t){return((t=Le(t))<16?"0":"")+t.toString(16)}function Be(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new je(t,e,n,r)}function Oe(t){if(t instanceof je)return new je(t.h,t.s,t.l,t.opacity);if(t instanceof fe||(t=Se(t)),!t)return new je;if(t instanceof je)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,l=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=l<.5?o+i:2-o-i,a*=60):s=l>0&&l<1?0:a,new je(a,s,l,t.opacity)}function je(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Re(t){return(t=(t||0)%360)<0?t+360:t}function Ge(t){return Math.max(0,Math.min(1,t||0))}function He(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}ue(fe,Se,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ae,formatHex:Ae,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Oe(this).formatHsl()},formatRgb:$e,toString:$e}),ue(Te,Ee,he(fe,{brighter(t){return t=null==t?pe:Math.pow(pe,t),new Te(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?de:Math.pow(de,t),new Te(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Te(Le(this.r),Le(this.g),Le(this.b),Ie(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ce,formatHex:Ce,formatHex8:function(){return`#${qe(this.r)}${qe(this.g)}${qe(this.b)}${qe(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Pe,toString:Pe})),ue(je,function(t,e,n,r){return 1===arguments.length?Oe(t):new je(t,e,n,null==r?1:r)},he(fe,{brighter(t){return t=null==t?pe:Math.pow(pe,t),new je(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?de:Math.pow(de,t),new je(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Te(He(t>=240?t-240:t+120,i,r),He(t,i,r),He(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new je(Re(this.h),Ge(this.s),Ge(this.l),Ie(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ie(this.opacity);return`${1===t?"hsl(":"hsla("}${Re(this.h)}, ${100*Ge(this.s)}%, ${100*Ge(this.l)}%${1===t?")":`, ${t})`}`}}));const De=t=>()=>t;function Ve(t){return 1===(t=+t)?Xe:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):De(isNaN(e)?n:e)}}function Xe(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):De(isNaN(t)?e:t)}const Ye=function t(e){var n=Ve(e);function r(t,e){var r=n((t=Ee(t)).r,(e=Ee(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=Xe(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);var We,Ue=(We=function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return function(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}((n-r/e)*e,a,i,o,s)}},function(t){var e,n,r=t.length,i=new Array(r),o=new Array(r),a=new Array(r);for(e=0;e<r;++e)n=Ee(t[e]),i[e]=n.r||0,o[e]=n.g||0,a[e]=n.b||0;return i=We(i),o=We(o),a=We(a),n.opacity=1,function(t){return n.r=i(t),n.g=o(t),n.b=a(t),n+""}});function Je(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function Ke(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=on(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function Ze(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Qe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function tn(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=on(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var en=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nn=new RegExp(en.source,"g");function rn(t,e){var n,r,i,o=en.lastIndex=nn.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=en.exec(t))&&(r=nn.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:Qe(n,r)})),o=nn.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)s[(n=l[r]).i]=n.x(t);return s.join("")})}function on(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?De(e):("number"===i?Qe:"string"===i?(n=Se(e))?(e=n,Ye):rn:e instanceof Se?Ye:e instanceof Date?Ze:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?Ke:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?tn:Qe:Je))(t,e)}function an(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var sn,ln=180/Math.PI,cn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function un(t,e,n,r,i,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),t*r<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*ln,skewX:Math.atan(l)*ln,scaleX:a,scaleY:s}}function hn(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],l=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:Qe(t,i)},{i:l-2,x:Qe(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Qe(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,l),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Qe(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,l),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:Qe(t,n)},{i:s-2,x:Qe(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(t){for(var e,n=-1,r=l.length;++n<r;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var fn=hn(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?cn:un(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),dn=hn(function(t){return null==t?cn:(sn||(sn=document.createElementNS("http://www.w3.org/2000/svg","g")),sn.setAttribute("transform",t),(t=sn.transform.baseVal.consolidate())?un((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):cn)},", ",")",")");function pn(t){return((t=Math.exp(t))+1/t)/2}const gn=function t(e,n,r){function i(t,i){var o,a,s=t[0],l=t[1],c=t[2],u=i[0],h=i[1],f=i[2],d=u-s,p=h-l,g=d*d+p*p;if(g<1e-12)a=Math.log(f/c)/e,o=function(t){return[s+t*d,l+t*p,c*Math.exp(e*t*a)]};else{var y=Math.sqrt(g),m=(f*f-c*c+r*g)/(2*c*n*y),x=(f*f-c*c-r*g)/(2*f*n*y),v=Math.log(Math.sqrt(m*m+1)-m),b=Math.log(Math.sqrt(x*x+1)-x);a=(b-v)/e,o=function(t){var r,i=t*a,o=pn(v),u=c/(n*y)*(o*(r=e*i+v,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[s+u*d,l+u*p,c*o/pn(e*i+v)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4);var yn,mn,xn=0,vn=0,bn=0,wn=0,_n=0,Fn=0,kn="object"==typeof performance&&performance.now?performance:Date,Mn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function An(){return _n||(Mn($n),_n=kn.now()+Fn)}function $n(){_n=0}function Sn(){this._call=this._time=this._next=null}function Nn(t,e,n){var r=new Sn;return r.restart(t,e,n),r}function zn(){_n=(wn=kn.now())+Fn,xn=vn=0;try{!function(){An(),++xn;for(var t,e=yn;e;)(t=_n-e._time)>=0&&e._call.call(void 0,t),e=e._next;--xn}()}finally{xn=0,function(){var t,e,n=yn,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:yn=e);mn=t,Tn(r)}(),_n=0}}function En(){var t=kn.now(),e=t-wn;e>1e3&&(Fn-=e,wn=t)}function Tn(t){xn||(vn&&(vn=clearTimeout(vn)),t-_n>24?(t<1/0&&(vn=setTimeout(zn,t-kn.now()-Fn)),bn&&(bn=clearInterval(bn))):(bn||(wn=kn.now(),bn=setInterval(En,1e3)),xn=1,Mn(zn)))}function Cn(t,e,n){var r=new Sn;return e=null==e?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,n),r}Sn.prototype=Nn.prototype={constructor:Sn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?An():+n)+(null==e?0:+e),this._next||mn===this||(mn?mn._next=this:yn=this,mn=this),this._call=t,this._time=n,Tn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Tn())}};var Pn=C("start","end","cancel","interrupt"),In=[];function Ln(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(t){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)}function a(o){var c,u,h,f;if(1!==n.state)return l();for(c in i)if((f=i[c]).name===n.name){if(3===f.state)return Cn(a);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete i[c]):+c<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete i[c])}if(Cn(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(o))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(f=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=f);r.length=u+1}}function s(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,a=r.length;++o<a;)r[o].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Nn(o,0,n.time)}(t,n,{name:e,index:r,group:i,on:Pn,tween:In,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function qn(t,e){var n=On(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Bn(t,e){var n=On(t,e);if(n.state>3)throw new Error("too late; already running");return n}function On(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function jn(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}}function Rn(t,e){var n,r;return function(){var i=Bn(this,t),o=i.tween;if(o!==n)for(var a=0,s=(r=n=o).length;a<s;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}function Gn(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Bn(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:e,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=s;break}l===c&&i.push(s)}o.tween=i}}function Hn(t,e,n){var r=t._id;return t.each(function(){var t=Bn(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return On(t,r).value[e]}}function Dn(t,e){var n;return("number"==typeof e?Qe:e instanceof Se?Ye:(n=Se(e))?(e=n,Ye):rn)(t,e)}function Vn(t){return function(){this.removeAttribute(t)}}function Xn(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Yn(t,e,n){var r,i,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===r?i:i=e(r=a,n)}}function Wn(t,e,n){var r,i,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===r?i:i=e(r=a,n)}}function Un(t,e,n){var r,i,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(t))===(s=l+"")?null:a===r&&s===i?o:(i=s,o=e(r=a,l));this.removeAttribute(t)}}function Jn(t,e,n){var r,i,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:a===r&&s===i?o:(i=s,o=e(r=a,l));this.removeAttributeNS(t.space,t.local)}}function Kn(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function Zn(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function Qn(t,e){return function(){qn(this,t).delay=+e.apply(this,arguments)}}function tr(t,e){return e=+e,function(){qn(this,t).delay=e}}function er(t,e){return function(){Bn(this,t).duration=+e.apply(this,arguments)}}function nr(t,e){return e=+e,function(){Bn(this,t).duration=e}}var rr=Wt.prototype.constructor;function ir(t){return function(){this.style.removeProperty(t)}}var or=0;function ar(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function sr(){return++or}var lr=Wt.prototype;ar.prototype={constructor:ar,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=D(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var s,l,c=r[a],u=c.length,h=o[a]=new Array(u),f=0;f<u;++f)(s=c[f])&&(l=t.call(s,s.__data__,f,c))&&("__data__"in s&&(l.__data__=s.__data__),h[f]=l,Ln(h[f],e,n,f,h,On(s,n)));return new ar(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Y(t));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var l,c=r[s],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var f,d=t.call(l,l.__data__,h,c),p=On(l,n),g=0,y=d.length;g<y;++g)(f=d[g])&&Ln(f,e,n,g,d,p);o.push(d),a.push(l)}return new ar(o,a,e,n)},selectChild:lr.selectChild,selectChildren:lr.selectChildren,filter:function(t){"function"!=typeof t&&(t=W(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,l=r[i]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new ar(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var l,c=e[s],u=n[s],h=c.length,f=a[s]=new Array(h),d=0;d<h;++d)(l=c[d]||u[d])&&(f[d]=l);for(;s<r;++s)a[s]=e[s];return new ar(a,this._parents,this._name,this._id)},selection:function(){return new rr(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=sr(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],l=s.length,c=0;c<l;++c)if(a=s[c]){var u=On(a,e);Ln(a,t,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ar(r,this._parents,t,n)},call:lr.call,nodes:lr.nodes,node:lr.node,size:lr.size,empty:lr.empty,each:lr.each,on:function(t,e){var n=this._id;return arguments.length<2?On(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?qn:Bn;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var n=O(t),r="transform"===n?dn:Dn;return this.attrTween(t,"function"==typeof e?(n.local?Jn:Un)(n,r,Hn(this,"attr."+t,e)):null==e?(n.local?Xn:Vn)(n):(n.local?Wn:Yn)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=O(t);return this.tween(n,(r.local?Kn:Zn)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?fn:Dn;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=mt(this,t),a=(this.style.removeProperty(t),mt(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}(t,r)).on("end.style."+t,ir(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,o;return function(){var a=mt(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=mt(this,t)),a===l?null:a===r&&l===i?o:(i=l,o=e(r=a,s))}}(t,r,Hn(this,"style."+t,e))).each(function(t,e){var n,r,i,o,a="style."+e,s="end."+a;return function(){var l=Bn(this,t),c=l.on,u=null==l.value[a]?o||(o=ir(e)):void 0;c===n&&i===u||(r=(n=c).copy()).on(s,i=u),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,o=n+"";return function(){var a=mt(this,t);return a===o?null:a===r?i:i=e(r=a,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function o(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,o,n)),r}return o._value=e,o}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Hn(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=On(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?Rn:Gn)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Qn:tr)(e,t)):On(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?er:nr)(e,t)):On(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Bn(this,t).ease=e}}(e,t)):On(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Bn(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,a){var s={value:a},l={value:function(){0===--i&&o()}};n.each(function(){var n=Bn(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e}),0===i&&o()})},[Symbol.iterator]:lr[Symbol.iterator]};var cr={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function ur(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Wt.prototype.interrupt=function(t){return this.each(function(){jn(this,t)})},Wt.prototype.transition=function(t){var e,n;t instanceof ar?(e=t._id,t=t._name):(e=sr(),(n=cr).time=An(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],l=s.length,c=0;c<l;++c)(a=s[c])&&Ln(a,t,e,c,s,n||ur(a,e));return new ar(r,this._parents,t,e)};const hr=Math.PI,fr=2*hr,dr=1e-6,pr=fr-dr;function gr(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class yr{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?gr:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return gr;const n=10**e;return function(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,r){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(t,e,n,r,i,o){this._append`C${+t},${+e},${+n},${+r},${this._x1=+i},${this._y1=+o}`}arcTo(t,e,n,r,i){if(t=+t,e=+e,n=+n,r=+r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let o=this._x1,a=this._y1,s=n-t,l=r-e,c=o-t,u=a-e,h=c*c+u*u;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(h>dr)if(Math.abs(u*s-l*c)>dr&&i){let f=n-o,d=r-a,p=s*s+l*l,g=f*f+d*d,y=Math.sqrt(p),m=Math.sqrt(h),x=i*Math.tan((hr-Math.acos((p+h-g)/(2*y*m)))/2),v=x/m,b=x/y;Math.abs(v-1)>dr&&this._append`L${t+v*c},${e+v*u}`,this._append`A${i},${i},0,0,${+(u*f>c*d)},${this._x1=t+b*s},${this._y1=e+b*l}`}else this._append`L${this._x1=t},${this._y1=e}`;else;}arc(t,e,n,r,i,o){if(t=+t,e=+e,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(r),s=n*Math.sin(r),l=t+a,c=e+s,u=1^o,h=o?r-i:i-r;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>dr||Math.abs(this._y1-c)>dr)&&this._append`L${l},${c}`,n&&(h<0&&(h=h%fr+fr),h>pr?this._append`A${n},${n},0,1,${u},${t-a},${e-s}A${n},${n},0,1,${u},${this._x1=l},${this._y1=c}`:h>dr&&this._append`A${n},${n},0,${+(h>=hr)},${u},${this._x1=t+n*Math.cos(i)},${this._y1=e+n*Math.sin(i)}`)}rect(t,e,n,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function mr(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,l,c,u,h,f,d=t._root,p={data:r},g=t._x0,y=t._y0,m=t._x1,x=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((c=e>=(o=(g+m)/2))?g=o:m=o,(u=n>=(a=(y+x)/2))?y=a:x=a,i=d,!(d=d[h=u<<1|c]))return i[h]=p,t;if(s=+t._x.call(null,d.data),l=+t._y.call(null,d.data),e===s&&n===l)return p.next=d,i?i[h]=p:t._root=p,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(c=e>=(o=(g+m)/2))?g=o:m=o,(u=n>=(a=(y+x)/2))?y=a:x=a}while((h=u<<1|c)==(f=(l>=a)<<1|s>=o));return i[f]=d,i[h]=p,t}function xr(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function vr(t){return t[0]}function br(t){return t[1]}function wr(t,e,n){var r=new _r(null==e?vr:e,null==n?br:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function _r(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function Fr(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var kr=wr.prototype=_r.prototype;function Mr(t){return function(){return t}}function Ar(t){return 1e-6*(t()-.5)}function $r(t){return t.x+t.vx}function Sr(t){return t.y+t.vy}function Nr(t){return t.index}function zr(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Er(t){var e,n,r,i,o,a,s=Nr,l=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},c=Mr(30),u=1;function h(r){for(var i=0,s=t.length;i<u;++i)for(var l,c,h,f,d,p,g,y=0;y<s;++y)c=(l=t[y]).source,f=(h=l.target).x+h.vx-c.x-c.vx||Ar(a),d=h.y+h.vy-c.y-c.vy||Ar(a),f*=p=((p=Math.sqrt(f*f+d*d))-n[y])/p*r*e[y],d*=p,h.vx-=f*(g=o[y]),h.vy-=d*g,c.vx+=f*(g=1-g),c.vy+=d*g}function f(){if(r){var a,l,c=r.length,u=t.length,h=new Map(r.map((t,e)=>[s(t,e,r),t]));for(a=0,i=new Array(c);a<u;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=zr(h,l.source)),"object"!=typeof l.target&&(l.target=zr(h,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(a=0,o=new Array(u);a<u;++a)l=t[a],o[a]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);e=new Array(u),d(),n=new Array(u),p()}}function d(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+l(t[n],n,t)}function p(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){r=t,a=e,f()},h.links=function(e){return arguments.length?(t=e,f(),h):t},h.id=function(t){return arguments.length?(s=t,h):s},h.iterations=function(t){return arguments.length?(u=+t,h):u},h.strength=function(t){return arguments.length?(l="function"==typeof t?t:Mr(+t),d(),h):l},h.distance=function(t){return arguments.length?(c="function"==typeof t?t:Mr(+t),p(),h):c},h}kr.copy=function(){var t,e,n=new _r(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Fr(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=Fr(e));return n},kr.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return mr(this.cover(e,n),e,n,t)},kr.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),l=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<l&&(l=r),r>u&&(u=r),i<c&&(c=i),i>h&&(h=i));if(l>u||c>h)return this;for(this.cover(l,c).cover(u,h),n=0;n<o;++n)mr(this,a[n],s[n],t[n]);return this},kr.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,l=i-n||1,c=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=c,c=a,l*=2,s){case 0:i=n+l,o=r+l;break;case 1:n=i-l,o=r+l;break;case 2:i=n+l,r=o-l;break;case 3:n=i-l,r=o-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},kr.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},kr.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},kr.find=function(t,e,n){var r,i,o,a,s,l,c,u=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new xr(g,u,h,f,d)),null==n?n=1/0:(u=t-n,h=e-n,f=t+n,d=e+n,n*=n);l=p.pop();)if(!(!(g=l.node)||(i=l.x0)>f||(o=l.y0)>d||(a=l.x1)<u||(s=l.y1)<h))if(g.length){var y=(i+a)/2,m=(o+s)/2;p.push(new xr(g[3],y,m,a,s),new xr(g[2],i,m,y,s),new xr(g[1],y,o,a,m),new xr(g[0],i,o,y,m)),(c=(e>=m)<<1|t>=y)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=l)}else{var x=t-+this._x.call(null,g.data),v=e-+this._y.call(null,g.data),b=x*x+v*v;if(b<n){var w=Math.sqrt(n=b);u=t-w,h=e-w,f=t+w,d=e+w,r=g.data}}return r},kr.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,l,c,u,h,f,d=this._root,p=this._x0,g=this._y0,y=this._x1,m=this._y1;if(!d)return this;if(d.length)for(;;){if((c=o>=(s=(p+y)/2))?p=s:y=s,(u=a>=(l=(g+m)/2))?g=l:m=l,e=d,!(d=d[h=u<<1|c]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=i,this)},kr.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},kr.root=function(){return this._root},kr.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},kr.visit=function(t){var e,n,r,i,o,a,s=[],l=this._root;for(l&&s.push(new xr(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&l.length){var c=(r+o)/2,u=(i+a)/2;(n=l[3])&&s.push(new xr(n,c,u,o,a)),(n=l[2])&&s.push(new xr(n,r,u,c,a)),(n=l[1])&&s.push(new xr(n,c,i,o,u)),(n=l[0])&&s.push(new xr(n,r,i,c,u))}return this},kr.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new xr(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,l=e.x1,c=e.y1,u=(a+l)/2,h=(s+c)/2;(o=i[0])&&n.push(new xr(o,a,s,u,h)),(o=i[1])&&n.push(new xr(o,u,s,l,h)),(o=i[2])&&n.push(new xr(o,a,h,u,c)),(o=i[3])&&n.push(new xr(o,u,h,l,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},kr.x=function(t){return arguments.length?(this._x=t,this):this._x},kr.y=function(t){return arguments.length?(this._y=t,this):this._y};const Tr=4294967296;function Cr(t){return t.x}function Pr(t){return t.y}var Ir=Math.PI*(3-Math.sqrt(5));function Lr(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,l=Nn(h),c=C("tick","end"),u=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Tr)/Tr}();function h(){f(),c.call("tick",e),n<r&&(l.stop(),c.call("end",e))}function f(r){var l,c,u=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(o-n)*i,s.forEach(function(t){t(n)}),l=0;l<u;++l)null==(c=t[l]).fx?c.x+=c.vx*=a:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=a:(c.y=c.fy,c.vy=0);return e}function d(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(.5+n),o=n*Ir;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),d(),e={tick:f,restart:function(){return l.restart(h),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(u=t,s.forEach(p),e):u},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,l,c=0,u=t.length;for(null==r?r=1/0:r*=r,c=0;c<u;++c)(a=(i=e-(s=t[c]).x)*i+(o=n-s.y)*o)<r&&(l=s,r=a);return l},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}}function qr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Br(t){return(t=qr(Math.abs(t)))?t[1]:NaN}var Or,jr=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Rr(t){if(!(e=jr.exec(t)))throw new Error("invalid format: "+t);var e;return new Gr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Gr(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Hr(t,e){var n=qr(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Rr.prototype=Gr.prototype,Gr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Dr={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Hr(100*t,e),r:Hr,s:function(t,e){var n=qr(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Or=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+qr(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Vr(t){return t}var Xr,Yr,Wr,Ur=Array.prototype.map,Jr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Kr(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Vr:(e=Ur.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),o.push(t.substring(i-=s,i+s)),!((l+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Vr:function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(Ur.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=Rr(t)).fill,n=t.align,h=t.sign,f=t.symbol,d=t.zero,p=t.width,g=t.comma,y=t.precision,m=t.trim,x=t.type;"n"===x?(g=!0,x="g"):Dr[x]||(void 0===y&&(y=12),m=!0,x="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var v="$"===f?i:"#"===f&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",b="$"===f?o:/[%p]/.test(x)?l:"",w=Dr[x],_=/[defgprs%]/.test(x);function F(t){var i,o,l,f=v,F=b;if("c"===x)F=w(t)+F,t="";else{var k=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:w(Math.abs(t),y),m&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),k&&0===+t&&"+"!==h&&(k=!1),f=(k?"("===h?h:c:"-"===h||"("===h?"":h)+f,F=("s"===x?Jr[8+Or/3]:"")+F+(k&&"("===h?")":""),_)for(i=-1,o=t.length;++i<o;)if(48>(l=t.charCodeAt(i))||l>57){F=(46===l?a+t.slice(i+1):t.slice(i))+F,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var M=f.length+t.length+F.length,A=M<p?new Array(p-M+1).join(e):"";switch(g&&d&&(t=r(A+t,A.length?p-F.length:1/0),A=""),n){case"<":t=f+t+F+A;break;case"=":t=f+A+t+F;break;case"^":t=A.slice(0,M=A.length>>1)+f+t+F+A.slice(M);break;default:t=A+f+t+F}return s(t)}return y=void 0===y?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),F.toString=function(){return t+""},F}return{format:h,formatPrefix:function(t,e){var n=h(((t=Rr(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Br(e)/3))),i=Math.pow(10,-r),o=Jr[8+r/3];return function(t){return n(i*t)+o}}}}Xr=Kr({thousands:",",grouping:[3],currency:["$",""]}),Yr=Xr.format,Wr=Xr.formatPrefix;var Zr=1e-6,Qr=Math.PI,ti=2*Qr,ei=180/Qr,ni=Qr/180,ri=Math.abs,ii=Math.cos,oi=Math.sin,ai=Math.sqrt;function si(){}function li(t,e){t&&ui.hasOwnProperty(t.type)&&ui[t.type](t,e)}var ci={Feature:function(t,e){li(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)li(n[r].geometry,e)}},ui={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){hi(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hi(n[r],e,0)},Polygon:function(t,e){fi(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)fi(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)li(n[r],e)}};function hi(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function fi(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)hi(t[n],e,1);e.polygonEnd()}function di(t,e){t&&ci.hasOwnProperty(t.type)?ci[t.type](t,e):li(t,e)}function pi(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function gi(t,e,n,r,i){var o,a,s=[],l=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,r,a,c=t[0],u=t[e];if(a=u,ri((r=c)[0]-a[0])<Zr&&ri(r[1]-a[1])<Zr){if(!c[2]&&!u[2]){for(i.lineStart(),o=0;o<e;++o)i.point((c=t[o])[0],c[1]);return void i.lineEnd()}u[0]+=2e-6}s.push(n=new pi(c,t,null,!0)),l.push(n.o=new pi(c,null,n,!1)),s.push(n=new pi(u,t,null,!1)),l.push(n.o=new pi(u,null,n,!0))}}),s.length){for(l.sort(e),yi(s),yi(l),o=0,a=l.length;o<a;++o)l[o].e=n=!n;for(var c,u,h=s[0];;){for(var f=h,d=!0;f.v;)if((f=f.n)===h)return;c=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(o=0,a=c.length;o<a;++o)i.point((u=c[o])[0],u[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(d)for(c=f.p.z,o=c.length-1;o>=0;--o)i.point((u=c[o])[0],u[1]);else r(f.x,f.p.x,-1,i);f=f.p}c=(f=f.o).z,d=!d}while(!f.v);i.lineEnd()}}}function yi(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}var mi=1e9,xi=-mi;function vi(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,s,c){var u=0,h=0;if(null==i||(u=a(i,s))!==(h=a(o,s))||l(i,o)<0^s>0)do{c.point(0===u||3===u?t:n,u>1?r:e)}while((u=(u+s+4)%4)!==h);else c.point(o[0],o[1])}function a(r,i){return ri(r[0]-t)<Zr?i>0?0:3:ri(r[0]-n)<Zr?i>0?2:1:ri(r[1]-e)<Zr?i>0?1:0:i>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=a(t,1),r=a(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var l,c,u,h,f,d,p,g,y,m,x,v,b,w=a,_=(b=[],{point:function(t,e,n){v.push([t,e,n])},lineStart:function(){b.push(v=[])},lineEnd:si,rejoin:function(){b.length>1&&b.push(b.pop().concat(b.shift()))},result:function(){var t=b;return b=[],v=null,t}}),F={point:k,lineStart:function(){F.point=M,c&&c.push(u=[]);m=!0,y=!1,p=g=NaN},lineEnd:function(){l&&(M(h,f),d&&y&&_.rejoin(),l.push(_.result()));F.point=k,y&&w.lineEnd()},polygonStart:function(){w=_,l=[],c=[],x=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=c.length;n<i;++n)for(var o,a,s=c[n],l=1,u=s.length,h=s[0],f=h[0],d=h[1];l<u;++l)o=f,a=d,f=(h=s[l])[0],d=h[1],a<=r?d>r&&(f-o)*(r-a)>(d-a)*(t-o)&&++e:d<=r&&(f-o)*(r-a)<(d-a)*(t-o)&&--e;return e}(),n=x&&e,i=(h=l,l=Array.from(function*(t){for(const e of t)yield*e}(h))).length;var h;(n||i)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&gi(l,s,e,o,a),a.polygonEnd());w=a,l=c=u=null}};function k(t,e){i(t,e)&&w.point(t,e)}function M(o,a){var s=i(o,a);if(c&&u.push([o,a]),m)h=o,f=a,d=s,m=!1,s&&(w.lineStart(),w.point(o,a));else if(s&&y)w.point(o,a);else{var l=[p=Math.max(xi,Math.min(mi,p)),g=Math.max(xi,Math.min(mi,g))],v=[o=Math.max(xi,Math.min(mi,o)),a=Math.max(xi,Math.min(mi,a))];!function(t,e,n,r,i,o){var a,s=t[0],l=t[1],c=0,u=1,h=e[0]-s,f=e[1]-l;if(a=n-s,h||!(a>0)){if(a/=h,h<0){if(a<c)return;a<u&&(u=a)}else if(h>0){if(a>u)return;a>c&&(c=a)}if(a=i-s,h||!(a<0)){if(a/=h,h<0){if(a>u)return;a>c&&(c=a)}else if(h>0){if(a<c)return;a<u&&(u=a)}if(a=r-l,f||!(a>0)){if(a/=f,f<0){if(a<c)return;a<u&&(u=a)}else if(f>0){if(a>u)return;a>c&&(c=a)}if(a=o-l,f||!(a<0)){if(a/=f,f<0){if(a>u)return;a>c&&(c=a)}else if(f>0){if(a<c)return;a<u&&(u=a)}return c>0&&(t[0]=s+c*h,t[1]=l+c*f),u<1&&(e[0]=s+u*h,e[1]=l+u*f),!0}}}}}(l,v,t,e,n,r)?s&&(w.lineStart(),w.point(o,a),x=!1):(y||(w.lineStart(),w.point(l[0],l[1])),w.point(v[0],v[1]),s||w.lineEnd(),x=!1)}p=o,g=a,y=s}return F}}const bi=t=>t;var wi,_i,Fi,ki,Mi=new s,Ai=new s,$i={point:si,lineStart:si,lineEnd:si,polygonStart:function(){$i.lineStart=Si,$i.lineEnd=Ei},polygonEnd:function(){$i.lineStart=$i.lineEnd=$i.point=si,Mi.add(ri(Ai)),Ai=new s},result:function(){var t=Mi/2;return Mi=new s,t}};function Si(){$i.point=Ni}function Ni(t,e){$i.point=zi,wi=Fi=t,_i=ki=e}function zi(t,e){Ai.add(ki*t-Fi*e),Fi=t,ki=e}function Ei(){zi(wi,_i)}var Ti=1/0,Ci=Ti,Pi=-Ti,Ii=Pi,Li={point:function(t,e){t<Ti&&(Ti=t);t>Pi&&(Pi=t);e<Ci&&(Ci=e);e>Ii&&(Ii=e)},lineStart:si,lineEnd:si,polygonStart:si,polygonEnd:si,result:function(){var t=[[Ti,Ci],[Pi,Ii]];return Pi=Ii=-(Ci=Ti=1/0),t}};var qi,Bi,Oi,ji,Ri=0,Gi=0,Hi=0,Di=0,Vi=0,Xi=0,Yi=0,Wi=0,Ui=0,Ji={point:Ki,lineStart:Zi,lineEnd:eo,polygonStart:function(){Ji.lineStart=no,Ji.lineEnd=ro},polygonEnd:function(){Ji.point=Ki,Ji.lineStart=Zi,Ji.lineEnd=eo},result:function(){var t=Ui?[Yi/Ui,Wi/Ui]:Xi?[Di/Xi,Vi/Xi]:Hi?[Ri/Hi,Gi/Hi]:[NaN,NaN];return Ri=Gi=Hi=Di=Vi=Xi=Yi=Wi=Ui=0,t}};function Ki(t,e){Ri+=t,Gi+=e,++Hi}function Zi(){Ji.point=Qi}function Qi(t,e){Ji.point=to,Ki(Oi=t,ji=e)}function to(t,e){var n=t-Oi,r=e-ji,i=ai(n*n+r*r);Di+=i*(Oi+t)/2,Vi+=i*(ji+e)/2,Xi+=i,Ki(Oi=t,ji=e)}function eo(){Ji.point=Ki}function no(){Ji.point=io}function ro(){oo(qi,Bi)}function io(t,e){Ji.point=oo,Ki(qi=Oi=t,Bi=ji=e)}function oo(t,e){var n=t-Oi,r=e-ji,i=ai(n*n+r*r);Di+=i*(Oi+t)/2,Vi+=i*(ji+e)/2,Xi+=i,Yi+=(i=ji*t-Oi*e)*(Oi+t),Wi+=i*(ji+e),Ui+=3*i,Ki(Oi=t,ji=e)}function ao(t){this._context=t}ao.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,ti)}},result:si};var so,lo,co,uo,ho,fo=new s,po={point:si,lineStart:function(){po.point=go},lineEnd:function(){so&&yo(lo,co),po.point=si},polygonStart:function(){so=!0},polygonEnd:function(){so=null},result:function(){var t=+fo;return fo=new s,t}};function go(t,e){po.point=yo,lo=uo=t,co=ho=e}function yo(t,e){uo-=t,ho-=e,fo.add(ai(uo*uo+ho*ho)),uo=t,ho=e}let mo,xo,vo,bo;class wo{constructor(t){this._append=null==t?_o:function(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return _o;if(e!==mo){const t=10**e;mo=e,xo=function(e){let n=1;this._+=e[0];for(const r=e.length;n<r;++n)this._+=Math.round(arguments[n]*t)/t+e[n]}}return xo}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:this._append`M${t},${e}`,this._point=1;break;case 1:this._append`L${t},${e}`;break;default:if(this._append`M${t},${e}`,this._radius!==vo||this._append!==xo){const t=this._radius,e=this._;this._="",this._append`m0,${t}a${t},${t} 0 1,1 0,${-2*t}a${t},${t} 0 1,1 0,${2*t}z`,vo=t,xo=this._append,bo=this._,this._=e}this._+=bo}}result(){const t=this._;return this._="",t.length?t:null}}function _o(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Fo(t,e){let n,r,i=3,o=4.5;function a(t){return t&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),di(t,n(r))),r.result()}return a.area=function(t){return di(t,n($i)),$i.result()},a.measure=function(t){return di(t,n(po)),po.result()},a.bounds=function(t){return di(t,n(Li)),Li.result()},a.centroid=function(t){return di(t,n(Ji)),Ji.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,bi):(t=e).stream,a):t},a.context=function(t){return arguments.length?(r=null==t?(e=null,new wo(i)):new ao(e=t),"function"!=typeof o&&r.pointRadius(o),a):e},a.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(r.pointRadius(+t),+t),a):o},a.digits=function(t){if(!arguments.length)return i;if(null==t)i=null;else{const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);i=e}return null===e&&(r=new wo(i)),a},a.projection(t).digits(i).context(e)}function ko(){}function Mo(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),di(n,t.stream(Li)),e(Li.result()),null!=r&&t.clipExtent(r),t}function Ao(t,e,n){return Mo(t,function(n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),a=+e[0][0]+(r-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(i-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])},n)}function $o(){var t,e,n,r,i,o,a,s,l=1,c=0,u=0,h=1,f=1,d=0,p=null,g=1,y=1,m=(s={point:function(t,e){var n=b([t,e]);this.stream.point(n[0],n[1])}},function(t){var e=new ko;for(var n in s)e[n]=s[n];return e.stream=t,e}),x=bi;function v(){return g=l*h,y=l*f,o=a=null,b}function b(n){var r=n[0]*g,i=n[1]*y;if(d){var o=i*t-r*e;r=r*t+i*e,i=o}return[r+c,i+u]}return b.invert=function(n){var r=n[0]-c,i=n[1]-u;if(d){var o=i*t+r*e;r=r*t-i*e,i=o}return[r/g,i/y]},b.stream=function(t){return o&&a===t?o:o=m(x(a=t))},b.postclip=function(t){return arguments.length?(x=t,p=n=r=i=null,v()):x},b.clipExtent=function(t){return arguments.length?(x=null==t?(p=n=r=i=null,bi):vi(p=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),v()):null==p?null:[[p,n],[r,i]]},b.scale=function(t){return arguments.length?(l=+t,v()):l},b.translate=function(t){return arguments.length?(c=+t[0],u=+t[1],v()):[c,u]},b.angle=function(n){return arguments.length?(e=oi(d=n%360*ni),t=ii(d),v()):d*ei},b.reflectX=function(t){return arguments.length?(h=t?-1:1,v()):h<0},b.reflectY=function(t){return arguments.length?(f=t?-1:1,v()):f<0},b.fitExtent=function(t,e){return Ao(b,t,e)},b.fitSize=function(t,e){return function(t,e,n){return Ao(t,[[0,0],e],n)}(b,t,e)},b.fitWidth=function(t,e){return function(t,e,n){return Mo(t,function(n){var r=+e,i=r/(n[1][0]-n[0][0]),o=(r-i*(n[1][0]+n[0][0]))/2,a=-i*n[0][1];t.scale(150*i).translate([o,a])},n)}(b,t,e)},b.fitHeight=function(t,e){return function(t,e,n){return Mo(t,function(n){var r=+e,i=r/(n[1][1]-n[0][1]),o=-i*n[0][0],a=(r-i*(n[1][1]+n[0][1]))/2;t.scale(150*i).translate([o,a])},n)}(b,t,e)},b}function So(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function No(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Eo)):void 0===e&&(e=zo);for(var n,r,i,o,a,s=new Po(t),l=[s];n=l.pop();)if((i=e(n.data))&&(a=(i=Array.from(i)).length))for(n.children=i,o=a-1;o>=0;--o)l.push(r=i[o]=new Po(i[o])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(Co)}function zo(t){return t.children}function Eo(t){return Array.isArray(t)?t[1]:null}function To(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Co(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Po(t){this.data=t,this.depth=this.height=0,this.parent=null}function Io(){return 0}function Lo(t){return function(){return t}}function qo(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function Bo(t,e,n,r,i){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(r-e)/t.value;++s<l;)(o=a[s]).y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*c}function Oo(t,e,n,r,i){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(i-n)/t.value;++s<l;)(o=a[s]).x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*c}ko.prototype={constructor:ko,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Po.prototype=No.prototype={constructor:Po,count:function(){return this.eachAfter(So)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,i,o=this,a=[o],s=[],l=-1;o=a.pop();)if(s.push(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r]);for(;o=s.pop();)t.call(e,o,++l,this);return this},eachBefore:function(t,e){for(var n,r,i=this,o=[i],a=-1;i=o.pop();)if(t.call(e,i,++a,this),n=i.children)for(r=n.length-1;r>=0;--r)o.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;t=n.pop(),e=r.pop();for(;t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e},copy:function(){return No(this).eachBefore(To)},[Symbol.iterator]:function*(){var t,e,n,r,i=this,o=[i];do{for(t=o.reverse(),o=[];i=t.pop();)if(yield i,e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n])}while(o.length)}};const jo=function t(e){function n(t,n,r,i,o){!function(t,e,n,r,i,o){for(var a,s,l,c,u,h,f,d,p,g,y,m=[],x=e.children,v=0,b=0,w=x.length,_=e.value;v<w;){l=i-n,c=o-r;do{u=x[b++].value}while(!u&&b<w);for(h=f=u,y=u*u*(g=Math.max(c/l,l/c)/(_*t)),p=Math.max(f/y,y/h);b<w;++b){if(u+=s=x[b].value,s<h&&(h=s),s>f&&(f=s),y=u*u*g,(d=Math.max(f/y,y/h))>p){u-=s;break}p=d}m.push(a={value:u,dice:l<c,children:x.slice(v,b)}),a.dice?Bo(a,n,r,i,_?r+=c*u/_:o):Oo(a,n,r,_?n+=l*u/_:i,o),_-=u,v=b}}(e,t,n,r,i,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}((1+Math.sqrt(5))/2);function Ro(){var t=jo,e=!1,n=1,r=1,i=[0],o=Io,a=Io,s=Io,l=Io,c=Io;function u(t){return t.x0=t.y0=0,t.x1=n,t.y1=r,t.eachBefore(h),i=[0],e&&t.eachBefore(qo),t}function h(e){var n=i[e.depth],r=e.x0+n,u=e.y0+n,h=e.x1-n,f=e.y1-n;h<r&&(r=h=(r+h)/2),f<u&&(u=f=(u+f)/2),e.x0=r,e.y0=u,e.x1=h,e.y1=f,e.children&&(n=i[e.depth+1]=o(e)/2,r+=c(e)-n,u+=a(e)-n,(h-=s(e)-n)<r&&(r=h=(r+h)/2),(f-=l(e)-n)<u&&(u=f=(u+f)/2),t(e,r,u,h,f))}return u.round=function(t){return arguments.length?(e=!!t,u):e},u.size=function(t){return arguments.length?(n=+t[0],r=+t[1],u):[n,r]},u.tile=function(e){return arguments.length?(t=function(t){if("function"!=typeof t)throw new Error;return t}(e),u):t},u.padding=function(t){return arguments.length?u.paddingInner(t).paddingOuter(t):u.paddingInner()},u.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:Lo(+t),u):o},u.paddingOuter=function(t){return arguments.length?u.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):u.paddingTop()},u.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:Lo(+t),u):a},u.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:Lo(+t),u):s},u.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:Lo(+t),u):l},u.paddingLeft=function(t){return arguments.length?(c="function"==typeof t?t:Lo(+t),u):c},u}function Go(t,e,n,r,i){(1&t.depth?Oo:Bo)(t,e,n,r,i)}function Ho(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Do(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const Vo=Symbol("implicit");function Xo(){var t=new l,e=[],n=[],r=Vo;function i(i){let o=t.get(i);if(void 0===o){if(r!==Vo)return r;t.set(i,o=e.push(i)-1)}return n[o%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new l;for(const r of n)t.has(r)||t.set(r,e.push(r)-1);return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return Xo(e,n).unknown(r)},Ho.apply(i,arguments),i}function Yo(){var t,e,n=Xo().unknown(void 0),r=n.domain,i=n.range,o=0,a=1,s=!1,l=0,c=0,u=.5;function h(){var n=r().length,h=a<o,f=h?a:o,d=h?o:a;t=(d-f)/Math.max(1,n-l+2*c),s&&(t=Math.floor(t)),f+=(d-f-t*(n-l))*u,e=t*(1-l),s&&(f=Math.round(f),e=Math.round(e));var p=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}(n).map(function(e){return f+t*e});return i(h?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),h()):r()},n.range=function(t){return arguments.length?([o,a]=t,o=+o,a=+a,h()):[o,a]},n.rangeRound=function(t){return[o,a]=t,o=+o,a=+a,s=!0,h()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(s=!!t,h()):s},n.padding=function(t){return arguments.length?(l=Math.min(1,c=+t),h()):l},n.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),h()):l},n.paddingOuter=function(t){return arguments.length?(c=+t,h()):c},n.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),h()):u},n.copy=function(){return Yo(r(),[o,a]).round(s).paddingInner(l).paddingOuter(c).align(u)},Ho.apply(h(),arguments)}function Wo(t){return+t}var Uo=[0,1];function Jo(t){return t}function Ko(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Zo(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Ko(i,r),o=n(a,o)):(r=Ko(r,i),o=n(o,a)),function(t){return o(r(t))}}function Qo(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)i[s]=Ko(t[s],t[s+1]),a[s]=n(e[s],e[s+1]);return function(e){var n=o(t,e,1,r)-1;return a[n](i[n](e))}}function ta(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ea(){var t,e,n,r,i,o,a=Uo,s=Uo,l=on,c=Jo;function u(){var t,e,n,l=Math.min(a.length,s.length);return c!==Jo&&(t=a[0],e=a[l-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),r=l>2?Qo:Zo,i=o=null,h}function h(e){return null==e||isNaN(e=+e)?n:(i||(i=r(a.map(t),s,l)))(t(c(e)))}return h.invert=function(n){return c(e((o||(o=r(s,a.map(t),Qe)))(n)))},h.domain=function(t){return arguments.length?(a=Array.from(t,Wo),u()):a.slice()},h.range=function(t){return arguments.length?(s=Array.from(t),u()):s.slice()},h.rangeRound=function(t){return s=Array.from(t),l=an,u()},h.clamp=function(t){return arguments.length?(c=!!t||Jo,u()):c!==Jo},h.interpolate=function(t){return arguments.length?(l=t,u()):l},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,u()}}function na(t,e,n,r){var i,o=function(t,e,n){n=+n;const r=(e=+e)<(t=+t),i=r?m(e,t,n):m(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}(t,e,n);switch((r=Rr(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Br(e)/3)))-Br(Math.abs(t)))}(o,a))||(r.precision=i),Wr(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Br(e)-Br(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-Br(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return Yr(r)}function ra(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const r=e<t,[i,o,a]=r?y(e,t,n):y(t,e,n);if(!(o>=i))return[];const s=o-i+1,l=new Array(s);if(r)if(a<0)for(let c=0;c<s;++c)l[c]=(o-c)/-a;else for(let c=0;c<s;++c)l[c]=(o-c)*a;else if(a<0)for(let c=0;c<s;++c)l[c]=(i+c)/-a;else for(let c=0;c<s;++c)l[c]=(i+c)*a;return l}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return na(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),a=0,s=o.length-1,l=o[a],c=o[s],u=10;for(c<l&&(i=l,l=c,c=i,i=a,a=s,s=i);u-- >0;){if((i=m(l,c,n))===r)return o[a]=l,o[s]=c,e(o);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}r=i}return t},t}function ia(){var t=ea()(Jo,Jo);return t.copy=function(){return ta(t,ia())},Ho.apply(t,arguments),ra(t)}function oa(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function aa(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function sa(t){return t<0?-t*t:t*t}function la(t){var e=t(Jo,Jo),n=1;return e.exponent=function(e){return arguments.length?1===(n=+e)?t(Jo,Jo):.5===n?t(aa,sa):t(oa(n),oa(1/n)):n},ra(e)}function ca(){var t=la(ea());return t.copy=function(){return ta(t,ca()).exponent(t.exponent())},Ho.apply(t,arguments),t}function ua(){return ca.apply(null,arguments).exponent(.5)}function ha(){var e,n=[],r=[],i=[];function a(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=b(n,t/e);return s}function s(t){return null==t||isNaN(t=+t)?e:r[o(i,t)]}return s.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},s.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(t),a()},s.range=function(t){return arguments.length?(r=Array.from(t),a()):r.slice()},s.unknown=function(t){return arguments.length?(e=t,s):e},s.quantiles=function(){return i.slice()},s.copy=function(){return ha().domain(n).range(r).unknown(e)},Ho.apply(s,arguments)}function fa(){var t=ra(function(){var t,e,n,r,i,o=0,a=1,s=Jo,l=!1;function c(e){return null==e||isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,l?Math.max(0,Math.min(1,e)):e))}function u(t){return function(e){var n,r;return arguments.length?([n,r]=e,s=t(n,r),c):[s(0),s(1)]}}return c.domain=function(i){return arguments.length?([o,a]=i,t=r(o=+o),e=r(a=+a),n=t===e?0:1/(e-t),c):[o,a]},c.clamp=function(t){return arguments.length?(l=!!t,c):l},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.range=u(on),c.rangeRound=u(an),c.unknown=function(t){return arguments.length?(i=t,c):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),c}}()(Jo));return t.copy=function(){return e=t,fa().domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown());var e},Do.apply(t,arguments)}function da(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}const pa=da("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ga(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const ya=ga(da("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));function ma(t){return function(){return t}}ga(da("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ga(da("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ga(da("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const xa=Math.abs,va=Math.atan2,ba=Math.cos,wa=Math.max,_a=Math.min,Fa=Math.sin,ka=Math.sqrt,Ma=1e-12,Aa=Math.PI,$a=Aa/2,Sa=2*Aa;function Na(t){return t>=1?$a:t<=-1?-$a:Math.asin(t)}function za(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new yr(e)}function Ea(t){return t.innerRadius}function Ta(t){return t.outerRadius}function Ca(t){return t.startAngle}function Pa(t){return t.endAngle}function Ia(t){return t&&t.padAngle}function La(t,e,n,r,i,o,a){var s=t-n,l=e-r,c=(a?o:-o)/ka(s*s+l*l),u=c*l,h=-c*s,f=t+u,d=e+h,p=n+u,g=r+h,y=(f+p)/2,m=(d+g)/2,x=p-f,v=g-d,b=x*x+v*v,w=i-o,_=f*g-p*d,F=(v<0?-1:1)*ka(wa(0,w*w*b-_*_)),k=(_*v-x*F)/b,M=(-_*x-v*F)/b,A=(_*v+x*F)/b,$=(-_*x+v*F)/b,S=k-y,N=M-m,z=A-y,E=$-m;return S*S+N*N>z*z+E*E&&(k=A,M=$),{cx:k,cy:M,x01:-u,y01:-h,x11:k*(i/w-1),y11:M*(i/w-1)}}function qa(){var t=Ea,e=Ta,n=ma(0),r=null,i=Ca,o=Pa,a=Ia,s=null,l=za(c);function c(){var c,u,h,f=+t.apply(this,arguments),d=+e.apply(this,arguments),p=i.apply(this,arguments)-$a,g=o.apply(this,arguments)-$a,y=xa(g-p),m=g>p;if(s||(s=c=l()),d<f&&(u=d,d=f,f=u),d>Ma)if(y>Sa-Ma)s.moveTo(d*ba(p),d*Fa(p)),s.arc(0,0,d,p,g,!m),f>Ma&&(s.moveTo(f*ba(g),f*Fa(g)),s.arc(0,0,f,g,p,m));else{var x,v,b=p,w=g,_=p,F=g,k=y,M=y,A=a.apply(this,arguments)/2,$=A>Ma&&(r?+r.apply(this,arguments):ka(f*f+d*d)),S=_a(xa(d-f)/2,+n.apply(this,arguments)),N=S,z=S;if($>Ma){var E=Na($/f*Fa(A)),T=Na($/d*Fa(A));(k-=2*E)>Ma?(_+=E*=m?1:-1,F-=E):(k=0,_=F=(p+g)/2),(M-=2*T)>Ma?(b+=T*=m?1:-1,w-=T):(M=0,b=w=(p+g)/2)}var C=d*ba(b),P=d*Fa(b),I=f*ba(F),L=f*Fa(F);if(S>Ma){var q,B=d*ba(w),O=d*Fa(w),j=f*ba(_),R=f*Fa(_);if(y<Aa)if(q=function(t,e,n,r,i,o,a,s){var l=n-t,c=r-e,u=a-i,h=s-o,f=h*l-u*c;if(!(f*f<Ma))return[t+(f=(u*(e-o)-h*(t-i))/f)*l,e+f*c]}(C,P,j,R,B,O,I,L)){var G=C-q[0],H=P-q[1],D=B-q[0],V=O-q[1],X=1/Fa(((h=(G*D+H*V)/(ka(G*G+H*H)*ka(D*D+V*V)))>1?0:h<-1?Aa:Math.acos(h))/2),Y=ka(q[0]*q[0]+q[1]*q[1]);N=_a(S,(f-Y)/(X-1)),z=_a(S,(d-Y)/(X+1))}else N=z=0}M>Ma?z>Ma?(x=La(j,R,C,P,d,z,m),v=La(B,O,I,L,d,z,m),s.moveTo(x.cx+x.x01,x.cy+x.y01),z<S?s.arc(x.cx,x.cy,z,va(x.y01,x.x01),va(v.y01,v.x01),!m):(s.arc(x.cx,x.cy,z,va(x.y01,x.x01),va(x.y11,x.x11),!m),s.arc(0,0,d,va(x.cy+x.y11,x.cx+x.x11),va(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,z,va(v.y11,v.x11),va(v.y01,v.x01),!m))):(s.moveTo(C,P),s.arc(0,0,d,b,w,!m)):s.moveTo(C,P),f>Ma&&k>Ma?N>Ma?(x=La(I,L,B,O,f,-N,m),v=La(C,P,j,R,f,-N,m),s.lineTo(x.cx+x.x01,x.cy+x.y01),N<S?s.arc(x.cx,x.cy,N,va(x.y01,x.x01),va(v.y01,v.x01),!m):(s.arc(x.cx,x.cy,N,va(x.y01,x.x01),va(x.y11,x.x11),!m),s.arc(0,0,f,va(x.cy+x.y11,x.cx+x.x11),va(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,N,va(v.y11,v.x11),va(v.y01,v.x01),!m))):s.arc(0,0,f,F,_,m):s.lineTo(I,L)}else s.moveTo(0,0);if(s.closePath(),c)return s=null,c+""||null}return c.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Aa/2;return[ba(r)*n,Fa(r)*n]},c.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),c):t},c.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),c):e},c.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:ma(+t),c):n},c.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:ma(+t),c):r},c.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:ma(+t),c):i},c.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:ma(+t),c):o},c.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:ma(+t),c):a},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}function Ba(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Oa(t){this._context=t}function ja(t){return new Oa(t)}function Ra(t){return t[0]}function Ga(t){return t[1]}function Ha(t,e){var n=ma(!0),r=null,i=ja,o=null,a=za(s);function s(s){var l,c,u,h=(s=Ba(s)).length,f=!1;for(null==r&&(o=i(u=a())),l=0;l<=h;++l)!(l<h&&n(c=s[l],l,s))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+t(c,l,s),+e(c,l,s));if(u)return o=null,u+""||null}return t="function"==typeof t?t:void 0===t?Ra:ma(t),e="function"==typeof e?e:void 0===e?Ga:ma(e),s.x=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),s):t},s.y=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),s):e},s.defined=function(t){return arguments.length?(n="function"==typeof t?t:ma(!!t),s):n},s.curve=function(t){return arguments.length?(i=t,null!=r&&(o=i(r)),s):i},s.context=function(t){return arguments.length?(null==t?r=o=null:o=i(r=t),s):r},s}function Da(t,e,n){var r=null,i=ma(!0),o=null,a=ja,s=null,l=za(c);function c(c){var u,h,f,d,p,g=(c=Ba(c)).length,y=!1,m=new Array(g),x=new Array(g);for(null==o&&(s=a(p=l())),u=0;u<=g;++u){if(!(u<g&&i(d=c[u],u,c))===y)if(y=!y)h=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=u-1;f>=h;--f)s.point(m[f],x[f]);s.lineEnd(),s.areaEnd()}y&&(m[u]=+t(d,u,c),x[u]=+e(d,u,c),s.point(r?+r(d,u,c):m[u],n?+n(d,u,c):x[u]))}if(p)return s=null,p+""||null}function u(){return Ha().defined(i).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?Ra:ma(+t),e="function"==typeof e?e:ma(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?Ga:ma(+n),c.x=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),r=null,c):t},c.x0=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),c):t},c.x1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:ma(+t),c):r},c.y=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),n=null,c):e},c.y0=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),c):e},c.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:ma(+t),c):n},c.lineX0=c.lineY0=function(){return u().x(t).y(e)},c.lineY1=function(){return u().x(t).y(n)},c.lineX1=function(){return u().x(r).y(e)},c.defined=function(t){return arguments.length?(i="function"==typeof t?t:ma(!!t),c):i},c.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),c):a},c.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),c):o},c}function Va(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function Xa(t){return t}function Ya(t,e){if((i=t.length)>1)for(var n,r,i,o=1,a=t[e[0]],s=a.length;o<i;++o)for(r=a,a=t[e[o]],n=0;n<s;++n)a[n][1]+=a[n][0]=isNaN(r[n][1])?r[n][0]:r[n][1]}function Wa(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function Ua(t,e){return t[e]}function Ja(t){const e=[];return e.key=t,e}function Ka(){var t=ma([]),e=Wa,n=Ya,r=Ua;function i(i){var o,a,s=Array.from(t.apply(this,arguments),Ja),l=s.length,c=-1;for(const t of i)for(o=0,++c;o<l;++o)(s[o][c]=[0,+r(t,s[o].key,c,i)]).data=t;for(o=0,a=Ba(e(s));o<l;++o)s[a[o]].index=o;return n(s,a),s}return i.keys=function(e){return arguments.length?(t="function"==typeof e?e:ma(Array.from(e)),i):t},i.value=function(t){return arguments.length?(r="function"==typeof t?t:ma(+t),i):r},i.order=function(t){return arguments.length?(e=null==t?Wa:"function"==typeof t?t:ma(Array.from(t)),i):e},i.offset=function(t){return arguments.length?(n=null==t?Ya:t,i):n},i}Oa.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const Za=t=>()=>t;function Qa(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function ts(t,e,n){this.k=t,this.x=e,this.y=n}ts.prototype={constructor:ts,scale:function(t){return 1===t?this:new ts(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new ts(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var es=new ts(1,0,0);function ns(t){t.stopImmediatePropagation()}function rs(t){t.preventDefault(),t.stopImmediatePropagation()}function is(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function os(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function as(){return this.__zoom||es}function ss(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ls(){return navigator.maxTouchPoints||"ontouchstart"in this}function cs(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function us(){var t,e,n,r=is,i=os,o=cs,a=ss,s=ls,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=gn,f=C("start","zoom","end"),d=0,p=10;function g(t){t.property("__zoom",as).on("wheel.zoom",_,{passive:!1}).on("mousedown.zoom",F).on("dblclick.zoom",k).filter(s).on("touchstart.zoom",M).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new ts(e,t.x,t.y)}function m(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new ts(t.k,r,i)}function x(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function v(t,e,n,r){t.on("start.zoom",function(){b(this,arguments).event(r).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(r).end()}).tween("zoom",function(){var t=this,o=arguments,a=b(t,o).event(r),s=i.apply(t,o),l=null==n?x(s):"function"==typeof n?n.apply(t,o):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=t.__zoom,f="function"==typeof e?e.apply(t,o):e,d=h(u.invert(l).concat(c/u.k),f.invert(l).concat(c/f.k));return function(t){if(1===t)t=f;else{var e=d(t),n=c/e[2];t=new ts(n,l[0]-e[0]*n,l[1]-e[1]*n)}a.zoom(null,t)}})}function b(t,e,n){return!n&&t.__zooming||new w(t,e)}function w(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function _(t,...e){if(r.apply(this,arguments)){var n=b(this,e).event(t),i=this.__zoom,s=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,a.apply(this,arguments)))),u=Jt(t);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=i.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[u,i.invert(u)],jn(this),n.start()}rs(t),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",o(m(y(i,s),n.mouse[0],n.mouse[1]),n.extent,c))}}function F(t,...e){if(!n&&r.apply(this,arguments)){var i=t.currentTarget,a=b(this,e,!0).event(t),s=Ut(t.view).on("mousemove.zoom",function(t){if(rs(t),!a.moved){var e=t.clientX-u,n=t.clientY-h;a.moved=e*e+n*n>d}a.event(t).zoom("mouse",o(m(a.that.__zoom,a.mouse[0]=Jt(t,i),a.mouse[1]),a.extent,c))},!0).on("mouseup.zoom",function(t){s.on("mousemove.zoom mouseup.zoom",null),re(t.view,a.moved),rs(t),a.event(t).end()},!0),l=Jt(t,i),u=t.clientX,h=t.clientY;ne(t.view),ns(t),a.mouse=[l,this.__zoom.invert(l)],jn(this),a.start()}}function k(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,a=Jt(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),l=n.k*(t.shiftKey?.5:2),h=o(m(y(n,l),a,s),i.apply(this,e),c);rs(t),u>0?Ut(this).transition().duration(u).call(v,h,a,t):Ut(this).call(g.transform,h,a,t)}}function M(n,...i){if(r.apply(this,arguments)){var o,a,s,l,c=n.touches,u=c.length,h=b(this,i,n.changedTouches.length===u).event(n);for(ns(n),a=0;a<u;++a)l=[l=Jt(s=c[a],this),this.__zoom.invert(l),s.identifier],h.touch0?h.touch1||h.touch0[2]===l[2]||(h.touch1=l,h.taps=0):(h.touch0=l,o=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(h.taps<2&&(e=l[0],t=setTimeout(function(){t=null},500)),jn(this),h.start())}}function A(t,...e){if(this.__zooming){var n,r,i,a,s=b(this,e).event(t),l=t.changedTouches,u=l.length;for(rs(t),n=0;n<u;++n)i=Jt(r=l[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var h=s.touch0[0],f=s.touch0[1],d=s.touch1[0],p=s.touch1[1],g=(g=d[0]-h[0])*g+(g=d[1]-h[1])*g,x=(x=p[0]-f[0])*x+(x=p[1]-f[1])*x;r=y(r,Math.sqrt(g/x)),i=[(h[0]+d[0])/2,(h[1]+d[1])/2],a=[(f[0]+p[0])/2,(f[1]+p[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(m(r,i,a),s.extent,c))}}function $(t,...r){if(this.__zooming){var i,o,a=b(this,r).event(t),s=t.changedTouches,l=s.length;for(ns(t),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),i=0;i<l;++i)o=s[i],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=Jt(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<p)){var c=Ut(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",as),t!==i?v(t,e,n,r):i.interrupt().each(function(){b(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},g.scaleBy=function(t,e,n,r){g.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)},n,r)},g.scaleTo=function(t,e,n,r){g.transform(t,function(){var t=i.apply(this,arguments),r=this.__zoom,a=null==n?x(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),l="function"==typeof e?e.apply(this,arguments):e;return o(m(y(r,l),a,s),t,c)},n,r)},g.translateBy=function(t,e,n,r){g.transform(t,function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)},null,r)},g.translateTo=function(t,e,n,r,a){g.transform(t,function(){var t=i.apply(this,arguments),a=this.__zoom,s=null==r?x(t):"function"==typeof r?r.apply(this,arguments):r;return o(es.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)},r,a)},w.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Ut(this.that).datum();f.call(t,this.that,new Qa(t,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:f}),e)}},g.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Za(+t),g):a},g.filter=function(t){return arguments.length?(r="function"==typeof t?t:Za(!!t),g):r},g.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Za(!!t),g):s},g.extent=function(t){return arguments.length?(i="function"==typeof t?t:Za([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),g):i},g.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],g):[l[0],l[1]]},g.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(t){return arguments.length?(o=t,g):o},g.duration=function(t){return arguments.length?(u=+t,g):u},g.interpolate=function(t){return arguments.length?(h=t,g):h},g.on=function(){var t=f.on.apply(f,arguments);return t===f?g:t},g.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,g):Math.sqrt(d)},g.tapDistance=function(t){return arguments.length?(p=+t,g):p},g}function hs(t){if("string"!=typeof t)return t;const e=t.match(/^#([0-9a-fA-F]{8})$/);if(!e)return t;const n=e[1],r=parseInt(n.slice(0,2),16),i=parseInt(n.slice(2,4),16),o=parseInt(n.slice(4,6),16),a=parseInt(n.slice(6,8),16)/255;return`rgba(${r}, ${i}, ${o}, ${Number(a.toFixed(3))})`}function fs(t,e,n){const r=["#74c0e2","#406662","#549e95","#8abdb6","#bcd8af","#a8c380","#ede788","#d6c650","#dc8e7a","#d05555","#bf3251","#872a41","#993f7b","#7454a6","#a17cb0","#d1a1bc","#a1aafb","#5c57d9","#1c26b3","#4d6fd0","#7485aa","#d3d3d3"];if((t=>{if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=Object.keys(t);return e.length>0&&e.every(e=>"string"==typeof t[e])})(e)){const t=e,n=t=>{if(!t||"object"!=typeof t)return String(t);if(void 0!==t.group)return String(t.group);for(const e of["reporter_continent","partner_continent","continent","type","category"])if(void 0!==t[e])return String(t[e]);for(const e of Object.keys(t))if("string"==typeof t[e]||"number"==typeof t[e])return String(t[e]);return""};return e=>{const r=n(e);return t[r]?hs(t[r]):hs(Object.values(t)[0])}}const i=(t=>{if(!t)return null;if(Array.isArray(t))return t.length?t:null;if("object"==typeof t){const e=Object.values(t);return e.length?e:null}return null})(e);if(i){const e=i.length?i:r,n=t=>{if(!t||"object"!=typeof t)return String(t);if(void 0!==t.group)return String(t.group);for(const n of Object.keys(t))if("string"==typeof t[n]||"number"==typeof t[n])return String(t[n]);try{return JSON.stringify(t)}catch(e){return String(t)}},o={};let a=0;return t.forEach(t=>{const r=n(t);r in o||(o[r]=hs(e[a%e.length]),a+=1)}),t=>{const r=n(t);return o[r]||e[0]}}if(!e){const e=r,n=t=>{if(!t||"object"!=typeof t)return String(t);if(void 0!==t.group)return String(t.group);for(const n of Object.keys(t))if("string"==typeof t[n]||"number"==typeof t[n])return String(t[n]);try{return JSON.stringify(t)}catch(e){return String(t)}},i={};let o=0;return t.forEach(t=>{const r=n(t);r in i||(i[r]=hs(e[o%e.length]),o+=1)}),t=>{const r=n(t);return i[r]||e[0]}}const o=[...new Set(t.map(t=>t[e]))],a={};return o.forEach((r,i)=>{a[r]=(t.find(t=>t[e]===r)||{}).color||n(i/o.length)}),t=>a[t[e]]||n(0)}function ds(t){try{const e=Ee(t),n=e.r/255,r=e.g/255,i=e.b/255,[o,a,s]=[n,r,i].map(t=>t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return.2126*o+.7152*a+.0722*s>.5?"black":"white"}catch(e){return"black"}}function ps(t){let e=null;try{e=Se(t)}catch(r){e=null}e||(e=Se("#999"));const n=.2126*(e.r||0)+.7152*(e.g||0)+.0722*(e.b||0);try{return n>180?e.darker(.3).toString():e.brighter(.5).toString()}catch(r){return e.toString()}}function gs(t,e=.15){try{const n=Se(t);if(!n)return t;const r=n.r,i=n.g,o=n.b,a=Math.max(0,Math.min(1,Number(e)||0)),s=Math.round(r+(255-r)*a),l=Math.round(i+(255-i)*a);return`rgb(${s}, ${l}, ${Math.round(o+(255-o)*a)})`}catch(n){return t}}ts.prototype;let ys=!1,ms=null;function xs(t,e,n,r){let i=null;try{const e=t&&t.target?t.target:document.elementFromPoint(t.clientX,t.clientY),n=e&&e.closest?e.closest("[data-d3po-tooltips]"):null;n&&(i=n.getAttribute("data-d3po-tooltips"))}catch(c){i=null}!function(t,e,n){const r=`${t}-${e}-${n?`explicit-${n}`:"auto"}`;if(ys&&ms===r)return;const i=document.getElementById("d3po-tooltip-styles");i&&i.remove();const o=n||"white",a=n?Se(o).darker(1).toString():"#999",s=n?"white"===ds(o)?"#eee":"#111":"#333",l=o,c=a,u=document.createElement("style");u.id="d3po-tooltip-styles",u.textContent=`\n    .d3po-tooltip {\n      position: absolute;\n      background: ${o};\n      border: 1px solid ${a};\n      color: ${s};\n      padding: 8px 10px;\n      border-radius: 4px;\n      pointer-events: none;\n      font-family: ${t||'"Noto Sans", "Fira Sans", sans-serif'};\n      font-size: ${e||12}px;\n      line-height: 1.6;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n      z-index: 1000;\n      max-width: 200px;\n    }\n    \n    .d3po-tooltip::after {\n      content: '';\n      position: absolute;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid ${l};\n    }\n    \n    .d3po-tooltip::before {\n      content: '';\n      position: absolute;\n      bottom: -7px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 7px solid transparent;\n      border-right: 7px solid transparent;\n      border-top: 7px solid ${c};\n    }\n    \n    .d3po-tooltip strong {\n      display: block;\n      margin-bottom: 4px;\n      color: ${s};\n    }\n  `,document.head.appendChild(u),ys=!0,ms=r}(n,r,i),Kt(".d3po-tooltip").remove();const o=Ut("body").append("div").attr("class","d3po-tooltip").html(e),a=o.node(),s=a.offsetHeight,l=a.offsetWidth;return o.style("left",t.pageX-l/2+"px").style("top",t.pageY-s-15+"px"),o}function vs(){Kt(".d3po-tooltip").remove()}function bs(t,e){if("function"==typeof t)return t;if("function"==typeof e)return e;if("string"==typeof e){const{maybeEvalJSFormatter:t}=require("./formatters.js");return t(e)}return null}function ws(t,e,n,r,i,o,a){try{if("function"==typeof e){const a=e(n,r);if(null!=a)return xs(t,a,i,o)}}catch(s){console.error("Tooltip formatter error",s)}return xs(t,"function"==typeof a?a(n,r):String(a||""),i,o)}function _s(t,e,n,r,i,o,a,s,l=12,c=0,u=14){let h=z(e),f=E(n);o.axisFormatters&&o.axisFormatters.x&&h.tickFormat(o.axisFormatters.x),o.axisFormatters&&o.axisFormatters.y&&f.tickFormat(o.axisFormatters.y);const d=t.append("g").attr("class","x-axis").attr("transform",`translate(0,${i})`).call(h);d.selectAll("text").style("font-family",o.fontFamily).style("font-size",`${o.fontSize}px`),o.textTransform&&d.selectAll("text").style("text-transform",o.textTransform);let p=0,g=0,y=!1;try{const t=d.selectAll(".tick text").nodes();if(t&&t.length){if(g=x(t,t=>t.getBBox().width)||0,p=x(t,t=>t.getBBox().height)||0,e.bandwidth){g>.9*e.bandwidth()&&(y=!0)}else if(t.length>0){g>.9*Math.max(10,r/t.length)&&(y=!0)}y&&d.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end")}}catch(M){}const m=i+(y?Math.max(25,.85*g):Math.max(8,p))+10+(y?20:16),v=o.xLabel||(a?String(a):"");t.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",r/2).attr("y",m).style("font-family",o.fontFamily).style("font-size","14px").style("text-transform",o.textTransform||"none").text(v);const b=t.append("g").attr("class","y-axis").call(f);b.selectAll("text").style("font-family",o.fontFamily).style("font-size",`${o.fontSize}px`),o.textTransform&&b.selectAll("text").style("text-transform",o.textTransform);let w=c;try{const t=b.selectAll(".tick text").nodes();t&&t.length&&(w=Math.max(w,x(t,t=>t.getBBox().width)||0))}catch(M){}let _=w+8+10;const F=o.margin&&o.margin.left?o.margin.left-5:55;_=Math.min(_,F);const k=o.yLabel||(s?String(s):"");return b.append("text").attr("class","y-axis-label").attr("transform",`translate(${-_},${i/2}) rotate(-90)`).attr("text-anchor","middle").style("font-family",o.fontFamily).style("font-size","14px").style("text-transform",o.textTransform||"none").text(k),{xAxisGroup:d,yAxisGroup:b}}function Fs(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function ks(t){if("function"==typeof t)return t;if("string"!=typeof t)return null;if(0!==t.indexOf("JS.")&&0!==t.indexOf("JS("))return null;var e;if(0===t.indexOf("JS."))e=t.slice(3).trim();else{var n=t.indexOf("("),r=t.lastIndexOf(")");e=n>=0&&r>n?t.substring(n+1,r).trim():t.slice(3).trim()}var i=e.match(/^([A-Za-z0-9_\-]+)\s*\((.*)\)$/);if(i){var o=i[1],a=i[2]||"";try{return new Function("value","row",'return window.d3po.format["'+o+'"]('+a+");")}catch(s){return console.warn("d3po: failed compiling simple formatter",t,s),null}}try{return new Function("value","row","with (window.d3po) { return ("+e+"); }")}catch(s){return console.warn("d3po: failed compiling JS formatter expression:",t,s),null}}function Ms(t,e){if(!Array.isArray(t)||0===t.length)throw new Error("Data must be a non-empty array");const n=t[0],r=e.filter(t=>!(t in n));if(r.length>0)throw new Error(`Missing required fields: ${r.join(", ")}`)}function As(t){const e=t.slice().sort((t,e)=>t-e),n=e.length;if(0===n)return{min:null,q1:null,median:null,q3:null,max:null,whiskerMin:null,whiskerMax:null,outliers:[]};const r=(t,e)=>{const n=(t.length-1)*e,r=Math.floor(n),i=Math.ceil(n),o=n%1;return t[r]*(1-o)+t[i]*o},i=r(e,.25),o=r(e,.75),a=o-i,s=i-1.5*a,l=o+1.5*a;let c=e[0];for(let f=0;f<n;f++)if(e[f]>=s){c=e[f];break}let u=e[n-1];for(let f=n-1;f>=0;f--)if(e[f]<=l){u=e[f];break}const h=e.filter(t=>t<s||t>l);return{min:e[0],q1:i,median:r(e,.5),q3:o,max:e[n-1],whiskerMin:c,whiskerMax:u,outliers:h}}function $s(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,r.style.display="none",document.body.appendChild(r),setTimeout(()=>{r.click(),setTimeout(()=>{document.body.removeChild(r),URL.revokeObjectURL(n)},100)},0)}window.d3po=window.d3po||{},window.d3po.format=window.d3po.format||{},window.d3po.format["format-as-billion"]=function(t,e){return null==t||isNaN(t)?"":(t/1e9).toFixed(e="number"==typeof e?e:2)+"B"},window.d3po.format["format-as-percentage"]=function(t,e){return null==t||isNaN(t)?"":(100*t).toFixed(e="number"==typeof e?e:0)+"%"},window.d3po.format.formatAsBillion=window.d3po.format["format-as-billion"],window.d3po.format.formatAsPercentage=window.d3po.format["format-as-percentage"];class Ss{constructor(t,e={}){if(this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error("Container element not found");if(this.options={width:e.width||this.container.clientWidth||800,height:e.height||this.container.clientHeight||600,margin:e.margin||{top:60,right:40,bottom:80,left:60},title:e.title||"",background:e.background||"#ffffff",fontFamily:e.fontFamily||'"Noto Sans", "Fira Sans", sans-serif',fontSize:e.fontSize||12,download:void 0===e.download||e.download,...e},this.data=null,this.svg=null,this.chart=null,this.tooltip=e.tooltip||null,this.axisFormatters=e.axisFormatters||null,void 0!==e.axis_x){this.options.axisFormatters=this.options.axisFormatters||{};const t=ks(e.axis_x);this.options.axisFormatters.x=t||null}if(void 0!==e.axis_y){this.options.axisFormatters=this.options.axisFormatters||{};const t=ks(e.axis_y);this.options.axisFormatters.y=t||null}if(void 0!==e.tooltip){const t=ks(e.tooltip);if(t)this.tooltip=t;else if("string"==typeof e.tooltip&&e.tooltip.indexOf("{")>=0){const t=e.tooltip;this.tooltip=function(e,n){return n?t.replace(/\{([^}]+)\}/g,function(t,e){var r=n[e];return null==r?"":Fs(String(r))}):""}}else this.tooltip=null}void 0!==e.formattedCols&&(this.options.formattedCols=e.formattedCols),void 0!==e.axisLabels&&(this.options.xLabel||void 0===e.axisLabels.x||(this.options.xLabel=e.axisLabels.x),this.options.yLabel||void 0===e.axisLabels.y||(this.options.yLabel=e.axisLabels.y),this.options.axisLabels=e.axisLabels),this.axisFormatters=this.options.axisFormatters||this.axisFormatters,this._initializeSVG()}_initializeSVG(){Ut(this.container).selectAll("*").remove(),this.svg=Ut(this.container).append("svg").attr("width",this.options.width).attr("height",this.options.height).style("background",this.options.background).style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&this.svg.style("text-transform",this.options.textTransform);let t=this.options.background;if(!t)try{t=window.getComputedStyle(this.container).backgroundColor||t}catch(e){t=t||"#ffffff"}try{const e=Se(t)||Ee("#ffffff"),n=(.2126*e.r+.7152*e.g+.0722*e.b)/255;this.isDark=n<=.5}catch(e){this.isDark=!1}if(this.options&&this.options.theme){this.explicitTheme=this.options.theme;try{if(this.explicitTheme.axis){const t=Se(this.explicitTheme.axis);if(t){const e=(.2126*t.r+.7152*t.g+.0722*t.b)/255;this.isDark=e<=.5}}}catch(e){}}try{const t=this.isDark?"dark":"light";if(this.svg.attr("data-d3po-theme",t),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-theme",t),this.explicitTheme)try{this.explicitTheme.axis&&(this.svg.attr("data-d3po-axis",this.explicitTheme.axis),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-axis",this.explicitTheme.axis)),this.explicitTheme.tooltips&&(this.svg.attr("data-d3po-tooltips",this.explicitTheme.tooltips),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-tooltips",this.explicitTheme.tooltips))}catch(e){}}catch(e){}try{this._injectThemeStyles()}catch(e){}try{if(this.explicitTheme&&this.explicitTheme.axis&&this.svg&&this.svg.node){this._applyExplicitAxisColors(this.explicitTheme.axis);const t=this.svg.node(),e=new MutationObserver(t=>{this._applyExplicitAxisColors(this.explicitTheme.axis)});e.observe(t,{childList:!0,subtree:!0}),this._axisMutationObserver=e}}catch(e){}if(this.options.title){const t=this.svg.append("text").attr("class","title").attr("x",this.options.width/2).attr("y",this.options.margin.top/2).attr("text-anchor","middle").style("font-size",1.5*this.options.fontSize+"px").style("font-weight","bold").text(this.options.title);try{this.explicitTheme&&this.explicitTheme.axis?t.style("fill",this.explicitTheme.axis):t.style("fill",this.isDark?"#eee":"#111")}catch(e){}}this.chart=this.svg.append("g").attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`),this.options.download&&this._addDownloadButtons()}_injectThemeStyles(){const t="d3po-explicit-theme-styles",e=document.getElementById(t);e&&e.remove();const n=document.createElement("style");n.id=t;const r=this.explicitTheme&&this.explicitTheme.axis||null,i=this.explicitTheme&&this.explicitTheme.tooltips||null,o=r||"#333",a=r||"rgba(255,255,255,0.85)",s=r||"#111",l=r||"#eee",c=i||(this.isDark?"#252543":"white"),u=i?"white"===ds(c)?"#eee":"#111":this.isDark?"#eee":"#333";n.textContent=`\n      /* Axis and ticks */\n      [data-d3po-theme="light"] .axis path,\n      [data-d3po-theme="light"] .axis line,\n      [data-d3po-theme="light"] g.tick line,\n      [data-d3po-theme="light"] path.domain {\n        stroke: ${o} !important;\n      }\n      [data-d3po-theme="light"] g.tick text,\n      [data-d3po-theme="light"] .x-axis-label,\n      [data-d3po-theme="light"] .y-axis-label,\n  [data-d3po-theme="light"] .title,\n  [data-d3po-theme="light"] .treemap-subtitle,\n  [data-d3po-theme="light"] .treemap-back {\n        fill: ${s} !important;\n      }\n\n      [data-d3po-theme="dark"] .axis path,\n      [data-d3po-theme="dark"] .axis line,\n      [data-d3po-theme="dark"] g.tick line,\n      [data-d3po-theme="dark"] path.domain {\n        stroke: ${a} !important;\n      }\n      [data-d3po-theme="dark"] g.tick text,\n      [data-d3po-theme="dark"] .x-axis-label,\n      [data-d3po-theme="dark"] .y-axis-label,\n  [data-d3po-theme="dark"] .title,\n  [data-d3po-theme="dark"] .treemap-subtitle,\n  [data-d3po-theme="dark"] .treemap-back {\n        fill: ${l} !important;\n      }\n\n      /* Force menu/tooltip text color for SVG-attached menus */\n      .d3po-menu text { fill: ${u} !important; }\n      .d3po-menu rect { fill: ${c} !important; }\n    `,document.head.appendChild(n)}_applyExplicitAxisColors(t){try{if(!t||!this.svg)return;const e=this.svg.node();if(!e)return;e.querySelectorAll(".axis path, .axis line, g.tick line, path.domain").forEach(e=>{try{e.setAttribute("stroke",t),e.style.stroke=t}catch(n){}});e.querySelectorAll("g.tick text, .x-axis-label, .y-axis-label, .title").forEach(e=>{try{e.setAttribute("fill",t),e.style.fill=t}catch(n){}})}catch(e){}}_addDownloadButtons(){const t=this,e=this.svg.append("g").attr("class","d3po-download-buttons").attr("transform",`translate(${this.options.width-40}, 20)`),n=e.append("g").attr("class","d3po-hamburger").style("cursor","pointer");n.append("rect").attr("x",-12).attr("y",-12).attr("width",24).attr("height",24).style("fill","transparent").style("stroke","none");[-4,0,4].forEach(t=>{n.append("line").attr("x1",-6).attr("x2",6).attr("y1",t).attr("y2",t).style("stroke","#666").style("stroke-width","2px").style("stroke-linecap","round").style("pointer-events","none")});const r=e.append("g").attr("class","d3po-menu").attr("transform","translate(-80, 20)").style("opacity",0).style("pointer-events","none"),i=this.explicitTheme&&this.explicitTheme.tooltips||(this.isDark?"#252543":"white");let o;try{o=this.explicitTheme&&this.explicitTheme.tooltips?Se(i).darker(.8).toString():this.isDark?"rgba(255,255,255,0.08)":"#999"}catch(c){o=this.isDark?"rgba(255,255,255,0.08)":"#999"}const a=this.explicitTheme&&this.explicitTheme.tooltips?"white"===ds(i)?"#eee":"#111":this.isDark?"#eee":"#333";r.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",60).attr("rx",4).style("fill",i).style("stroke",o).style("stroke-width","1px").style("filter","drop-shadow(0 2px 4px rgba(0,0,0,0.2))");const s=r.append("g").attr("class","d3po-menu-item").attr("transform","translate(0, 0)").style("cursor","pointer");s.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",30).style("fill","transparent"),s.append("text").attr("x",10).attr("y",20).style("font-size","12px").style("fill",a).style("user-select","none").text(" SVG"),s.on("click",function(e){e.stopPropagation(),t.downloadSVG(),t._hideMenu()}).on("mouseover",function(){try{const e=t.explicitTheme&&t.explicitTheme.tooltips?Se(i).brighter(.5).toString():t.isDark?"#3a3a5a":"#f0f0f0";Ut(this).select("rect").style("fill",e)}catch(c){Ut(this).select("rect").style("fill","#f0f0f0")}}).on("mouseout",function(){Ut(this).select("rect").style("fill","transparent")});const l=r.append("g").attr("class","d3po-menu-item").attr("transform","translate(0, 30)").style("cursor","pointer");l.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",30).style("fill","transparent"),l.append("text").attr("x",10).attr("y",20).style("font-size","12px").style("fill",a).style("user-select","none").text(" PNG"),l.on("click",function(e){e.stopPropagation(),t.downloadPNG(),t._hideMenu()}).on("mouseover",function(){try{const e=t.explicitTheme&&t.explicitTheme.tooltips?Se(i).brighter(.5).toString():t.isDark?"#3a3a5a":"#f0f0f0";Ut(this).select("rect").style("fill",e)}catch(c){Ut(this).select("rect").style("fill","#f0f0f0")}}).on("mouseout",function(){Ut(this).select("rect").style("fill","transparent")}),n.on("mouseenter",function(e){e.stopPropagation(),Ut(this).selectAll("line").style("stroke","#333"),t._showMenu()}).on("mouseleave",function(){Ut(this).selectAll("line").style("stroke","#666"),setTimeout(()=>{t._isMouseOverMenu||t._hideMenu()},100)}),r.on("mouseenter",function(){t._isMouseOverMenu=!0}).on("mouseleave",function(){t._isMouseOverMenu=!1,t._hideMenu()}),this._isMouseOverMenu=!1,this.menu=r}_showMenu(){this.menu&&this.menu.transition().duration(200).style("opacity",1).style("pointer-events","all")}_hideMenu(){this.menu&&this.menu.transition().duration(200).style("opacity",0).style("pointer-events","none")}getInnerWidth(){return this.options.width-this.options.margin.left-this.options.margin.right}getInnerHeight(){return this.options.height-this.options.margin.top-this.options.margin.bottom}setData(t){return Ms(t,[]),this.data=t,this}setTitle(t){return this.options.title=t,this.svg.select(".title").text(t),this}setBackground(t){return this.options.background=t,this.svg.style("background",t),this}setFont(t,e,n){return this.options.fontFamily=t,this.options.fontSize=e,n&&(this.options.textTransform=n),this.svg.style("font-family",t).style("font-size",`${e}px`),n&&this.svg.style("text-transform",n),this}setDownload(t){return this.options.download=t,this.svg.select(".d3po-download-buttons").remove(),t&&this._addDownloadButtons(),this}downloadSVG(){try{const t=this.svg.node().cloneNode(!0);t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const e=t.querySelector(".d3po-download-buttons");e&&e.remove();const n='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+(new XMLSerializer).serializeToString(t);$s(new Blob([n],{type:"image/svg+xml;charset=utf-8"}),"d3po-chart.svg")}catch(t){console.error("Error in downloadSVG:",t),alert("Failed to download SVG: "+t.message)}}downloadPNG(){try{const t=this.svg.node().cloneNode(!0);t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const e=t.querySelector(".d3po-download-buttons");e&&e.remove();const n=(new XMLSerializer).serializeToString(t),r=document.createElement("canvas"),i=r.getContext("2d"),o=new Image;r.width=this.options.width,r.height=this.options.height,o.onload=()=>{try{i.fillStyle=this.options.background||"white",i.fillRect(0,0,r.width,r.height),i.drawImage(o,0,0),r.toBlob(t=>{t?$s(t,"d3po-chart.png"):(console.error("Failed to create blob from canvas"),alert("PNG export failed: Could not create image blob"))},"image/png")}catch(t){console.error("Error converting to PNG:",t),alert("PNG export failed: "+t.message)}},o.onerror=t=>{console.error("Failed to load SVG into image:",t),alert("PNG export failed. Please try SVG export instead.")};const a=btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode("0x"+e)));o.src="data:image/svg+xml;base64,"+a}catch(t){console.error("Error in downloadPNG:",t),alert("Failed to download PNG: "+t.message)}}render(){throw new Error("render() must be implemented by subclass")}resize(t,e){return this.options.width=t,this.options.height=e,this.chart.selectAll("*").remove(),this.svg.attr("width",t).attr("height",e),this.options.title&&this.svg.select(".title").attr("x",t/2),this.svg.select(".d3po-download-buttons").attr("transform",`translate(${t-40}, 20)`),this.data&&this.render(),this}destroy(){Ut(this.container).selectAll("*").remove(),this.data=null,this.svg=null,this.chart=null,this.menu=null,this._isMouseOverMenu=!1}}function Ns(t){return t}function zs(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=function(t,e){var n=function(t){if(null==t)return Ns;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var l=2,c=t.length,u=new Array(c);for(u[0]=(e+=t[0])*r+o,u[1]=(n+=t[1])*i+a;l<c;)u[l]=t[l],++l;return u}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}function c(t){var e,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(c)};case"Point":e=o(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(o);break;case"LineString":e=a(t.arcs);break;case"MultiLineString":e=t.arcs.map(a);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:n,coordinates:e}}return c(e)}(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}const Es={D3po:Ss,BoxPlot:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Box plot requires x and y fields");this.xField=e.x,this.yField=e.y,this.colorField=e.color}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.xField,this.yField]);const t="string"==typeof this.data[0][this.yField],e=t?this.yField:this.xField,n=t?this.xField:this.yField,r=this.options&&this.options.formattedCols?this.options.formattedCols:null,i=t=>r?r[t]?r[t]:t===this.xField&&r.x?r.x:t===this.yField&&r.y?r.y:null:null;let o;var a,s;a=this.data,s=e,o=a.reduce((t,e)=>{const n=e[s];return t[n]||(t[n]=[]),t[n].push(e),t},{});const l=["#74c0e2","#406662","#549e95","#8abdb6","#bcd8af","#a8c380","#ede788","#d6c650","#dc8e7a","#d05555","#bf3251","#872a41","#993f7b","#7454a6","#a17cb0","#d1a1bc","#a1aafb","#5c57d9","#1c26b3","#4d6fd0","#7485aa","#d3d3d3"],c=Object.keys(o);let u=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const t=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),e=t.length?t:l;u={},c.forEach((t,n)=>{u[t]=hs(e[n%e.length])})}else if(!this.colorField){const t=l;u={},c.forEach((e,n)=>{u[e]=hs(t[n%t.length])})}const h=Object.entries(o).map(([t,r])=>({group:t,label:(()=>{const n=i(e);return n&&void 0!==r[0][n]?r[0][n]:t})(),stats:As(r.map(t=>t[n])),color:u?u[t]:this.colorField?r[0][this.colorField]:pa[0]}));let f,d;const p=this.options&&(this.options.xLabel||this.options.axisLabels&&this.options.axisLabels.x)?this.options.xLabel||this.options.axisLabels.x:this.xField?String(this.xField):"",g=this.options&&(this.options.yLabel||this.options.axisLabels&&this.options.axisLabels.y)?this.options.yLabel||this.options.axisLabels.y:this.yField?String(this.yField):"";t?(f=Yo().domain(h.map(t=>t.label)).range([0,this.getInnerHeight()]).padding(.2),d=ia().domain([v(h,t=>t.stats.min),x(h,t=>t.stats.max)]).nice().range([0,this.getInnerWidth()])):(f=Yo().domain(h.map(t=>t.label)).range([0,this.getInnerWidth()]).padding(.2),d=ia().domain([v(h,t=>t.stats.min),x(h,t=>t.stats.max)]).nice().range([this.getInnerHeight(),0]));let y=null,m=null;t?(y=z(d),this.options&&this.options.axisFormatters&&this.options.axisFormatters.x&&y.tickFormat(this.options.axisFormatters.x),m=E(f),r&&r[e]&&m.tickFormat(t=>{const e=h.find(e=>e.group===t);return e?e.label:t})):(y=z(f),r&&r[e]&&y.tickFormat(t=>{const e=h.find(e=>e.group===t);return e?e.label:t}),this.options&&this.options.axisFormatters&&this.options.axisFormatters.x&&y.tickFormat(this.options.axisFormatters.x),m=E(d),this.options&&this.options.axisFormatters&&this.options.axisFormatters.y&&m.tickFormat(this.options.axisFormatters.y));let b=0,w=0,_=this.getInnerWidth(),F=this.getInnerHeight();const k=this.options&&!1!==this.options.useLeftMarginSpace;try{const e=this.svg.append("g").attr("class","d3po-probe");e.call(m);try{const t=e.selectAll(".tick text").nodes();t&&t.length&&(b=x(t,t=>t.getBBox().width)||0)}catch(P){}e.remove();try{const e=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(t?this.xField:this.yField);w=e.node().getBBox().height||0,e.remove()}catch(P){w=14}const n=void 0!==this.yLabelGap?this.yLabelGap:12,r=Math.ceil(b+n+w+8);r>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin=this.options.margin||{},this.options.margin.left=r,_=this.getInnerWidth(),F=this.getInnerHeight(),f&&f.range&&(t?f.range([0,F]):f.range([0,_])),d&&d.range&&(t?d.range([0,_]):d.range([F,0])),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(P){}if(k&&b>0){const e=void 0!==this.yLabelGap?this.yLabelGap:12,n=Math.ceil(b+e+w+8),r=this.options&&this.options.margin&&this.options.margin.left||60,i=4,o=Math.max(0,(n||0)+i),a=r-o,s=this.getInnerWidth();_=Math.max(20,Math.round(s+Math.max(0,a))),F=this.getInnerHeight(),f&&f.range&&(t?f.range([0,F]):f.range([0,_])),d&&d.range&&(t?d.range([0,_]):d.range([F,0]));const l=o;this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${l},${this.options.margin.top})`)}const M=this.chart.append("g").attr("transform",`translate(0,${F})`).call(y);M.selectAll("text").style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&M.selectAll("text").style("text-transform",this.options.textTransform);try{const e=M.selectAll(".tick text").nodes();let n=0,r=0;e&&e.length&&(n=x(e,t=>t.getBBox().width)||0,r=x(e,t=>t.getBBox().height)||0);let i=!1;if(f&&f.bandwidth){n>.9*f.bandwidth()&&(i=!0)}else if(e&&e.length){n>.9*Math.max(10,_/e.length)&&(i=!0)}if(i){M.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end");const e=Math.max(25,.85*n)+10+20+14+10;e>(this.options&&this.options.margin&&this.options.margin.bottom||80)&&(this.options.margin.bottom=e,F=this.getInnerHeight(),f&&f.range&&t&&f.range([0,F]),d&&d.range&&(t?d.range([0,_]):d.range([F,0])),M.attr("transform",`translate(0,${F})`))}const o=i?Math.max(25,.85*n):Math.max(8,r),a=F+o+10+(i?20:16);this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",_/2).attr("y",a).style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(p)}catch(P){this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",_/2).attr("y",F+(t?45:65)).style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(p)}const A=this.chart.append("g").call(m);A.selectAll("text").style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&A.selectAll("text").style("text-transform",this.options.textTransform);try{const t=A.selectAll(".tick text").nodes(),e=t&&t.length?x(t,t=>t.getBBox().width):b;let n=e+8+10;const r=this.options.margin&&this.options.margin.left?this.options.margin.left-5:55;n=Math.min(n,r),A.append("text").attr("class","y-axis-label").attr("transform",`translate(${-n},${F/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(g)}catch(P){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-F/2).attr("y",t?-70:-40).style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(g)}const $=f.bandwidth(),S=this.chart.selectAll(".box").data(h).enter().append("g").attr("class","box").attr("transform",e=>t?`translate(0,${f(e.label)})`:`translate(${f(e.label)},0)`);t?(S.append("line").attr("x1",t=>d(t.stats.whiskerMin)).attr("x2",t=>d(t.stats.q1)).attr("y1",$/2).attr("y2",$/2).attr("stroke","black").attr("stroke-width",1.5),S.append("line").attr("x1",t=>d(t.stats.q3)).attr("x2",t=>d(t.stats.whiskerMax)).attr("y1",$/2).attr("y2",$/2).attr("stroke","black").attr("stroke-width",1.5),S.append("line").attr("x1",t=>d(t.stats.whiskerMin)).attr("x2",t=>d(t.stats.whiskerMin)).attr("y1",.25*$).attr("y2",.75*$).attr("stroke","black").attr("stroke-width",1.5),S.append("line").attr("x1",t=>d(t.stats.whiskerMax)).attr("x2",t=>d(t.stats.whiskerMax)).attr("y1",.25*$).attr("y2",.75*$).attr("stroke","black").attr("stroke-width",1.5),S.append("rect").attr("x",t=>d(t.stats.q1)).attr("y",0).attr("width",t=>d(t.stats.q3)-d(t.stats.q1)).attr("height",$).attr("fill",t=>t.color).attr("stroke","black").attr("stroke-width",1.5).style("opacity",1),S.append("line").attr("x1",t=>d(t.stats.median)).attr("x2",t=>d(t.stats.median)).attr("y1",0).attr("y2",$).attr("stroke","black").attr("stroke-width",2),S.each(function(t){t.stats.min<t.stats.whiskerMin&&Ut(this).append("circle").attr("cx",d(t.stats.min)).attr("cy",$/2).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),S.each(function(t){t.stats.max>t.stats.whiskerMax&&Ut(this).append("circle").attr("cx",d(t.stats.max)).attr("cy",$/2).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),S.each(function(t){t.stats.outliers.forEach(t=>{Ut(this).append("circle").attr("cx",d(t)).attr("cy",$/2).attr("r",4).attr("fill","black").style("opacity",1)})})):(S.append("line").attr("x1",$/2).attr("x2",$/2).attr("y1",t=>d(t.stats.whiskerMax)).attr("y2",t=>d(t.stats.q3)).attr("stroke","black").attr("stroke-width",1.5),S.append("line").attr("x1",$/2).attr("x2",$/2).attr("y1",t=>d(t.stats.q1)).attr("y2",t=>d(t.stats.whiskerMin)).attr("stroke","black").attr("stroke-width",1.5),S.append("line").attr("x1",.25*$).attr("x2",.75*$).attr("y1",t=>d(t.stats.whiskerMax)).attr("y2",t=>d(t.stats.whiskerMax)).attr("stroke","black").attr("stroke-width",1.5),S.append("line").attr("x1",.25*$).attr("x2",.75*$).attr("y1",t=>d(t.stats.whiskerMin)).attr("y2",t=>d(t.stats.whiskerMin)).attr("stroke","black").attr("stroke-width",1.5),S.append("rect").attr("x",0).attr("y",t=>d(t.stats.q3)).attr("width",$).attr("height",t=>d(t.stats.q1)-d(t.stats.q3)).attr("fill",t=>t.color).attr("stroke","black").attr("stroke-width",1.5).style("opacity",1),S.append("line").attr("x1",0).attr("x2",$).attr("y1",t=>d(t.stats.median)).attr("y2",t=>d(t.stats.median)).attr("stroke","black").attr("stroke-width",2),S.each(function(t){t.stats.min<t.stats.whiskerMin&&Ut(this).append("circle").attr("cx",$/2).attr("cy",d(t.stats.min)).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),S.each(function(t){t.stats.max>t.stats.whiskerMax&&Ut(this).append("circle").attr("cx",$/2).attr("cy",d(t.stats.max)).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),S.each(function(t){t.stats.outliers.forEach(t=>{Ut(this).append("circle").attr("cx",$/2).attr("cy",d(t)).attr("r",4).attr("fill","black").style("opacity",1)})}));const N=this.options.fontFamily,T=this.options.fontSize;var C=bs(this.tooltip,this.options&&this.options.tooltip);return S.on("mouseover",function(t,e){const n=Ut(this).select("rect"),r=ps(n.attr("fill"));if(n.attr("fill",r),C){const n=()=>`<strong>${Fs(e.label||e.group)}</strong>Percentile 0th (Min): ${e.stats.min.toFixed(2)}<br/>Percentile 25th: ${e.stats.q1.toFixed(2)}<br/>Percentile 50th (Median): ${e.stats.median.toFixed(2)}<br/>Percentile 75th: ${e.stats.q3.toFixed(2)}<br/>Percentile 100th (Max): ${e.stats.max.toFixed(2)}<br/>Outliers: ${e.stats.outliers.length}`;ws(t,C,null,{group:e.group,label:e.label||e.group,stats:e.stats},N,T,n)}else{xs(t,`<strong>${e.label||e.group}</strong>Percentile 0th (Min): ${e.stats.min.toFixed(2)}<br/>Percentile 25th: ${e.stats.q1.toFixed(2)}<br/>Percentile 50th (Median): ${e.stats.median.toFixed(2)}<br/>Percentile 75th: ${e.stats.q3.toFixed(2)}<br/>Percentile 100th (Max): ${e.stats.max.toFixed(2)}<br/>Outliers: ${e.stats.outliers.length}`,N,T)}}).on("mouseout",function(t,e){Ut(this).select("rect").attr("fill",e.color),vs()}),this}},BarChart:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Bar chart requires x and y fields");this.xField=e.x,this.yField=e.y,this.colorField=e.color,this.groupField=e.group}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.xField,this.yField]);const t="string"==typeof this.data[0][this.yField];let e=this.getInnerWidth(),n=this.getInnerHeight();const r=this.options&&!1!==this.options.useLeftMarginSpace,i=!(!this.options||!0!==this.options.stack&&"stacked"!==this.options.type),o=null!=this.groupField?this.groupField:null,a=t?this.yField:this.xField,s=t?this.xField:this.yField,l=Array.from(new Set(this.data.map(t=>null==t[a]?"":String(t[a])))),c=this.options&&this.options.sort?String(this.options.sort):null,u="Rest of the world",h=t=>{l.splice(0,l.length,...t)},f=()=>{const t=new Map;return this.data.forEach(e=>{const n=null==e[a]?"":String(e[a]),r=Number(e[s])||0;t.set(n,(t.get(n)||0)+r)}),Array.from(t.entries())};let d=null;if(c&&!i){const t=c.match(/^(asc|desc)-([xy])$/);t&&(d={dir:t[1],axis:t[2]})}const p=o?Array.from(new Set(this.data.map(t=>null==t[o]?"":String(t[o])))):[];let g=!1;if(o&&!i){const t=new Map;this.data.forEach(e=>{const n=null==e[a]?"":String(e[a]),r=null==e[o]?"":String(e[o]);t.has(n)||t.set(n,new Set),t.get(n).add(r)});for(const e of t.values())if(e.size>1){g=!0;break}}let y,m,v=null;const b=fs(this.data,this.colorField,ya);let w=null;const _=new Map;if(i&&o){this.colorField&&this.data.forEach(t=>{const e=null==t[o]?"":String(t[o]);_.has(e)||null==t[this.colorField]||_.set(e,t[this.colorField])});const r=l.map(t=>{const e={__cat:t};return p.forEach(t=>{e[t]=0}),e.__total=0,e}),i=new Map(r.map(t=>[t.__cat,t]));this.data.forEach(t=>{const e=null==t[a]?"":String(t[a]),n=null==t[o]?"":String(t[o]),r=Number(t[s])||0,l=i.get(e);l&&(l[n]=(l[n]||0)+r,l.__total=(l.__total||0)+r)});const f=x(r,t=>t.__total)||0;if(t?(m=Yo().domain(l).range([0,n]).padding(.2),y=ia().domain([0,f]).nice().range([0,e])):(y=Yo().domain(l).range([0,e]).padding(.2),m=ia().domain([0,f]).nice().range([n,0])),c){const e=c.match(/^(asc|desc)-([xy])$/);if(e){const n=e[1];r.sort((t,e)=>"desc"===n?e.__total-t.__total:t.__total-e.__total);const i=r.map(t=>t.__cat);if(-1!==i.indexOf(u)){h(i.filter(t=>t!==u).concat([u]))}else h(i);t?m.domain(l):y.domain(l)}}const d=Ka().keys(p)(r),g=this.chart.selectAll(".series").data(d).enter().append("g").attr("class","series");t?g.selectAll("rect").data(t=>t).enter().append("rect").attr("y",(t,e)=>m(r[e].__cat)).attr("x",t=>y(t[0])).attr("width",t=>Math.max(0,y(t[1])-y(t[0]))).attr("height",m.bandwidth()).attr("fill",(t,e,n)=>{const r=Ut(n[e].parentNode).datum(),i=r&&r.key?r.key:null;if(this.colorField&&_.has(i)){const t=_.get(i);return b({[this.colorField]:t})}return b({[this.colorField]:i})}):g.selectAll("rect").data(t=>t).enter().append("rect").attr("x",(t,e)=>y(r[e].__cat)).attr("y",t=>m(t[1])).attr("height",t=>Math.max(0,m(t[0])-m(t[1]))).attr("width",y.bandwidth()).attr("fill",(t,e,n)=>{const r=Ut(n[e].parentNode).datum(),i=r&&r.key?r.key:null;if(this.colorField&&_.has(i)){const t=_.get(i);return b({[this.colorField]:t})}return b({[this.colorField]:i})}),w=this.chart.selectAll(".series").selectAll("rect")}else if(g)t?(y=ia().domain([0,x(this.data,t=>Number(t[s])||0)]).nice().range([0,e]),m=Yo().domain(l).range([0,n]).padding(.12),v=Yo().domain(p).range([0,m.bandwidth()]).padding(.05)):(y=Yo().domain(l).range([0,e]).padding(.12),m=ia().domain([0,x(this.data,t=>Number(t[s])||0)]).nice().range([n,0]),v=Yo().domain(p).range([0,y.bandwidth()]).padding(.05)),w=this.chart.selectAll(".bar").data(this.data).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",t=>b(t)),t?w.attr("x",0).attr("y",t=>m(String(null==t[a]?"":t[a]))+v(String(null==t[o]?"":t[o]))).attr("width",t=>y(Number(t[s])||0)).attr("height",()=>v.bandwidth()):w.attr("x",t=>y(String(null==t[a]?"":t[a]))+v(String(null==t[o]?"":t[o]))).attr("y",t=>m(Number(t[s])||0)).attr("width",()=>v.bandwidth()).attr("height",t=>Math.max(0,n-m(Number(t[s])||0)));else{const r=new Map;if(this.data.forEach(t=>{const e=null==t[a]?"":String(t[a]);r.has(e)||r.set(e,[]),r.get(e).push(t)}),d){const t=d.dir,e=d.axis;if("x"===e){const e=f();e.sort((e,n)=>"desc"===t?n[1]-e[1]:e[1]-n[1]);let n=e.map(t=>t[0]);-1!==n.indexOf(u)&&(n=n.filter(t=>t!==u).concat([u])),h(n)}else if("y"===e){const e=Array.from(l).sort((e,n)=>(null==e&&(e=""),null==n&&(n=""),e<n?"asc"===t?-1:1:e>n?"asc"===t?1:-1:0));if(-1!==e.indexOf(u)){h(e.filter(t=>t!==u).concat([u]))}else h(e)}}t?(y=ia().domain([0,x(this.data,t=>Number(t[this.xField])||0)]).nice().range([0,e]),m=Yo().domain(l).range([0,n]).padding(.2),w=this.chart.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",t=>{const e=(r.get(t)||[])[0]||{};return b(e)}).attr("x",0).attr("y",t=>m(t)).attr("width",t=>{const e=(r.get(t)||[])[0]||{};return y(Number(e[this.xField])||0)}).attr("height",()=>m.bandwidth()),w.each(function(t,e,n){const i=(r.get(t)||[])[0]||{[a]:t};Ut(n[e]).datum(i)})):(y=Yo().domain(l).range([0,e]).padding(.2),m=ia().domain([0,x(this.data,t=>Number(t[this.yField])||0)]).nice().range([n,0]),w=this.chart.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",t=>{const e=(r.get(t)||[])[0]||{};return b(e)}).attr("x",t=>y(t)).attr("y",t=>{const e=(r.get(t)||[])[0]||{};return m(Number(e[this.yField])||0)}).attr("width",()=>y.bandwidth()).attr("height",t=>{const e=(r.get(t)||[])[0]||{};return Math.max(0,n-m(Number(e[this.yField])||0))}),w.each(function(t,e,n){const i=(r.get(t)||[])[0]||{[a]:t};Ut(n[e]).datum(i)}))}let F=0,k=0;try{const t=this.svg.append("g").attr("class","d3po-probe"),r=E(m);this.options.axisFormatters&&this.options.axisFormatters.y&&r.tickFormat(this.options.axisFormatters.y),t.call(r);try{const e=t.selectAll(".tick text").nodes();e&&e.length&&(F=x(e,t=>t.getBBox().width)||0)}catch(R){}t.remove();try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);k=t.node().getBBox().height||0,t.remove()}catch(R){k=14}const i=void 0!==this.yLabelGap?this.yLabelGap:12,o=Math.ceil(F+i+k+8);o>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin.left=o,e=this.getInnerWidth(),n=this.getInnerHeight(),y&&y.range&&(y.bandwidth,y.range([0,e])),m&&m.range&&(m.bandwidth?m.range([0,n]):m.range([n,0])),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(R){}if(r&&F>0){const t=void 0!==this.yLabelGap?this.yLabelGap:12,r=Math.ceil(F+t+k+8),i=this.options&&this.options.margin&&this.options.margin.left||60,o=4,a=Math.max(0,(r||0)+o),s=i-a,l=this.getInnerWidth();e=Math.max(20,Math.round(l+Math.max(0,s))),y&&y.range&&(y.bandwidth,y.range([0,e])),m&&m.range&&(m.bandwidth?m.range([0,n]):m.range([n,0]));const c=a;this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${c},${this.options.margin.top})`)}const M=this.options.fontFamily,A=this.options.fontSize,$=bs(this.tooltip,this.options&&this.options.tooltip),S=(t,e=!1)=>{if(!t||!t.node)return;const n=t.node();if(n)try{const t=t=>{if(!t)return!1;const e=String(t).trim();return""!==e&&(!!/^\d+[.)]?$/.test(e)||!!/^-?\d+(?:\.\d+)?$/.test(e))};if(e){const e=n=>{if(!n||!n.childNodes)return;const r=Array.from(n.childNodes);for(const i of r){const r=(i.textContent||"").trim();if(""===r||t(r))try{n.removeChild(i)}catch(R){}else 1===i.nodeType&&i.childNodes&&i.childNodes.length&&e(i)}};for(e(n);n.firstChild&&""===(n.firstChild.textContent||"").trim();)n.removeChild(n.firstChild);return}for(;n.firstChild;){const e=n.firstChild,r=(e.textContent||"").trim();if(""!==r){if(!t(r))break;for(n.removeChild(e);n.firstChild&&""===(n.firstChild.textContent||"").trim();)n.removeChild(n.firstChild)}else n.removeChild(e)}}catch(R){}},N=t=>{if(null==t)return t;return String(t).replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())},T=t=>"number"==typeof t&&Number.isFinite(t)?t.toFixed(2):t,C=this.xField,P=this.yField,I=this.colorField,L=null!=o&&(g||i);w.on("mouseover",function(e,n){let r=n,a=null,s=null;if(Array.isArray(n)&&n.data){r=n.data;const t=Ut(this.parentNode).datum();a=t&&t.key?t.key:null,s=n[1]-n[0]}const l=Ut(this).attr("fill");if(Ut(this).attr("fill",ps(l)),$){const n=ws(e,(t,e)=>{const n=$(t,e);return"string"==typeof n?"string"!=typeof(r=n)?r:r=(r=r.replace(/^(?:\s*\d+(?:[.)]\s*)?\r?\n)+/,"")).replace(/^\s*\r?\n+/,""):n;var r},null,r,M,A,()=>{let e,n=null;a?n=a:L&&o&&r&&o in r&&(n=r[o]),null!=n&&""===String(n).trim()&&(n=null),e=i&&r&&null!=r.__cat?r.__cat:r&&r[t?P:C];let l;l=i&&null!=s?s:r&&r[t?C:P];const c=[];return n?c.push(`<strong>${Fs(String(e))}</strong> ${Fs(String(N(n)))}`):c.push(`<strong>${Fs(String(e))}</strong>`),c.push(`Value: ${Fs(String(T(l)))}`),c.join("<br/>")});S(n,!L)}else{let n;n=i&&r&&null!=r.__cat?r.__cat:r&&r[t?P:C];let l;l=i&&null!=s?s:r&&r[t?C:P];let c=null;a?c=a:L&&o&&r&&o in r&&(c=r[o]),null!=c&&""===String(c).trim()&&(c=null);const u=[];c?u.push(`<strong>${Fs(String(n))}</strong> ${Fs(String(N(c)))}`):u.push(`<strong>${Fs(String(n))}</strong>`),u.push(`Value: ${Fs(String(T(l)))}`);const h=xs(e,u.join("<br/>"),M,A);S(h,!L)}}).on("mouseout",function(){const t=Ut(this).datum();if(Array.isArray(t)&&t.data){const t=Ut(this.parentNode).datum(),e=t&&t.key?t.key:null;if(i&&o&&I&&_&&_.has(e)){const t=_.get(e),n={};n[I]=t,Ut(this).attr("fill",b(n))}else{const t={};t[I]=e,Ut(this).attr("fill",b(t))}}else Ut(this).attr("fill",b(t));vs()});let q=z(y),B=E(m);this.options.axisFormatters&&this.options.axisFormatters.x&&q.tickFormat(this.options.axisFormatters.x),this.options.axisFormatters&&this.options.axisFormatters.y&&B.tickFormat(this.options.axisFormatters.y);const O=this.chart.append("g").attr("transform",`translate(0,${n})`).call(q);O.selectAll("text").style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&O.selectAll("text").style("text-transform",this.options.textTransform);try{const r=O.selectAll(".tick text").nodes();let o=0,a=0;r&&r.length&&(o=x(r,t=>t.getBBox().width)||0,a=x(r,t=>t.getBBox().height)||0);let l=!1;if(y.bandwidth){o>.9*y.bandwidth()&&(l=!0)}else if(r&&r.length){o>.9*Math.max(10,e/r.length)&&(l=!0)}if(l){O.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end");const e=Math.max(25,.85*o)+10+20+14+10;e>(this.options&&this.options.margin&&this.options.margin.bottom||80)&&(this.options.margin.bottom=e,n=this.getInnerHeight(),m&&m.range&&(m.bandwidth?m.range([0,n]):m.range([n,0])),O.attr("transform",`translate(0,${n})`),t||w.attr("y",t=>i&&Array.isArray(t)?m(t[1]):m(g?Number(t[s])||0:Number(t[this.yField])||0)).attr("height",t=>i&&Array.isArray(t)?Math.max(0,m(t[0])-m(t[1])):g?Math.max(0,n-m(Number(t[s])||0)):Math.max(0,n-m(Number(t[this.yField])||0))))}const c=l?Math.max(25,.85*o):Math.max(8,a),u=n+c+10+(l?20:16);this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",e/2).attr("y",u).style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"")}catch(R){}const j=this.chart.append("g").call(B);j.selectAll("text").style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&j.selectAll("text").style("text-transform",this.options.textTransform);try{const t=j.selectAll(".tick text").nodes(),e=t&&t.length?x(t,t=>t.getBBox().width):F,r=e+8+10;j.append("text").attr("class","y-axis-label").attr("transform",`translate(${-r},${n/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"")}catch(R){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-n/2).attr("y",-40).attr("fill","black").style("font-size","14px").text(this.yField)}return this}},Treemap:class extends Ss{constructor(t,e){if(super(t,e),!e.size||!e.group)throw new Error("Treemap requires size and group fields");if(this.sizeField=e.size,this.groupField=e.group,this.colorField=e.color,this.subgroupField=e.subgroup,"string"==typeof e.tile){const t={squarify:jo,dice:Bo,slice:Oo,"slice-dice":Go};this.tile=t[e.tile]||jo}else this.tile=e.tile||jo;this.labels=e.labels&&"object"==typeof e.labels?e.labels:{align:"left",valign:"top"},this.labelsOption=null,e.labels&&(this.labelsOption=e.labels.fields||e.labels.formatter||e.labels),this.labelsFormatter=ks(this.labelsOption),this.labelMode=e.labelMode||"percent",this.subtitleOption=e.labels&&e.labels.subtitle?e.labels.subtitle:null,this.subtitleFormatter=ks(this.subtitleOption),this.getSubtitleText=(t,e)=>{if(this.subtitleFormatter)try{const n={mode:t,nodeName:e&&e.data&&e.data.name?e.data.name:null,groupField:this.groupField,subgroupField:this.subgroupField},r=this.subtitleFormatter(null,n);if(null!=r)return r}catch(n){console.error("Subtitle formatter error",n)}return"aggregated"===t||"flat"===t?this.groupField:this.subgroupField||this.groupField},this.tooltipFormatter=bs(this.tooltip,e&&e.tooltip)}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.sizeField,this.groupField]);const t=fs(this.data,this.colorField,ya);let e;if(this.subgroupField){const n=new Map;this.data.forEach(e=>{const r=e[this.groupField],i=e[this.subgroupField]||"None",o=t(e),a=`${r}|||${i}`;n.has(a)||n.set(a,{group:r,subgroup:i,color:o,value:0,rows:[]});const s=n.get(a);s.value+=Number(e[this.sizeField])||0,s.rows.push(e)});const r=new Map;for(const t of n.values())r.has(t.group)||r.set(t.group,{name:t.group,children:[]}),r.get(t.group).children.push({name:t.subgroup,value:t.value,color:t.color,__rows:t.rows});e={children:Array.from(r.values())}}else e={children:this.data.map(e=>({name:e[this.groupField],value:e[this.sizeField],color:t(e),__row:e}))};const n=No(e).sum(t=>t.value),r=Ro().tile(this.tile).size([this.getInnerWidth(),this.getInnerHeight()]).padding(2).round(!0);let i=null;if(this.subgroupField){const t=e.children.map(t=>{const e=(t.children||[]).reduce((t,e)=>t+(e.value||0),0),n=t.children&&t.children.length&&t.children[0].color?t.children[0].color:null;return{name:t.name,value:e,color:n,isAggregated:!0}});i=No({children:t}).sum(t=>t.value||0),r(i)}r(n);let o=i||n;const a=n.value,s=t=>"black"===ds(t)?"white":"black";let l;l=this.subgroupField&&i&&i.children?i.children:n.leaves(),l.forEach(t=>{t._originalColor||(t._originalColor=t.data.color||ya(Math.random()))});const c=this.chart.selectAll(".cell").data(l).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);c.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2).style("opacity",1),this.chart.selectAll(".treemap-subtitle").remove(),this.chart.selectAll(".treemap-back").remove();const u=this.chart.append("text").attr("class","treemap-subtitle").attr("x",this.getInnerWidth()/2).attr("y",-10).attr("text-anchor","middle").attr("font-size",.9*this.options.fontSize+"px").attr("font-family",this.options.fontFamily).style("display",this.subgroupField?null:"none").text(this.groupField),h=this.chart.append("text").attr("class","treemap-back").attr("x",0).attr("y",-10).attr("font-size",.9*this.options.fontSize+"px").attr("font-family",this.options.fontFamily).attr("fill","currentColor").attr("cursor","pointer").style("display","none").text(" Back").on("click",()=>{o=i||n,g(o)}),f=this.options.fontFamily,d=this.options.fontSize,p=this.tooltipFormatter;c.selectAll("rect").on("mouseover",(t,e)=>{const n=ps(e._originalColor);Ut(t.currentTarget).attr("fill",n);const r=e.value/a*100,o=r.toFixed(1);if(p)try{let n=e.data&&e.data.__row?e.data.__row:e.data&&e.data.__rows?e.data.__rows[0]:null;const o=!(!i||!(e.parent===i||e.data&&e.data.isAggregated));n||(o?(n={[this.groupField]:e.data.name,count:e.value,color:e.data.color},n[this.groupField]=e.data.name,n.name=e.data.name):n={name:e.data.name,value:e.value,color:e.data.color}),null==n.count&&(n.count=null!=n.value?n.value:e.value);const a=p(r,n);if(null!=a)return void xs(t,a,f,d)}catch(u){console.error("Tooltip formatter error",u)}const s=e.data&&e.data.name?this.subgroupField&&e.parent&&e.parent.data&&e.parent.data.name?`${e.parent.data.name} ${e.data.name}`:e.data.name:"";let l=null;e.data&&e.data.__row?l=e.data.__row:e.data&&e.data.__rows&&e.data.__rows.length&&(l=e.data.__rows[0]);const c=!(!i||!(e.parent===i||e.data&&e.data.isAggregated));if(l||(l={},l[this.groupField]=e.data&&e.data.name?e.data.name:null,this.subgroupField&&!c&&(l[this.subgroupField]=e.data&&e.data.name?e.data.name:null),l.count=e.value,l.color=e.data&&e.data.color?e.data.color:null,l.name=e.data&&e.data.name?e.data.name:null),null==l.count&&(l.count=e.value),p)try{const e=p(r,l);if(null!=e)return void xs(t,e,f,d)}catch(u){console.error("Tooltip formatter error",u)}xs(t,`<strong>${Fs(s)}</strong>Value: ${Fs(String(l.count))}<br/>Percentage: ${o}%`,f,d)}).on("mouseout",(t,e)=>{Ut(t.currentTarget).attr("fill",e._originalColor),vs()}),c.selectAll("rect").on("click",(t,e)=>{if(i&&(e.parent===i||e.data.isAggregated)){const t=e.data.name,r=n.children.find(e=>e.data.name===t);return void(r&&(o=r,g(o)))}e.children&&e.children.length&&(o=e,g(o))});const g=t=>{if(this.chart.selectAll(".cell").remove(),this.subgroupField&&t===i){r(i);const t=i.children||[];t.forEach(t=>{t._originalColor||(t._originalColor=t.data.color||ya(Math.random()))});const e=this.chart.selectAll(".cell").data(t).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);return e.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2),b(e,1,1),e.selectAll("rect").on("mouseover",(t,e)=>{const n=ps(e._originalColor);Ut(t.currentTarget).attr("fill",n);const r=e.value/a*100,o=r.toFixed(1),s=e.data&&e.data.name?this.subgroupField&&e.parent&&e.parent.data&&e.parent.data.name?`${e.parent.data.name} ${e.data.name}`:e.data.name:"";if(p)try{let n=e.data&&e.data.__row?e.data.__row:e.data&&e.data.__rows?e.data.__rows[0]:null;const o=!(!i||!(e.parent===i||e.data&&e.data.isAggregated));n||(o?(n={[this.groupField]:e.data.name,count:e.value,color:e.data.color},n.name=e.data.name):n={name:e.data.name,value:e.value,color:e.data.color}),null==n.count&&(n.count=null!=n.value?n.value:e.value);const a=p(r,n);if(null!=a)return void xs(t,a,f,d)}catch(l){console.error("Tooltip formatter error",l)}xs(t,`<strong>${Fs(s)}</strong>Value: ${Fs(String(e.value))}<br/>Percentage: ${o}%`,f,d)}).on("mouseout",(t,e)=>{Ut(t.currentTarget).attr("fill",e._originalColor),vs()}).on("click",(t,e)=>{const r=e.data.name,i=n.children&&n.children.find(t=>t.data.name===r);i&&(o=i,g(o))}),h.style("display","none"),void u.text(this.getSubtitleText("aggregated",null))}if(!this.subgroupField&&t===n){r(n);const t=n.leaves();t.forEach(t=>{t._originalColor||(t._originalColor=t.data.color||ya(Math.random()))});const e=this.chart.selectAll(".cell").data(t).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);return e.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2),b(e,1,1),e.selectAll("rect").on("click",(t,e)=>{e.children&&e.children.length&&(o=e,g(o))}),h.style("display","none"),void u.text(this.getSubtitleText("flat",null))}const e=No(JSON.parse(JSON.stringify(t.data))).sum(t=>t.value||0);r.size([this.getInnerWidth(),this.getInnerHeight()]),r(e);const s=e.leaves();s.forEach(t=>{if(!t._originalColor){const e=n.leaves().find(e=>e.data&&t.data&&e.data.name===t.data.name&&e.value===t.value);t._originalColor=e&&e._originalColor?e._originalColor:t.data&&t.data.color||ya(Math.random())}});const l=this.chart.selectAll(".cell").data(s).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);l.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2),b(l,1,1),l.selectAll("rect").on("mouseover",(t,e)=>{const n=ps(e._originalColor);Ut(t.currentTarget).attr("fill",n);const r=e.value/a*100,o=r.toFixed(1),s=e.data&&e.data.name?this.subgroupField&&e.parent&&e.parent.data&&e.parent.data.name?`${e.parent.data.name} ${e.data.name}`:e.data.name:"";let l=e.data&&e.data.__row?e.data.__row:e.data&&e.data.__rows?e.data.__rows[0]:null;const c=!(!i||!(e.parent===i||e.data&&e.data.isAggregated));if(l||(c?(l={[this.groupField]:e.data.name,count:e.value,color:e.data.color},l.name=e.data.name):l={name:e.data.name,value:e.value,color:e.data.color}),null==l.count&&(l.count=null!=l.value?l.value:e.value),p)try{const e=p(r,l);if(null!=e)return void xs(t,e,f,d)}catch(u){console.error("Tooltip formatter error",u)}xs(t,`<strong>${Fs(s)}</strong>Value: ${Fs(String(e.data.value||e.value))}<br/>Percentage: ${o}%`,f,d)}).on("mouseout",(t,e)=>{Ut(t.currentTarget).attr("fill",e._originalColor),vs()}),h.style("display",null),u.text(this.getSubtitleText("drilled",t))};this.subgroupField&&i?u.text(this.getSubtitleText("aggregated",null)):u.text(this.getSubtitleText("flat",null));const y=(t,e,n=1)=>{const r=(t.x1-t.x0)*n;switch(e){case"center":case"middle":return r/2;case"right":case"end":return r-5;default:return 5}},m=(t,e,n=0,r=2,i=1)=>{const o=(t.y1-t.y0)*i,a=1.4*this.options.fontSize,s=r*a,l=n*a;switch(e){case"middle":return(o-s)/2+this.options.fontSize+l;case"bottom":return o-5-a*(r-n);default:return this.options.fontSize+4+l}},x=t=>{switch(t){case"center":case"middle":return"middle";case"right":case"end":return"end";default:return"start"}},v=this.labels,b=(t,e=1,n=1)=>{const r=this;t.each(function(t){const o=Ut(this),l=(t.x1-t.x0)*e,c=(t.y1-t.y0)*n,u=2*(1.4*r.options.fontSize),h=(i,o)=>{if(!v)return!1;const a=y(t,v.align,e),s=m(t,v.valign,o,2,n),h=x(v.align);if("middle"===v.valign){if(u>c)return!1}else if(s+r.options.fontSize>c||s<r.options.fontSize)return!1;const f=r.chart.append("text").attr("x",a).attr("y",s).text(i).attr("font-size",`${r.options.fontSize}px`).attr("font-family",r.options.fontFamily).attr("font-weight","bold").attr("text-anchor",h).style("visibility","hidden"),d=f.node().getBBox();f.remove();let p,g;return"start"===h?(p=a,g=a+d.width):"end"===h?(p=a-d.width,g=a):(p=a-d.width/2,g=a+d.width/2),p>=5&&g<=l-5},f=(t,e)=>{if(!t)return"";if(h(t,e))return t;let n=0,r=t.length,i="";for(;n<r;){const o=Math.ceil((n+r)/2),a=t.slice(0,o).trim()+"...";h(a,e)?(i=a,n=o):r=o-1}if(!i)for(let o=Math.min(t.length,20);o>0;o--){const n=t.slice(0,o).trim()+"...";if(h(n,e)){i=n;break}}return i||""};let d=t.data&&t.data.__row?t.data.__row:t.data&&t.data.__rows?t.data.__rows[0]:null;const p=!(!i||!(t.parent===i||t.data&&t.data.isAggregated));d||(d={},d[r.groupField]=t.data&&t.data.name?t.data.name:null,r.subgroupField&&!p&&(d[r.subgroupField]=t.data&&t.data.name?t.data.name:null),d.count=t.value,d.color=t.data&&t.data.color?t.data.color:null,d.name=t.data&&t.data.name?t.data.name:null),null==d.count&&(d.count=null!=d.value?d.value:t.value);let g=t.data.name;r.subgroupField&&t.parent&&t.parent.data&&t.parent.data.name&&(g=`${t.parent.data.name} ${t.data.name}`);const b=(t.value/a*100).toFixed(1)+"%",w=null!=t.data.value?t.data.value.toLocaleString():"";if(r.labelsFormatter)try{const i=r.labelsFormatter(t.value/a*100,d);if(null!=i){let a=[];if(a=Array.isArray(i)?i.map(String):"string"==typeof i?i.split(/<br\s*\/?\s*>/i).map(t=>t.replace(/<[^>]*>/g,"").trim()).filter(Boolean):[String(i)],a.length>0){const i=Math.max(1,a.length);for(let l=0;l<a.length;l++){const c=a[l];if(c)if(h(c,l))o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,l,i,n)).text(c).attr("font-size",`${r.options.fontSize}px`).attr("font-family",r.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ds(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none");else{const a=f(c,l);a&&o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,l,i,n)).text(a).attr("font-size",`${r.options.fontSize}px`).attr("font-family",r.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ds(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none")}}return}}}catch(k){console.error("Labels formatter error",k)}const _=i=>{if(!i)return!1;if(h(i,0))return o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,0,2,n)).text(i).attr("font-size",`${r.options.fontSize}px`).attr("font-family",r.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ds(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none"),!0;const a=f(i,0);return!!a&&(o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,0,2,n)).text(a).attr("font-size",`${r.options.fontSize}px`).attr("font-family",r.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ds(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none"),!0)};if(!_(g)){const t=g&&g.split(/[,;]+/)[0];if(!_(t&&t.trim()&&t.trim().length<g.length?`${t.trim()}...`:null)){const t=g?g.trim().split(/\s+/):[];if(t.length>1){_(`${t.slice(0,2).join(" ")}...`)}}}const F="count"===r.labelMode?w:b;F&&h(F,1)&&o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,1,2,n)).text(F).attr("font-size",`${r.options.fontSize}px`).attr("font-family",r.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ds(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none")})};return b(c,1,1),this}},PieChart:class extends Ss{constructor(t,e){if(super(t,e),!e.size||!e.group)throw new Error("Pie chart requires size and group fields");this.sizeField=e.size,this.groupField=e.group,this.colorField=e.color,this.donut=e.donut||!1,this.innerRadiusRatio=void 0!==e.innerRadius?e.innerRadius:this.donut?.5:0,this.labelMode=e.labelMode||"percent"}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.sizeField,this.groupField]);const t=this.getInnerWidth(),e=this.getInnerHeight();if(t<=0||e<=0||isNaN(t)||isNaN(e))return console.error("Invalid chart dimensions:",{width:t,height:e}),this;const n=Math.min(t,e)/2,r=this.options.margin.left+t/2,i=this.options.margin.top+e/2;this.chart.attr("transform",`translate(${r},${i})`);const o=function(){var t=Xa,e=Va,n=null,r=ma(0),i=ma(Sa),o=ma(0);function a(a){var s,l,c,u,h,f=(a=Ba(a)).length,d=0,p=new Array(f),g=new Array(f),y=+r.apply(this,arguments),m=Math.min(Sa,Math.max(-Sa,i.apply(this,arguments)-y)),x=Math.min(Math.abs(m)/f,o.apply(this,arguments)),v=x*(m<0?-1:1);for(s=0;s<f;++s)(h=g[p[s]=s]=+t(a[s],s,a))>0&&(d+=h);for(null!=e?p.sort(function(t,n){return e(g[t],g[n])}):null!=n&&p.sort(function(t,e){return n(a[t],a[e])}),s=0,c=d?(m-f*v)/d:0;s<f;++s,y=u)l=p[s],u=y+((h=g[l])>0?h*c:0)+v,g[l]={data:a[l],index:s,value:h,startAngle:y,endAngle:u,padAngle:x};return g}return a.value=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),a):t},a.sortValues=function(t){return arguments.length?(e=t,n=null,a):e},a.sort=function(t){return arguments.length?(n=t,e=null,a):n},a.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:ma(+t),a):r},a.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:ma(+t),a):i},a.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:ma(+t),a):o},a}().value(t=>t[this.sizeField]).sort(null),a=qa().innerRadius(n*this.innerRadiusRatio).outerRadius(n),s=qa().innerRadius(.7*n).outerRadius(.7*n),l=this.groupField,c=this.sizeField,u=this.colorField,h=this;let f=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const t=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),e=t.length?t:null;if(e){f={};[...new Set(this.data.map(t=>t[l]))].forEach((t,n)=>{f[t]=hs(e[n%e.length])})}}const d=this.chart.selectAll(".slice").data(o(this.data)).enter().append("g").attr("class","slice"),p=d.append("path").attr("d",a).attr("fill",t=>f?f[t.data[l]]||Object.values(f)[0]:u&&"string"==typeof u?hs(t.data[u]):ya(Math.random())).each(function(t){t._originalColor=f?f[t.data[l]]:u&&"string"==typeof u?hs(t.data[u]):Ut(this).attr("fill")}).attr("stroke","white").attr("stroke-width",2).style("opacity",1),g=this.options.fontFamily,y=this.options.fontSize;var m=bs(this.tooltip,this.options&&this.options.tooltip);p.on("mouseover",function(t,e){const n=ps(e._originalColor);if(Ut(this).attr("fill",n),m)try{var r=0;try{var i=0;Array.isArray(e.data.__pie_source__)?i=e.data.__pie_source__.reduce((t,e)=>t+(e[c]||0),0):this&&this.data?i=this.data.reduce((t,e)=>t+(e[c]||0),0):r=(e.endAngle-e.startAngle)/(2*Math.PI)*100,i>0&&(r=e.data[c]/i*100)}catch(o){r=(e.endAngle-e.startAngle)/(2*Math.PI)*100}const n=()=>`<strong>${e.data[l]}</strong>Value: ${e.data[c]}<br/>Percentage: ${((e.endAngle-e.startAngle)/(2*Math.PI)*100).toFixed(1)}%`;return void ws(t,m,r,e.data,g,y,n)}catch(o){console.warn("PieChart: tooltip formatter failed",o)}xs(t,`<strong>${e.data[l]}</strong>Value: ${e.data[c]}<br/>Percentage: ${((e.endAngle-e.startAngle)/(2*Math.PI)*100).toFixed(1)}%`,g,y)}).on("mouseout",function(t,e){Ut(this).attr("fill",e._originalColor),vs()});return d.append("text").attr("transform",t=>{const[e,n]=s.centroid(t);return`translate(${e},${n})`}).attr("text-anchor","middle").attr("font-size","14px").attr("fill",t=>ds(u?t.data[u]:"#999")).style("font-weight","bold").each(function(t){const e=Ut(this),r=(t.endAngle-t.startAngle)/(2*Math.PI)*100;e.selectAll("*").remove(),"count"===h.labelMode?(e.append("tspan").attr("x",0).attr("dy","-6").text(t.data[l]||""),e.append("tspan").attr("x",0).attr("dy","14").text(null!=t.data[c]?t.data[c].toString():"")):r>5&&(e.append("tspan").attr("x",0).attr("dy","-6").text(t.data[l]||""),e.append("tspan").attr("x",0).attr("dy","14").text(`${r.toFixed(1)}%`));try{const r=e.node().getBBox().width||0,i=.7*n;r>.9*((t.endAngle-t.startAngle)*i)&&e.style("display","none")}catch(i){}}),this}},LineChart:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Line chart requires x and y fields");this.xField=e.x,this.yField=e.y,this.groupField=e.group,this.colorField=e.color,this.area=e.area||!1,this.stacked=e.stacked||!1}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.xField,this.yField]);let t=[this.data];if(this.groupField){const e=f(this.data,t=>t[this.groupField]);t=Array.from(e.values())}const e=this.options.height-this.options.margin.top-this.options.margin.bottom,n=ia().domain([0,x(this.data,t=>t[this.yField])]).nice().range([e,0]),r=E(n);this.options.axisFormatters&&this.options.axisFormatters.y&&r.tickFormat(this.options.axisFormatters.y);const i=this.svg.append("g").attr("class","d3po-probe-group");i.call(r);let o=0;try{const t=i.selectAll(".tick text").nodes();t&&t.length&&(o=x(t,t=>t.getBBox().width)||0)}catch(v){}i.remove();const s=void 0!==this.yLabelGap?this.yLabelGap:12;let l=0;try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"");l=t.node().getBBox().height||0,t.remove()}catch(v){l=14}const c=Math.ceil(o+s+l+8),u=this.options&&this.options.margin&&this.options.margin.left||60;let h=Math.max(u,c);if(h!==u){this.options.margin.left=h;try{this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`)}catch(v){}}const d=ia().domain(a(this.data,t=>t[this.xField])).nice().range([0,this.getInnerWidth()]);n.range([this.getInnerHeight(),0]),_s(this.chart,d,n,this.getInnerWidth(),this.getInnerHeight(),this.options,this.xField,this.yField,void 0!==this.yLabelGap?this.yLabelGap:12,o,l),this.chart.append("g").attr("class","grid").call(E(n).ticks(6).tickSize(-this.getInnerWidth()).tickFormat("")).attr("opacity",.08);const p=Ha().x(t=>d(t[this.xField])).y(t=>n(t[this.yField])).curve(ja),g=Da().x(t=>d(t[this.xField])).y0(this.getInnerHeight()).y1(t=>n(t[this.yField])).curve(ja),y=Xo(pa).domain(t.map((t,e)=>e));let m=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const e=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),n=e.length?e:null;n&&(m={},t.forEach((t,e)=>{const r=this.groupField?t[0][this.groupField]:e;m[r]=hs(n[e%n.length])}))}return t.forEach((t,e)=>{const r=this.groupField?t[0][this.groupField]:e,i=m?m[r]:this.colorField?hs(t[0][this.colorField]):y(e);this.area&&this.chart.append("path").datum(t).attr("class","area").attr("d",g).attr("fill",i).style("opacity",1),this.chart.append("path").datum(t).attr("class","line").attr("d",p).attr("fill","none").attr("stroke",i).attr("stroke-width",2);var o=bs(this.tooltip,this.options&&this.options.tooltip);this.chart.selectAll(`.point-${e}`).data(t).enter().append("circle").attr("class",`point-${e}`).attr("cx",t=>d(t[this.xField])).attr("cy",t=>n(t[this.yField])).attr("r",4).attr("fill",i).attr("stroke","#fff").attr("stroke-width",1.2).on("mouseover",(t,e)=>{const n=Ut(t.currentTarget),a=ps(i);if(n.raise().attr("r",8).attr("fill",a),o){const n=()=>(this.groupField&&r?`<strong>${r}</strong>`:"")+`${this.xField}: ${e[this.xField]}<br/>${this.yField}: ${e[this.yField]}`;ws(t,o,null,e,this.options.fontFamily,this.options.fontSize,n)}else xs(t,(this.groupField&&r?`<strong>${r}</strong>`:"")+`${this.xField}: ${e[this.xField]}<br/>${this.yField}: ${e[this.yField]}`,this.options.fontFamily,this.options.fontSize)}).on("mouseout",t=>{Ut(t.currentTarget).attr("r",4).attr("fill",i),vs()})}),this}},AreaChart:class extends Ss{constructor(t,e){if(super(t,e),!e||!e.x||!e.y)throw new Error("Area chart requires x and y fields");this.xField=e.x,this.yField=e.y,this.groupField=e.group,this.colorField=e.color}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.xField,this.yField]);const t=!(!this.options||!0!==this.options.stack&&"stacked"!==this.options.type),e=Array.from(new Set(this.data.map(t=>t[this.xField]))).sort((t,e)=>t-e),n=ia().domain(a(e)).nice().range([0,this.getInnerWidth()]);let r=null,i=[],o=x(this.data,t=>+t[this.yField]||0)||0;if(t&&this.groupField){i=Array.from(new Set(this.data.map(t=>String(null==t[this.groupField]?"":t[this.groupField]))));const t=e.map(t=>{const e={[this.xField]:t};return i.forEach(t=>e[t]=0),e}),n=new Map(t.map(t=>[String(t[this.xField]),t]));this.data.forEach(t=>{const e=t[this.xField],r=String(null==t[this.groupField]?"":t[this.groupField]),i=Number(t[this.yField])||0,o=n.get(String(e));o&&(o[r]=(o[r]||0)+i)}),r=Ka().keys(i)(t),i=r.map(t=>String(t.key)),o=x(t,t=>i.reduce((e,n)=>e+(t[n]||0),0))||0}const s=ia().domain([0,o]).nice().range([this.getInnerHeight(),0]);let l=0,c=0;try{const t=this.svg.append("g").attr("class","d3po-probe"),e=E(s);this.options.axisFormatters&&this.options.axisFormatters.y&&e.tickFormat(this.options.axisFormatters.y),t.call(e);try{const e=t.selectAll(".tick text").nodes();e&&e.length&&(l=x(e,t=>t.getBBox().width)||0)}catch(p){}t.remove();try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);c=t.node().getBBox().height||0,t.remove()}catch(p){c=14}const r=void 0!==this.yLabelGap?this.yLabelGap:12,i=Math.ceil(l+r+c+8);i>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin.left=i,n.range([0,this.getInnerWidth()]),s.range([this.getInnerHeight(),0]),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(p){}_s(this.chart,n,s,this.getInnerWidth(),this.getInnerHeight(),this.options,this.xField,this.yField);const u=bs(this.tooltip,this.options&&this.options.tooltip),h=fs(this.data,this.colorField,ya),d=t=>null==t?t:String(t).replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase());if(t&&this.groupField&&r){const t=Da().x(t=>n(t.data[this.xField])).y0(t=>s(t[0])).y1(t=>s(t[1])).curve(ja);r.forEach((e,r)=>{const o=i[r],a=this.data.find(t=>String(t[this.groupField])===o),l=h(a||{group:o}),c=this.options&&null!=this.options.stackFillOpacity,u=this.options&&null!=this.options.stackTint?Number(this.options.stackTint):.3,f=c?l||h(o):gs(l||h(o),u);this.chart.append("path").datum(e).attr("d",t).attr("fill",f).attr("fill-opacity",c?this.options.stackFillOpacity:1);const d=Ha().x(t=>n(t.data[this.xField])).y(t=>s(t[1])).curve(ja);this.chart.append("path").datum(e).attr("d",d).attr("fill","none").attr("stroke",l||h(o)).attr("stroke-width",1.5)});const e=this.chart.append("g").attr("class","points-layer");r.forEach((t,r)=>{const o=i[r],a=this.data.find(t=>String(t[this.groupField])===o),l=h(a||{group:o});e.selectAll(`.point-stack-${r}`).data(t).enter().append("circle").attr("cx",t=>n(t.data[this.xField])).attr("cy",t=>s(t[1])).attr("r",4).attr("fill",l||h(o)).attr("stroke","#fff").each(function(){this.__origR=+Ut(this).attr("r"),this.__origFill=Ut(this).attr("fill")}).on("mouseover",(t,e)=>{const n=Ut(t.currentTarget),r=n.attr("fill")||l||h(o);n.raise().attr("r",8).attr("fill",ps(r));const i=e.data||e;ws(t,u,null,i,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`<strong>${Fs(String(d(o)))}</strong>${Fs(String(d(this.xField)))}: ${Fs(String(e.data[this.xField]))}<br/>Value: ${Fs(String((e[1]-e[0]).toFixed?(e[1]-e[0]).toFixed(6):e[1]-e[0]))}`)}).on("mouseout",function(){const t=Ut(this);null!=this.__origR&&t.attr("r",this.__origR),null!=this.__origFill&&t.attr("fill",this.__origFill),vs()})})}else{let t=[this.data];if(this.groupField){const e=f(this.data,t=>t[this.groupField]);t=Array.from(e.values()),t=t.map(t=>({series:t,total:w(t,t=>Number(t[this.yField])||0)})),t.sort((t,e)=>e.total-t.total),t=t.map(t=>t.series)}const e=Da().x(t=>n(t[this.xField])).y0(this.getInnerHeight()).y1(t=>s(t[this.yField])).curve(ja),r=Ha().x(t=>n(t[this.xField])).y(t=>s(t[this.yField])).curve(ja);t.forEach((t,n)=>{const i=t[0]?h(t[0]):h({group:n}),o=this.options&&null!=this.options.areaFillOpacity,a=this.options&&null!=this.options.areaTint?Number(this.options.areaTint):.12,s=o?i:gs(i,a);this.chart.append("path").datum(t).attr("d",e).attr("fill",s).attr("fill-opacity",o?this.options.areaFillOpacity:1).attr("stroke",i).attr("stroke-width",1).style("pointer-events","none"),this.chart.append("path").datum(t).attr("d",r).attr("fill","none").attr("stroke",i).attr("stroke-width",1.5).style("pointer-events","none")});const i=this.chart.append("g").attr("class","points-layer");t.forEach((t,e)=>{const r=t[0]?h(t[0]):h({group:e});i.selectAll(`.point-${e}`).data(t).enter().append("circle").attr("cx",t=>n(t[this.xField])).attr("cy",t=>s(t[this.yField])).attr("r",4).attr("fill",r).attr("stroke","#fff").style("cursor","pointer").style("pointer-events","all").each(function(){this.__origR=+Ut(this).attr("r"),this.__origFill=Ut(this).attr("fill")}).on("mouseover",(e,n)=>{const i=Ut(e.currentTarget),o=i.attr("fill")||r;i.raise().attr("r",8).attr("fill",ps(o));ws(e,u,null,n||null,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`${this.groupField&&t[0]&&null!=t[0][this.groupField]?`<strong>${Fs(String(d(n[this.groupField]||t[0][this.groupField])))}</strong>`:""}${Fs(String(d(this.xField)))}: ${Fs(String(n[this.xField]))}<br/>${Fs(String(d(this.yField)))}: ${Fs(String(n[this.yField]))}`)}).on("click",(e,n)=>{ws(e,u,null,n||null,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`${this.groupField&&t[0]&&null!=t[0][this.groupField]?`<strong>${Fs(String(d(n[this.groupField]||t[0][this.groupField])))}</strong><br/>`:""}${Fs(String(d(this.xField)))}: ${Fs(String(n[this.xField]))}<br/>${Fs(String(d(this.yField)))}: ${Fs(String(n[this.yField]))}`)}).on("mouseout",function(){const t=Ut(this);null!=this.__origR&&t.attr("r",this.__origR),null!=this.__origFill&&t.attr("fill",this.__origFill),vs()})})}return this}},ScatterPlot:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Scatter plot requires x and y fields");this.xField=e.x,this.yField=e.y,this.sizeField=e.size,this.groupField=e.group,this.colorField=e.color}render(){if(!this.data)throw new Error("No data provided");Ms(this.data,[this.xField,this.yField]);const t=this.options.height-this.options.margin.top-this.options.margin.bottom,e=ia().domain(a(this.data,t=>t[this.yField])).nice().range([t,0]),n=E(e);this.options.axisFormatters&&this.options.axisFormatters.y&&n.tickFormat(this.options.axisFormatters.y);const r=this.svg.append("g").attr("class","d3po-probe-group");r.call(n);let i=0;try{const t=r.selectAll(".tick text").nodes();t&&t.length&&(i=x(t,t=>t.getBBox().width)||0)}catch(k){}r.remove();let o=0;try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);o=t.node().getBBox().height||0,t.remove()}catch(k){o=14}const s=void 0!==this.yLabelGap?this.yLabelGap:12,l=Math.ceil(i+s+o+8),c=this.options&&this.options.margin&&this.options.margin.left||60;let u=Math.max(c,l);if(u!==c){this.options.margin.left=u;try{this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`)}catch(k){}}const h=ia().domain(a(this.data,t=>t[this.xField])).nice().range([0,this.getInnerWidth()]);e.range([this.getInnerHeight(),0]);const f=this.sizeField?ua().domain(a(this.data,t=>t[this.sizeField])).range([3,20]):()=>5;_s(this.chart,h,e,this.getInnerWidth(),this.getInnerHeight(),this.options,this.xField,this.yField,void 0!==this.yLabelGap?this.yLabelGap:12,i,o);const d=this.xField,p=this.yField,g=this.sizeField,y=this.groupField,m=fs(this.data,this.colorField,ya),v=this.chart.selectAll(".point").data(this.data).enter().append("circle").attr("class","point").attr("cx",t=>h(t[d])).attr("cy",t=>e(t[p])).attr("r",t=>g?f(t[g]):5).each(function(t){t._originalRadius=g?f(t[g]):5,t._originalColor=m(t)}).attr("fill",t=>m(t)).attr("stroke","white").attr("stroke-width",1).style("opacity",1),b=this.options.fontFamily,w=this.options.fontSize;var _=bs(this.tooltip,this.options&&this.options.tooltip);const F=t=>"number"==typeof t&&Number.isFinite(t)?t.toFixed(2):t;return v.on("mouseover",function(t,e){const n=ps(e._originalColor);if(Ut(this).raise().attr("r",2*e._originalRadius).attr("fill",n),_){ws(t,_,null,e,b,w,()=>(y&&e&&e[y]?`<strong>${Fs(String(e[y]))}</strong>`:"")+`${Fs(String(d))}: ${Fs(String(F(e[d])))}<br/>${Fs(String(p))}: ${Fs(String(F(e[p])))}`+(g?`<br/>size: ${Fs(String(F(e[g])))}`:""))}else{xs(t,(y&&e&&e[y]?`<strong>${Fs(String(e[y]))}</strong>`:"")+`${Fs(String(d))}: ${Fs(String(F(e[d])))}<br/>${Fs(String(p))}: ${Fs(String(F(e[p])))}`+(g?`<br/>size: ${Fs(String(F(e[g])))}`:""),b,w)}}).on("mouseout",function(t,e){Ut(this).attr("r",e._originalRadius).attr("fill",e._originalColor),vs()}),this}},GeoMap:class extends Ss{constructor(t,e){super(t,e),this.geom=e&&e.geomap_data?e.geomap_data:null,this.groupField=e.group,this.sizeField=e.size,this.tooltipField=e.tooltip,this.colorField=e.color}render(){const t=this.getInnerWidth(),e=this.getInnerHeight(),n=this.options.geomap_data||this.geom||this.data&&this.data.geomap_data||null;if(!n)return this;this.chart.selectAll("*").remove();let r=n.features;if(!r&&n.objects){const t=Object.keys(n.objects);t.length>0&&(r=(i=n,o=n.objects[t[0]],"string"==typeof o&&(o=i.objects[o]),"GeometryCollection"===o.type?{type:"FeatureCollection",features:o.geometries.map(function(t){return zs(i,t)})}:zs(i,o)).features)}var i,o;if(!r)return this;const s={type:"FeatureCollection",features:r},l=Fo().projection(null).bounds(s),c=t-((this.options.gradient||this.options.discrete_palette&&Array.isArray(this.options.discrete_palette)&&this.options.discrete_palette.length>0)&&this.sizeField&&this.data?Math.max(100,.15*t):0),u=l[1][0]-l[0][0],h=l[1][1]-l[0][1],f=(l[0][0]+l[1][0])/2,d=(l[0][1]+l[1][1])/2,p=1/Math.max(u/c*.85,h/e),g=[c/2-p*f,e/2+p*d],y=$o().reflectY(!0).scale(p).translate(g),m=Fo().projection(y),b=new Map;let w;this.data&&this.groupField&&this.data.forEach(t=>{const e=t[this.groupField];null!=e&&b.set(String(e),t)});let _=!1,F=!1;if((t=>{if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=Object.keys(t);return e.length>0&&e.every(e=>"string"==typeof t[e])})(this.colorField)){F=!0;const t=r.map(t=>t.properties).filter(t=>t);w=fs(t,this.colorField,Xo(pa))}const k=this.options.discrete_palette&&Array.isArray(this.options.discrete_palette)&&this.options.discrete_palette.length>0;if(k&&this.options.gradient&&this.sizeField&&this.data){const t=this.options.discrete_palette,e=this.data.map(t=>t[this.sizeField]).filter(t=>null!=t&&!isNaN(t));if(e.length>0){const n=a(e),r=Ue(t);w=fa(r).domain(n)}}else if(k&&this.sizeField&&this.data){const t=this.options.discrete_palette,e=this.data.map(t=>t[this.sizeField]).filter(t=>null!=t&&!isNaN(t));e.length>0&&(w=ha().domain(e).range(t),_=!0)}else if(this.options.gradient&&this.sizeField&&this.data){const t=a(this.data.map(t=>t[this.sizeField]).filter(t=>null!=t));w=fa(ya).domain(t)}else if(this.colorField&&this.data){const t=[...new Set(this.data.map(t=>t[this.colorField]))],e=t.length>0&&t.every(t=>"string"==typeof t&&/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?([0-9A-Fa-f]{2})?$/.test(t));w=e?null:Xo(pa).domain(t)}else if(this.groupField&&this.data){const t=[...new Set(this.data.map(t=>t[this.groupField]))];w=Xo(pa).domain(t)}const M=this.chart.append("g").attr("class","map"),A=us().scaleExtent([1,8]).on("zoom",t=>{M.attr("transform",t.transform)});this.svg.call(A);const $=M.selectAll("path").data(r).enter().append("path").attr("d",m).attr("fill",t=>{var e,n,r,i;const o=(null==(e=t.properties)?void 0:e[this.groupField])||(null==(n=t.properties)?void 0:n.region_iso)||(null==(r=t.properties)?void 0:r.name)||(null==(i=t.properties)?void 0:i.NAME),a=b.get(String(o));if(!a)return"#cccccc";if(w){if(F)return w(t.properties);if(_&&this.sizeField){const t=a[this.sizeField];return null==t||isNaN(t)?"#cccccc":w(t)}if(this.options.gradient&&this.sizeField){const t=a[this.sizeField];return null==t||isNaN(t)?"#cccccc":w(t)}if(this.colorField){const t=a[this.colorField];return null==t?"#cccccc":w(t)}if(o)return w(o)}else if(this.colorField&&a[this.colorField])return a[this.colorField];return this.options.fill||"#cce5df"}).attr("stroke",this.options.stroke||"#333").attr("stroke-width",1).style("cursor","pointer").each(function(t){const e=Ut(this);e.attr("data-original-fill",e.attr("fill"))});if((this.options.gradient||_)&&w&&this.sizeField){const n=20,r=200,i=t-n-10,o=(e-r)/2,a=this.chart.append("g").attr("class","legend").attr("transform",`translate(${i}, ${o})`);if(_){const t=this.options.discrete_palette,e=r/t.length,i=w.quantiles(),o=this.data.map(t=>t[this.sizeField]).filter(t=>null!=t&&!isNaN(t)),s=v(o),l=x(o);t.forEach((t,i)=>{a.append("rect").attr("x",0).attr("y",r-(i+1)*e).attr("width",n).attr("height",e).style("fill",t).style("stroke","#333").style("stroke-width",.5)});[s,...i,l].forEach((t,i)=>{const o=r-i*e;a.append("text").attr("x",n+5).attr("y",o).attr("dy","0.3em").style("font-size",this.options.fontSize||"10px").style("font-family",this.options.fontFamily||"sans-serif").text(Yr(".1f")(t))})}else{const t=this.svg.append("defs").append("linearGradient").attr("id",`gradient-${this.container.id}`).attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%"),e=10;for(let n=0;n<=e;n++){const r=n/e;t.append("stop").attr("offset",100*r+"%").attr("stop-color",w(w.domain()[0]+r*(w.domain()[1]-w.domain()[0])))}a.append("rect").attr("width",n).attr("height",r).style("fill",`url(#gradient-${this.container.id})`).style("stroke","#333").style("stroke-width",1);const i=function(t){return N(2,t)}(ia().domain(w.domain()).range([r,0])).ticks(5).tickFormat(Yr(".0f"));a.append("g").attr("transform",`translate(${n}, 0)`).call(i).style("font-size",this.options.fontSize||"12px").style("font-family",this.options.fontFamily||"sans-serif")}}const S=this.options.fontFamily,z=this.options.fontSize,E=this;return $.on("mouseover",function(t,e){const n=Ut(this),r=ps(n.attr("data-original-fill"));n.attr("fill",r);const i=e.properties&&(e.properties[E.groupField]||e.properties.region_iso||e.properties.name||e.properties.NAME||e.properties.id)||"Region",o=b.get(String(i)),a=o&&E.tooltipField&&o[E.tooltipField]?o[E.tooltipField]:i;let s=`<strong>${Fs(String(a))}</strong>`;o&&E.sizeField&&null!=o[E.sizeField]&&(s+=`Value: ${Fs(String(o[E.sizeField]))}`),xs(t,s,S,z)}).on("mouseout",function(){const t=Ut(this),e=t.attr("data-original-fill");e&&t.attr("fill",e),vs()}),this}},Network:class extends Ss{constructor(t,e){if(super(t,e),!e.nodes||!e.links)throw new Error("Network requires nodes and links");this.nodes=e.nodes,this.links=e.links,this.sizeField=e.size,this.colorField=e.color,this.layout=e.layout||"force",this.movable=void 0!==e.move&&e.move}render(){const t=this.getInnerWidth(),e=this.getInnerHeight(),n=`clip-${Math.random().toString(36).substr(2,9)}`;this.svg.append("defs").append("clipPath").attr("id",n).append("rect").attr("x",0).attr("y",0).attr("width",t).attr("height",e),this.chart.attr("clip-path",`url(#${n})`);const r=this.sizeField?ua().domain(a(this.nodes,t=>t[this.sizeField])).range([5,20]):()=>8,i="manual"===this.options.layout;if(i){const n=a(this.nodes,t=>t.x),r=a(this.nodes,t=>t.y),i=n[1]-n[0],o=r[1]-r[0];if(i<.5*t||o<.5*e){const a=Math.max(.15*i,.5),s=Math.max(.15*o,.5),l=ia().domain([n[0]-a,n[1]+a]).range([80,t-80]),c=ia().domain([r[0]-s,r[1]+s]).range([80,e-80]);this.nodes.forEach(n=>{void 0===n.x||void 0===n.y?(n.x=t/2,n.y=e/2):(n.x=l(n.x),n.y=c(n.y)),n.fx=n.x,n.fy=n.y})}else this.nodes.forEach(n=>{void 0!==n.x&&void 0!==n.y||(n.x=t/2,n.y=e/2),n.fx=n.x,n.fy=n.y})}const o=Lr(this.nodes);i?(o.force("link",Er(this.links).id(t=>t.id).distance(0).strength(0)),o.tick(),o.stop()):o.force("link",Er(this.links).id(t=>t.id).distance(100)).force("charge",function(){var t,e,n,r,i,o=Mr(-30),a=1,s=1/0,l=.81;function c(n){var i,o=t.length,a=wr(t,Cr,Pr).visitAfter(h);for(r=n,i=0;i<o;++i)e=t[i],a.visit(f)}function u(){if(t){var e,n,r=t.length;for(i=new Array(r),e=0;e<r;++e)n=t[e],i[n.index]=+o(n,e,t)}}function h(t){var e,n,r,o,a,s=0,l=0;if(t.length){for(r=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,l+=n,r+=n*e.x,o+=n*e.y);t.x=r/l,t.y=o/l}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=i[e.data.index]}while(e=e.next)}t.value=s}function f(t,o,c,u){if(!t.value)return!0;var h=t.x-e.x,f=t.y-e.y,d=u-o,p=h*h+f*f;if(d*d/l<p)return p<s&&(0===h&&(p+=(h=Ar(n))*h),0===f&&(p+=(f=Ar(n))*f),p<a&&(p=Math.sqrt(a*p)),e.vx+=h*t.value*r/p,e.vy+=f*t.value*r/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===h&&(p+=(h=Ar(n))*h),0===f&&(p+=(f=Ar(n))*f),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(d=i[t.data.index]*r/p,e.vx+=h*d,e.vy+=f*d)}while(t=t.next)}}return c.initialize=function(e,r){t=e,n=r,u()},c.strength=function(t){return arguments.length?(o="function"==typeof t?t:Mr(+t),u(),c):o},c.distanceMin=function(t){return arguments.length?(a=t*t,c):Math.sqrt(a)},c.distanceMax=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c.theta=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c}().strength(-300)).force("center",function(t,e){var n,r=1;function i(){var i,o,a=n.length,s=0,l=0;for(i=0;i<a;++i)s+=(o=n[i]).x,l+=o.y;for(s=(s/a-t)*r,l=(l/a-e)*r,i=0;i<a;++i)(o=n[i]).x-=s,o.y-=l}return null==t&&(t=0),null==e&&(e=0),i.initialize=function(t){n=t},i.x=function(e){return arguments.length?(t=+e,i):t},i.y=function(t){return arguments.length?(e=+t,i):e},i.strength=function(t){return arguments.length?(r=+t,i):r},i}(t/2,e/2)).force("collision",function(t){var e,n,r,i=1,o=1;function a(){for(var t,a,l,c,u,h,f,d=e.length,p=0;p<o;++p)for(a=wr(e,$r,Sr).visitAfter(s),t=0;t<d;++t)l=e[t],h=n[l.index],f=h*h,c=l.x+l.vx,u=l.y+l.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,d=t.r,p=h+d;if(!s)return e>c+p||o<c-p||n>u+p||a<u-p;if(s.index>l.index){var g=c-s.x-s.vx,y=u-s.y-s.vy,m=g*g+y*y;m<p*p&&(0===g&&(m+=(g=Ar(r))*g),0===y&&(m+=(y=Ar(r))*y),m=(p-(m=Math.sqrt(m)))/m*i,l.vx+=(g*=m)*(p=(d*=d)/(f+d)),l.vy+=(y*=m)*p,s.vx-=g*(p=1-p),s.vy-=y*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var r,i,o=e.length;for(n=new Array(o),r=0;r<o;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=Mr(null==t?1:+t)),a.initialize=function(t,n){e=t,r=n,l()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(i=+t,a):i},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:Mr(+e),l(),a):t},a}().radius(t=>r(t[this.sizeField]||8)+5));const s=this.chart.selectAll(".link").data(this.links).enter().append("line").attr("class","link").attr("stroke","#999").attr("stroke-opacity",1).attr("stroke-width",2),l=this.sizeField,c=this.colorField;let u=null;if(Array.isArray(c)||c&&"object"==typeof c){const t=Array.isArray(c)?c:Object.values(c||{}),e=t.length?t:null;e&&(u={},this.nodes.forEach((t,n)=>{u[t.id]=hs(e[n%e.length])}))}const h=this.chart.selectAll(".node").data(this.nodes).enter().append("circle").attr("class","node").attr("r",t=>r(t[this.sizeField]||8)).attr("fill",t=>u?u[t.id]||"#69b3a2":"string"==typeof c?t[c]||"#69b3a2":ya(Math.random())).each(function(t){t._originalColor=u?u[t.id]:"string"==typeof c?t[c]:ya(Math.random())}).attr("stroke","white").attr("stroke-width",2).style("cursor",this.movable?"move":"pointer");this.movable&&h.call(function(){var t,e,n,r,i=ae,o=se,a=le,s=ce,l={},c=C("start","drag","end"),u=0,h=0;function f(t){t.on("mousedown.drag",d).filter(s).on("touchstart.drag",y).on("touchmove.drag",m,Zt).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(a,s){if(!r&&i.call(this,a,s)){var l=v(this,o.call(this,a,s),a,s,"mouse");l&&(Ut(a.view).on("mousemove.drag",p,Qt).on("mouseup.drag",g,Qt),ne(a.view),te(a),n=!1,t=a.clientX,e=a.clientY,l("start",a))}}function p(r){if(ee(r),!n){var i=r.clientX-t,o=r.clientY-e;n=i*i+o*o>h}l.mouse("drag",r)}function g(t){Ut(t.view).on("mousemove.drag mouseup.drag",null),re(t.view,n),ee(t),l.mouse("end",t)}function y(t,e){if(i.call(this,t,e)){var n,r,a=t.changedTouches,s=o.call(this,t,e),l=a.length;for(n=0;n<l;++n)(r=v(this,s,t,e,a[n].identifier,a[n]))&&(te(t),r("start",t,a[n]))}}function m(t){var e,n,r=t.changedTouches,i=r.length;for(e=0;e<i;++e)(n=l[r[e].identifier])&&(ee(t),n("drag",t,r[e]))}function x(t){var e,n,i=t.changedTouches,o=i.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),e=0;e<o;++e)(n=l[i[e].identifier])&&(te(t),n("end",t,i[e]))}function v(t,e,n,r,i,o){var s,h,d,p=c.copy(),g=Jt(o||n,e);if(null!=(d=a.call(t,new oe("beforestart",{sourceEvent:n,target:f,identifier:i,active:u,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),r)))return s=d.x-g[0]||0,h=d.y-g[1]||0,function n(o,a,c){var y,m=g;switch(o){case"start":l[i]=n,y=u++;break;case"end":delete l[i],--u;case"drag":g=Jt(c||a,e),y=u}p.call(o,t,new oe(o,{sourceEvent:a,subject:d,target:f,identifier:i,active:y,x:g[0]+s,y:g[1]+h,dx:g[0]-m[0],dy:g[1]-m[1],dispatch:p}),r)}}return f.filter=function(t){return arguments.length?(i="function"==typeof t?t:ie(!!t),f):i},f.container=function(t){return arguments.length?(o="function"==typeof t?t:ie(t),f):o},f.subject=function(t){return arguments.length?(a="function"==typeof t?t:ie(t),f):a},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:ie(!!t),f):s},f.on=function(){var t=c.on.apply(c,arguments);return t===c?f:t},f.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,f):Math.sqrt(h)},f}().on("start",(t,e)=>{t.active||o.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}).on("drag",(t,e)=>{e.fx=t.x,e.fy=t.y}).on("end",t=>{t.active||o.alphaTarget(0)}));const f=this.options.fontFamily,d=this.options.fontSize;let p=bs(this.tooltip,this.options&&this.options.tooltip);h.on("mouseover",function(t,e){const n=ps(e._originalColor);if(Ut(this).attr("fill",n),p)try{const n=p(null,e);if(null!=n)return void xs(t,n,f,d)}catch(c){}const r=Fs(e.id||"Node"),i=[];l&&i.push(l),i.push("value","size","count");let o=null,a=null;for(const l of i)if(null!=e[l]){o=l,a=e[l];break}let s=`<strong>${r}</strong>`;null!=o&&(s+=`${Fs(String(o))}: ${Fs(String(a))}`),xs(t,s,f,d)}).on("mouseout",function(t,e){Ut(this).attr("fill",e._originalColor),vs()});const g=this.chart.selectAll(".label").data(this.nodes).enter().append("text").attr("class","label").attr("text-anchor","middle").attr("dy",4).attr("font-size","10px").attr("pointer-events","none").text(t=>t.id||"");o.on("tick",()=>{s.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),h.attr("cx",t=>t.x).attr("cy",t=>t.y),g.attr("x",t=>t.x).attr("y",t=>t.y)}),i&&(s.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),h.attr("cx",t=>t.x).attr("cy",t=>t.y),g.attr("x",t=>t.x).attr("y",t=>t.y));const y=us().scaleExtent([.5,5]).on("zoom",t=>{s.attr("transform",t.transform),h.attr("transform",t.transform),g.attr("transform",t.transform)});return this.svg.call(y),this}}};return Es});
