!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).d3po=e()}(this,function(){"use strict";function t(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function e(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function n(n){let r,o,a;function s(t,e,n=0,i=t.length){if(n<i){if(0!==r(e,e))return i;do{const r=n+i>>>1;o(t[r],e)<0?n=r+1:i=r}while(n<i)}return n}return 2!==n.length?(r=t,o=(e,i)=>t(n(e),i),a=(t,e)=>n(t)-e):(r=n===t||n===e?n:i,o=n,a=n),{left:s,center:function(t,e,n=0,i=t.length){const r=s(t,e,n,i-1);return r>n&&a(t[r-1],e)>-a(t[r],e)?r-1:r},right:function(t,e,n=0,i=t.length){if(n<i){if(0!==r(e,e))return i;do{const r=n+i>>>1;o(t[r],e)<=0?n=r+1:i=r}while(n<i)}return n}}}function i(){return 0}function r(t){return null===t?NaN:+t}const o=n(t).right;function a(t,e){let n,i;if(void 0===e)for(const r of t)null!=r&&(void 0===n?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let o of t)null!=(o=e(o,++r,t))&&(void 0===n?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}n(r).center;class s{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const r=e[i],o=t+r,a=Math.abs(t)<Math.abs(r)?t-(o-r):r-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,i,r=this._n,o=0;if(r>0){for(o=t[--r];r>0&&(e=o,n=t[--r],o=e+n,i=n-(o-e),!i););r>0&&(i<0&&t[r-1]<0||i>0&&t[r-1]>0)&&(n=2*i,e=o+n,n==e-o&&(o=e))}return o}}class l extends Map{constructor(t,e=h){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[n,i]of t)this.set(n,i)}get(t){return super.get(c(this,t))}has(t){return super.has(c(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const i=e(n);t.has(i)&&(n=t.get(i),t.delete(i));return n}(this,t))}}function c({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function h(t){return null!==t&&"object"==typeof t?t.valueOf():t}function u(t){return t}function f(t,...e){return function(t,e,n,i){return function t(r,o){if(o>=i.length)return n(r);const a=new l,s=i[o++];let c=-1;for(const e of r){const t=s(e,++c,r),n=a.get(t);n?n.push(e):a.set(t,[e])}for(const[e,n]of a)a.set(e,t(n,o));return e(a)}(t,0)}(t,u,u,e)}const d=Math.sqrt(50),p=Math.sqrt(10),g=Math.sqrt(2);function y(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),a=o>=d?10:o>=p?5:o>=g?2:1;let s,l,c;return r<0?(c=Math.pow(10,-r)/a,s=Math.round(t*c),l=Math.round(e*c),s/c<t&&++s,l/c>e&&--l,c=-c):(c=Math.pow(10,r)*a,s=Math.round(t/c),l=Math.round(e/c),s*c<t&&++s,l*c>e&&--l),l<s&&.5<=n&&n<2?y(t,e,2*n):[s,l,c]}function m(t,e,n){return y(t=+t,e=+e,n=+n)[2]}function x(t,e){let n;if(void 0===e)for(const i of t)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function v(t,e){let n;if(void 0===e)for(const i of t)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function b(t,e,n=r){if((i=t.length)&&!isNaN(e=+e)){if(e<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,o=(i-1)*e,a=Math.floor(o),s=+n(t[a],a,t);return s+(+n(t[a+1],a+1,t)-s)*(o-a)}}function w(t,e){let n=0;if(void 0===e)for(let i of t)(i=+i)&&(n+=i);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&(n+=r)}return n}function _(t){return t}var F=1e-6;function k(t){return"translate("+t+",0)"}function M(t){return"translate(0,"+t+")"}function A(t){return e=>+t(e)}function S(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function $(){return!this.__axis}function N(t,e){var n=[],i=null,r=null,o=6,a=6,s=3,l="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===t||4===t?-1:1,h=4===t||2===t?"x":"y",u=1===t||3===t?k:M;function f(f){var d=null==i?e.ticks?e.ticks.apply(e,n):e.domain():i,p=null==r?e.tickFormat?e.tickFormat.apply(e,n):_:r,g=Math.max(o,0)+s,y=e.range(),m=+y[0]+l,x=+y[y.length-1]+l,v=(e.bandwidth?S:A)(e.copy(),l),b=f.selection?f.selection():f,w=b.selectAll(".domain").data([null]),k=b.selectAll(".tick").data(d,e).order(),M=k.exit(),N=k.enter().append("g").attr("class","tick"),z=k.select("line"),E=k.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),k=k.merge(N),z=z.merge(N.append("line").attr("stroke","currentColor").attr(h+"2",c*o)),E=E.merge(N.append("text").attr("fill","currentColor").attr(h,c*g).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),f!==b&&(w=w.transition(f),k=k.transition(f),z=z.transition(f),E=E.transition(f),M=M.transition(f).attr("opacity",F).attr("transform",function(t){return isFinite(t=v(t))?u(t+l):this.getAttribute("transform")}),N.attr("opacity",F).attr("transform",function(t){var e=this.parentNode.__axis;return u((e&&isFinite(e=e(t))?e:v(t))+l)})),M.remove(),w.attr("d",4===t||2===t?a?"M"+c*a+","+m+"H"+l+"V"+x+"H"+c*a:"M"+l+","+m+"V"+x:a?"M"+m+","+c*a+"V"+l+"H"+x+"V"+c*a:"M"+m+","+l+"H"+x),k.attr("opacity",1).attr("transform",function(t){return u(v(t)+l)}),z.attr(h+"2",c*o),E.attr(h,c*g).text(p),b.filter($).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),b.each(function(){this.__axis=v})}return f.scale=function(t){return arguments.length?(e=t,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(t){return arguments.length?(n=null==t?[]:Array.from(t),f):n.slice()},f.tickValues=function(t){return arguments.length?(i=null==t?null:Array.from(t),f):i&&i.slice()},f.tickFormat=function(t){return arguments.length?(r=t,f):r},f.tickSize=function(t){return arguments.length?(o=a=+t,f):o},f.tickSizeInner=function(t){return arguments.length?(o=+t,f):o},f.tickSizeOuter=function(t){return arguments.length?(a=+t,f):a},f.tickPadding=function(t){return arguments.length?(s=+t,f):s},f.offset=function(t){return arguments.length?(l=+t,f):l},f}function z(t){return N(3,t)}function E(t){return N(4,t)}var T={value:()=>{}};function C(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new L(i)}function L(t){this._=t}function P(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function I(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=T,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}L.prototype=C.prototype={constructor:L,on:function(t,e){var n,i,r=this._,o=(i=r,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)r[n]=I(r[n],t.name,e);else if(null==e)for(n in r)r[n]=I(r[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=P(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new L(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(i=this._[t]).length;o<n;++o)i[o].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};var q="http://www.w3.org/1999/xhtml";const B={svg:"http://www.w3.org/2000/svg",xhtml:q,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function O(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),B.hasOwnProperty(e)?{space:B[e],local:t}:t}function j(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===q&&e.documentElement.namespaceURI===q?e.createElement(t):e.createElementNS(n,t)}}function R(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function G(t){var e=O(t);return(e.local?R:j)(e)}function H(){}function D(t){return null==t?H:function(){return this.querySelector(t)}}function V(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function X(){return[]}function Y(t){return null==t?X:function(){return this.querySelectorAll(t)}}function W(t){return function(){return this.matches(t)}}function U(t){return function(e){return e.matches(t)}}var J=Array.prototype.find;function K(){return this.firstElementChild}var Z=Array.prototype.filter;function Q(){return Array.from(this.children)}function tt(t){return new Array(t.length)}function et(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function nt(t,e,n,i,r,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],i[s]=a):n[s]=new et(t,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function it(t,e,n,i,r,o,a){var s,l,c,h=new Map,u=e.length,f=o.length,d=new Array(u);for(s=0;s<u;++s)(l=e[s])&&(d[s]=c=a.call(l,l.__data__,s,e)+"",h.has(c)?r[s]=l:h.set(c,l));for(s=0;s<f;++s)c=a.call(t,o[s],s,o)+"",(l=h.get(c))?(i[s]=l,l.__data__=o[s],h.delete(c)):n[s]=new et(t,o[s]);for(s=0;s<u;++s)(l=e[s])&&h.get(d[s])===l&&(r[s]=l)}function rt(t){return t.__data__}function ot(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function at(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function st(t){return function(){this.removeAttribute(t)}}function lt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ct(t,e){return function(){this.setAttribute(t,e)}}function ht(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ut(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function ft(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function dt(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function pt(t){return function(){this.style.removeProperty(t)}}function gt(t,e,n){return function(){this.style.setProperty(t,e,n)}}function yt(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function mt(t,e){return t.style.getPropertyValue(e)||dt(t).getComputedStyle(t,null).getPropertyValue(e)}function xt(t){return function(){delete this[t]}}function vt(t,e){return function(){this[t]=e}}function bt(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function wt(t){return t.trim().split(/^|\s+/)}function _t(t){return t.classList||new Ft(t)}function Ft(t){this._node=t,this._names=wt(t.getAttribute("class")||"")}function kt(t,e){for(var n=_t(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Mt(t,e){for(var n=_t(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function At(t){return function(){kt(this,t)}}function St(t){return function(){Mt(this,t)}}function $t(t,e){return function(){(e.apply(this,arguments)?kt:Mt)(this,t)}}function Nt(){this.textContent=""}function zt(t){return function(){this.textContent=t}}function Et(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Tt(){this.innerHTML=""}function Ct(t){return function(){this.innerHTML=t}}function Lt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Pt(){this.nextSibling&&this.parentNode.appendChild(this)}function It(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qt(){return null}function Bt(){var t=this.parentNode;t&&t.removeChild(this)}function Ot(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function jt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Rt(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function Gt(t,e,n){return function(){var i,r=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var a=0,s=r.length;a<s;++a)if((i=r[a]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=e);this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Ht(t,e,n){var i=dt(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Dt(t,e){return function(){return Ht(this,t,e)}}function Vt(t,e){return function(){return Ht(this,t,e.apply(this,arguments))}}et.prototype={constructor:et,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},Ft.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Xt=[null];function Yt(t,e){this._groups=t,this._parents=e}function Wt(){return new Yt([[document.documentElement]],Xt)}function Ut(t){return"string"==typeof t?new Yt([[document.querySelector(t)]],[document.documentElement]):new Yt([[t]],Xt)}function Jt(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function Kt(t){return"string"==typeof t?new Yt([document.querySelectorAll(t)],[document.documentElement]):new Yt([V(t)],Xt)}Yt.prototype=Wt.prototype={constructor:Yt,select:function(t){"function"!=typeof t&&(t=D(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a,s=e[r],l=s.length,c=i[r]=new Array(l),h=0;h<l;++h)(o=s[h])&&(a=t.call(o,o.__data__,h,s))&&("__data__"in o&&(a.__data__=o.__data__),c[h]=a);return new Yt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return V(t.apply(this,arguments))}}(t):Y(t);for(var e=this._groups,n=e.length,i=[],r=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(i.push(t.call(a,a.__data__,c,s)),r.push(a));return new Yt(i,r)},selectChild:function(t){return this.select(null==t?K:function(t){return function(){return J.call(this.children,t)}}("function"==typeof t?t:U(t)))},selectChildren:function(t){return this.selectAll(null==t?Q:function(t){return function(){return Z.call(this.children,t)}}("function"==typeof t?t:U(t)))},filter:function(t){"function"!=typeof t&&(t=W(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new Yt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,rt);var n,i=e?it:nt,r=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),l=new Array(a),c=new Array(a),h=0;h<a;++h){var u=r[h],f=o[h],d=f.length,p=ot(t.call(u,u&&u.__data__,h,r)),g=p.length,y=l[h]=new Array(g),m=s[h]=new Array(g);i(u,f,y,m,c[h]=new Array(d),p,e);for(var x,v,b=0,w=0;b<g;++b)if(x=y[b]){for(b>=w&&(w=b+1);!(v=m[w])&&++w<g;);x._next=v||null}}return(s=new Yt(s,r))._enter=l,s._exit=c,s},enter:function(){return new Yt(this._enter||this._groups.map(tt),this._parents)},exit:function(){return new Yt(this._exit||this._groups.map(tt),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,o=i.length,a=Math.min(r,o),s=new Array(r),l=0;l<a;++l)for(var c,h=n[l],u=i[l],f=h.length,d=s[l]=new Array(f),p=0;p<f;++p)(c=h[p]||u[p])&&(d[p]=c);for(;l<r;++l)s[l]=n[l];return new Yt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,a=r[o];--o>=0;)(i=r[o])&&(a&&4^i.compareDocumentPosition(a)&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=at);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a,s=n[o],l=s.length,c=r[o]=new Array(l),h=0;h<l;++h)(a=s[h])&&(c[h]=a);c.sort(e)}return new Yt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],a=0,s=o.length;a<s;++a)(r=o[a])&&t.call(r,r.__data__,a,o);return this},attr:function(t,e){var n=O(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?lt:st:"function"==typeof e?n.local?ft:ut:n.local?ht:ct)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?pt:"function"==typeof e?yt:gt)(t,e,null==n?"":n)):mt(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?xt:"function"==typeof e?bt:vt)(t,e)):this.node()[t]},classed:function(t,e){var n=wt(t+"");if(arguments.length<2){for(var i=_t(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?$t:e?At:St)(n,e))},text:function(t){return arguments.length?this.each(null==t?Nt:("function"==typeof t?Et:zt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Tt:("function"==typeof t?Lt:Ct)(t)):this.node().innerHTML},raise:function(){return this.each(Pt)},lower:function(){return this.each(It)},append:function(t){var e="function"==typeof t?t:G(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:G(t),i=null==e?qt:"function"==typeof e?e:D(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(Bt)},clone:function(t){return this.select(t?jt:Ot)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Gt:Rt,i=0;i<a;++i)this.each(s(o[i],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,h=s.length;c<h;++c)for(i=0,l=s[c];i<a;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Vt:Dt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,a=r.length;o<a;++o)(i=r[o])&&(yield i)}};const Zt={passive:!1},Qt={capture:!0,passive:!1};function te(t){t.stopImmediatePropagation()}function ee(t){t.preventDefault(),t.stopImmediatePropagation()}function ne(t){var e=t.document.documentElement,n=Ut(t).on("dragstart.drag",ee,Qt);"onselectstart"in e?n.on("selectstart.drag",ee,Qt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ie(t,e){var n=t.document.documentElement,i=Ut(t).on("dragstart.drag",null);e&&(i.on("click.drag",ee,Qt),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const re=t=>()=>t;function oe(t,{sourceEvent:e,subject:n,target:i,identifier:r,active:o,x:a,y:s,dx:l,dy:c,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:h}})}function ae(t){return!t.ctrlKey&&!t.button}function se(){return this.parentNode}function le(t,e){return null==e?{x:t.x,y:t.y}:e}function ce(){return navigator.maxTouchPoints||"ontouchstart"in this}function he(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function ue(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function fe(){}oe.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var de=.7,pe=1/de,ge="\\s*([+-]?\\d+)\\s*",ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",me="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xe=/^#([0-9a-f]{3,8})$/,ve=new RegExp(`^rgb\\(${ge},${ge},${ge}\\)$`),be=new RegExp(`^rgb\\(${me},${me},${me}\\)$`),we=new RegExp(`^rgba\\(${ge},${ge},${ge},${ye}\\)$`),_e=new RegExp(`^rgba\\(${me},${me},${me},${ye}\\)$`),Fe=new RegExp(`^hsl\\(${ye},${me},${me}\\)$`),ke=new RegExp(`^hsla\\(${ye},${me},${me},${ye}\\)$`),Me={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ae(){return this.rgb().formatHex()}function Se(){return this.rgb().formatRgb()}function $e(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=xe.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ne(e):3===n?new Te(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ze(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ze(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ve.exec(t))?new Te(e[1],e[2],e[3],1):(e=be.exec(t))?new Te(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=we.exec(t))?ze(e[1],e[2],e[3],e[4]):(e=_e.exec(t))?ze(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Fe.exec(t))?Be(e[1],e[2]/100,e[3]/100,1):(e=ke.exec(t))?Be(e[1],e[2]/100,e[3]/100,e[4]):Me.hasOwnProperty(t)?Ne(Me[t]):"transparent"===t?new Te(NaN,NaN,NaN,0):null}function Ne(t){return new Te(t>>16&255,t>>8&255,255&t,1)}function ze(t,e,n,i){return i<=0&&(t=e=n=NaN),new Te(t,e,n,i)}function Ee(t,e,n,i){return 1===arguments.length?((r=t)instanceof fe||(r=$e(r)),r?new Te((r=r.rgb()).r,r.g,r.b,r.opacity):new Te):new Te(t,e,n,null==i?1:i);var r}function Te(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ce(){return`#${qe(this.r)}${qe(this.g)}${qe(this.b)}`}function Le(){const t=Pe(this.opacity);return`${1===t?"rgb(":"rgba("}${Ie(this.r)}, ${Ie(this.g)}, ${Ie(this.b)}${1===t?")":`, ${t})`}`}function Pe(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ie(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function qe(t){return((t=Ie(t))<16?"0":"")+t.toString(16)}function Be(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new je(t,e,n,i)}function Oe(t){if(t instanceof je)return new je(t.h,t.s,t.l,t.opacity);if(t instanceof fe||(t=$e(t)),!t)return new je;if(t instanceof je)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),o=Math.max(e,n,i),a=NaN,s=o-r,l=(o+r)/2;return s?(a=e===o?(n-i)/s+6*(n<i):n===o?(i-e)/s+2:(e-n)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new je(a,s,l,t.opacity)}function je(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Re(t){return(t=(t||0)%360)<0?t+360:t}function Ge(t){return Math.max(0,Math.min(1,t||0))}function He(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}he(fe,$e,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ae,formatHex:Ae,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Oe(this).formatHsl()},formatRgb:Se,toString:Se}),he(Te,Ee,ue(fe,{brighter(t){return t=null==t?pe:Math.pow(pe,t),new Te(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?de:Math.pow(de,t),new Te(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Te(Ie(this.r),Ie(this.g),Ie(this.b),Pe(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ce,formatHex:Ce,formatHex8:function(){return`#${qe(this.r)}${qe(this.g)}${qe(this.b)}${qe(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Le,toString:Le})),he(je,function(t,e,n,i){return 1===arguments.length?Oe(t):new je(t,e,n,null==i?1:i)},ue(fe,{brighter(t){return t=null==t?pe:Math.pow(pe,t),new je(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?de:Math.pow(de,t),new je(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Te(He(t>=240?t-240:t+120,r,i),He(t,r,i),He(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new je(Re(this.h),Ge(this.s),Ge(this.l),Pe(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Pe(this.opacity);return`${1===t?"hsl(":"hsla("}${Re(this.h)}, ${100*Ge(this.s)}%, ${100*Ge(this.l)}%${1===t?")":`, ${t})`}`}}));const De=t=>()=>t;function Ve(t){return 1===(t=+t)?Xe:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):De(isNaN(e)?n:e)}}function Xe(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):De(isNaN(t)?e:t)}const Ye=function t(e){var n=Ve(e);function i(t,e){var i=n((t=Ee(t)).r,(e=Ee(e)).r),r=n(t.g,e.g),o=n(t.b,e.b),a=Xe(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=o(e),t.opacity=a(e),t+""}}return i.gamma=t,i}(1);var We,Ue=(We=function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],o=t[i+1],a=i>0?t[i-1]:2*r-o,s=i<e-1?t[i+2]:2*o-r;return function(t,e,n,i,r){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*i+a*r)/6}((n-i/e)*e,a,r,o,s)}},function(t){var e,n,i=t.length,r=new Array(i),o=new Array(i),a=new Array(i);for(e=0;e<i;++e)n=Ee(t[e]),r[e]=n.r||0,o[e]=n.g||0,a[e]=n.b||0;return r=We(r),o=We(o),a=We(a),n.opacity=1,function(t){return n.r=r(t),n.g=o(t),n.b=a(t),n+""}});function Je(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(o){for(n=0;n<i;++n)r[n]=t[n]*(1-o)+e[n]*o;return r}}function Ke(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,o=new Array(r),a=new Array(i);for(n=0;n<r;++n)o[n]=on(t[n],e[n]);for(;n<i;++n)a[n]=e[n];return function(t){for(n=0;n<r;++n)a[n]=o[n](t);return a}}function Ze(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Qe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function tn(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=on(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}}var en=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nn=new RegExp(en.source,"g");function rn(t,e){var n,i,r,o=en.lastIndex=nn.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=en.exec(t))&&(i=nn.exec(e));)(r=i.index)>o&&(r=e.slice(o,r),s[a]?s[a]+=r:s[++a]=r),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,l.push({i:a,x:Qe(n,i)})),o=nn.lastIndex;return o<e.length&&(r=e.slice(o),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function on(t,e){var n,i,r=typeof e;return null==e||"boolean"===r?De(e):("number"===r?Qe:"string"===r?(n=$e(e))?(e=n,Ye):rn:e instanceof $e?Ye:e instanceof Date?Ze:(i=e,!ArrayBuffer.isView(i)||i instanceof DataView?Array.isArray(e)?Ke:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?tn:Qe:Je))(t,e)}function an(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var sn,ln=180/Math.PI,cn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hn(t,e,n,i,r,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*ln,skewX:Math.atan(l)*ln,scaleX:a,scaleY:s}}function un(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],l=[];return o=t(o),a=t(a),function(t,i,r,o,a,s){if(t!==r||i!==o){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:Qe(t,r)},{i:l-2,x:Qe(i,o)})}else(r||o)&&a.push("translate("+r+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Qe(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(o.rotate,a.rotate,s,l),function(t,e,n,o){t!==e?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Qe(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(o.skewX,a.skewX,s,l),function(t,e,n,i,o,a){if(t!==n||e!==i){var s=o.push(r(o)+"scale(",null,",",null,")");a.push({i:s-4,x:Qe(t,n)},{i:s-2,x:Qe(e,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var fn=un(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?cn:hn(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),dn=un(function(t){return null==t?cn:(sn||(sn=document.createElementNS("http://www.w3.org/2000/svg","g")),sn.setAttribute("transform",t),(t=sn.transform.baseVal.consolidate())?hn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):cn)},", ",")",")");function pn(t){return((t=Math.exp(t))+1/t)/2}const gn=function t(e,n,i){function r(t,r){var o,a,s=t[0],l=t[1],c=t[2],h=r[0],u=r[1],f=r[2],d=h-s,p=u-l,g=d*d+p*p;if(g<1e-12)a=Math.log(f/c)/e,o=function(t){return[s+t*d,l+t*p,c*Math.exp(e*t*a)]};else{var y=Math.sqrt(g),m=(f*f-c*c+i*g)/(2*c*n*y),x=(f*f-c*c-i*g)/(2*f*n*y),v=Math.log(Math.sqrt(m*m+1)-m),b=Math.log(Math.sqrt(x*x+1)-x);a=(b-v)/e,o=function(t){var i,r=t*a,o=pn(v),h=c/(n*y)*(o*(i=e*r+v,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[s+h*d,l+h*p,c*o/pn(e*r+v)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4);var yn,mn,xn=0,vn=0,bn=0,wn=0,_n=0,Fn=0,kn="object"==typeof performance&&performance.now?performance:Date,Mn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function An(){return _n||(Mn(Sn),_n=kn.now()+Fn)}function Sn(){_n=0}function $n(){this._call=this._time=this._next=null}function Nn(t,e,n){var i=new $n;return i.restart(t,e,n),i}function zn(){_n=(wn=kn.now())+Fn,xn=vn=0;try{!function(){An(),++xn;for(var t,e=yn;e;)(t=_n-e._time)>=0&&e._call.call(void 0,t),e=e._next;--xn}()}finally{xn=0,function(){var t,e,n=yn,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:yn=e);mn=t,Tn(i)}(),_n=0}}function En(){var t=kn.now(),e=t-wn;e>1e3&&(Fn-=e,wn=t)}function Tn(t){xn||(vn&&(vn=clearTimeout(vn)),t-_n>24?(t<1/0&&(vn=setTimeout(zn,t-kn.now()-Fn)),bn&&(bn=clearInterval(bn))):(bn||(wn=kn.now(),bn=setInterval(En,1e3)),xn=1,Mn(zn)))}function Cn(t,e,n){var i=new $n;return e=null==e?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,n),i}$n.prototype=Nn.prototype={constructor:$n,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?An():+n)+(null==e?0:+e),this._next||mn===this||(mn?mn._next=this:yn=this,mn=this),this._call=t,this._time=n,Tn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Tn())}};var Ln=C("start","end","cancel","interrupt"),Pn=[];function In(t,e,n,i,r,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function o(t){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)}function a(o){var c,h,u,f;if(1!==n.state)return l();for(c in r)if((f=r[c]).name===n.name){if(3===f.state)return Cn(a);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(Cn(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(o))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(u=n.tween.length),c=0,h=-1;c<u;++c)(f=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++h]=f);i.length=h+1}}function s(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,a=i.length;++o<a;)i[o].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=Nn(o,0,n.time)}(t,n,{name:e,index:i,group:r,on:Ln,tween:Pn,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function qn(t,e){var n=On(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Bn(t,e){var n=On(t,e);if(n.state>3)throw new Error("too late; already running");return n}function On(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function jn(t,e){var n,i,r,o=t.__transition,a=!0;if(o){for(r in e=null==e?null:e+"",o)(n=o[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[r]):a=!1;a&&delete t.__transition}}function Rn(t,e){var n,i;return function(){var r=Bn(this,t),o=r.tween;if(o!==n)for(var a=0,s=(i=n=o).length;a<s;++a)if(i[a].name===e){(i=i.slice()).splice(a,1);break}r.tween=i}}function Gn(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var o=Bn(this,t),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:e,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}o.tween=r}}function Hn(t,e,n){var i=t._id;return t.each(function(){var t=Bn(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return On(t,i).value[e]}}function Dn(t,e){var n;return("number"==typeof e?Qe:e instanceof $e?Ye:(n=$e(e))?(e=n,Ye):rn)(t,e)}function Vn(t){return function(){this.removeAttribute(t)}}function Xn(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Yn(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===i?r:r=e(i=a,n)}}function Wn(t,e,n){var i,r,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===i?r:r=e(i=a,n)}}function Un(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(t))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttribute(t)}}function Jn(t,e,n){var i,r,o;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:a===i&&s===r?o:(r=s,o=e(i=a,l));this.removeAttributeNS(t.space,t.local)}}function Kn(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,r)),n}return r._value=e,r}function Zn(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,r)),n}return r._value=e,r}function Qn(t,e){return function(){qn(this,t).delay=+e.apply(this,arguments)}}function ti(t,e){return e=+e,function(){qn(this,t).delay=e}}function ei(t,e){return function(){Bn(this,t).duration=+e.apply(this,arguments)}}function ni(t,e){return e=+e,function(){Bn(this,t).duration=e}}var ii=Wt.prototype.constructor;function ri(t){return function(){this.style.removeProperty(t)}}var oi=0;function ai(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function si(){return++oi}var li=Wt.prototype;ai.prototype={constructor:ai,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=D(t));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s,l,c=i[a],h=c.length,u=o[a]=new Array(h),f=0;f<h;++f)(s=c[f])&&(l=t.call(s,s.__data__,f,c))&&("__data__"in s&&(l.__data__=s.__data__),u[f]=l,In(u[f],e,n,f,u,On(s,n)));return new ai(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Y(t));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var l,c=i[s],h=c.length,u=0;u<h;++u)if(l=c[u]){for(var f,d=t.call(l,l.__data__,u,c),p=On(l,n),g=0,y=d.length;g<y;++g)(f=d[g])&&In(f,e,n,g,d,p);o.push(d),a.push(l)}return new ai(o,a,e,n)},selectChild:li.selectChild,selectChildren:li.selectChildren,filter:function(t){"function"!=typeof t&&(t=W(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,a=e[r],s=a.length,l=i[r]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new ai(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var l,c=e[s],h=n[s],u=c.length,f=a[s]=new Array(u),d=0;d<u;++d)(l=c[d]||h[d])&&(f[d]=l);for(;s<i;++s)a[s]=e[s];return new ai(a,this._parents,this._name,this._id)},selection:function(){return new ii(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=si(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)if(a=s[c]){var h=On(a,e);In(a,t,n,c,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new ai(i,this._parents,t,n)},call:li.call,nodes:li.nodes,node:li.node,size:li.size,empty:li.empty,each:li.each,on:function(t,e){var n=this._id;return arguments.length<2?On(this.node(),n).on.on(t):this.each(function(t,e,n){var i,r,o=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?qn:Bn;return function(){var a=o(this,t),s=a.on;s!==i&&(r=(i=s).copy()).on(e,n),a.on=r}}(n,t,e))},attr:function(t,e){var n=O(t),i="transform"===n?dn:Dn;return this.attrTween(t,"function"==typeof e?(n.local?Jn:Un)(n,i,Hn(this,"attr."+t,e)):null==e?(n.local?Xn:Vn)(n):(n.local?Wn:Yn)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=O(t);return this.tween(n,(i.local?Kn:Zn)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?fn:Dn;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var o=mt(this,t),a=(this.style.removeProperty(t),mt(this,t));return o===a?null:o===n&&a===i?r:r=e(n=o,i=a)}}(t,i)).on("end.style."+t,ri(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,o;return function(){var a=mt(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=mt(this,t)),a===l?null:a===i&&l===r?o:(r=l,o=e(i=a,s))}}(t,i,Hn(this,"style."+t,e))).each(function(t,e){var n,i,r,o,a="style."+e,s="end."+a;return function(){var l=Bn(this,t),c=l.on,h=null==l.value[a]?o||(o=ri(e)):void 0;c===n&&r===h||(i=(n=c).copy()).on(s,r=h),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,o=n+"";return function(){var a=mt(this,t);return a===o?null:a===i?r:r=e(i=a,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,function(t,e,n){var i,r;function o(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&function(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}(t,o,n)),i}return o._value=e,o}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Hn(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){return function(e){this.textContent=t.call(this,e)}}(i)),e}return i._value=t,i}(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=On(this.node(),n).tween,o=0,a=r.length;o<a;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((null==e?Rn:Gn)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Qn:ti)(e,t)):On(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ei:ni)(e,t)):On(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Bn(this,t).ease=e}}(e,t)):On(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Bn(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(o,a){var s={value:a},l={value:function(){0===--r&&o()}};n.each(function(){var n=Bn(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e}),0===r&&o()})},[Symbol.iterator]:li[Symbol.iterator]};var ci={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function hi(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Wt.prototype.interrupt=function(t){return this.each(function(){jn(this,t)})},Wt.prototype.transition=function(t){var e,n;t instanceof ai?(e=t._id,t=t._name):(e=si(),(n=ci).time=An(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a,s=i[o],l=s.length,c=0;c<l;++c)(a=s[c])&&In(a,t,e,c,s,n||hi(a,e));return new ai(i,this._parents,t,e)};const ui=Math.PI,fi=2*ui,di=1e-6,pi=fi-di;function gi(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class yi{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?gi:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return gi;const n=10**e;return function(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,i){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,e,n,i,r,o){this._append`C${+t},${+e},${+n},${+i},${this._x1=+r},${this._y1=+o}`}arcTo(t,e,n,i,r){if(t=+t,e=+e,n=+n,i=+i,(r=+r)<0)throw new Error(`negative radius: ${r}`);let o=this._x1,a=this._y1,s=n-t,l=i-e,c=o-t,h=a-e,u=c*c+h*h;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(u>di)if(Math.abs(h*s-l*c)>di&&r){let f=n-o,d=i-a,p=s*s+l*l,g=f*f+d*d,y=Math.sqrt(p),m=Math.sqrt(u),x=r*Math.tan((ui-Math.acos((p+u-g)/(2*y*m)))/2),v=x/m,b=x/y;Math.abs(v-1)>di&&this._append`L${t+v*c},${e+v*h}`,this._append`A${r},${r},0,0,${+(h*f>c*d)},${this._x1=t+b*s},${this._y1=e+b*l}`}else this._append`L${this._x1=t},${this._y1=e}`;else;}arc(t,e,n,i,r,o){if(t=+t,e=+e,o=!!o,(n=+n)<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(i),s=n*Math.sin(i),l=t+a,c=e+s,h=1^o,u=o?i-r:r-i;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>di||Math.abs(this._y1-c)>di)&&this._append`L${l},${c}`,n&&(u<0&&(u=u%fi+fi),u>pi?this._append`A${n},${n},0,1,${h},${t-a},${e-s}A${n},${n},0,1,${h},${this._x1=l},${this._y1=c}`:u>di&&this._append`A${n},${n},0,${+(u>=ui)},${h},${this._x1=t+n*Math.cos(r)},${this._y1=e+n*Math.sin(r)}`)}rect(t,e,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}}function mi(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,o,a,s,l,c,h,u,f,d=t._root,p={data:i},g=t._x0,y=t._y0,m=t._x1,x=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((c=e>=(o=(g+m)/2))?g=o:m=o,(h=n>=(a=(y+x)/2))?y=a:x=a,r=d,!(d=d[u=h<<1|c]))return r[u]=p,t;if(s=+t._x.call(null,d.data),l=+t._y.call(null,d.data),e===s&&n===l)return p.next=d,r?r[u]=p:t._root=p,t;do{r=r?r[u]=new Array(4):t._root=new Array(4),(c=e>=(o=(g+m)/2))?g=o:m=o,(h=n>=(a=(y+x)/2))?y=a:x=a}while((u=h<<1|c)==(f=(l>=a)<<1|s>=o));return r[f]=d,r[u]=p,t}function xi(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function vi(t){return t[0]}function bi(t){return t[1]}function wi(t,e,n){var i=new _i(null==e?vi:e,null==n?bi:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function _i(t,e,n,i,r,o){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function Fi(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var ki=wi.prototype=_i.prototype;function Mi(t){return function(){return t}}function Ai(t){return 1e-6*(t()-.5)}function Si(t){return t.x+t.vx}function $i(t){return t.y+t.vy}function Ni(t){return t.index}function zi(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Ei(t){var e,n,i,r,o,a,s=Ni,l=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},c=Mi(30),h=1;function u(i){for(var r=0,s=t.length;r<h;++r)for(var l,c,u,f,d,p,g,y=0;y<s;++y)c=(l=t[y]).source,f=(u=l.target).x+u.vx-c.x-c.vx||Ai(a),d=u.y+u.vy-c.y-c.vy||Ai(a),f*=p=((p=Math.sqrt(f*f+d*d))-n[y])/p*i*e[y],d*=p,u.vx-=f*(g=o[y]),u.vy-=d*g,c.vx+=f*(g=1-g),c.vy+=d*g}function f(){if(i){var a,l,c=i.length,h=t.length,u=new Map(i.map((t,e)=>[s(t,e,i),t]));for(a=0,r=new Array(c);a<h;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=zi(u,l.source)),"object"!=typeof l.target&&(l.target=zi(u,l.target)),r[l.source.index]=(r[l.source.index]||0)+1,r[l.target.index]=(r[l.target.index]||0)+1;for(a=0,o=new Array(h);a<h;++a)l=t[a],o[a]=r[l.source.index]/(r[l.source.index]+r[l.target.index]);e=new Array(h),d(),n=new Array(h),p()}}function d(){if(i)for(var n=0,r=t.length;n<r;++n)e[n]=+l(t[n],n,t)}function p(){if(i)for(var e=0,r=t.length;e<r;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),u.initialize=function(t,e){i=t,a=e,f()},u.links=function(e){return arguments.length?(t=e,f(),u):t},u.id=function(t){return arguments.length?(s=t,u):s},u.iterations=function(t){return arguments.length?(h=+t,u):h},u.strength=function(t){return arguments.length?(l="function"==typeof t?t:Mi(+t),d(),u):l},u.distance=function(t){return arguments.length?(c="function"==typeof t?t:Mi(+t),p(),u):c},u}ki.copy=function(){var t,e,n=new _i(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=Fi(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=Fi(e));return n},ki.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return mi(this.cover(e,n),e,n,t)},ki.addAll=function(t){var e,n,i,r,o=t.length,a=new Array(o),s=new Array(o),l=1/0,c=1/0,h=-1/0,u=-1/0;for(n=0;n<o;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(a[n]=i,s[n]=r,i<l&&(l=i),i>h&&(h=i),r<c&&(c=r),r>u&&(u=r));if(l>h||c>u)return this;for(this.cover(l,c).cover(h,u),n=0;n<o;++n)mi(this,a[n],s[n],t[n]);return this},ki.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var a,s,l=r-n||1,c=this._root;n>t||t>=r||i>e||e>=o;)switch(s=(e<i)<<1|t<n,(a=new Array(4))[s]=c,c=a,l*=2,s){case 0:r=n+l,o=i+l;break;case 1:n=r-l,o=i+l;break;case 2:r=n+l,i=o-l;break;case 3:n=r-l,i=o-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this},ki.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},ki.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},ki.find=function(t,e,n){var i,r,o,a,s,l,c,h=this._x0,u=this._y0,f=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new xi(g,h,u,f,d)),null==n?n=1/0:(h=t-n,u=e-n,f=t+n,d=e+n,n*=n);l=p.pop();)if(!(!(g=l.node)||(r=l.x0)>f||(o=l.y0)>d||(a=l.x1)<h||(s=l.y1)<u))if(g.length){var y=(r+a)/2,m=(o+s)/2;p.push(new xi(g[3],y,m,a,s),new xi(g[2],r,m,y,s),new xi(g[1],y,o,a,m),new xi(g[0],r,o,y,m)),(c=(e>=m)<<1|t>=y)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=l)}else{var x=t-+this._x.call(null,g.data),v=e-+this._y.call(null,g.data),b=x*x+v*v;if(b<n){var w=Math.sqrt(n=b);h=t-w,u=e-w,f=t+w,d=e+w,i=g.data}}return i},ki.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,i,r,o,a,s,l,c,h,u,f,d=this._root,p=this._x0,g=this._y0,y=this._x1,m=this._y1;if(!d)return this;if(d.length)for(;;){if((c=o>=(s=(p+y)/2))?p=s:y=s,(h=a>=(l=(g+m)/2))?g=l:m=l,e=d,!(d=d[u=h<<1|c]))return this;if(!d.length)break;(e[u+1&3]||e[u+2&3]||e[u+3&3])&&(n=e,f=u)}for(;d.data!==t;)if(i=d,!(d=d.next))return this;return(r=d.next)&&delete d.next,i?(r?i.next=r:delete i.next,this):e?(r?e[u]=r:delete e[u],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=r,this)},ki.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},ki.root=function(){return this._root},ki.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},ki.visit=function(t){var e,n,i,r,o,a,s=[],l=this._root;for(l&&s.push(new xi(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,i=e.x0,r=e.y0,o=e.x1,a=e.y1)&&l.length){var c=(i+o)/2,h=(r+a)/2;(n=l[3])&&s.push(new xi(n,c,h,o,a)),(n=l[2])&&s.push(new xi(n,i,h,c,a)),(n=l[1])&&s.push(new xi(n,c,r,o,h)),(n=l[0])&&s.push(new xi(n,i,r,c,h))}return this},ki.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new xi(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var o,a=e.x0,s=e.y0,l=e.x1,c=e.y1,h=(a+l)/2,u=(s+c)/2;(o=r[0])&&n.push(new xi(o,a,s,h,u)),(o=r[1])&&n.push(new xi(o,h,s,l,u)),(o=r[2])&&n.push(new xi(o,a,u,h,c)),(o=r[3])&&n.push(new xi(o,h,u,l,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},ki.x=function(t){return arguments.length?(this._x=t,this):this._x},ki.y=function(t){return arguments.length?(this._y=t,this):this._y};const Ti=4294967296;function Ci(t){return t.x}function Li(t){return t.y}var Pi=Math.PI*(3-Math.sqrt(5));function Ii(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),o=0,a=.6,s=new Map,l=Nn(u),c=C("tick","end"),h=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Ti)/Ti}();function u(){f(),c.call("tick",e),n<i&&(l.stop(),c.call("end",e))}function f(i){var l,c,h=t.length;void 0===i&&(i=1);for(var u=0;u<i;++u)for(n+=(o-n)*r,s.forEach(function(t){t(n)}),l=0;l<h;++l)null==(c=t[l]).fx?c.x+=c.vx*=a:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=a:(c.y=c.fy,c.vy=0);return e}function d(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+n),o=n*Pi;e.x=r*Math.cos(o),e.y=r*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,h),e}return null==t&&(t=[]),d(),e={tick:f,restart:function(){return l.restart(u),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(i=+t,e):i},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(h=t,s.forEach(p),e):h},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,i){var r,o,a,s,l,c=0,h=t.length;for(null==i?i=1/0:i*=i,c=0;c<h;++c)(a=(r=e-(s=t[c]).x)*r+(o=n-s.y)*o)<i&&(l=s,i=a);return l},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}}function qi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Bi(t){return(t=qi(Math.abs(t)))?t[1]:NaN}var Oi,ji=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ri(t){if(!(e=ji.exec(t)))throw new Error("invalid format: "+t);var e;return new Gi({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Gi(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Hi(t,e){var n=qi(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}Ri.prototype=Gi.prototype,Gi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Di={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Hi(100*t,e),r:Hi,s:function(t,e){var n=qi(t,e);if(!n)return t+"";var i=n[0],r=n[1],o=r-(Oi=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+qi(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Vi(t){return t}var Xi,Yi,Wi,Ui=Array.prototype.map,Ji=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Ki(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?Vi:(e=Ui.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,o=[],a=0,s=e[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),o.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Vi:function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(Ui.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"":t.minus+"",h=void 0===t.nan?"NaN":t.nan+"";function u(t){var e=(t=Ri(t)).fill,n=t.align,u=t.sign,f=t.symbol,d=t.zero,p=t.width,g=t.comma,y=t.precision,m=t.trim,x=t.type;"n"===x?(g=!0,x="g"):Di[x]||(void 0===y&&(y=12),m=!0,x="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var v="$"===f?r:"#"===f&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",b="$"===f?o:/[%p]/.test(x)?l:"",w=Di[x],_=/[defgprs%]/.test(x);function F(t){var r,o,l,f=v,F=b;if("c"===x)F=w(t)+F,t="";else{var k=(t=+t)<0||1/t<0;if(t=isNaN(t)?h:w(Math.abs(t),y),m&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),k&&0===+t&&"+"!==u&&(k=!1),f=(k?"("===u?u:c:"-"===u||"("===u?"":u)+f,F=("s"===x?Ji[8+Oi/3]:"")+F+(k&&"("===u?")":""),_)for(r=-1,o=t.length;++r<o;)if(48>(l=t.charCodeAt(r))||l>57){F=(46===l?a+t.slice(r+1):t.slice(r))+F,t=t.slice(0,r);break}}g&&!d&&(t=i(t,1/0));var M=f.length+t.length+F.length,A=M<p?new Array(p-M+1).join(e):"";switch(g&&d&&(t=i(A+t,A.length?p-F.length:1/0),A=""),n){case"<":t=f+t+F+A;break;case"=":t=f+A+t+F;break;case"^":t=A.slice(0,M=A.length>>1)+f+t+F+A.slice(M);break;default:t=A+f+t+F}return s(t)}return y=void 0===y?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),F.toString=function(){return t+""},F}return{format:u,formatPrefix:function(t,e){var n=u(((t=Ri(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(Bi(e)/3))),r=Math.pow(10,-i),o=Ji[8+i/3];return function(t){return n(r*t)+o}}}}Xi=Ki({thousands:",",grouping:[3],currency:["$",""]}),Yi=Xi.format,Wi=Xi.formatPrefix;var Zi=1e-6,Qi=Math.PI,tr=2*Qi,er=180/Qi,nr=Qi/180,ir=Math.abs,rr=Math.cos,or=Math.sin,ar=Math.sqrt;function sr(){}function lr(t,e){t&&hr.hasOwnProperty(t.type)&&hr[t.type](t,e)}var cr={Feature:function(t,e){lr(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)lr(n[i].geometry,e)}},hr={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){ur(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ur(n[i],e,0)},Polygon:function(t,e){fr(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)fr(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)lr(n[i],e)}};function ur(t,e,n){var i,r=-1,o=t.length-n;for(e.lineStart();++r<o;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function fr(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)ur(t[n],e,1);e.polygonEnd()}function dr(t,e){t&&cr.hasOwnProperty(t.type)?cr[t.type](t,e):lr(t,e)}function pr(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function gr(t,e,n,i,r){var o,a,s=[],l=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,i,a,c=t[0],h=t[e];if(a=h,ir((i=c)[0]-a[0])<Zi&&ir(i[1]-a[1])<Zi){if(!c[2]&&!h[2]){for(r.lineStart(),o=0;o<e;++o)r.point((c=t[o])[0],c[1]);return void r.lineEnd()}h[0]+=2e-6}s.push(n=new pr(c,t,null,!0)),l.push(n.o=new pr(c,null,n,!1)),s.push(n=new pr(h,t,null,!1)),l.push(n.o=new pr(h,null,n,!0))}}),s.length){for(l.sort(e),yr(s),yr(l),o=0,a=l.length;o<a;++o)l[o].e=n=!n;for(var c,h,u=s[0];;){for(var f=u,d=!0;f.v;)if((f=f.n)===u)return;c=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(o=0,a=c.length;o<a;++o)r.point((h=c[o])[0],h[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(d)for(c=f.p.z,o=c.length-1;o>=0;--o)r.point((h=c[o])[0],h[1]);else i(f.x,f.p.x,-1,r);f=f.p}c=(f=f.o).z,d=!d}while(!f.v);r.lineEnd()}}}function yr(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}var mr=1e9,xr=-mr;function vr(t,e,n,i){function r(r,o){return t<=r&&r<=n&&e<=o&&o<=i}function o(r,o,s,c){var h=0,u=0;if(null==r||(h=a(r,s))!==(u=a(o,s))||l(r,o)<0^s>0)do{c.point(0===h||3===h?t:n,h>1?i:e)}while((h=(h+s+4)%4)!==u);else c.point(o[0],o[1])}function a(i,r){return ir(i[0]-t)<Zi?r>0?0:3:ir(i[0]-n)<Zi?r>0?2:1:ir(i[1]-e)<Zi?r>0?1:0:r>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=a(t,1),i=a(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var l,c,h,u,f,d,p,g,y,m,x,v,b,w=a,_=(b=[],{point:function(t,e,n){v.push([t,e,n])},lineStart:function(){b.push(v=[])},lineEnd:sr,rejoin:function(){b.length>1&&b.push(b.pop().concat(b.shift()))},result:function(){var t=b;return b=[],v=null,t}}),F={point:k,lineStart:function(){F.point=M,c&&c.push(h=[]);m=!0,y=!1,p=g=NaN},lineEnd:function(){l&&(M(u,f),d&&y&&_.rejoin(),l.push(_.result()));F.point=k,y&&w.lineEnd()},polygonStart:function(){w=_,l=[],c=[],x=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=c.length;n<r;++n)for(var o,a,s=c[n],l=1,h=s.length,u=s[0],f=u[0],d=u[1];l<h;++l)o=f,a=d,f=(u=s[l])[0],d=u[1],a<=i?d>i&&(f-o)*(i-a)>(d-a)*(t-o)&&++e:d<=i&&(f-o)*(i-a)<(d-a)*(t-o)&&--e;return e}(),n=x&&e,r=(u=l,l=Array.from(function*(t){for(const e of t)yield*e}(u))).length;var u;(n||r)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),r&&gr(l,s,e,o,a),a.polygonEnd());w=a,l=c=h=null}};function k(t,e){r(t,e)&&w.point(t,e)}function M(o,a){var s=r(o,a);if(c&&h.push([o,a]),m)u=o,f=a,d=s,m=!1,s&&(w.lineStart(),w.point(o,a));else if(s&&y)w.point(o,a);else{var l=[p=Math.max(xr,Math.min(mr,p)),g=Math.max(xr,Math.min(mr,g))],v=[o=Math.max(xr,Math.min(mr,o)),a=Math.max(xr,Math.min(mr,a))];!function(t,e,n,i,r,o){var a,s=t[0],l=t[1],c=0,h=1,u=e[0]-s,f=e[1]-l;if(a=n-s,u||!(a>0)){if(a/=u,u<0){if(a<c)return;a<h&&(h=a)}else if(u>0){if(a>h)return;a>c&&(c=a)}if(a=r-s,u||!(a<0)){if(a/=u,u<0){if(a>h)return;a>c&&(c=a)}else if(u>0){if(a<c)return;a<h&&(h=a)}if(a=i-l,f||!(a>0)){if(a/=f,f<0){if(a<c)return;a<h&&(h=a)}else if(f>0){if(a>h)return;a>c&&(c=a)}if(a=o-l,f||!(a<0)){if(a/=f,f<0){if(a>h)return;a>c&&(c=a)}else if(f>0){if(a<c)return;a<h&&(h=a)}return c>0&&(t[0]=s+c*u,t[1]=l+c*f),h<1&&(e[0]=s+h*u,e[1]=l+h*f),!0}}}}}(l,v,t,e,n,i)?s&&(w.lineStart(),w.point(o,a),x=!1):(y||(w.lineStart(),w.point(l[0],l[1])),w.point(v[0],v[1]),s||w.lineEnd(),x=!1)}p=o,g=a,y=s}return F}}const br=t=>t;var wr,_r,Fr,kr,Mr=new s,Ar=new s,Sr={point:sr,lineStart:sr,lineEnd:sr,polygonStart:function(){Sr.lineStart=$r,Sr.lineEnd=Er},polygonEnd:function(){Sr.lineStart=Sr.lineEnd=Sr.point=sr,Mr.add(ir(Ar)),Ar=new s},result:function(){var t=Mr/2;return Mr=new s,t}};function $r(){Sr.point=Nr}function Nr(t,e){Sr.point=zr,wr=Fr=t,_r=kr=e}function zr(t,e){Ar.add(kr*t-Fr*e),Fr=t,kr=e}function Er(){zr(wr,_r)}var Tr=1/0,Cr=Tr,Lr=-Tr,Pr=Lr,Ir={point:function(t,e){t<Tr&&(Tr=t);t>Lr&&(Lr=t);e<Cr&&(Cr=e);e>Pr&&(Pr=e)},lineStart:sr,lineEnd:sr,polygonStart:sr,polygonEnd:sr,result:function(){var t=[[Tr,Cr],[Lr,Pr]];return Lr=Pr=-(Cr=Tr=1/0),t}};var qr,Br,Or,jr,Rr=0,Gr=0,Hr=0,Dr=0,Vr=0,Xr=0,Yr=0,Wr=0,Ur=0,Jr={point:Kr,lineStart:Zr,lineEnd:eo,polygonStart:function(){Jr.lineStart=no,Jr.lineEnd=io},polygonEnd:function(){Jr.point=Kr,Jr.lineStart=Zr,Jr.lineEnd=eo},result:function(){var t=Ur?[Yr/Ur,Wr/Ur]:Xr?[Dr/Xr,Vr/Xr]:Hr?[Rr/Hr,Gr/Hr]:[NaN,NaN];return Rr=Gr=Hr=Dr=Vr=Xr=Yr=Wr=Ur=0,t}};function Kr(t,e){Rr+=t,Gr+=e,++Hr}function Zr(){Jr.point=Qr}function Qr(t,e){Jr.point=to,Kr(Or=t,jr=e)}function to(t,e){var n=t-Or,i=e-jr,r=ar(n*n+i*i);Dr+=r*(Or+t)/2,Vr+=r*(jr+e)/2,Xr+=r,Kr(Or=t,jr=e)}function eo(){Jr.point=Kr}function no(){Jr.point=ro}function io(){oo(qr,Br)}function ro(t,e){Jr.point=oo,Kr(qr=Or=t,Br=jr=e)}function oo(t,e){var n=t-Or,i=e-jr,r=ar(n*n+i*i);Dr+=r*(Or+t)/2,Vr+=r*(jr+e)/2,Xr+=r,Yr+=(r=jr*t-Or*e)*(Or+t),Wr+=r*(jr+e),Ur+=3*r,Kr(Or=t,jr=e)}function ao(t){this._context=t}ao.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,tr)}},result:sr};var so,lo,co,ho,uo,fo=new s,po={point:sr,lineStart:function(){po.point=go},lineEnd:function(){so&&yo(lo,co),po.point=sr},polygonStart:function(){so=!0},polygonEnd:function(){so=null},result:function(){var t=+fo;return fo=new s,t}};function go(t,e){po.point=yo,lo=ho=t,co=uo=e}function yo(t,e){ho-=t,uo-=e,fo.add(ar(ho*ho+uo*uo)),ho=t,uo=e}let mo,xo,vo,bo;class wo{constructor(t){this._append=null==t?_o:function(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return _o;if(e!==mo){const t=10**e;mo=e,xo=function(e){let n=1;this._+=e[0];for(const i=e.length;n<i;++n)this._+=Math.round(arguments[n]*t)/t+e[n]}}return xo}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:this._append`M${t},${e}`,this._point=1;break;case 1:this._append`L${t},${e}`;break;default:if(this._append`M${t},${e}`,this._radius!==vo||this._append!==xo){const t=this._radius,e=this._;this._="",this._append`m0,${t}a${t},${t} 0 1,1 0,${-2*t}a${t},${t} 0 1,1 0,${2*t}z`,vo=t,xo=this._append,bo=this._,this._=e}this._+=bo}}result(){const t=this._;return this._="",t.length?t:null}}function _o(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Fo(t,e){let n,i,r=3,o=4.5;function a(t){return t&&("function"==typeof o&&i.pointRadius(+o.apply(this,arguments)),dr(t,n(i))),i.result()}return a.area=function(t){return dr(t,n(Sr)),Sr.result()},a.measure=function(t){return dr(t,n(po)),po.result()},a.bounds=function(t){return dr(t,n(Ir)),Ir.result()},a.centroid=function(t){return dr(t,n(Jr)),Jr.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,br):(t=e).stream,a):t},a.context=function(t){return arguments.length?(i=null==t?(e=null,new wo(r)):new ao(e=t),"function"!=typeof o&&i.pointRadius(o),a):e},a.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(i.pointRadius(+t),+t),a):o},a.digits=function(t){if(!arguments.length)return r;if(null==t)r=null;else{const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);r=e}return null===e&&(i=new wo(r)),a},a.projection(t).digits(r).context(e)}function ko(){}function Mo(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),dr(n,t.stream(Ir)),e(Ir.result()),null!=i&&t.clipExtent(i),t}function Ao(t,e,n){return Mo(t,function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),a=+e[0][0]+(i-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])},n)}function So(){var t,e,n,i,r,o,a,s,l=1,c=0,h=0,u=1,f=1,d=0,p=null,g=1,y=1,m=(s={point:function(t,e){var n=b([t,e]);this.stream.point(n[0],n[1])}},function(t){var e=new ko;for(var n in s)e[n]=s[n];return e.stream=t,e}),x=br;function v(){return g=l*u,y=l*f,o=a=null,b}function b(n){var i=n[0]*g,r=n[1]*y;if(d){var o=r*t-i*e;i=i*t+r*e,r=o}return[i+c,r+h]}return b.invert=function(n){var i=n[0]-c,r=n[1]-h;if(d){var o=r*t+i*e;i=i*t-r*e,r=o}return[i/g,r/y]},b.stream=function(t){return o&&a===t?o:o=m(x(a=t))},b.postclip=function(t){return arguments.length?(x=t,p=n=i=r=null,v()):x},b.clipExtent=function(t){return arguments.length?(x=null==t?(p=n=i=r=null,br):vr(p=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),v()):null==p?null:[[p,n],[i,r]]},b.scale=function(t){return arguments.length?(l=+t,v()):l},b.translate=function(t){return arguments.length?(c=+t[0],h=+t[1],v()):[c,h]},b.angle=function(n){return arguments.length?(e=or(d=n%360*nr),t=rr(d),v()):d*er},b.reflectX=function(t){return arguments.length?(u=t?-1:1,v()):u<0},b.reflectY=function(t){return arguments.length?(f=t?-1:1,v()):f<0},b.fitExtent=function(t,e){return Ao(b,t,e)},b.fitSize=function(t,e){return function(t,e,n){return Ao(t,[[0,0],e],n)}(b,t,e)},b.fitWidth=function(t,e){return function(t,e,n){return Mo(t,function(n){var i=+e,r=i/(n[1][0]-n[0][0]),o=(i-r*(n[1][0]+n[0][0]))/2,a=-r*n[0][1];t.scale(150*r).translate([o,a])},n)}(b,t,e)},b.fitHeight=function(t,e){return function(t,e,n){return Mo(t,function(n){var i=+e,r=i/(n[1][1]-n[0][1]),o=-r*n[0][0],a=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([o,a])},n)}(b,t,e)},b}function $o(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function No(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Eo)):void 0===e&&(e=zo);for(var n,i,r,o,a,s=new Lo(t),l=[s];n=l.pop();)if((r=e(n.data))&&(a=(r=Array.from(r)).length))for(n.children=r,o=a-1;o>=0;--o)l.push(i=r[o]=new Lo(r[o])),i.parent=n,i.depth=n.depth+1;return s.eachBefore(Co)}function zo(t){return t.children}function Eo(t){return Array.isArray(t)?t[1]:null}function To(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Co(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Lo(t){this.data=t,this.depth=this.height=0,this.parent=null}function Po(){return 0}function Io(t){return function(){return t}}function qo(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function Bo(t,e,n,i,r){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(i-e)/t.value;++s<l;)(o=a[s]).y0=n,o.y1=r,o.x0=e,o.x1=e+=o.value*c}function Oo(t,e,n,i,r){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(r-n)/t.value;++s<l;)(o=a[s]).x0=e,o.x1=i,o.y0=n,o.y1=n+=o.value*c}ko.prototype={constructor:ko,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Lo.prototype=No.prototype={constructor:Lo,count:function(){return this.eachAfter($o)},each:function(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,o=this,a=[o],s=[],l=-1;o=a.pop();)if(s.push(o),n=o.children)for(i=0,r=n.length;i<r;++i)a.push(n[i]);for(;o=s.pop();)t.call(e,o,++l,this);return this},eachBefore:function(t,e){for(var n,i,r=this,o=[r],a=-1;r=o.pop();)if(t.call(e,r,++a,this),n=r.children)for(i=n.length-1;i>=0;--i)o.push(n[i]);return this},find:function(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;t=n.pop(),e=i.pop();for(;t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e},copy:function(){return No(this).eachBefore(To)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,o=[r];do{for(t=o.reverse(),o=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)o.push(e[n])}while(o.length)}};const jo=function t(e){function n(t,n,i,r,o){!function(t,e,n,i,r,o){for(var a,s,l,c,h,u,f,d,p,g,y,m=[],x=e.children,v=0,b=0,w=x.length,_=e.value;v<w;){l=r-n,c=o-i;do{h=x[b++].value}while(!h&&b<w);for(u=f=h,y=h*h*(g=Math.max(c/l,l/c)/(_*t)),p=Math.max(f/y,y/u);b<w;++b){if(h+=s=x[b].value,s<u&&(u=s),s>f&&(f=s),y=h*h*g,(d=Math.max(f/y,y/u))>p){h-=s;break}p=d}m.push(a={value:h,dice:l<c,children:x.slice(v,b)}),a.dice?Bo(a,n,i,r,_?i+=c*h/_:o):Oo(a,n,i,_?n+=l*h/_:r,o),_-=h,v=b}}(e,t,n,i,r,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}((1+Math.sqrt(5))/2);function Ro(){var t=jo,e=!1,n=1,i=1,r=[0],o=Po,a=Po,s=Po,l=Po,c=Po;function h(t){return t.x0=t.y0=0,t.x1=n,t.y1=i,t.eachBefore(u),r=[0],e&&t.eachBefore(qo),t}function u(e){var n=r[e.depth],i=e.x0+n,h=e.y0+n,u=e.x1-n,f=e.y1-n;u<i&&(i=u=(i+u)/2),f<h&&(h=f=(h+f)/2),e.x0=i,e.y0=h,e.x1=u,e.y1=f,e.children&&(n=r[e.depth+1]=o(e)/2,i+=c(e)-n,h+=a(e)-n,(u-=s(e)-n)<i&&(i=u=(i+u)/2),(f-=l(e)-n)<h&&(h=f=(h+f)/2),t(e,i,h,u,f))}return h.round=function(t){return arguments.length?(e=!!t,h):e},h.size=function(t){return arguments.length?(n=+t[0],i=+t[1],h):[n,i]},h.tile=function(e){return arguments.length?(t=function(t){if("function"!=typeof t)throw new Error;return t}(e),h):t},h.padding=function(t){return arguments.length?h.paddingInner(t).paddingOuter(t):h.paddingInner()},h.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:Io(+t),h):o},h.paddingOuter=function(t){return arguments.length?h.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):h.paddingTop()},h.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:Io(+t),h):a},h.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:Io(+t),h):s},h.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:Io(+t),h):l},h.paddingLeft=function(t){return arguments.length?(c="function"==typeof t?t:Io(+t),h):c},h}function Go(t,e,n,i,r){(1&t.depth?Oo:Bo)(t,e,n,i,r)}function Ho(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Do(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const Vo=Symbol("implicit");function Xo(){var t=new l,e=[],n=[],i=Vo;function r(r){let o=t.get(r);if(void 0===o){if(i!==Vo)return i;t.set(r,o=e.push(r)-1)}return n[o%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new l;for(const i of n)t.has(i)||t.set(i,e.push(i)-1);return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return Xo(e,n).unknown(i)},Ho.apply(r,arguments),r}function Yo(){var t,e,n=Xo().unknown(void 0),i=n.domain,r=n.range,o=0,a=1,s=!1,l=0,c=0,h=.5;function u(){var n=i().length,u=a<o,f=u?a:o,d=u?o:a;t=(d-f)/Math.max(1,n-l+2*c),s&&(t=Math.floor(t)),f+=(d-f-t*(n-l))*h,e=t*(1-l),s&&(f=Math.round(f),e=Math.round(e));var p=function(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(r);++i<r;)o[i]=t+i*n;return o}(n).map(function(e){return f+t*e});return r(u?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(i(t),u()):i()},n.range=function(t){return arguments.length?([o,a]=t,o=+o,a=+a,u()):[o,a]},n.rangeRound=function(t){return[o,a]=t,o=+o,a=+a,s=!0,u()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(s=!!t,u()):s},n.padding=function(t){return arguments.length?(l=Math.min(1,c=+t),u()):l},n.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),u()):l},n.paddingOuter=function(t){return arguments.length?(c=+t,u()):c},n.align=function(t){return arguments.length?(h=Math.max(0,Math.min(1,t)),u()):h},n.copy=function(){return Yo(i(),[o,a]).round(s).paddingInner(l).paddingOuter(c).align(h)},Ho.apply(u(),arguments)}function Wo(t){return+t}var Uo=[0,1];function Jo(t){return t}function Ko(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Zo(t,e,n){var i=t[0],r=t[1],o=e[0],a=e[1];return r<i?(i=Ko(r,i),o=n(a,o)):(i=Ko(i,r),o=n(o,a)),function(t){return o(i(t))}}function Qo(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),a=new Array(i),s=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<i;)r[s]=Ko(t[s],t[s+1]),a[s]=n(e[s],e[s+1]);return function(e){var n=o(t,e,1,i)-1;return a[n](r[n](e))}}function ta(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ea(){var t,e,n,i,r,o,a=Uo,s=Uo,l=on,c=Jo;function h(){var t,e,n,l=Math.min(a.length,s.length);return c!==Jo&&(t=a[0],e=a[l-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),i=l>2?Qo:Zo,r=o=null,u}function u(e){return null==e||isNaN(e=+e)?n:(r||(r=i(a.map(t),s,l)))(t(c(e)))}return u.invert=function(n){return c(e((o||(o=i(s,a.map(t),Qe)))(n)))},u.domain=function(t){return arguments.length?(a=Array.from(t,Wo),h()):a.slice()},u.range=function(t){return arguments.length?(s=Array.from(t),h()):s.slice()},u.rangeRound=function(t){return s=Array.from(t),l=an,h()},u.clamp=function(t){return arguments.length?(c=!!t||Jo,h()):c!==Jo},u.interpolate=function(t){return arguments.length?(l=t,h()):l},u.unknown=function(t){return arguments.length?(n=t,u):n},function(n,i){return t=n,e=i,h()}}function na(t,e,n,i){var r,o=function(t,e,n){n=+n;const i=(e=+e)<(t=+t),r=i?m(e,t,n):m(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}(t,e,n);switch((i=Ri(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Bi(e)/3)))-Bi(Math.abs(t)))}(o,a))||(i.precision=r),Wi(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Bi(e)-Bi(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(t){return Math.max(0,-Bi(Math.abs(t)))}(o))||(i.precision=r-2*("%"===i.type))}return Yi(i)}function ia(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const i=e<t,[r,o,a]=i?y(e,t,n):y(t,e,n);if(!(o>=r))return[];const s=o-r+1,l=new Array(s);if(i)if(a<0)for(let c=0;c<s;++c)l[c]=(o-c)/-a;else for(let c=0;c<s;++c)l[c]=(o-c)*a;else if(a<0)for(let c=0;c<s;++c)l[c]=(r+c)/-a;else for(let c=0;c<s;++c)l[c]=(r+c)*a;return l}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return na(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r,o=e(),a=0,s=o.length-1,l=o[a],c=o[s],h=10;for(c<l&&(r=l,l=c,c=r,r=a,a=s,s=r);h-- >0;){if((r=m(l,c,n))===i)return o[a]=l,o[s]=c,e(o);if(r>0)l=Math.floor(l/r)*r,c=Math.ceil(c/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,c=Math.floor(c*r)/r}i=r}return t},t}function ra(){var t=ea()(Jo,Jo);return t.copy=function(){return ta(t,ra())},Ho.apply(t,arguments),ia(t)}function oa(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function aa(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function sa(t){return t<0?-t*t:t*t}function la(t){var e=t(Jo,Jo),n=1;return e.exponent=function(e){return arguments.length?1===(n=+e)?t(Jo,Jo):.5===n?t(aa,sa):t(oa(n),oa(1/n)):n},ia(e)}function ca(){var t=la(ea());return t.copy=function(){return ta(t,ca()).exponent(t.exponent())},Ho.apply(t,arguments),t}function ha(){return ca.apply(null,arguments).exponent(.5)}function ua(){var e,n=[],i=[],r=[];function a(){var t=0,e=Math.max(1,i.length);for(r=new Array(e-1);++t<e;)r[t-1]=b(n,t/e);return s}function s(t){return null==t||isNaN(t=+t)?e:i[o(r,t)]}return s.invertExtent=function(t){var e=i.indexOf(t);return e<0?[NaN,NaN]:[e>0?r[e-1]:n[0],e<r.length?r[e]:n[n.length-1]]},s.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(t),a()},s.range=function(t){return arguments.length?(i=Array.from(t),a()):i.slice()},s.unknown=function(t){return arguments.length?(e=t,s):e},s.quantiles=function(){return r.slice()},s.copy=function(){return ua().domain(n).range(i).unknown(e)},Ho.apply(s,arguments)}function fa(){var t=ia(function(){var t,e,n,i,r,o=0,a=1,s=Jo,l=!1;function c(e){return null==e||isNaN(e=+e)?r:s(0===n?.5:(e=(i(e)-t)*n,l?Math.max(0,Math.min(1,e)):e))}function h(t){return function(e){var n,i;return arguments.length?([n,i]=e,s=t(n,i),c):[s(0),s(1)]}}return c.domain=function(r){return arguments.length?([o,a]=r,t=i(o=+o),e=i(a=+a),n=t===e?0:1/(e-t),c):[o,a]},c.clamp=function(t){return arguments.length?(l=!!t,c):l},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.range=h(on),c.rangeRound=h(an),c.unknown=function(t){return arguments.length?(r=t,c):r},function(r){return i=r,t=r(o),e=r(a),n=t===e?0:1/(e-t),c}}()(Jo));return t.copy=function(){return e=t,fa().domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown());var e},Do.apply(t,arguments)}function da(t){for(var e=t.length/6|0,n=new Array(e),i=0;i<e;)n[i]="#"+t.slice(6*i,6*++i);return n}const pa=da("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ga(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}const ya=ga(da("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));function ma(t){return function(){return t}}ga(da("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ga(da("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ga(da("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const xa=Math.abs,va=Math.atan2,ba=Math.cos,wa=Math.max,_a=Math.min,Fa=Math.sin,ka=Math.sqrt,Ma=1e-12,Aa=Math.PI,Sa=Aa/2,$a=2*Aa;function Na(t){return t>=1?Sa:t<=-1?-Sa:Math.asin(t)}function za(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new yi(e)}function Ea(t){return t.innerRadius}function Ta(t){return t.outerRadius}function Ca(t){return t.startAngle}function La(t){return t.endAngle}function Pa(t){return t&&t.padAngle}function Ia(t,e,n,i,r,o,a){var s=t-n,l=e-i,c=(a?o:-o)/ka(s*s+l*l),h=c*l,u=-c*s,f=t+h,d=e+u,p=n+h,g=i+u,y=(f+p)/2,m=(d+g)/2,x=p-f,v=g-d,b=x*x+v*v,w=r-o,_=f*g-p*d,F=(v<0?-1:1)*ka(wa(0,w*w*b-_*_)),k=(_*v-x*F)/b,M=(-_*x-v*F)/b,A=(_*v+x*F)/b,S=(-_*x+v*F)/b,$=k-y,N=M-m,z=A-y,E=S-m;return $*$+N*N>z*z+E*E&&(k=A,M=S),{cx:k,cy:M,x01:-h,y01:-u,x11:k*(r/w-1),y11:M*(r/w-1)}}function qa(){var t=Ea,e=Ta,n=ma(0),i=null,r=Ca,o=La,a=Pa,s=null,l=za(c);function c(){var c,h,u,f=+t.apply(this,arguments),d=+e.apply(this,arguments),p=r.apply(this,arguments)-Sa,g=o.apply(this,arguments)-Sa,y=xa(g-p),m=g>p;if(s||(s=c=l()),d<f&&(h=d,d=f,f=h),d>Ma)if(y>$a-Ma)s.moveTo(d*ba(p),d*Fa(p)),s.arc(0,0,d,p,g,!m),f>Ma&&(s.moveTo(f*ba(g),f*Fa(g)),s.arc(0,0,f,g,p,m));else{var x,v,b=p,w=g,_=p,F=g,k=y,M=y,A=a.apply(this,arguments)/2,S=A>Ma&&(i?+i.apply(this,arguments):ka(f*f+d*d)),$=_a(xa(d-f)/2,+n.apply(this,arguments)),N=$,z=$;if(S>Ma){var E=Na(S/f*Fa(A)),T=Na(S/d*Fa(A));(k-=2*E)>Ma?(_+=E*=m?1:-1,F-=E):(k=0,_=F=(p+g)/2),(M-=2*T)>Ma?(b+=T*=m?1:-1,w-=T):(M=0,b=w=(p+g)/2)}var C=d*ba(b),L=d*Fa(b),P=f*ba(F),I=f*Fa(F);if($>Ma){var q,B=d*ba(w),O=d*Fa(w),j=f*ba(_),R=f*Fa(_);if(y<Aa)if(q=function(t,e,n,i,r,o,a,s){var l=n-t,c=i-e,h=a-r,u=s-o,f=u*l-h*c;if(!(f*f<Ma))return[t+(f=(h*(e-o)-u*(t-r))/f)*l,e+f*c]}(C,L,j,R,B,O,P,I)){var G=C-q[0],H=L-q[1],D=B-q[0],V=O-q[1],X=1/Fa(((u=(G*D+H*V)/(ka(G*G+H*H)*ka(D*D+V*V)))>1?0:u<-1?Aa:Math.acos(u))/2),Y=ka(q[0]*q[0]+q[1]*q[1]);N=_a($,(f-Y)/(X-1)),z=_a($,(d-Y)/(X+1))}else N=z=0}M>Ma?z>Ma?(x=Ia(j,R,C,L,d,z,m),v=Ia(B,O,P,I,d,z,m),s.moveTo(x.cx+x.x01,x.cy+x.y01),z<$?s.arc(x.cx,x.cy,z,va(x.y01,x.x01),va(v.y01,v.x01),!m):(s.arc(x.cx,x.cy,z,va(x.y01,x.x01),va(x.y11,x.x11),!m),s.arc(0,0,d,va(x.cy+x.y11,x.cx+x.x11),va(v.cy+v.y11,v.cx+v.x11),!m),s.arc(v.cx,v.cy,z,va(v.y11,v.x11),va(v.y01,v.x01),!m))):(s.moveTo(C,L),s.arc(0,0,d,b,w,!m)):s.moveTo(C,L),f>Ma&&k>Ma?N>Ma?(x=Ia(P,I,B,O,f,-N,m),v=Ia(C,L,j,R,f,-N,m),s.lineTo(x.cx+x.x01,x.cy+x.y01),N<$?s.arc(x.cx,x.cy,N,va(x.y01,x.x01),va(v.y01,v.x01),!m):(s.arc(x.cx,x.cy,N,va(x.y01,x.x01),va(x.y11,x.x11),!m),s.arc(0,0,f,va(x.cy+x.y11,x.cx+x.x11),va(v.cy+v.y11,v.cx+v.x11),m),s.arc(v.cx,v.cy,N,va(v.y11,v.x11),va(v.y01,v.x01),!m))):s.arc(0,0,f,F,_,m):s.lineTo(P,I)}else s.moveTo(0,0);if(s.closePath(),c)return s=null,c+""||null}return c.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Aa/2;return[ba(i)*n,Fa(i)*n]},c.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),c):t},c.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),c):e},c.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:ma(+t),c):n},c.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:ma(+t),c):i},c.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:ma(+t),c):r},c.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:ma(+t),c):o},c.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:ma(+t),c):a},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}function Ba(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Oa(t){this._context=t}function ja(t){return new Oa(t)}function Ra(t){return t[0]}function Ga(t){return t[1]}function Ha(t,e){var n=ma(!0),i=null,r=ja,o=null,a=za(s);function s(s){var l,c,h,u=(s=Ba(s)).length,f=!1;for(null==i&&(o=r(h=a())),l=0;l<=u;++l)!(l<u&&n(c=s[l],l,s))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+t(c,l,s),+e(c,l,s));if(h)return o=null,h+""||null}return t="function"==typeof t?t:void 0===t?Ra:ma(t),e="function"==typeof e?e:void 0===e?Ga:ma(e),s.x=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),s):t},s.y=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),s):e},s.defined=function(t){return arguments.length?(n="function"==typeof t?t:ma(!!t),s):n},s.curve=function(t){return arguments.length?(r=t,null!=i&&(o=r(i)),s):r},s.context=function(t){return arguments.length?(null==t?i=o=null:o=r(i=t),s):i},s}function Da(t,e,n){var i=null,r=ma(!0),o=null,a=ja,s=null,l=za(c);function c(c){var h,u,f,d,p,g=(c=Ba(c)).length,y=!1,m=new Array(g),x=new Array(g);for(null==o&&(s=a(p=l())),h=0;h<=g;++h){if(!(h<g&&r(d=c[h],h,c))===y)if(y=!y)u=h,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=h-1;f>=u;--f)s.point(m[f],x[f]);s.lineEnd(),s.areaEnd()}y&&(m[h]=+t(d,h,c),x[h]=+e(d,h,c),s.point(i?+i(d,h,c):m[h],n?+n(d,h,c):x[h]))}if(p)return s=null,p+""||null}function h(){return Ha().defined(r).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?Ra:ma(+t),e="function"==typeof e?e:ma(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?Ga:ma(+n),c.x=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),i=null,c):t},c.x0=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),c):t},c.x1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:ma(+t),c):i},c.y=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),n=null,c):e},c.y0=function(t){return arguments.length?(e="function"==typeof t?t:ma(+t),c):e},c.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:ma(+t),c):n},c.lineX0=c.lineY0=function(){return h().x(t).y(e)},c.lineY1=function(){return h().x(t).y(n)},c.lineX1=function(){return h().x(i).y(e)},c.defined=function(t){return arguments.length?(r="function"==typeof t?t:ma(!!t),c):r},c.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),c):a},c.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),c):o},c}function Va(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function Xa(t){return t}function Ya(t,e){if((r=t.length)>1)for(var n,i,r,o=1,a=t[e[0]],s=a.length;o<r;++o)for(i=a,a=t[e[o]],n=0;n<s;++n)a[n][1]+=a[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]}function Wa(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function Ua(t,e){return t[e]}function Ja(t){const e=[];return e.key=t,e}function Ka(){var t=ma([]),e=Wa,n=Ya,i=Ua;function r(r){var o,a,s=Array.from(t.apply(this,arguments),Ja),l=s.length,c=-1;for(const t of r)for(o=0,++c;o<l;++o)(s[o][c]=[0,+i(t,s[o].key,c,r)]).data=t;for(o=0,a=Ba(e(s));o<l;++o)s[a[o]].index=o;return n(s,a),s}return r.keys=function(e){return arguments.length?(t="function"==typeof e?e:ma(Array.from(e)),r):t},r.value=function(t){return arguments.length?(i="function"==typeof t?t:ma(+t),r):i},r.order=function(t){return arguments.length?(e=null==t?Wa:"function"==typeof t?t:ma(Array.from(t)),r):e},r.offset=function(t){return arguments.length?(n=null==t?Ya:t,r):n},r}Oa.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const Za=t=>()=>t;function Qa(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function ts(t,e,n){this.k=t,this.x=e,this.y=n}ts.prototype={constructor:ts,scale:function(t){return 1===t?this:new ts(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new ts(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var es=new ts(1,0,0);function ns(t){t.stopImmediatePropagation()}function is(t){t.preventDefault(),t.stopImmediatePropagation()}function rs(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function os(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function as(){return this.__zoom||es}function ss(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ls(){return navigator.maxTouchPoints||"ontouchstart"in this}function cs(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function hs(){var t,e,n,i=rs,r=os,o=cs,a=ss,s=ls,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],h=250,u=gn,f=C("start","zoom","end"),d=0,p=10;function g(t){t.property("__zoom",as).on("wheel.zoom",_,{passive:!1}).on("mousedown.zoom",F).on("dblclick.zoom",k).filter(s).on("touchstart.zoom",M).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",S).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new ts(e,t.x,t.y)}function m(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new ts(t.k,i,r)}function x(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function v(t,e,n,i){t.on("start.zoom",function(){b(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(i).end()}).tween("zoom",function(){var t=this,o=arguments,a=b(t,o).event(i),s=r.apply(t,o),l=null==n?x(s):"function"==typeof n?n.apply(t,o):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),h=t.__zoom,f="function"==typeof e?e.apply(t,o):e,d=u(h.invert(l).concat(c/h.k),f.invert(l).concat(c/f.k));return function(t){if(1===t)t=f;else{var e=d(t),n=c/e[2];t=new ts(n,l[0]-e[0]*n,l[1]-e[1]*n)}a.zoom(null,t)}})}function b(t,e,n){return!n&&t.__zooming||new w(t,e)}function w(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function _(t,...e){if(i.apply(this,arguments)){var n=b(this,e).event(t),r=this.__zoom,s=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,a.apply(this,arguments)))),h=Jt(t);if(n.wheel)n.mouse[0][0]===h[0]&&n.mouse[0][1]===h[1]||(n.mouse[1]=r.invert(n.mouse[0]=h)),clearTimeout(n.wheel);else{if(r.k===s)return;n.mouse=[h,r.invert(h)],jn(this),n.start()}is(t),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",o(m(y(r,s),n.mouse[0],n.mouse[1]),n.extent,c))}}function F(t,...e){if(!n&&i.apply(this,arguments)){var r=t.currentTarget,a=b(this,e,!0).event(t),s=Ut(t.view).on("mousemove.zoom",function(t){if(is(t),!a.moved){var e=t.clientX-h,n=t.clientY-u;a.moved=e*e+n*n>d}a.event(t).zoom("mouse",o(m(a.that.__zoom,a.mouse[0]=Jt(t,r),a.mouse[1]),a.extent,c))},!0).on("mouseup.zoom",function(t){s.on("mousemove.zoom mouseup.zoom",null),ie(t.view,a.moved),is(t),a.event(t).end()},!0),l=Jt(t,r),h=t.clientX,u=t.clientY;ne(t.view),ns(t),a.mouse=[l,this.__zoom.invert(l)],jn(this),a.start()}}function k(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,a=Jt(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),l=n.k*(t.shiftKey?.5:2),u=o(m(y(n,l),a,s),r.apply(this,e),c);is(t),h>0?Ut(this).transition().duration(h).call(v,u,a,t):Ut(this).call(g.transform,u,a,t)}}function M(n,...r){if(i.apply(this,arguments)){var o,a,s,l,c=n.touches,h=c.length,u=b(this,r,n.changedTouches.length===h).event(n);for(ns(n),a=0;a<h;++a)l=[l=Jt(s=c[a],this),this.__zoom.invert(l),s.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,o=!0,u.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(u.taps<2&&(e=l[0],t=setTimeout(function(){t=null},500)),jn(this),u.start())}}function A(t,...e){if(this.__zooming){var n,i,r,a,s=b(this,e).event(t),l=t.changedTouches,h=l.length;for(is(t),n=0;n<h;++n)r=Jt(i=l[n],this),s.touch0&&s.touch0[2]===i.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===i.identifier&&(s.touch1[0]=r);if(i=s.that.__zoom,s.touch1){var u=s.touch0[0],f=s.touch0[1],d=s.touch1[0],p=s.touch1[1],g=(g=d[0]-u[0])*g+(g=d[1]-u[1])*g,x=(x=p[0]-f[0])*x+(x=p[1]-f[1])*x;i=y(i,Math.sqrt(g/x)),r=[(u[0]+d[0])/2,(u[1]+d[1])/2],a=[(f[0]+p[0])/2,(f[1]+p[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(m(i,r,a),s.extent,c))}}function S(t,...i){if(this.__zooming){var r,o,a=b(this,i).event(t),s=t.changedTouches,l=s.length;for(ns(t),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),r=0;r<l;++r)o=s[r],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=Jt(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<p)){var c=Ut(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",as),t!==r?v(t,e,n,i):r.interrupt().each(function(){b(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},g.scaleBy=function(t,e,n,i){g.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)},n,i)},g.scaleTo=function(t,e,n,i){g.transform(t,function(){var t=r.apply(this,arguments),i=this.__zoom,a=null==n?x(t):"function"==typeof n?n.apply(this,arguments):n,s=i.invert(a),l="function"==typeof e?e.apply(this,arguments):e;return o(m(y(i,l),a,s),t,c)},n,i)},g.translateBy=function(t,e,n,i){g.transform(t,function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)},null,i)},g.translateTo=function(t,e,n,i,a){g.transform(t,function(){var t=r.apply(this,arguments),a=this.__zoom,s=null==i?x(t):"function"==typeof i?i.apply(this,arguments):i;return o(es.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)},i,a)},w.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Ut(this.that).datum();f.call(t,this.that,new Qa(t,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:f}),e)}},g.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Za(+t),g):a},g.filter=function(t){return arguments.length?(i="function"==typeof t?t:Za(!!t),g):i},g.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Za(!!t),g):s},g.extent=function(t){return arguments.length?(r="function"==typeof t?t:Za([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),g):r},g.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],g):[l[0],l[1]]},g.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(t){return arguments.length?(o=t,g):o},g.duration=function(t){return arguments.length?(h=+t,g):h},g.interpolate=function(t){return arguments.length?(u=t,g):u},g.on=function(){var t=f.on.apply(f,arguments);return t===f?g:t},g.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,g):Math.sqrt(d)},g.tapDistance=function(t){return arguments.length?(p=+t,g):p},g}ts.prototype;let us=!1,fs=null;function ds(t,e,n,i){let r=null;try{const e=t&&t.target?t.target:document.elementFromPoint(t.clientX,t.clientY),n=e&&e.closest?e.closest("[data-d3po-tooltips]"):null;n&&(r=n.getAttribute("data-d3po-tooltips"))}catch(c){r=null}!function(t,e,n){const i=`${t}-${e}-${n?`explicit-${n}`:"auto"}`;if(us&&fs===i)return;const r=document.getElementById("d3po-tooltip-styles");r&&r.remove();const o=n||"white",a=n?$e(o).darker(1).toString():"#999",s=n?"white"===ws(o)?"#eee":"#111":"#333",l=o,c=a,h=document.createElement("style");h.id="d3po-tooltip-styles",h.textContent=`\n    .d3po-tooltip {\n      position: absolute;\n      background: ${o};\n      border: 1px solid ${a};\n      color: ${s};\n      padding: 8px 10px;\n      border-radius: 4px;\n      pointer-events: none;\n      font-family: ${t||'"Noto Sans", "Fira Sans", sans-serif'};\n      font-size: ${e||12}px;\n      line-height: 1.6;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n      z-index: 1000;\n      max-width: 200px;\n    }\n    \n    .d3po-tooltip::after {\n      content: '';\n      position: absolute;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid ${l};\n    }\n    \n    .d3po-tooltip::before {\n      content: '';\n      position: absolute;\n      bottom: -7px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 7px solid transparent;\n      border-right: 7px solid transparent;\n      border-top: 7px solid ${c};\n    }\n    \n    .d3po-tooltip strong {\n      display: block;\n      margin-bottom: 4px;\n      color: ${s};\n    }\n  `,document.head.appendChild(h),us=!0,fs=i}(n,i,r),Kt(".d3po-tooltip").remove();const o=Ut("body").append("div").attr("class","d3po-tooltip").html(e),a=o.node(),s=a.offsetHeight,l=a.offsetWidth;return o.style("left",t.pageX-l/2+"px").style("top",t.pageY-s-15+"px"),o}function ps(t){if("string"!=typeof t)return t;const e=t.match(/^#([0-9a-fA-F]{8})$/);if(!e)return t;const n=e[1],i=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),o=parseInt(n.slice(4,6),16),a=parseInt(n.slice(6,8),16)/255;return`rgba(${i}, ${r}, ${o}, ${Number(a.toFixed(3))})`}function gs(){Kt(".d3po-tooltip").remove()}function ys(t,e){return"function"==typeof t?t:"function"==typeof e?e:"string"==typeof e?As(e):null}function ms(t,e,n,i,r,o,a){try{if("function"==typeof e){const a=e(n,i);if(null!=a)return ds(t,a,r,o)}}catch(s){console.error("Tooltip formatter error",s)}return ds(t,"function"==typeof a?a(n,i):String(a||""),r,o)}function xs(t,e){if(!Array.isArray(t)||0===t.length)throw new Error("Data must be a non-empty array");const n=t[0],i=e.filter(t=>!(t in n));if(i.length>0)throw new Error(`Missing required fields: ${i.join(", ")}`)}function vs(t,e,n){const i=["#74c0e2","#406662","#549e95","#8abdb6","#bcd8af","#a8c380","#ede788","#d6c650","#dc8e7a","#d05555","#bf3251","#872a41","#993f7b","#7454a6","#a17cb0","#d1a1bc","#a1aafb","#5c57d9","#1c26b3","#4d6fd0","#7485aa","#d3d3d3"];if((t=>{if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=Object.keys(t);return e.length>0&&e.every(e=>"string"==typeof t[e])})(e)){const t=e,n=t=>{if(!t||"object"!=typeof t)return String(t);if(void 0!==t.group)return String(t.group);for(const e of["reporter_continent","partner_continent","continent","type","category"])if(void 0!==t[e])return String(t[e]);for(const e of Object.keys(t))if("string"==typeof t[e]||"number"==typeof t[e])return String(t[e]);return""};return e=>{const i=n(e);return t[i]?ps(t[i]):ps(Object.values(t)[0])}}const r=(t=>{if(!t)return null;if(Array.isArray(t))return t.length?t:null;if("object"==typeof t){const e=Object.values(t);return e.length?e:null}return null})(e);if(r){const e=r.length?r:i,n=t=>{if(!t||"object"!=typeof t)return String(t);if(void 0!==t.group)return String(t.group);for(const n of Object.keys(t))if("string"==typeof t[n]||"number"==typeof t[n])return String(t[n]);try{return JSON.stringify(t)}catch(e){return String(t)}},o={};let a=0;return t.forEach(t=>{const i=n(t);i in o||(o[i]=ps(e[a%e.length]),a+=1)}),t=>{const i=n(t);return o[i]||e[0]}}if(!e){const e=i,n=t=>{if(!t||"object"!=typeof t)return String(t);if(void 0!==t.group)return String(t.group);for(const n of Object.keys(t))if("string"==typeof t[n]||"number"==typeof t[n])return String(t[n]);try{return JSON.stringify(t)}catch(e){return String(t)}},r={};let o=0;return t.forEach(t=>{const i=n(t);i in r||(r[i]=ps(e[o%e.length]),o+=1)}),t=>{const i=n(t);return r[i]||e[0]}}const o=[...new Set(t.map(t=>t[e]))],a={};return o.forEach((i,r)=>{a[i]=(t.find(t=>t[e]===i)||{}).color||n(r/o.length)}),t=>a[t[e]]||n(0)}function bs(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function ws(t){try{const e=Ee(t),n=e.r/255,i=e.g/255,r=e.b/255,[o,a,s]=[n,i,r].map(t=>t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return.2126*o+.7152*a+.0722*s>.5?"black":"white"}catch(e){return"black"}}function _s(t){const e=t.slice().sort((t,e)=>t-e),n=e.length;if(0===n)return{min:null,q1:null,median:null,q3:null,max:null,whiskerMin:null,whiskerMax:null,outliers:[]};const i=(t,e)=>{const n=(t.length-1)*e,i=Math.floor(n),r=Math.ceil(n),o=n%1;return t[i]*(1-o)+t[r]*o},r=i(e,.25),o=i(e,.75),a=o-r,s=r-1.5*a,l=o+1.5*a;let c=e[0];for(let f=0;f<n;f++)if(e[f]>=s){c=e[f];break}let h=e[n-1];for(let f=n-1;f>=0;f--)if(e[f]<=l){h=e[f];break}const u=e.filter(t=>t<s||t>l);return{min:e[0],q1:r,median:i(e,.5),q3:o,max:e[n-1],whiskerMin:c,whiskerMax:h,outliers:u}}function Fs(t,e){const n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=e,i.style.display="none",document.body.appendChild(i),setTimeout(()=>{i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n)},100)},0)}function ks(t){let e=null;try{e=$e(t)}catch(i){e=null}e||(e=$e("#999"));const n=.2126*(e.r||0)+.7152*(e.g||0)+.0722*(e.b||0);try{return n>180?e.darker(.3).toString():e.brighter(.5).toString()}catch(i){return e.toString()}}function Ms(t,e=.15){try{const n=$e(t);if(!n)return t;const i=n.r,r=n.g,o=n.b,a=Math.max(0,Math.min(1,Number(e)||0)),s=Math.round(i+(255-i)*a),l=Math.round(r+(255-r)*a);return`rgb(${s}, ${l}, ${Math.round(o+(255-o)*a)})`}catch(n){return t}}function As(t){if("function"==typeof t)return t;if("string"!=typeof t)return null;if(0!==t.indexOf("JS.")&&0!==t.indexOf("JS("))return null;var e;if(0===t.indexOf("JS."))e=t.slice(3).trim();else{var n=t.indexOf("("),i=t.lastIndexOf(")");e=n>=0&&i>n?t.substring(n+1,i).trim():t.slice(3).trim()}var r=e.match(/^([A-Za-z0-9_\-]+)\s*\((.*)\)$/);if(r){var o=r[1],a=r[2]||"";try{return new Function("value","row",'return window.d3po.format["'+o+'"]('+a+");")}catch(s){return console.warn("d3po: failed compiling simple formatter",t,s),null}}try{return new Function("value","row","with (window.d3po) { return ("+e+"); }")}catch(s){return console.warn("d3po: failed compiling JS formatter expression:",t,s),null}}window.d3po=window.d3po||{},window.d3po.format=window.d3po.format||{},window.d3po.format["format-as-billion"]=function(t,e){return null==t||isNaN(t)?"":(t/1e9).toFixed(e="number"==typeof e?e:2)+"B"},window.d3po.format["format-as-percentage"]=function(t,e){return null==t||isNaN(t)?"":(100*t).toFixed(e="number"==typeof e?e:0)+"%"},window.d3po.format.formatAsBillion=window.d3po.format["format-as-billion"],window.d3po.format.formatAsPercentage=window.d3po.format["format-as-percentage"];class Ss{constructor(t,e={}){if(this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error("Container element not found");if(this.options={width:e.width||this.container.clientWidth||800,height:e.height||this.container.clientHeight||600,margin:e.margin||{top:60,right:40,bottom:80,left:60},title:e.title||"",background:e.background||"#ffffff",fontFamily:e.fontFamily||'"Noto Sans", "Fira Sans", sans-serif',fontSize:e.fontSize||12,download:void 0===e.download||e.download,...e},this.data=null,this.svg=null,this.chart=null,this.tooltip=e.tooltip||null,this.axisFormatters=e.axisFormatters||null,void 0!==e.axis_x){this.options.axisFormatters=this.options.axisFormatters||{};const t=As(e.axis_x);this.options.axisFormatters.x=t||null}if(void 0!==e.axis_y){this.options.axisFormatters=this.options.axisFormatters||{};const t=As(e.axis_y);this.options.axisFormatters.y=t||null}if(void 0!==e.tooltip){const t=As(e.tooltip);if(t)this.tooltip=t;else if("string"==typeof e.tooltip&&e.tooltip.indexOf("{")>=0){const t=e.tooltip;this.tooltip=function(e,n){return n?t.replace(/\{([^}]+)\}/g,function(t,e){var i=n[e];return null==i?"":bs(String(i))}):""}}else this.tooltip=null}void 0!==e.formattedCols&&(this.options.formattedCols=e.formattedCols),void 0!==e.axisLabels&&(this.options.xLabel||void 0===e.axisLabels.x||(this.options.xLabel=e.axisLabels.x),this.options.yLabel||void 0===e.axisLabels.y||(this.options.yLabel=e.axisLabels.y),this.options.axisLabels=e.axisLabels),this.axisFormatters=this.options.axisFormatters||this.axisFormatters,this._initializeSVG()}_initializeSVG(){Ut(this.container).selectAll("*").remove(),this.svg=Ut(this.container).append("svg").attr("width",this.options.width).attr("height",this.options.height).style("background",this.options.background).style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&this.svg.style("text-transform",this.options.textTransform);let t=this.options.background;if(!t)try{t=window.getComputedStyle(this.container).backgroundColor||t}catch(e){t=t||"#ffffff"}try{const e=$e(t)||Ee("#ffffff"),n=(.2126*e.r+.7152*e.g+.0722*e.b)/255;this.isDark=n<=.5}catch(e){this.isDark=!1}if(this.options&&this.options.theme){this.explicitTheme=this.options.theme;try{if(this.explicitTheme.axis){const t=$e(this.explicitTheme.axis);if(t){const e=(.2126*t.r+.7152*t.g+.0722*t.b)/255;this.isDark=e<=.5}}}catch(e){}}try{const t=this.isDark?"dark":"light";if(this.svg.attr("data-d3po-theme",t),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-theme",t),this.explicitTheme)try{this.explicitTheme.axis&&(this.svg.attr("data-d3po-axis",this.explicitTheme.axis),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-axis",this.explicitTheme.axis)),this.explicitTheme.tooltips&&(this.svg.attr("data-d3po-tooltips",this.explicitTheme.tooltips),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-tooltips",this.explicitTheme.tooltips))}catch(e){}}catch(e){}try{this._injectThemeStyles()}catch(e){}try{if(this.explicitTheme&&this.explicitTheme.axis&&this.svg&&this.svg.node){this._applyExplicitAxisColors(this.explicitTheme.axis);const t=this.svg.node(),e=new MutationObserver(t=>{this._applyExplicitAxisColors(this.explicitTheme.axis)});e.observe(t,{childList:!0,subtree:!0}),this._axisMutationObserver=e}}catch(e){}if(this.options.title){const t=this.svg.append("text").attr("class","title").attr("x",this.options.width/2).attr("y",this.options.margin.top/2).attr("text-anchor","middle").style("font-size",1.5*this.options.fontSize+"px").style("font-weight","bold").text(this.options.title);try{this.explicitTheme&&this.explicitTheme.axis?t.style("fill",this.explicitTheme.axis):t.style("fill",this.isDark?"#eee":"#111")}catch(e){}}this.chart=this.svg.append("g").attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`),this.options.download&&this._addDownloadButtons()}_injectThemeStyles(){const t="d3po-explicit-theme-styles",e=document.getElementById(t);e&&e.remove();const n=document.createElement("style");n.id=t;const i=this.explicitTheme&&this.explicitTheme.axis||null,r=this.explicitTheme&&this.explicitTheme.tooltips||null,o=i||"#333",a=i||"rgba(255,255,255,0.85)",s=i||"#111",l=i||"#eee",c=r||(this.isDark?"#252543":"white"),h=r?"white"===ws(c)?"#eee":"#111":this.isDark?"#eee":"#333";n.textContent=`\n      /* Axis and ticks */\n      [data-d3po-theme="light"] .axis path,\n      [data-d3po-theme="light"] .axis line,\n      [data-d3po-theme="light"] g.tick line,\n      [data-d3po-theme="light"] path.domain {\n        stroke: ${o} !important;\n      }\n      [data-d3po-theme="light"] g.tick text,\n      [data-d3po-theme="light"] .x-axis-label,\n      [data-d3po-theme="light"] .y-axis-label,\n  [data-d3po-theme="light"] .title,\n  [data-d3po-theme="light"] .treemap-subtitle,\n  [data-d3po-theme="light"] .treemap-back {\n        fill: ${s} !important;\n      }\n\n      [data-d3po-theme="dark"] .axis path,\n      [data-d3po-theme="dark"] .axis line,\n      [data-d3po-theme="dark"] g.tick line,\n      [data-d3po-theme="dark"] path.domain {\n        stroke: ${a} !important;\n      }\n      [data-d3po-theme="dark"] g.tick text,\n      [data-d3po-theme="dark"] .x-axis-label,\n      [data-d3po-theme="dark"] .y-axis-label,\n  [data-d3po-theme="dark"] .title,\n  [data-d3po-theme="dark"] .treemap-subtitle,\n  [data-d3po-theme="dark"] .treemap-back {\n        fill: ${l} !important;\n      }\n\n      /* Force menu/tooltip text color for SVG-attached menus */\n      .d3po-menu text { fill: ${h} !important; }\n      .d3po-menu rect { fill: ${c} !important; }\n    `,document.head.appendChild(n)}_applyExplicitAxisColors(t){try{if(!t||!this.svg)return;const e=this.svg.node();if(!e)return;e.querySelectorAll(".axis path, .axis line, g.tick line, path.domain").forEach(e=>{try{e.setAttribute("stroke",t),e.style.stroke=t}catch(n){}});e.querySelectorAll("g.tick text, .x-axis-label, .y-axis-label, .title").forEach(e=>{try{e.setAttribute("fill",t),e.style.fill=t}catch(n){}})}catch(e){}}_addDownloadButtons(){const t=this,e=this.svg.append("g").attr("class","d3po-download-buttons").attr("transform",`translate(${this.options.width-40}, 20)`),n=e.append("g").attr("class","d3po-hamburger").style("cursor","pointer");n.append("rect").attr("x",-12).attr("y",-12).attr("width",24).attr("height",24).style("fill","transparent").style("stroke","none");[-4,0,4].forEach(t=>{n.append("line").attr("x1",-6).attr("x2",6).attr("y1",t).attr("y2",t).style("stroke","#666").style("stroke-width","2px").style("stroke-linecap","round").style("pointer-events","none")});const i=e.append("g").attr("class","d3po-menu").attr("transform","translate(-80, 20)").style("opacity",0).style("pointer-events","none"),r=this.explicitTheme&&this.explicitTheme.tooltips||(this.isDark?"#252543":"white");let o;try{o=this.explicitTheme&&this.explicitTheme.tooltips?$e(r).darker(.8).toString():this.isDark?"rgba(255,255,255,0.08)":"#999"}catch(c){o=this.isDark?"rgba(255,255,255,0.08)":"#999"}const a=this.explicitTheme&&this.explicitTheme.tooltips?"white"===ws(r)?"#eee":"#111":this.isDark?"#eee":"#333";i.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",60).attr("rx",4).style("fill",r).style("stroke",o).style("stroke-width","1px").style("filter","drop-shadow(0 2px 4px rgba(0,0,0,0.2))");const s=i.append("g").attr("class","d3po-menu-item").attr("transform","translate(0, 0)").style("cursor","pointer");s.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",30).style("fill","transparent"),s.append("text").attr("x",10).attr("y",20).style("font-size","12px").style("fill",a).style("user-select","none").text(" SVG"),s.on("click",function(e){e.stopPropagation(),t.downloadSVG(),t._hideMenu()}).on("mouseover",function(){try{const e=t.explicitTheme&&t.explicitTheme.tooltips?$e(r).brighter(.5).toString():t.isDark?"#3a3a5a":"#f0f0f0";Ut(this).select("rect").style("fill",e)}catch(c){Ut(this).select("rect").style("fill","#f0f0f0")}}).on("mouseout",function(){Ut(this).select("rect").style("fill","transparent")});const l=i.append("g").attr("class","d3po-menu-item").attr("transform","translate(0, 30)").style("cursor","pointer");l.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",30).style("fill","transparent"),l.append("text").attr("x",10).attr("y",20).style("font-size","12px").style("fill",a).style("user-select","none").text(" PNG"),l.on("click",function(e){e.stopPropagation(),t.downloadPNG(),t._hideMenu()}).on("mouseover",function(){try{const e=t.explicitTheme&&t.explicitTheme.tooltips?$e(r).brighter(.5).toString():t.isDark?"#3a3a5a":"#f0f0f0";Ut(this).select("rect").style("fill",e)}catch(c){Ut(this).select("rect").style("fill","#f0f0f0")}}).on("mouseout",function(){Ut(this).select("rect").style("fill","transparent")}),n.on("mouseenter",function(e){e.stopPropagation(),Ut(this).selectAll("line").style("stroke","#333"),t._showMenu()}).on("mouseleave",function(){Ut(this).selectAll("line").style("stroke","#666"),setTimeout(()=>{t._isMouseOverMenu||t._hideMenu()},100)}),i.on("mouseenter",function(){t._isMouseOverMenu=!0}).on("mouseleave",function(){t._isMouseOverMenu=!1,t._hideMenu()}),this._isMouseOverMenu=!1,this.menu=i}_showMenu(){this.menu&&this.menu.transition().duration(200).style("opacity",1).style("pointer-events","all")}_hideMenu(){this.menu&&this.menu.transition().duration(200).style("opacity",0).style("pointer-events","none")}getInnerWidth(){return this.options.width-this.options.margin.left-this.options.margin.right}getInnerHeight(){return this.options.height-this.options.margin.top-this.options.margin.bottom}setData(t){return xs(t,[]),this.data=t,this}setTitle(t){return this.options.title=t,this.svg.select(".title").text(t),this}setBackground(t){return this.options.background=t,this.svg.style("background",t),this}setFont(t,e,n){return this.options.fontFamily=t,this.options.fontSize=e,n&&(this.options.textTransform=n),this.svg.style("font-family",t).style("font-size",`${e}px`),n&&this.svg.style("text-transform",n),this}setDownload(t){return this.options.download=t,this.svg.select(".d3po-download-buttons").remove(),t&&this._addDownloadButtons(),this}downloadSVG(){try{const t=this.svg.node().cloneNode(!0);t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const e=t.querySelector(".d3po-download-buttons");e&&e.remove();const n='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+(new XMLSerializer).serializeToString(t);Fs(new Blob([n],{type:"image/svg+xml;charset=utf-8"}),"d3po-chart.svg")}catch(t){console.error("Error in downloadSVG:",t),alert("Failed to download SVG: "+t.message)}}downloadPNG(){try{const t=this.svg.node().cloneNode(!0);t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const e=t.querySelector(".d3po-download-buttons");e&&e.remove();const n=(new XMLSerializer).serializeToString(t),i=document.createElement("canvas"),r=i.getContext("2d"),o=new Image;i.width=this.options.width,i.height=this.options.height,o.onload=()=>{try{r.fillStyle=this.options.background||"white",r.fillRect(0,0,i.width,i.height),r.drawImage(o,0,0),i.toBlob(t=>{t?Fs(t,"d3po-chart.png"):(console.error("Failed to create blob from canvas"),alert("PNG export failed: Could not create image blob"))},"image/png")}catch(t){console.error("Error converting to PNG:",t),alert("PNG export failed: "+t.message)}},o.onerror=t=>{console.error("Failed to load SVG into image:",t),alert("PNG export failed. Please try SVG export instead.")};const a=btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode("0x"+e)));o.src="data:image/svg+xml;base64,"+a}catch(t){console.error("Error in downloadPNG:",t),alert("Failed to download PNG: "+t.message)}}render(){throw new Error("render() must be implemented by subclass")}resize(t,e){return this.options.width=t,this.options.height=e,this.chart.selectAll("*").remove(),this.svg.attr("width",t).attr("height",e),this.options.title&&this.svg.select(".title").attr("x",t/2),this.svg.select(".d3po-download-buttons").attr("transform",`translate(${t-40}, 20)`),this.data&&this.render(),this}destroy(){Ut(this.container).selectAll("*").remove(),this.data=null,this.svg=null,this.chart=null,this.menu=null,this._isMouseOverMenu=!1}}function $s(t){return t}function Ns(t,e){var n=e.id,i=e.bbox,r=null==e.properties?{}:e.properties,o=function(t,e){var n=function(t){if(null==t)return $s;var e,n,i=t.scale[0],r=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var l=2,c=t.length,h=new Array(c);for(h[0]=(e+=t[0])*i+o,h[1]=(n+=t[1])*r+a;l<c;)h[l]=t[l],++l;return h}}(t.transform),i=t.arcs;function r(t,e){e.length&&e.pop();for(var r=i[t<0?~t:t],o=0,a=r.length;o<a;++o)e.push(n(r[o],o));t<0&&function(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,i=t.length;n<i;++n)r(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}function c(t){var e,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(c)};case"Point":e=o(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(o);break;case"LineString":e=a(t.arcs);break;case"MultiLineString":e=t.arcs.map(a);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:n,coordinates:e}}return c(e)}(t,e);return null==n&&null==i?{type:"Feature",properties:r,geometry:o}:null==i?{type:"Feature",id:n,properties:r,geometry:o}:{type:"Feature",id:n,bbox:i,properties:r,geometry:o}}const zs={D3po:Ss,BoxPlot:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Box plot requires x and y fields");this.xField=e.x,this.yField=e.y,this.colorField=e.color}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.xField,this.yField]);const t="string"==typeof this.data[0][this.yField],e=t?this.yField:this.xField,n=t?this.xField:this.yField,i=this.options&&this.options.formattedCols?this.options.formattedCols:null,r=t=>i?i[t]?i[t]:t===this.xField&&i.x?i.x:t===this.yField&&i.y?i.y:null:null;let o;var a,s;a=this.data,s=e,o=a.reduce((t,e)=>{const n=e[s];return t[n]||(t[n]=[]),t[n].push(e),t},{});const l=["#74c0e2","#406662","#549e95","#8abdb6","#bcd8af","#a8c380","#ede788","#d6c650","#dc8e7a","#d05555","#bf3251","#872a41","#993f7b","#7454a6","#a17cb0","#d1a1bc","#a1aafb","#5c57d9","#1c26b3","#4d6fd0","#7485aa","#d3d3d3"],c=Object.keys(o);let h=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const t=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),e=t.length?t:l;h={},c.forEach((t,n)=>{h[t]=ps(e[n%e.length])})}else if(!this.colorField){const t=l;h={},c.forEach((e,n)=>{h[e]=ps(t[n%t.length])})}const u=Object.entries(o).map(([t,i])=>({group:t,label:(()=>{const n=r(e);return n&&void 0!==i[0][n]?i[0][n]:t})(),stats:_s(i.map(t=>t[n])),color:h?h[t]:this.colorField?i[0][this.colorField]:pa[0]}));let f,d;const p=this.options&&(this.options.xLabel||this.options.axisLabels&&this.options.axisLabels.x)?this.options.xLabel||this.options.axisLabels.x:this.xField?String(this.xField):"",g=this.options&&(this.options.yLabel||this.options.axisLabels&&this.options.axisLabels.y)?this.options.yLabel||this.options.axisLabels.y:this.yField?String(this.yField):"";t?(f=Yo().domain(u.map(t=>t.label)).range([0,this.getInnerHeight()]).padding(.2),d=ra().domain([v(u,t=>t.stats.min),x(u,t=>t.stats.max)]).nice().range([0,this.getInnerWidth()])):(f=Yo().domain(u.map(t=>t.label)).range([0,this.getInnerWidth()]).padding(.2),d=ra().domain([v(u,t=>t.stats.min),x(u,t=>t.stats.max)]).nice().range([this.getInnerHeight(),0]));let y=null,m=null;t?(y=z(d),this.options&&this.options.axisFormatters&&this.options.axisFormatters.x&&y.tickFormat(this.options.axisFormatters.x),m=E(f),i&&i[e]&&m.tickFormat(t=>{const e=u.find(e=>e.group===t);return e?e.label:t})):(y=z(f),i&&i[e]&&y.tickFormat(t=>{const e=u.find(e=>e.group===t);return e?e.label:t}),this.options&&this.options.axisFormatters&&this.options.axisFormatters.x&&y.tickFormat(this.options.axisFormatters.x),m=E(d),this.options&&this.options.axisFormatters&&this.options.axisFormatters.y&&m.tickFormat(this.options.axisFormatters.y));let b=0,w=0,_=this.getInnerWidth(),F=this.getInnerHeight();const k=this.options&&!1!==this.options.useLeftMarginSpace;try{const e=this.svg.append("g").attr("class","d3po-probe");e.call(m);try{const t=e.selectAll(".tick text").nodes();t&&t.length&&(b=x(t,t=>t.getBBox().width)||0)}catch(L){}e.remove();try{const e=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(t?this.xField:this.yField);w=e.node().getBBox().height||0,e.remove()}catch(L){w=14}const n=void 0!==this.yLabelGap?this.yLabelGap:12,i=Math.ceil(b+n+w+8);i>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin=this.options.margin||{},this.options.margin.left=i,_=this.getInnerWidth(),F=this.getInnerHeight(),f&&f.range&&(t?f.range([0,F]):f.range([0,_])),d&&d.range&&(t?d.range([0,_]):d.range([F,0])),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(L){}if(k&&b>0){const e=void 0!==this.yLabelGap?this.yLabelGap:12,n=Math.ceil(b+e+w+8),i=this.options&&this.options.margin&&this.options.margin.left||60,r=4,o=Math.max(0,(n||0)+r),a=i-o,s=this.getInnerWidth();_=Math.max(20,Math.round(s+Math.max(0,a))),F=this.getInnerHeight(),f&&f.range&&(t?f.range([0,F]):f.range([0,_])),d&&d.range&&(t?d.range([0,_]):d.range([F,0]));const l=o;this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${l},${this.options.margin.top})`)}const M=this.chart.append("g").attr("transform",`translate(0,${F})`).call(y);try{const t=M.selectAll(".tick text").nodes();let e=0,n=0;t&&t.length&&(e=x(t,t=>t.getBBox().width)||0,n=x(t,t=>t.getBBox().height)||0);let i=!1;if(f&&f.bandwidth){e>.9*f.bandwidth()&&(i=!0)}else if(t&&t.length){e>.9*Math.max(10,_/t.length)&&(i=!0)}i&&M.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end");const r=Math.max(8,n+8);this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",_/2).attr("y",F+r+(i?36:24)).style("font-size","14px").text(p)}catch(L){this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",_/2).attr("y",F+(t?45:65)).style("font-size","14px").text(p)}const A=this.chart.append("g").call(m);try{const t=A.selectAll(".tick text").nodes(),e=t&&t.length?x(t,t=>t.getBBox().width):b,n=void 0!==this.yLabelGap?this.yLabelGap:12,i=w||14,r=Math.max(e+n,i+n);let o=r+Math.min(36,Math.max(4,Math.round(.08*e)))+10;const a=e>0?Math.ceil(e+n+i+8):null;let s=(this.options&&this.options.margin&&this.options.margin.left||60)-4;s=null!=a?Math.max(10,Math.min(s,a)):Math.max(10,s),o>s&&(o=s),A.append("text").attr("class","y-axis-label").attr("transform",`translate(${-o},${F/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(g)}catch(L){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-F/2).attr("y",t?-70:-40).style("font-size","14px").text(g)}const S=f.bandwidth(),$=this.chart.selectAll(".box").data(u).enter().append("g").attr("class","box").attr("transform",e=>t?`translate(0,${f(e.label)})`:`translate(${f(e.label)},0)`);t?($.append("line").attr("x1",t=>d(t.stats.whiskerMin)).attr("x2",t=>d(t.stats.q1)).attr("y1",S/2).attr("y2",S/2).attr("stroke","black").attr("stroke-width",1.5),$.append("line").attr("x1",t=>d(t.stats.q3)).attr("x2",t=>d(t.stats.whiskerMax)).attr("y1",S/2).attr("y2",S/2).attr("stroke","black").attr("stroke-width",1.5),$.append("line").attr("x1",t=>d(t.stats.whiskerMin)).attr("x2",t=>d(t.stats.whiskerMin)).attr("y1",.25*S).attr("y2",.75*S).attr("stroke","black").attr("stroke-width",1.5),$.append("line").attr("x1",t=>d(t.stats.whiskerMax)).attr("x2",t=>d(t.stats.whiskerMax)).attr("y1",.25*S).attr("y2",.75*S).attr("stroke","black").attr("stroke-width",1.5),$.append("rect").attr("x",t=>d(t.stats.q1)).attr("y",0).attr("width",t=>d(t.stats.q3)-d(t.stats.q1)).attr("height",S).attr("fill",t=>t.color).attr("stroke","black").attr("stroke-width",1.5).style("opacity",1),$.append("line").attr("x1",t=>d(t.stats.median)).attr("x2",t=>d(t.stats.median)).attr("y1",0).attr("y2",S).attr("stroke","black").attr("stroke-width",2),$.each(function(t){t.stats.min<t.stats.whiskerMin&&Ut(this).append("circle").attr("cx",d(t.stats.min)).attr("cy",S/2).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),$.each(function(t){t.stats.max>t.stats.whiskerMax&&Ut(this).append("circle").attr("cx",d(t.stats.max)).attr("cy",S/2).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),$.each(function(t){t.stats.outliers.forEach(t=>{Ut(this).append("circle").attr("cx",d(t)).attr("cy",S/2).attr("r",4).attr("fill","black").style("opacity",1)})})):($.append("line").attr("x1",S/2).attr("x2",S/2).attr("y1",t=>d(t.stats.whiskerMax)).attr("y2",t=>d(t.stats.q3)).attr("stroke","black").attr("stroke-width",1.5),$.append("line").attr("x1",S/2).attr("x2",S/2).attr("y1",t=>d(t.stats.q1)).attr("y2",t=>d(t.stats.whiskerMin)).attr("stroke","black").attr("stroke-width",1.5),$.append("line").attr("x1",.25*S).attr("x2",.75*S).attr("y1",t=>d(t.stats.whiskerMax)).attr("y2",t=>d(t.stats.whiskerMax)).attr("stroke","black").attr("stroke-width",1.5),$.append("line").attr("x1",.25*S).attr("x2",.75*S).attr("y1",t=>d(t.stats.whiskerMin)).attr("y2",t=>d(t.stats.whiskerMin)).attr("stroke","black").attr("stroke-width",1.5),$.append("rect").attr("x",0).attr("y",t=>d(t.stats.q3)).attr("width",S).attr("height",t=>d(t.stats.q1)-d(t.stats.q3)).attr("fill",t=>t.color).attr("stroke","black").attr("stroke-width",1.5).style("opacity",1),$.append("line").attr("x1",0).attr("x2",S).attr("y1",t=>d(t.stats.median)).attr("y2",t=>d(t.stats.median)).attr("stroke","black").attr("stroke-width",2),$.each(function(t){t.stats.min<t.stats.whiskerMin&&Ut(this).append("circle").attr("cx",S/2).attr("cy",d(t.stats.min)).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),$.each(function(t){t.stats.max>t.stats.whiskerMax&&Ut(this).append("circle").attr("cx",S/2).attr("cy",d(t.stats.max)).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),$.each(function(t){t.stats.outliers.forEach(t=>{Ut(this).append("circle").attr("cx",S/2).attr("cy",d(t)).attr("r",4).attr("fill","black").style("opacity",1)})}));const N=this.options.fontFamily,T=this.options.fontSize;var C=ys(this.tooltip,this.options&&this.options.tooltip);return $.on("mouseover",function(t,e){const n=Ut(this).select("rect"),i=ks(n.attr("fill"));if(n.attr("fill",i),C){const n=()=>`<strong>${bs(e.label||e.group)}</strong>Percentile 0th (Min): ${e.stats.min.toFixed(2)}<br/>Percentile 25th: ${e.stats.q1.toFixed(2)}<br/>Percentile 50th (Median): ${e.stats.median.toFixed(2)}<br/>Percentile 75th: ${e.stats.q3.toFixed(2)}<br/>Percentile 100th (Max): ${e.stats.max.toFixed(2)}<br/>Outliers: ${e.stats.outliers.length}`;ms(t,C,null,{group:e.group,label:e.label||e.group,stats:e.stats},N,T,n)}else{ds(t,`<strong>${e.label||e.group}</strong>Percentile 0th (Min): ${e.stats.min.toFixed(2)}<br/>Percentile 25th: ${e.stats.q1.toFixed(2)}<br/>Percentile 50th (Median): ${e.stats.median.toFixed(2)}<br/>Percentile 75th: ${e.stats.q3.toFixed(2)}<br/>Percentile 100th (Max): ${e.stats.max.toFixed(2)}<br/>Outliers: ${e.stats.outliers.length}`,N,T)}}).on("mouseout",function(t,e){Ut(this).select("rect").attr("fill",e.color),gs()}),this}},BarChart:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Bar chart requires x and y fields");this.xField=e.x,this.yField=e.y,this.colorField=e.color,this.groupField=e.group}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.xField,this.yField]);const t="string"==typeof this.data[0][this.yField];let e=this.getInnerWidth(),n=this.getInnerHeight();const i=this.options&&!1!==this.options.useLeftMarginSpace,r=!(!this.options||!0!==this.options.stack&&"stacked"!==this.options.type),o=null!=this.groupField?this.groupField:null,a=t?this.yField:this.xField,s=t?this.xField:this.yField,l=Array.from(new Set(this.data.map(t=>null==t[a]?"":String(t[a])))),c=this.options&&this.options.sort?String(this.options.sort):null,h="Rest of the world",u=t=>{l.splice(0,l.length,...t)},f=()=>{const t=new Map;return this.data.forEach(e=>{const n=null==e[a]?"":String(e[a]),i=Number(e[s])||0;t.set(n,(t.get(n)||0)+i)}),Array.from(t.entries())};let d=null;if(c&&!r){const t=c.match(/^(asc|desc)-([xy])$/);t&&(d={dir:t[1],axis:t[2]})}const p=o?Array.from(new Set(this.data.map(t=>null==t[o]?"":String(t[o])))):[];let g=!1;if(o&&!r){const t=new Map;this.data.forEach(e=>{const n=null==e[a]?"":String(e[a]),i=null==e[o]?"":String(e[o]);t.has(n)||t.set(n,new Set),t.get(n).add(i)});for(const e of t.values())if(e.size>1){g=!0;break}}let y,m,v=null;const b=vs(this.data,this.colorField,ya);let w=null;const _=new Map;if(r&&o){this.colorField&&this.data.forEach(t=>{const e=null==t[o]?"":String(t[o]);_.has(e)||null==t[this.colorField]||_.set(e,t[this.colorField])});const i=l.map(t=>{const e={__cat:t};return p.forEach(t=>{e[t]=0}),e.__total=0,e}),r=new Map(i.map(t=>[t.__cat,t]));this.data.forEach(t=>{const e=null==t[a]?"":String(t[a]),n=null==t[o]?"":String(t[o]),i=Number(t[s])||0,l=r.get(e);l&&(l[n]=(l[n]||0)+i,l.__total=(l.__total||0)+i)});const f=x(i,t=>t.__total)||0;if(t?(m=Yo().domain(l).range([0,n]).padding(.2),y=ra().domain([0,f]).nice().range([0,e])):(y=Yo().domain(l).range([0,e]).padding(.2),m=ra().domain([0,f]).nice().range([n,0])),c){const e=c.match(/^(asc|desc)-([xy])$/);if(e){const n=e[1];i.sort((t,e)=>"desc"===n?e.__total-t.__total:t.__total-e.__total);const r=i.map(t=>t.__cat);if(-1!==r.indexOf(h)){u(r.filter(t=>t!==h).concat([h]))}else u(r);t?m.domain(l):y.domain(l)}}const d=Ka().keys(p)(i),g=this.chart.selectAll(".series").data(d).enter().append("g").attr("class","series");t?g.selectAll("rect").data(t=>t).enter().append("rect").attr("y",(t,e)=>m(i[e].__cat)).attr("x",t=>y(t[0])).attr("width",t=>Math.max(0,y(t[1])-y(t[0]))).attr("height",m.bandwidth()).attr("fill",(t,e,n)=>{const i=Ut(n[e].parentNode).datum(),r=i&&i.key?i.key:null;if(this.colorField&&_.has(r)){const t=_.get(r);return b({[this.colorField]:t})}return b({[this.colorField]:r})}):g.selectAll("rect").data(t=>t).enter().append("rect").attr("x",(t,e)=>y(i[e].__cat)).attr("y",t=>m(t[1])).attr("height",t=>Math.max(0,m(t[0])-m(t[1]))).attr("width",y.bandwidth()).attr("fill",(t,e,n)=>{const i=Ut(n[e].parentNode).datum(),r=i&&i.key?i.key:null;if(this.colorField&&_.has(r)){const t=_.get(r);return b({[this.colorField]:t})}return b({[this.colorField]:r})}),w=this.chart.selectAll(".series").selectAll("rect")}else if(g)t?(y=ra().domain([0,x(this.data,t=>Number(t[s])||0)]).nice().range([0,e]),m=Yo().domain(l).range([0,n]).padding(.12),v=Yo().domain(p).range([0,m.bandwidth()]).padding(.05)):(y=Yo().domain(l).range([0,e]).padding(.12),m=ra().domain([0,x(this.data,t=>Number(t[s])||0)]).nice().range([n,0]),v=Yo().domain(p).range([0,y.bandwidth()]).padding(.05)),w=this.chart.selectAll(".bar").data(this.data).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",t=>b(t)),t?w.attr("x",0).attr("y",t=>m(String(null==t[a]?"":t[a]))+v(String(null==t[o]?"":t[o]))).attr("width",t=>y(Number(t[s])||0)).attr("height",()=>v.bandwidth()):w.attr("x",t=>y(String(null==t[a]?"":t[a]))+v(String(null==t[o]?"":t[o]))).attr("y",t=>m(Number(t[s])||0)).attr("width",()=>v.bandwidth()).attr("height",t=>Math.max(0,n-m(Number(t[s])||0)));else{const i=new Map;if(this.data.forEach(t=>{const e=null==t[a]?"":String(t[a]);i.has(e)||i.set(e,[]),i.get(e).push(t)}),d){const t=d.dir,e=d.axis;if("x"===e){const e=f();e.sort((e,n)=>"desc"===t?n[1]-e[1]:e[1]-n[1]);let n=e.map(t=>t[0]);-1!==n.indexOf(h)&&(n=n.filter(t=>t!==h).concat([h])),u(n)}else if("y"===e){const e=Array.from(l).sort((e,n)=>(null==e&&(e=""),null==n&&(n=""),e<n?"asc"===t?-1:1:e>n?"asc"===t?1:-1:0));if(-1!==e.indexOf(h)){u(e.filter(t=>t!==h).concat([h]))}else u(e)}}t?(y=ra().domain([0,x(this.data,t=>Number(t[this.xField])||0)]).nice().range([0,e]),m=Yo().domain(l).range([0,n]).padding(.2),w=this.chart.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",t=>{const e=(i.get(t)||[])[0]||{};return b(e)}).attr("x",0).attr("y",t=>m(t)).attr("width",t=>{const e=(i.get(t)||[])[0]||{};return y(Number(e[this.xField])||0)}).attr("height",()=>m.bandwidth()),w.each(function(t,e,n){const r=(i.get(t)||[])[0]||{[a]:t};Ut(n[e]).datum(r)})):(y=Yo().domain(l).range([0,e]).padding(.2),m=ra().domain([0,x(this.data,t=>Number(t[this.yField])||0)]).nice().range([n,0]),w=this.chart.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",t=>{const e=(i.get(t)||[])[0]||{};return b(e)}).attr("x",t=>y(t)).attr("y",t=>{const e=(i.get(t)||[])[0]||{};return m(Number(e[this.yField])||0)}).attr("width",()=>y.bandwidth()).attr("height",t=>{const e=(i.get(t)||[])[0]||{};return Math.max(0,n-m(Number(e[this.yField])||0))}),w.each(function(t,e,n){const r=(i.get(t)||[])[0]||{[a]:t};Ut(n[e]).datum(r)}))}let F=0,k=0;try{const t=this.svg.append("g").attr("class","d3po-probe"),i=E(m);this.options.axisFormatters&&this.options.axisFormatters.y&&i.tickFormat(this.options.axisFormatters.y),t.call(i);try{const e=t.selectAll(".tick text").nodes();e&&e.length&&(F=x(e,t=>t.getBBox().width)||0)}catch(R){}t.remove();try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);k=t.node().getBBox().height||0,t.remove()}catch(R){k=14}const r=void 0!==this.yLabelGap?this.yLabelGap:12,o=Math.ceil(F+r+k+8);o>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin.left=o,e=this.getInnerWidth(),n=this.getInnerHeight(),y&&y.range&&(y.bandwidth,y.range([0,e])),m&&m.range&&(m.bandwidth?m.range([0,n]):m.range([n,0])),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(R){}if(i&&F>0){const t=void 0!==this.yLabelGap?this.yLabelGap:12,i=Math.ceil(F+t+k+8),r=this.options&&this.options.margin&&this.options.margin.left||60,o=4,a=Math.max(0,(i||0)+o),s=r-a,l=this.getInnerWidth();e=Math.max(20,Math.round(l+Math.max(0,s))),y&&y.range&&(y.bandwidth,y.range([0,e])),m&&m.range&&(m.bandwidth?m.range([0,n]):m.range([n,0]));const c=a;this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${c},${this.options.margin.top})`)}const M=this.options.fontFamily,A=this.options.fontSize,S=ys(this.tooltip,this.options&&this.options.tooltip),$=(t,e=!1)=>{if(!t||!t.node)return;const n=t.node();if(n)try{const t=t=>{if(!t)return!1;const e=String(t).trim();return""!==e&&(!!/^\d+[.)]?$/.test(e)||!!/^-?\d+(?:\.\d+)?$/.test(e))};if(e){const e=n=>{if(!n||!n.childNodes)return;const i=Array.from(n.childNodes);for(const r of i){const i=(r.textContent||"").trim();if(""===i||t(i))try{n.removeChild(r)}catch(R){}else 1===r.nodeType&&r.childNodes&&r.childNodes.length&&e(r)}};for(e(n);n.firstChild&&""===(n.firstChild.textContent||"").trim();)n.removeChild(n.firstChild);return}for(;n.firstChild;){const e=n.firstChild,i=(e.textContent||"").trim();if(""!==i){if(!t(i))break;for(n.removeChild(e);n.firstChild&&""===(n.firstChild.textContent||"").trim();)n.removeChild(n.firstChild)}else n.removeChild(e)}}catch(R){}},N=t=>{if(null==t)return t;return String(t).replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())},T=t=>"number"==typeof t&&Number.isFinite(t)?t.toFixed(2):t,C=this.xField,L=this.yField,P=this.colorField,I=null!=o&&(g||r);w.on("mouseover",function(e,n){let i=n,a=null,s=null;if(Array.isArray(n)&&n.data){i=n.data;const t=Ut(this.parentNode).datum();a=t&&t.key?t.key:null,s=n[1]-n[0]}const l=Ut(this).attr("fill");if(Ut(this).attr("fill",ks(l)),S){const n=ms(e,(t,e)=>{const n=S(t,e);return"string"==typeof n?"string"!=typeof(i=n)?i:i=(i=i.replace(/^(?:\s*\d+(?:[.)]\s*)?\r?\n)+/,"")).replace(/^\s*\r?\n+/,""):n;var i},null,i,M,A,()=>{let e,n=null;a?n=a:I&&o&&i&&o in i&&(n=i[o]),null!=n&&""===String(n).trim()&&(n=null),e=r&&i&&null!=i.__cat?i.__cat:i&&i[t?L:C];let l;l=r&&null!=s?s:i&&i[t?C:L];const c=[];return n?c.push(`<strong>${bs(String(e))}</strong> ${bs(String(N(n)))}`):c.push(`<strong>${bs(String(e))}</strong>`),c.push(`Value: ${bs(String(T(l)))}`),c.join("<br/>")});$(n,!I)}else{let n;n=r&&i&&null!=i.__cat?i.__cat:i&&i[t?L:C];let l;l=r&&null!=s?s:i&&i[t?C:L];let c=null;a?c=a:I&&o&&i&&o in i&&(c=i[o]),null!=c&&""===String(c).trim()&&(c=null);const h=[];c?h.push(`<strong>${bs(String(n))}</strong> ${bs(String(N(c)))}`):h.push(`<strong>${bs(String(n))}</strong>`),h.push(`Value: ${bs(String(T(l)))}`);const u=ds(e,h.join("<br/>"),M,A);$(u,!I)}}).on("mouseout",function(){const t=Ut(this).datum();if(Array.isArray(t)&&t.data){const t=Ut(this.parentNode).datum(),e=t&&t.key?t.key:null;if(r&&o&&P&&_&&_.has(e)){const t=_.get(e),n={};n[P]=t,Ut(this).attr("fill",b(n))}else{const t={};t[P]=e,Ut(this).attr("fill",b(t))}}else Ut(this).attr("fill",b(t));gs()});let q=z(y),B=E(m);this.options.axisFormatters&&this.options.axisFormatters.x&&q.tickFormat(this.options.axisFormatters.x),this.options.axisFormatters&&this.options.axisFormatters.y&&B.tickFormat(this.options.axisFormatters.y);const O=this.chart.append("g").attr("transform",`translate(0,${n})`).call(q);O.selectAll("text").style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&O.selectAll("text").style("text-transform",this.options.textTransform);try{const t=O.selectAll(".tick text").nodes();let i=0,r=0;t&&t.length&&(i=x(t,t=>t.getBBox().width)||0,r=x(t,t=>t.getBBox().height)||0);let o=!1;if(y.bandwidth){i>.9*y.bandwidth()&&(o=!0)}else if(t&&t.length){i>.9*Math.max(10,e/t.length)&&(o=!0)}o&&O.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end");const a=Math.max(8,r+8);this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",e/2).attr("y",n+a+(o?36:24)).style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"")}catch(R){}const j=this.chart.append("g").call(B);j.selectAll("text").style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`),this.options.textTransform&&j.selectAll("text").style("text-transform",this.options.textTransform);try{const t=j.selectAll(".tick text").nodes(),e=t&&t.length?x(t,t=>t.getBBox().width):F,i=void 0!==this.yLabelGap?this.yLabelGap:12,r=k||14,o=Math.max(e+i,r+i);let a=o+Math.min(36,Math.max(4,Math.round(.08*e)))+10;const s=e>0?Math.ceil(e+i+r+8):null;let l=(this.options&&this.options.margin&&this.options.margin.left||60)-4;l=null!=s?Math.max(10,Math.min(l,s)):Math.max(10,l),a>l&&(a=l),j.append("text").attr("class","y-axis-label").attr("transform",`translate(${-a},${n/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-family",this.options.fontFamily).style("font-size","14px").style("text-transform",this.options.textTransform||"none").text(this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"")}catch(R){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-n/2).attr("y",-40).attr("fill","black").style("font-size","14px").text(this.yField)}return this}},Treemap:class extends Ss{constructor(t,e){if(super(t,e),!e.size||!e.group)throw new Error("Treemap requires size and group fields");if(this.sizeField=e.size,this.groupField=e.group,this.colorField=e.color,this.subgroupField=e.subgroup,"string"==typeof e.tile){const t={squarify:jo,dice:Bo,slice:Oo,"slice-dice":Go};this.tile=t[e.tile]||jo}else this.tile=e.tile||jo;this.labels=e.labels&&"object"==typeof e.labels?e.labels:{align:"left",valign:"top"},this.labelsOption=null,e.labels&&(this.labelsOption=e.labels.fields||e.labels.formatter||e.labels),this.labelsFormatter=As(this.labelsOption),this.labelMode=e.labelMode||"percent",this.subtitleOption=e.labels&&e.labels.subtitle?e.labels.subtitle:null,this.subtitleFormatter=As(this.subtitleOption),this.getSubtitleText=(t,e)=>{if(this.subtitleFormatter)try{const n={mode:t,nodeName:e&&e.data&&e.data.name?e.data.name:null,groupField:this.groupField,subgroupField:this.subgroupField},i=this.subtitleFormatter(null,n);if(null!=i)return i}catch(n){console.error("Subtitle formatter error",n)}return"aggregated"===t||"flat"===t?this.groupField:this.subgroupField||this.groupField},this.tooltipFormatter=ys(this.tooltip,e&&e.tooltip)}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.sizeField,this.groupField]);const t=vs(this.data,this.colorField,ya);let e;if(this.subgroupField){const n=new Map;this.data.forEach(e=>{const i=e[this.groupField],r=e[this.subgroupField]||"None",o=t(e),a=`${i}|||${r}`;n.has(a)||n.set(a,{group:i,subgroup:r,color:o,value:0,rows:[]});const s=n.get(a);s.value+=Number(e[this.sizeField])||0,s.rows.push(e)});const i=new Map;for(const t of n.values())i.has(t.group)||i.set(t.group,{name:t.group,children:[]}),i.get(t.group).children.push({name:t.subgroup,value:t.value,color:t.color,__rows:t.rows});e={children:Array.from(i.values())}}else e={children:this.data.map(e=>({name:e[this.groupField],value:e[this.sizeField],color:t(e),__row:e}))};const n=No(e).sum(t=>t.value),i=Ro().tile(this.tile).size([this.getInnerWidth(),this.getInnerHeight()]).padding(2).round(!0);let r=null;if(this.subgroupField){const t=e.children.map(t=>{const e=(t.children||[]).reduce((t,e)=>t+(e.value||0),0),n=t.children&&t.children.length&&t.children[0].color?t.children[0].color:null;return{name:t.name,value:e,color:n,isAggregated:!0}});r=No({children:t}).sum(t=>t.value||0),i(r)}i(n);let o=r||n;const a=n.value,s=t=>"black"===ws(t)?"white":"black";let l;l=this.subgroupField&&r&&r.children?r.children:n.leaves(),l.forEach(t=>{t._originalColor||(t._originalColor=t.data.color||ya(Math.random()))});const c=this.chart.selectAll(".cell").data(l).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);c.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2).style("opacity",1),this.chart.selectAll(".treemap-subtitle").remove(),this.chart.selectAll(".treemap-back").remove();const h=this.chart.append("text").attr("class","treemap-subtitle").attr("x",this.getInnerWidth()/2).attr("y",-10).attr("text-anchor","middle").attr("font-size",.9*this.options.fontSize+"px").attr("font-family",this.options.fontFamily).style("display",this.subgroupField?null:"none").text(this.groupField),u=this.chart.append("text").attr("class","treemap-back").attr("x",0).attr("y",-10).attr("font-size",.9*this.options.fontSize+"px").attr("font-family",this.options.fontFamily).attr("fill","currentColor").attr("cursor","pointer").style("display","none").text(" Back").on("click",()=>{o=r||n,g(o)}),f=this.options.fontFamily,d=this.options.fontSize,p=this.tooltipFormatter;c.selectAll("rect").on("mouseover",(t,e)=>{const n=ks(e._originalColor);Ut(t.currentTarget).attr("fill",n);const i=e.value/a*100,o=i.toFixed(1);if(p)try{let n=e.data&&e.data.__row?e.data.__row:e.data&&e.data.__rows?e.data.__rows[0]:null;const o=!(!r||!(e.parent===r||e.data&&e.data.isAggregated));n||(o?(n={[this.groupField]:e.data.name,count:e.value,color:e.data.color},n[this.groupField]=e.data.name,n.name=e.data.name):n={name:e.data.name,value:e.value,color:e.data.color}),null==n.count&&(n.count=null!=n.value?n.value:e.value);const a=p(i,n);if(null!=a)return void ds(t,a,f,d)}catch(h){console.error("Tooltip formatter error",h)}const s=e.data&&e.data.name?this.subgroupField&&e.parent&&e.parent.data&&e.parent.data.name?`${e.parent.data.name} ${e.data.name}`:e.data.name:"";let l=null;e.data&&e.data.__row?l=e.data.__row:e.data&&e.data.__rows&&e.data.__rows.length&&(l=e.data.__rows[0]);const c=!(!r||!(e.parent===r||e.data&&e.data.isAggregated));if(l||(l={},l[this.groupField]=e.data&&e.data.name?e.data.name:null,this.subgroupField&&!c&&(l[this.subgroupField]=e.data&&e.data.name?e.data.name:null),l.count=e.value,l.color=e.data&&e.data.color?e.data.color:null,l.name=e.data&&e.data.name?e.data.name:null),null==l.count&&(l.count=e.value),p)try{const e=p(i,l);if(null!=e)return void ds(t,e,f,d)}catch(h){console.error("Tooltip formatter error",h)}ds(t,`<strong>${bs(s)}</strong>Value: ${bs(String(l.count))}<br/>Percentage: ${o}%`,f,d)}).on("mouseout",(t,e)=>{Ut(t.currentTarget).attr("fill",e._originalColor),gs()}),c.selectAll("rect").on("click",(t,e)=>{if(r&&(e.parent===r||e.data.isAggregated)){const t=e.data.name,i=n.children.find(e=>e.data.name===t);return void(i&&(o=i,g(o)))}e.children&&e.children.length&&(o=e,g(o))});const g=t=>{if(this.chart.selectAll(".cell").remove(),this.subgroupField&&t===r){i(r);const t=r.children||[];t.forEach(t=>{t._originalColor||(t._originalColor=t.data.color||ya(Math.random()))});const e=this.chart.selectAll(".cell").data(t).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);return e.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2),b(e,1,1),e.selectAll("rect").on("mouseover",(t,e)=>{const n=ks(e._originalColor);Ut(t.currentTarget).attr("fill",n);const i=e.value/a*100,o=i.toFixed(1),s=e.data&&e.data.name?this.subgroupField&&e.parent&&e.parent.data&&e.parent.data.name?`${e.parent.data.name} ${e.data.name}`:e.data.name:"";if(p)try{let n=e.data&&e.data.__row?e.data.__row:e.data&&e.data.__rows?e.data.__rows[0]:null;const o=!(!r||!(e.parent===r||e.data&&e.data.isAggregated));n||(o?(n={[this.groupField]:e.data.name,count:e.value,color:e.data.color},n.name=e.data.name):n={name:e.data.name,value:e.value,color:e.data.color}),null==n.count&&(n.count=null!=n.value?n.value:e.value);const a=p(i,n);if(null!=a)return void ds(t,a,f,d)}catch(l){console.error("Tooltip formatter error",l)}ds(t,`<strong>${bs(s)}</strong>Value: ${bs(String(e.value))}<br/>Percentage: ${o}%`,f,d)}).on("mouseout",(t,e)=>{Ut(t.currentTarget).attr("fill",e._originalColor),gs()}).on("click",(t,e)=>{const i=e.data.name,r=n.children&&n.children.find(t=>t.data.name===i);r&&(o=r,g(o))}),u.style("display","none"),void h.text(this.getSubtitleText("aggregated",null))}if(!this.subgroupField&&t===n){i(n);const t=n.leaves();t.forEach(t=>{t._originalColor||(t._originalColor=t.data.color||ya(Math.random()))});const e=this.chart.selectAll(".cell").data(t).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);return e.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2),b(e,1,1),e.selectAll("rect").on("click",(t,e)=>{e.children&&e.children.length&&(o=e,g(o))}),u.style("display","none"),void h.text(this.getSubtitleText("flat",null))}const e=No(JSON.parse(JSON.stringify(t.data))).sum(t=>t.value||0);i.size([this.getInnerWidth(),this.getInnerHeight()]),i(e);const s=e.leaves();s.forEach(t=>{if(!t._originalColor){const e=n.leaves().find(e=>e.data&&t.data&&e.data.name===t.data.name&&e.value===t.value);t._originalColor=e&&e._originalColor?e._originalColor:t.data&&t.data.color||ya(Math.random())}});const l=this.chart.selectAll(".cell").data(s).enter().append("g").attr("class","cell").attr("transform",t=>`translate(${t.x0},${t.y0})`);l.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("fill",t=>t._originalColor).attr("stroke","white").attr("stroke-width",2),b(l,1,1),l.selectAll("rect").on("mouseover",(t,e)=>{const n=ks(e._originalColor);Ut(t.currentTarget).attr("fill",n);const i=e.value/a*100,o=i.toFixed(1),s=e.data&&e.data.name?this.subgroupField&&e.parent&&e.parent.data&&e.parent.data.name?`${e.parent.data.name} ${e.data.name}`:e.data.name:"";let l=e.data&&e.data.__row?e.data.__row:e.data&&e.data.__rows?e.data.__rows[0]:null;const c=!(!r||!(e.parent===r||e.data&&e.data.isAggregated));if(l||(c?(l={[this.groupField]:e.data.name,count:e.value,color:e.data.color},l.name=e.data.name):l={name:e.data.name,value:e.value,color:e.data.color}),null==l.count&&(l.count=null!=l.value?l.value:e.value),p)try{const e=p(i,l);if(null!=e)return void ds(t,e,f,d)}catch(h){console.error("Tooltip formatter error",h)}ds(t,`<strong>${bs(s)}</strong>Value: ${bs(String(e.data.value||e.value))}<br/>Percentage: ${o}%`,f,d)}).on("mouseout",(t,e)=>{Ut(t.currentTarget).attr("fill",e._originalColor),gs()}),u.style("display",null),h.text(this.getSubtitleText("drilled",t))};this.subgroupField&&r?h.text(this.getSubtitleText("aggregated",null)):h.text(this.getSubtitleText("flat",null));const y=(t,e,n=1)=>{const i=(t.x1-t.x0)*n;switch(e){case"center":case"middle":return i/2;case"right":case"end":return i-5;default:return 5}},m=(t,e,n=0,i=2,r=1)=>{const o=(t.y1-t.y0)*r,a=1.4*this.options.fontSize,s=i*a,l=n*a;switch(e){case"middle":return(o-s)/2+this.options.fontSize+l;case"bottom":return o-5-a*(i-n);default:return this.options.fontSize+4+l}},x=t=>{switch(t){case"center":case"middle":return"middle";case"right":case"end":return"end";default:return"start"}},v=this.labels,b=(t,e=1,n=1)=>{const i=this;t.each(function(t){const o=Ut(this),l=(t.x1-t.x0)*e,c=(t.y1-t.y0)*n,h=2*(1.4*i.options.fontSize),u=(r,o)=>{if(!v)return!1;const a=y(t,v.align,e),s=m(t,v.valign,o,2,n),u=x(v.align);if("middle"===v.valign){if(h>c)return!1}else if(s+i.options.fontSize>c||s<i.options.fontSize)return!1;const f=i.chart.append("text").attr("x",a).attr("y",s).text(r).attr("font-size",`${i.options.fontSize}px`).attr("font-family",i.options.fontFamily).attr("font-weight","bold").attr("text-anchor",u).style("visibility","hidden"),d=f.node().getBBox();f.remove();let p,g;return"start"===u?(p=a,g=a+d.width):"end"===u?(p=a-d.width,g=a):(p=a-d.width/2,g=a+d.width/2),p>=5&&g<=l-5},f=(t,e)=>{if(!t)return"";if(u(t,e))return t;let n=0,i=t.length,r="";for(;n<i;){const o=Math.ceil((n+i)/2),a=t.slice(0,o).trim()+"...";u(a,e)?(r=a,n=o):i=o-1}if(!r)for(let o=Math.min(t.length,20);o>0;o--){const n=t.slice(0,o).trim()+"...";if(u(n,e)){r=n;break}}return r||""};let d=t.data&&t.data.__row?t.data.__row:t.data&&t.data.__rows?t.data.__rows[0]:null;const p=!(!r||!(t.parent===r||t.data&&t.data.isAggregated));d||(d={},d[i.groupField]=t.data&&t.data.name?t.data.name:null,i.subgroupField&&!p&&(d[i.subgroupField]=t.data&&t.data.name?t.data.name:null),d.count=t.value,d.color=t.data&&t.data.color?t.data.color:null,d.name=t.data&&t.data.name?t.data.name:null),null==d.count&&(d.count=null!=d.value?d.value:t.value);let g=t.data.name;i.subgroupField&&t.parent&&t.parent.data&&t.parent.data.name&&(g=`${t.parent.data.name} ${t.data.name}`);const b=(t.value/a*100).toFixed(1)+"%",w=null!=t.data.value?t.data.value.toLocaleString():"";if(i.labelsFormatter)try{const r=i.labelsFormatter(t.value/a*100,d);if(null!=r){let a=[];if(a=Array.isArray(r)?r.map(String):"string"==typeof r?r.split(/<br\s*\/?\s*>/i).map(t=>t.replace(/<[^>]*>/g,"").trim()).filter(Boolean):[String(r)],a.length>0){const r=Math.max(1,a.length);for(let l=0;l<a.length;l++){const c=a[l];if(c)if(u(c,l))o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,l,r,n)).text(c).attr("font-size",`${i.options.fontSize}px`).attr("font-family",i.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ws(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none");else{const a=f(c,l);a&&o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,l,r,n)).text(a).attr("font-size",`${i.options.fontSize}px`).attr("font-family",i.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ws(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none")}}return}}}catch(k){console.error("Labels formatter error",k)}const _=r=>{if(!r)return!1;if(u(r,0))return o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,0,2,n)).text(r).attr("font-size",`${i.options.fontSize}px`).attr("font-family",i.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ws(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none"),!0;const a=f(r,0);return!!a&&(o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,0,2,n)).text(a).attr("font-size",`${i.options.fontSize}px`).attr("font-family",i.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ws(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none"),!0)};if(!_(g)){const t=g&&g.split(/[,;]+/)[0];if(!_(t&&t.trim()&&t.trim().length<g.length?`${t.trim()}...`:null)){const t=g?g.trim().split(/\s+/):[];if(t.length>1){_(`${t.slice(0,2).join(" ")}...`)}}}const F="count"===i.labelMode?w:b;F&&u(F,1)&&o.append("text").attr("x",y(t,v.align,e)).attr("y",m(t,v.valign,1,2,n)).text(F).attr("font-size",`${i.options.fontSize}px`).attr("font-family",i.options.fontFamily).attr("font-weight","bold").attr("text-anchor",x(v.align)).attr("fill",ws(t.data.color||"#999")).attr("stroke",s(t.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none")})};return b(c,1,1),this}},PieChart:class extends Ss{constructor(t,e){if(super(t,e),!e.size||!e.group)throw new Error("Pie chart requires size and group fields");this.sizeField=e.size,this.groupField=e.group,this.colorField=e.color,this.donut=e.donut||!1,this.innerRadiusRatio=void 0!==e.innerRadius?e.innerRadius:this.donut?.5:0,this.startAngle=void 0!==e.startAngle?e.startAngle:0,this.endAngle=void 0!==e.endAngle?e.endAngle:2*Math.PI,this.labelMode=e.labelMode||"percent"}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.sizeField,this.groupField]);const t=this.getInnerWidth(),e=this.getInnerHeight();if(t<=0||e<=0||isNaN(t)||isNaN(e))return console.error("Invalid chart dimensions:",{width:t,height:e}),this;const n=Math.min(t,e)/2,i=this.endAngle-this.startAngle,r=i<=Math.PI,o=this.options.margin.left+t/2;let a;a=r?this.startAngle<0&&this.endAngle>0?this.options.margin.top+n:this.startAngle>=0&&this.endAngle<=Math.PI?this.options.margin.top+e-n:this.options.margin.top+e/2:this.options.margin.top+e/2,this.chart.attr("transform",`translate(${o},${a})`);const s=function(){var t=Xa,e=Va,n=null,i=ma(0),r=ma($a),o=ma(0);function a(a){var s,l,c,h,u,f=(a=Ba(a)).length,d=0,p=new Array(f),g=new Array(f),y=+i.apply(this,arguments),m=Math.min($a,Math.max(-$a,r.apply(this,arguments)-y)),x=Math.min(Math.abs(m)/f,o.apply(this,arguments)),v=x*(m<0?-1:1);for(s=0;s<f;++s)(u=g[p[s]=s]=+t(a[s],s,a))>0&&(d+=u);for(null!=e?p.sort(function(t,n){return e(g[t],g[n])}):null!=n&&p.sort(function(t,e){return n(a[t],a[e])}),s=0,c=d?(m-f*v)/d:0;s<f;++s,y=h)l=p[s],h=y+((u=g[l])>0?u*c:0)+v,g[l]={data:a[l],index:s,value:u,startAngle:y,endAngle:h,padAngle:x};return g}return a.value=function(e){return arguments.length?(t="function"==typeof e?e:ma(+e),a):t},a.sortValues=function(t){return arguments.length?(e=t,n=null,a):e},a.sort=function(t){return arguments.length?(n=t,e=null,a):n},a.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:ma(+t),a):i},a.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:ma(+t),a):r},a.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:ma(+t),a):o},a}().value(t=>t[this.sizeField]).sort(null).startAngle(this.startAngle).endAngle(this.endAngle),l=qa().innerRadius(n*this.innerRadiusRatio).outerRadius(n),c=qa().innerRadius(.7*n).outerRadius(.7*n),h=this.groupField,u=this.sizeField,f=this.colorField,d=this;let p=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const t=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),e=t.length?t:null;if(e){p={};[...new Set(this.data.map(t=>t[h]))].forEach((t,n)=>{p[t]=ps(e[n%e.length])})}}const g=this.chart.selectAll(".slice").data(s(this.data)).enter().append("g").attr("class","slice"),y=g.append("path").attr("d",l).attr("fill",t=>p?p[t.data[h]]||Object.values(p)[0]:f&&"string"==typeof f?ps(t.data[f]):ya(Math.random())).each(function(t){t._originalColor=p?p[t.data[h]]:f&&"string"==typeof f?ps(t.data[f]):Ut(this).attr("fill")}).attr("stroke","white").attr("stroke-width",2).style("opacity",1),m=this.options.fontFamily,x=this.options.fontSize;var v=ys(this.tooltip,this.options&&this.options.tooltip);y.on("mouseover",function(t,e){const n=ks(e._originalColor);if(Ut(this).attr("fill",n),v)try{var r=0;try{var o=0;Array.isArray(e.data.__pie_source__)?o=e.data.__pie_source__.reduce((t,e)=>t+(e[u]||0),0):this&&this.data?o=this.data.reduce((t,e)=>t+(e[u]||0),0):r=(e.endAngle-e.startAngle)/i*100,o>0&&(r=e.data[u]/o*100)}catch(a){r=(e.endAngle-e.startAngle)/i*100}const n=()=>`<strong>${e.data[h]}</strong>Value: ${e.data[u]}<br/>Percentage: ${((e.endAngle-e.startAngle)/i*100).toFixed(1)}%`;return void ms(t,v,r,e.data,m,x,n)}catch(a){console.warn("PieChart: tooltip formatter failed",a)}ds(t,`<strong>${e.data[h]}</strong>Value: ${e.data[u]}<br/>Percentage: ${((e.endAngle-e.startAngle)/i*100).toFixed(1)}%`,m,x)}).on("mouseout",function(t,e){Ut(this).attr("fill",e._originalColor),gs()});return g.append("text").attr("transform",t=>{const[e,n]=c.centroid(t);return`translate(${e},${n})`}).attr("text-anchor","middle").attr("font-size","14px").attr("fill",t=>ws(f?t.data[f]:"#999")).style("font-weight","bold").each(function(t){const e=Ut(this),r=(t.endAngle-t.startAngle)/i*100;e.selectAll("*").remove(),"count"===d.labelMode?(e.append("tspan").attr("x",0).attr("dy","-6").text(t.data[h]||""),e.append("tspan").attr("x",0).attr("dy","14").text(null!=t.data[u]?t.data[u].toString():"")):r>5&&(e.append("tspan").attr("x",0).attr("dy","-6").text(t.data[h]||""),e.append("tspan").attr("x",0).attr("dy","14").text(`${r.toFixed(1)}%`));try{const i=e.node().getBBox().width||0,r=.7*n;i>.9*((t.endAngle-t.startAngle)*r)&&e.style("display","none")}catch(o){}}),this}},LineChart:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Line chart requires x and y fields");this.xField=e.x,this.yField=e.y,this.groupField=e.group,this.colorField=e.color,this.area=e.area||!1,this.stacked=e.stacked||!1}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.xField,this.yField]);let t=[this.data];if(this.groupField){const e=f(this.data,t=>t[this.groupField]);t=Array.from(e.values())}const e=this.options.height-this.options.margin.top-this.options.margin.bottom,n=ra().domain([0,x(this.data,t=>t[this.yField])]).nice().range([e,0]),i=E(n);this.options.axisFormatters&&this.options.axisFormatters.y&&i.tickFormat(this.options.axisFormatters.y);const r=this.svg.append("g").attr("class","d3po-probe-group");r.call(i);let o=0;try{const t=r.selectAll(".tick text").nodes();t&&t.length&&(o=x(t,t=>t.getBBox().width)||0)}catch(T){}r.remove();const s=void 0!==this.yLabelGap?this.yLabelGap:12;let l=0;try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"");l=t.node().getBBox().height||0,t.remove()}catch(T){l=14}const c=Math.ceil(o+s+l+8),h=this.options&&this.options.margin&&this.options.margin.left||60;let u=Math.max(h,c);if(u!==h){this.options.margin.left=u;try{this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`)}catch(T){}}const d=ra().domain(a(this.data,t=>t[this.xField])).nice().range([0,this.getInnerWidth()]);n.range([this.getInnerHeight(),0]);var p=z(d);this.options.axisFormatters&&this.options.axisFormatters.x&&p.tickFormat(this.options.axisFormatters.x);var g=E(n);this.options.axisFormatters&&this.options.axisFormatters.y&&g.tickFormat(this.options.axisFormatters.y);const y=this.chart.append("g").attr("transform",`translate(0,${this.getInnerHeight()})`).call(p);let m=0;try{const t=y.selectAll(".tick text").nodes();t&&t.length&&(m=x(t,t=>t.getBBox().height)||0)}catch(T){}const v=Math.max(8,m+8),b=this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"",w=this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"";y.append("text").attr("class","x-axis-label").attr("x",this.getInnerWidth()/2).attr("y",v+24).attr("text-anchor","middle").style("font-size","14px").text(b);const _=this.chart.append("g").call(g);let F=o+(void 0!==this.yLabelGap?this.yLabelGap:12);const k=this.options&&this.options.margin&&this.options.margin.left||60,M=Math.max(10,k-4);F>M&&(F=M),_.append("text").attr("class","y-axis-label").attr("transform",`translate(${-F},${this.getInnerHeight()/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(w),this.chart.append("g").attr("class","grid").call(E(n).ticks(6).tickSize(-this.getInnerWidth()).tickFormat("")).attr("opacity",.08);const A=Ha().x(t=>d(t[this.xField])).y(t=>n(t[this.yField])).curve(ja),S=Da().x(t=>d(t[this.xField])).y0(this.getInnerHeight()).y1(t=>n(t[this.yField])).curve(ja),$=Xo(pa).domain(t.map((t,e)=>e));let N=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const e=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),n=e.length?e:null;n&&(N={},t.forEach((t,e)=>{const i=this.groupField?t[0][this.groupField]:e;N[i]=ps(n[e%n.length])}))}return t.forEach((t,e)=>{const i=this.groupField?t[0][this.groupField]:e,r=N?N[i]:this.colorField?ps(t[0][this.colorField]):$(e);this.area&&this.chart.append("path").datum(t).attr("class","area").attr("d",S).attr("fill",r).style("opacity",1),this.chart.append("path").datum(t).attr("class","line").attr("d",A).attr("fill","none").attr("stroke",r).attr("stroke-width",2);var o=ys(this.tooltip,this.options&&this.options.tooltip);this.chart.selectAll(`.point-${e}`).data(t).enter().append("circle").attr("class",`point-${e}`).attr("cx",t=>d(t[this.xField])).attr("cy",t=>n(t[this.yField])).attr("r",4).attr("fill",r).attr("stroke","#fff").attr("stroke-width",1.2).on("mouseover",(t,e)=>{const n=Ut(t.currentTarget),a=ks(r);if(n.raise().attr("r",8).attr("fill",a),o){const n=()=>(this.groupField&&i?`<strong>${i}</strong>`:"")+`${this.xField}: ${e[this.xField]}<br/>${this.yField}: ${e[this.yField]}`;ms(t,o,null,e,this.options.fontFamily,this.options.fontSize,n)}else ds(t,(this.groupField&&i?`<strong>${i}</strong>`:"")+`${this.xField}: ${e[this.xField]}<br/>${this.yField}: ${e[this.yField]}`,this.options.fontFamily,this.options.fontSize)}).on("mouseout",t=>{Ut(t.currentTarget).attr("r",4).attr("fill",r),gs()})}),this}},AreaChart:class extends Ss{constructor(t,e){if(super(t,e),!e||!e.x||!e.y)throw new Error("Area chart requires x and y fields");this.xField=e.x,this.yField=e.y,this.groupField=e.group,this.colorField=e.color}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.xField,this.yField]);const t=!(!this.options||!0!==this.options.stack&&"stacked"!==this.options.type),e=Array.from(new Set(this.data.map(t=>t[this.xField]))).sort((t,e)=>t-e),n=ra().domain(a(e)).nice().range([0,this.getInnerWidth()]);let i=null,r=[],o=x(this.data,t=>+t[this.yField]||0)||0;if(t&&this.groupField){r=Array.from(new Set(this.data.map(t=>String(null==t[this.groupField]?"":t[this.groupField]))));const t=e.map(t=>{const e={[this.xField]:t};return r.forEach(t=>e[t]=0),e}),n=new Map(t.map(t=>[String(t[this.xField]),t]));this.data.forEach(t=>{const e=t[this.xField],i=String(null==t[this.groupField]?"":t[this.groupField]),r=Number(t[this.yField])||0,o=n.get(String(e));o&&(o[i]=(o[i]||0)+r)}),i=Ka().keys(r)(t),r=i.map(t=>String(t.key)),o=x(t,t=>r.reduce((e,n)=>e+(t[n]||0),0))||0}const s=ra().domain([0,o]).nice().range([this.getInnerHeight(),0]),l=z(n),c=E(s);this.options&&this.options.axisFormatters&&(this.options.axisFormatters.x&&l.tickFormat(this.options.axisFormatters.x),this.options.axisFormatters.y&&c.tickFormat(this.options.axisFormatters.y));const h=this.options&&(this.options.xLabel||this.options.axisLabels&&this.options.axisLabels.x)?this.options.xLabel||this.options.axisLabels.x:this.xField?String(this.xField):"",u=this.options&&(this.options.yLabel||this.options.axisLabels&&this.options.axisLabels.y)?this.options.yLabel||this.options.axisLabels.y:this.yField?String(this.yField):"";this.chart.append("g").attr("transform",`translate(0,${this.getInnerHeight()})`).call(l),this.chart.append("g").call(c),h&&this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",this.getInnerWidth()/2).attr("y",this.getInnerHeight()+(this.options&&this.options.axisLabelOffsetY?this.options.axisLabelOffsetY:30)).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.fontSize?`${this.options.fontSize}px`:null).text(String(h)),u&&this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform",`translate(-40,${this.getInnerHeight()/2}) rotate(-90)`).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.fontSize?`${this.options.fontSize}px`:null).text(String(u));const d=ys(this.tooltip,this.options&&this.options.tooltip),p=vs(this.data,this.colorField,ya),g=t=>null==t?t:String(t).replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase());if(t&&this.groupField&&i){const t=Da().x(t=>n(t.data[this.xField])).y0(t=>s(t[0])).y1(t=>s(t[1])).curve(ja);i.forEach((e,i)=>{const o=r[i],a=this.data.find(t=>String(t[this.groupField])===o),l=p(a||{group:o}),c=this.options&&null!=this.options.stackFillOpacity,h=this.options&&null!=this.options.stackTint?Number(this.options.stackTint):.3,u=c?l||p(o):Ms(l||p(o),h);this.chart.append("path").datum(e).attr("d",t).attr("fill",u).attr("fill-opacity",c?this.options.stackFillOpacity:1);const f=Ha().x(t=>n(t.data[this.xField])).y(t=>s(t[1])).curve(ja);this.chart.append("path").datum(e).attr("d",f).attr("fill","none").attr("stroke",l||p(o)).attr("stroke-width",1.5)});const e=this.chart.append("g").attr("class","points-layer");i.forEach((t,i)=>{const o=r[i],a=this.data.find(t=>String(t[this.groupField])===o),l=p(a||{group:o});e.selectAll(`.point-stack-${i}`).data(t).enter().append("circle").attr("cx",t=>n(t.data[this.xField])).attr("cy",t=>s(t[1])).attr("r",4).attr("fill",l||p(o)).attr("stroke","#fff").each(function(){this.__origR=+Ut(this).attr("r"),this.__origFill=Ut(this).attr("fill")}).on("mouseover",(t,e)=>{const n=Ut(t.currentTarget),i=n.attr("fill")||l||p(o);n.raise().attr("r",8).attr("fill",ks(i));const r=e.data||e;ms(t,d,null,r,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`<strong>${bs(String(g(o)))}</strong>${bs(String(g(this.xField)))}: ${bs(String(e.data[this.xField]))}<br/>Value: ${bs(String((e[1]-e[0]).toFixed?(e[1]-e[0]).toFixed(6):e[1]-e[0]))}`)}).on("mouseout",function(){const t=Ut(this);null!=this.__origR&&t.attr("r",this.__origR),null!=this.__origFill&&t.attr("fill",this.__origFill),gs()})})}else{let t=[this.data];if(this.groupField){const e=f(this.data,t=>t[this.groupField]);t=Array.from(e.values()),t=t.map(t=>({series:t,total:w(t,t=>Number(t[this.yField])||0)})),t.sort((t,e)=>e.total-t.total),t=t.map(t=>t.series)}const e=Da().x(t=>n(t[this.xField])).y0(this.getInnerHeight()).y1(t=>s(t[this.yField])).curve(ja),i=Ha().x(t=>n(t[this.xField])).y(t=>s(t[this.yField])).curve(ja);t.forEach((t,n)=>{const r=t[0]?p(t[0]):p({group:n}),o=this.options&&null!=this.options.areaFillOpacity,a=this.options&&null!=this.options.areaTint?Number(this.options.areaTint):.12,s=o?r:Ms(r,a);this.chart.append("path").datum(t).attr("d",e).attr("fill",s).attr("fill-opacity",o?this.options.areaFillOpacity:1).attr("stroke",r).attr("stroke-width",1).style("pointer-events","none"),this.chart.append("path").datum(t).attr("d",i).attr("fill","none").attr("stroke",r).attr("stroke-width",1.5).style("pointer-events","none")});const r=this.chart.append("g").attr("class","points-layer");t.forEach((t,e)=>{const i=t[0]?p(t[0]):p({group:e});r.selectAll(`.point-${e}`).data(t).enter().append("circle").attr("cx",t=>n(t[this.xField])).attr("cy",t=>s(t[this.yField])).attr("r",4).attr("fill",i).attr("stroke","#fff").style("cursor","pointer").style("pointer-events","all").each(function(){this.__origR=+Ut(this).attr("r"),this.__origFill=Ut(this).attr("fill")}).on("mouseover",(e,n)=>{const r=Ut(e.currentTarget),o=r.attr("fill")||i;r.raise().attr("r",8).attr("fill",ks(o));ms(e,d,null,n||null,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`${this.groupField&&t[0]&&null!=t[0][this.groupField]?`<strong>${bs(String(g(n[this.groupField]||t[0][this.groupField])))}</strong>`:""}${bs(String(g(this.xField)))}: ${bs(String(n[this.xField]))}<br/>${bs(String(g(this.yField)))}: ${bs(String(n[this.yField]))}`)}).on("click",(e,n)=>{ms(e,d,null,n||null,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`${this.groupField&&t[0]&&null!=t[0][this.groupField]?`<strong>${bs(String(g(n[this.groupField]||t[0][this.groupField])))}</strong><br/>`:""}${bs(String(g(this.xField)))}: ${bs(String(n[this.xField]))}<br/>${bs(String(g(this.yField)))}: ${bs(String(n[this.yField]))}`)}).on("mouseout",function(){const t=Ut(this);null!=this.__origR&&t.attr("r",this.__origR),null!=this.__origFill&&t.attr("fill",this.__origFill),gs()})})}return this}},ScatterPlot:class extends Ss{constructor(t,e){if(super(t,e),!e.x||!e.y)throw new Error("Scatter plot requires x and y fields");this.xField=e.x,this.yField=e.y,this.sizeField=e.size,this.groupField=e.group,this.colorField=e.color}render(){if(!this.data)throw new Error("No data provided");xs(this.data,[this.xField,this.yField]);const t=this.options.height-this.options.margin.top-this.options.margin.bottom,e=ra().domain(a(this.data,t=>t[this.yField])).nice().range([t,0]),n=E(e);this.options.axisFormatters&&this.options.axisFormatters.y&&n.tickFormat(this.options.axisFormatters.y);const i=this.svg.append("g").attr("class","d3po-probe-group");i.call(n);let r=0;try{const t=i.selectAll(".tick text").nodes();t&&t.length&&(r=x(t,t=>t.getBBox().width)||0)}catch(L){}i.remove();let o=0;try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);o=t.node().getBBox().height||0,t.remove()}catch(L){o=14}const s=void 0!==this.yLabelGap?this.yLabelGap:12,l=Math.ceil(r+s+o+8),c=this.options&&this.options.margin&&this.options.margin.left||60;let h=Math.max(c,l);if(h!==c){this.options.margin.left=h;try{this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`)}catch(L){}}const u=ra().domain(a(this.data,t=>t[this.xField])).nice().range([0,this.getInnerWidth()]);e.range([this.getInnerHeight(),0]);const f=this.sizeField?ha().domain(a(this.data,t=>t[this.sizeField])).range([3,20]):()=>5;var d=z(u);this.options.axisFormatters&&this.options.axisFormatters.x&&d.tickFormat(this.options.axisFormatters.x);var p=E(e);this.options.axisFormatters&&this.options.axisFormatters.y&&p.tickFormat(this.options.axisFormatters.y);const g=this.chart.append("g").attr("transform",`translate(0,${this.getInnerHeight()})`).call(d);let y=0;try{const t=g.selectAll(".tick text").nodes();t&&t.length&&(y=x(t,t=>t.getBBox().height)||0)}catch(L){}const m=Math.max(8,y+8),v=this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"",b=this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"";this.chart.append("text").attr("class","x-axis-label").attr("x",this.getInnerWidth()/2).attr("y",this.getInnerHeight()+m+24).attr("text-anchor","middle").style("font-size","14px").text(v);const w=this.chart.append("g").call(p);try{const t=w.selectAll(".tick text").nodes(),e=t&&t.length?x(t,t=>t.getBBox().width):0;let n=14;try{const t=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);n=t.node().getBBox().height||14,t.remove()}catch(L){n=14}const i=void 0!==this.yLabelGap?this.yLabelGap:12,r=Math.max(e+i,n+i);let o=r+Math.min(36,Math.max(4,Math.round(.08*e)))+10;const a=e>0?Math.ceil(e+i+n+8):null;let s=(this.options&&this.options.margin&&this.options.margin.left||60)-4;s=null!=a?Math.max(10,Math.min(s,a)):Math.max(10,s),o>s&&(o=s),w.append("text").attr("class","y-axis-label").attr("transform",`translate(${-o},${this.getInnerHeight()/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(b)}catch(L){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-this.getInnerHeight()/2).attr("y",-40).attr("fill","black").style("font-size","14px").text(this.yField)}const _=this.xField,F=this.yField,k=this.sizeField,M=this.groupField,A=vs(this.data,this.colorField,ya),S=this.chart.selectAll(".point").data(this.data).enter().append("circle").attr("class","point").attr("cx",t=>u(t[_])).attr("cy",t=>e(t[F])).attr("r",t=>k?f(t[k]):5).each(function(t){t._originalRadius=k?f(t[k]):5,t._originalColor=A(t)}).attr("fill",t=>A(t)).attr("stroke","white").attr("stroke-width",1).style("opacity",1),$=this.options.fontFamily,N=this.options.fontSize;var T=ys(this.tooltip,this.options&&this.options.tooltip);const C=t=>"number"==typeof t&&Number.isFinite(t)?t.toFixed(2):t;return S.on("mouseover",function(t,e){const n=ks(e._originalColor);if(Ut(this).raise().attr("r",2*e._originalRadius).attr("fill",n),T){ms(t,T,null,e,$,N,()=>(M&&e&&e[M]?`<strong>${bs(String(e[M]))}</strong>`:"")+`${bs(String(_))}: ${bs(String(C(e[_])))}<br/>${bs(String(F))}: ${bs(String(C(e[F])))}`+(k?`<br/>size: ${bs(String(C(e[k])))}`:""))}else{ds(t,(M&&e&&e[M]?`<strong>${bs(String(e[M]))}</strong>`:"")+`${bs(String(_))}: ${bs(String(C(e[_])))}<br/>${bs(String(F))}: ${bs(String(C(e[F])))}`+(k?`<br/>size: ${bs(String(C(e[k])))}`:""),$,N)}}).on("mouseout",function(t,e){Ut(this).attr("r",e._originalRadius).attr("fill",e._originalColor),gs()}),this}},GeoMap:class extends Ss{constructor(t,e){super(t,e),this.geom=e&&e.geomap_data?e.geomap_data:null,this.groupField=e.group,this.sizeField=e.size,this.tooltipField=e.tooltip,this.colorField=e.color}render(){const t=this.getInnerWidth(),e=this.getInnerHeight(),n=this.options.geomap_data||this.geom||this.data&&this.data.geomap_data||null;if(!n)return this;this.chart.selectAll("*").remove();let i=n.features;if(!i&&n.objects){const t=Object.keys(n.objects);t.length>0&&(i=(r=n,o=n.objects[t[0]],"string"==typeof o&&(o=r.objects[o]),"GeometryCollection"===o.type?{type:"FeatureCollection",features:o.geometries.map(function(t){return Ns(r,t)})}:Ns(r,o)).features)}var r,o;if(!i)return this;const s={type:"FeatureCollection",features:i},l=Fo().projection(null).bounds(s),c=l[1][0]-l[0][0],h=l[1][1]-l[0][1],u=(l[0][0]+l[1][0])/2,f=(l[0][1]+l[1][1])/2,d=1/Math.max(c/t*.85,h/e),p=[t/2-d*u,e/2+d*f],g=So().reflectY(!0).scale(d).translate(p),y=Fo().projection(g),m=new Map;let b;this.data&&this.groupField&&this.data.forEach(t=>{const e=t[this.groupField];null!=e&&m.set(String(e),t)});let w=!1;const _=this.options.discrete_palette&&Array.isArray(this.options.discrete_palette)&&this.options.discrete_palette.length>0;if(_&&this.options.gradient&&this.sizeField&&this.data){const t=this.options.discrete_palette,e=this.data.map(t=>t[this.sizeField]).filter(t=>null!=t&&!isNaN(t));if(e.length>0){const n=a(e),i=Ue(t);b=fa(i).domain(n)}}else if(_&&this.sizeField&&this.data){const t=this.options.discrete_palette,e=this.data.map(t=>t[this.sizeField]).filter(t=>null!=t&&!isNaN(t));e.length>0&&(b=ua().domain(e).range(t),w=!0)}else if(this.options.gradient&&this.sizeField&&this.data){const t=a(this.data.map(t=>t[this.sizeField]).filter(t=>null!=t));b=fa(ya).domain(t)}else if(this.colorField&&this.data){const t=[...new Set(this.data.map(t=>t[this.colorField]))],e=t.length>0&&t.every(t=>"string"==typeof t&&/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?([0-9A-Fa-f]{2})?$/.test(t));b=e?null:Xo(pa).domain(t)}else if(this.groupField&&this.data){const t=[...new Set(this.data.map(t=>t[this.groupField]))];b=Xo(pa).domain(t)}const F=this.chart.append("g").attr("class","map"),k=hs().scaleExtent([1,8]).on("zoom",t=>{F.attr("transform",t.transform)});this.svg.call(k);const M=F.selectAll("path").data(i).enter().append("path").attr("d",y).attr("fill",t=>{var e,n,i,r;const o=(null==(e=t.properties)?void 0:e[this.groupField])||(null==(n=t.properties)?void 0:n.region_iso)||(null==(i=t.properties)?void 0:i.name)||(null==(r=t.properties)?void 0:r.NAME),a=m.get(String(o));if(b){if(w&&this.sizeField&&a)return b(a[this.sizeField]);if(this.options.gradient&&this.sizeField&&a)return b(a[this.sizeField]);if(this.colorField&&a)return b(a[this.colorField]);if(o)return b(o)}else if(this.colorField&&a&&a[this.colorField])return a[this.colorField];return this.options.fill||"#cce5df"}).attr("stroke",this.options.stroke||"#333").attr("stroke-width",1).style("cursor","pointer");if((this.options.gradient||w)&&b&&this.sizeField){const n=20,i=200,r=t-n-10,o=(e-i)/2,a=this.chart.append("g").attr("class","legend").attr("transform",`translate(${r}, ${o})`);if(w){const t=this.options.discrete_palette,e=i/t.length,r=b.quantiles(),o=this.data.map(t=>t[this.sizeField]).filter(t=>null!=t&&!isNaN(t)),s=v(o),l=x(o);t.forEach((t,r)=>{a.append("rect").attr("x",0).attr("y",i-(r+1)*e).attr("width",n).attr("height",e).style("fill",t).style("stroke","#333").style("stroke-width",.5)});[s,...r,l].forEach((t,r)=>{const o=i-r*e;a.append("text").attr("x",n+5).attr("y",o).attr("dy","0.3em").style("font-size",this.options.fontSize||"10px").style("font-family",this.options.fontFamily||"sans-serif").text(Yi(".1f")(t))})}else{const t=this.svg.append("defs").append("linearGradient").attr("id",`gradient-${this.container.id}`).attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%"),e=10;for(let n=0;n<=e;n++){const i=n/e;t.append("stop").attr("offset",100*i+"%").attr("stop-color",b(b.domain()[0]+i*(b.domain()[1]-b.domain()[0])))}a.append("rect").attr("width",n).attr("height",i).style("fill",`url(#gradient-${this.container.id})`).style("stroke","#333").style("stroke-width",1);const r=function(t){return N(2,t)}(ra().domain(b.domain()).range([i,0])).ticks(5).tickFormat(Yi(".0f"));a.append("g").attr("transform",`translate(${n}, 0)`).call(r).style("font-size",this.options.fontSize||"12px").style("font-family",this.options.fontFamily||"sans-serif")}}const A=this.options.fontFamily,S=this.options.fontSize,$=this;return M.on("mouseover",function(t,e){const n=Ut(this),i=n.attr("fill");n.attr("data-original-fill",i);const r=ks(i);n.attr("fill",r);const o=e.properties&&(e.properties[$.groupField]||e.properties.region_iso||e.properties.name||e.properties.NAME||e.properties.id)||"Region",a=m.get(String(o)),s=a&&$.tooltipField&&a[$.tooltipField]?a[$.tooltipField]:o;let l=`<strong>${bs(String(s))}</strong>`;a&&$.sizeField&&null!=a[$.sizeField]&&(l+=`Value: ${bs(String(a[$.sizeField]))}`),ds(t,l,A,S)}).on("mouseout",function(){const t=Ut(this),e=t.attr("data-original-fill");e&&t.attr("fill",e),gs()}),this}},Network:class extends Ss{constructor(t,e){if(super(t,e),!e.nodes||!e.links)throw new Error("Network requires nodes and links");this.nodes=e.nodes,this.links=e.links,this.sizeField=e.size,this.colorField=e.color,this.layout=e.layout||"force",this.movable=void 0!==e.move&&e.move}render(){const t=this.getInnerWidth(),e=this.getInnerHeight(),n=`clip-${Math.random().toString(36).substr(2,9)}`;this.svg.append("defs").append("clipPath").attr("id",n).append("rect").attr("x",0).attr("y",0).attr("width",t).attr("height",e),this.chart.attr("clip-path",`url(#${n})`);const i=this.sizeField?ha().domain(a(this.nodes,t=>t[this.sizeField])).range([5,20]):()=>8,r="manual"===this.options.layout;if(r){const n=a(this.nodes,t=>t.x),i=a(this.nodes,t=>t.y),r=n[1]-n[0],o=i[1]-i[0];if(r<.5*t||o<.5*e){const a=Math.max(.15*r,.5),s=Math.max(.15*o,.5),l=ra().domain([n[0]-a,n[1]+a]).range([80,t-80]),c=ra().domain([i[0]-s,i[1]+s]).range([80,e-80]);this.nodes.forEach(n=>{void 0===n.x||void 0===n.y?(n.x=t/2,n.y=e/2):(n.x=l(n.x),n.y=c(n.y)),n.fx=n.x,n.fy=n.y})}else this.nodes.forEach(n=>{void 0!==n.x&&void 0!==n.y||(n.x=t/2,n.y=e/2),n.fx=n.x,n.fy=n.y})}const o=Ii(this.nodes);r?(o.force("link",Ei(this.links).id(t=>t.id).distance(0).strength(0)),o.tick(),o.stop()):o.force("link",Ei(this.links).id(t=>t.id).distance(100)).force("charge",function(){var t,e,n,i,r,o=Mi(-30),a=1,s=1/0,l=.81;function c(n){var r,o=t.length,a=wi(t,Ci,Li).visitAfter(u);for(i=n,r=0;r<o;++r)e=t[r],a.visit(f)}function h(){if(t){var e,n,i=t.length;for(r=new Array(i),e=0;e<i;++e)n=t[e],r[n.index]=+o(n,e,t)}}function u(t){var e,n,i,o,a,s=0,l=0;if(t.length){for(i=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,l+=n,i+=n*e.x,o+=n*e.y);t.x=i/l,t.y=o/l}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=r[e.data.index]}while(e=e.next)}t.value=s}function f(t,o,c,h){if(!t.value)return!0;var u=t.x-e.x,f=t.y-e.y,d=h-o,p=u*u+f*f;if(d*d/l<p)return p<s&&(0===u&&(p+=(u=Ai(n))*u),0===f&&(p+=(f=Ai(n))*f),p<a&&(p=Math.sqrt(a*p)),e.vx+=u*t.value*i/p,e.vy+=f*t.value*i/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===u&&(p+=(u=Ai(n))*u),0===f&&(p+=(f=Ai(n))*f),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(d=r[t.data.index]*i/p,e.vx+=u*d,e.vy+=f*d)}while(t=t.next)}}return c.initialize=function(e,i){t=e,n=i,h()},c.strength=function(t){return arguments.length?(o="function"==typeof t?t:Mi(+t),h(),c):o},c.distanceMin=function(t){return arguments.length?(a=t*t,c):Math.sqrt(a)},c.distanceMax=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c.theta=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c}().strength(-300)).force("center",function(t,e){var n,i=1;function r(){var r,o,a=n.length,s=0,l=0;for(r=0;r<a;++r)s+=(o=n[r]).x,l+=o.y;for(s=(s/a-t)*i,l=(l/a-e)*i,r=0;r<a;++r)(o=n[r]).x-=s,o.y-=l}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(i=+t,r):i},r}(t/2,e/2)).force("collision",function(t){var e,n,i,r=1,o=1;function a(){for(var t,a,l,c,h,u,f,d=e.length,p=0;p<o;++p)for(a=wi(e,Si,$i).visitAfter(s),t=0;t<d;++t)l=e[t],u=n[l.index],f=u*u,c=l.x+l.vx,h=l.y+l.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,d=t.r,p=u+d;if(!s)return e>c+p||o<c-p||n>h+p||a<h-p;if(s.index>l.index){var g=c-s.x-s.vx,y=h-s.y-s.vy,m=g*g+y*y;m<p*p&&(0===g&&(m+=(g=Ai(i))*g),0===y&&(m+=(y=Ai(i))*y),m=(p-(m=Math.sqrt(m)))/m*r,l.vx+=(g*=m)*(p=(d*=d)/(f+d)),l.vy+=(y*=m)*p,s.vx-=g*(p=1-p),s.vy-=y*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var i,r,o=e.length;for(n=new Array(o),i=0;i<o;++i)r=e[i],n[r.index]=+t(r,i,e)}}return"function"!=typeof t&&(t=Mi(null==t?1:+t)),a.initialize=function(t,n){e=t,i=n,l()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(r=+t,a):r},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:Mi(+e),l(),a):t},a}().radius(t=>i(t[this.sizeField]||8)+5));const s=this.chart.selectAll(".link").data(this.links).enter().append("line").attr("class","link").attr("stroke","#999").attr("stroke-opacity",1).attr("stroke-width",2),l=this.sizeField,c=this.colorField;let h=null;if(Array.isArray(c)||c&&"object"==typeof c){const t=Array.isArray(c)?c:Object.values(c||{}),e=t.length?t:null;e&&(h={},this.nodes.forEach((t,n)=>{h[t.id]=ps(e[n%e.length])}))}const u=this.chart.selectAll(".node").data(this.nodes).enter().append("circle").attr("class","node").attr("r",t=>i(t[this.sizeField]||8)).attr("fill",t=>h?h[t.id]||"#69b3a2":"string"==typeof c?t[c]||"#69b3a2":ya(Math.random())).each(function(t){t._originalColor=h?h[t.id]:"string"==typeof c?t[c]:ya(Math.random())}).attr("stroke","white").attr("stroke-width",2).style("cursor",this.movable?"move":"pointer");this.movable&&u.call(function(){var t,e,n,i,r=ae,o=se,a=le,s=ce,l={},c=C("start","drag","end"),h=0,u=0;function f(t){t.on("mousedown.drag",d).filter(s).on("touchstart.drag",y).on("touchmove.drag",m,Zt).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(a,s){if(!i&&r.call(this,a,s)){var l=v(this,o.call(this,a,s),a,s,"mouse");l&&(Ut(a.view).on("mousemove.drag",p,Qt).on("mouseup.drag",g,Qt),ne(a.view),te(a),n=!1,t=a.clientX,e=a.clientY,l("start",a))}}function p(i){if(ee(i),!n){var r=i.clientX-t,o=i.clientY-e;n=r*r+o*o>u}l.mouse("drag",i)}function g(t){Ut(t.view).on("mousemove.drag mouseup.drag",null),ie(t.view,n),ee(t),l.mouse("end",t)}function y(t,e){if(r.call(this,t,e)){var n,i,a=t.changedTouches,s=o.call(this,t,e),l=a.length;for(n=0;n<l;++n)(i=v(this,s,t,e,a[n].identifier,a[n]))&&(te(t),i("start",t,a[n]))}}function m(t){var e,n,i=t.changedTouches,r=i.length;for(e=0;e<r;++e)(n=l[i[e].identifier])&&(ee(t),n("drag",t,i[e]))}function x(t){var e,n,r=t.changedTouches,o=r.length;for(i&&clearTimeout(i),i=setTimeout(function(){i=null},500),e=0;e<o;++e)(n=l[r[e].identifier])&&(te(t),n("end",t,r[e]))}function v(t,e,n,i,r,o){var s,u,d,p=c.copy(),g=Jt(o||n,e);if(null!=(d=a.call(t,new oe("beforestart",{sourceEvent:n,target:f,identifier:r,active:h,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),i)))return s=d.x-g[0]||0,u=d.y-g[1]||0,function n(o,a,c){var y,m=g;switch(o){case"start":l[r]=n,y=h++;break;case"end":delete l[r],--h;case"drag":g=Jt(c||a,e),y=h}p.call(o,t,new oe(o,{sourceEvent:a,subject:d,target:f,identifier:r,active:y,x:g[0]+s,y:g[1]+u,dx:g[0]-m[0],dy:g[1]-m[1],dispatch:p}),i)}}return f.filter=function(t){return arguments.length?(r="function"==typeof t?t:re(!!t),f):r},f.container=function(t){return arguments.length?(o="function"==typeof t?t:re(t),f):o},f.subject=function(t){return arguments.length?(a="function"==typeof t?t:re(t),f):a},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:re(!!t),f):s},f.on=function(){var t=c.on.apply(c,arguments);return t===c?f:t},f.clickDistance=function(t){return arguments.length?(u=(t=+t)*t,f):Math.sqrt(u)},f}().on("start",(t,e)=>{t.active||o.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}).on("drag",(t,e)=>{e.fx=t.x,e.fy=t.y}).on("end",t=>{t.active||o.alphaTarget(0)}));const f=this.options.fontFamily,d=this.options.fontSize;let p=ys(this.tooltip,this.options&&this.options.tooltip);u.on("mouseover",function(t,e){const n=ks(e._originalColor);if(Ut(this).attr("fill",n),p)try{const n=p(null,e);if(null!=n)return void ds(t,n,f,d)}catch(c){}const i=bs(e.id||"Node"),r=[];l&&r.push(l),r.push("value","size","count");let o=null,a=null;for(const l of r)if(null!=e[l]){o=l,a=e[l];break}let s=`<strong>${i}</strong>`;null!=o&&(s+=`${bs(String(o))}: ${bs(String(a))}`),ds(t,s,f,d)}).on("mouseout",function(t,e){Ut(this).attr("fill",e._originalColor),gs()});const g=this.chart.selectAll(".label").data(this.nodes).enter().append("text").attr("class","label").attr("text-anchor","middle").attr("dy",4).attr("font-size","10px").attr("pointer-events","none").text(t=>t.id||"");o.on("tick",()=>{s.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),u.attr("cx",t=>t.x).attr("cy",t=>t.y),g.attr("x",t=>t.x).attr("y",t=>t.y)}),r&&(s.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),u.attr("cx",t=>t.x).attr("cy",t=>t.y),g.attr("x",t=>t.x).attr("y",t=>t.y));const y=hs().scaleExtent([.5,5]).on("zoom",t=>{s.attr("transform",t.transform),u.attr("transform",t.transform),g.attr("transform",t.transform)});return this.svg.call(y),this}}};return zs});
