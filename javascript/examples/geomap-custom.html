<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3po GeoMap Test - Pokemon in Chile (custom tooltip)</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Pokemon Distribution in Chile (custom tooltip)</h1>
    <p>How many Pokemon live in each region? Mewtwo lives in Magallanes</p>
    <p>You can zoom in/out with the mouse wheel or touchpad (two-finger scroll)</p>
    
    <div style="max-width: 1200px; height: 750px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start;">
      <div>
        <h3 style="text-align:center;">Vanilla GeoMap</h3>
        <div id="chart-vanilla" style="height: 700px;"></div>
      </div>
      <div>
        <h3 style="text-align:center;">Custom GeoMap</h3>
        <div id="chart" style="height: 700px;"></div>
      </div>
    </div>
  </div>

  <!-- Load D3.js 7.9 from CDN -->
  <script src="./d3.v7.min.js"></script>
  
  <!-- Load TopoJSON client -->
  <script src="https://unpkg.com/topojson-client@3"></script>
  
  <!-- Load D3po library from build -->
  <script src="../dist/d3po.min.js"></script>

  <script>
    (async function() {
      try {
        // Data: Pokemon count by Chilean region
        const data = [
          { id: 'CL.AI', name: 'Aisén', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.AN', name: 'Antofagasta', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.AP', name: 'Arica y Parinacota', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.AR', name: 'Araucanía', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.AT', name: 'Atacama', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.BI', name: 'Biobío', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.CO', name: 'Coquimbo', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.LI', name: 'Libertador General Bernardo O\'Higgins', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.LL', name: 'Los Lagos', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.LR', name: 'Los Ríos', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.MA', name: 'Magallanes', pokemon_count: 1, color: '#F85888' },
          { id: 'CL.ML', name: 'Maule', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.NB', name: 'Ñuble', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.RM', name: 'Región Metropolitana', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.TA', name: 'Tarapacá', pokemon_count: 0, color: '#e0e0e0' },
          { id: 'CL.VS', name: 'Valparaíso', pokemon_count: 0, color: '#e0e0e0' }
        ];

        // Load the TopoJSON file
        const topology = await d3.json('./cl-all.topojson');

        // Create GeoMap (custom tooltip)
        const geoMap = new d3po.GeoMap('#chart', {
          group: 'id',
          map: topology,
          color: 'color',
          size: 'pokemon_count',
          // enable built-in tooltip using JS formatter expression
          tooltip: "JS('Pokemon count in Region of ' + '<b>' + (row && row.name ? row.name : (row && row.id) || 'Unknown') + '</b>' + ': ' + ((row && row.pokemon_count != null) ? row.pokemon_count : 0))",
          width: 500,
          height: 700
        });

        // Render the map with built-in tooltip formatter
        geoMap.setData(data).render();

        // Also create the vanilla GeoMap example side-by-side for comparison
        const geoMapVanilla = new d3po.GeoMap('#chart-vanilla', {
          group: 'id',
          map: topology,
          color: 'color',
          size: 'pokemon_count',
          tooltip: 'name',
          width: 500,
          height: 700
        });

        geoMapVanilla.setData(data).render();

        console.log('✅ Both GeoMaps rendered successfully!');
      } catch (error) {
        console.error('❌ Error rendering GeoMap:', error);
        document.getElementById('chart').innerHTML = `
          <div style="color: red; padding: 20px; border: 2px solid red; border-radius: 4px;">
            <h3>Error!</h3>
            <p>${error.message}</p>
            <pre>${error.stack}</pre>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>
