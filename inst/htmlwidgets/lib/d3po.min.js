!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).d3po=factory()}(this,function(){"use strict";function ascending$1(a2,b){return null==a2||null==b?NaN:a2<b?-1:a2>b?1:a2>=b?0:NaN}function descending$1(a2,b){return null==a2||null==b?NaN:b<a2?-1:b>a2?1:b>=a2?0:NaN}function bisector(f){let compare1,compare2,delta;function left2(a2,x2,lo=0,hi=a2.length){if(lo<hi){if(0!==compare1(x2,x2))return hi;do{const mid=lo+hi>>>1;compare2(a2[mid],x2)<0?lo=mid+1:hi=mid}while(lo<hi)}return lo}return 2!==f.length?(compare1=ascending$1,compare2=(d,x2)=>ascending$1(f(d),x2),delta=(d,x2)=>f(d)-x2):(compare1=f===ascending$1||f===descending$1?f:zero$1,compare2=f,delta=f),{left:left2,center:function center2(a2,x2,lo=0,hi=a2.length){const i=left2(a2,x2,lo,hi-1);return i>lo&&delta(a2[i-1],x2)>-delta(a2[i],x2)?i-1:i},right:function right2(a2,x2,lo=0,hi=a2.length){if(lo<hi){if(0!==compare1(x2,x2))return hi;do{const mid=lo+hi>>>1;compare2(a2[mid],x2)<=0?lo=mid+1:hi=mid}while(lo<hi)}return lo}}}function zero$1(){return 0}const bisectRight=bisector(ascending$1).right;function extent(values,valueof){let min2,max2;if(void 0===valueof)for(const value of values)null!=value&&(void 0===min2?value>=value&&(min2=max2=value):(min2>value&&(min2=value),max2<value&&(max2=value)));else{let index2=-1;for(let value of values)null!=(value=valueof(value,++index2,values))&&(void 0===min2?value>=value&&(min2=max2=value):(min2>value&&(min2=value),max2<value&&(max2=value)))}return[min2,max2]}bisector(function number$2(x2){return null===x2?NaN:+x2}).center;class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(x2){const p=this._partials;let i=0;for(let j=0;j<this._n&&j<32;j++){const y2=p[j],hi=x2+y2,lo=Math.abs(x2)<Math.abs(y2)?x2-(hi-y2):y2-(hi-x2);lo&&(p[i++]=lo),x2=hi}return p[i]=x2,this._n=i+1,this}valueOf(){const p=this._partials;let x2,y2,lo,n=this._n,hi=0;if(n>0){for(hi=p[--n];n>0&&(x2=hi,y2=p[--n],hi=x2+y2,lo=y2-(hi-x2),!lo););n>0&&(lo<0&&p[n-1]<0||lo>0&&p[n-1]>0)&&(y2=2*lo,x2=hi+y2,y2==x2-hi&&(hi=x2))}return hi}}class InternMap extends Map{constructor(entries,key=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:key}}),null!=entries)for(const[key2,value]of entries)this.set(key2,value)}get(key){return super.get(intern_get(this,key))}has(key){return super.has(intern_get(this,key))}set(key,value){return super.set(function intern_set({_intern:_intern,_key:_key},value){const key=_key(value);return _intern.has(key)?_intern.get(key):(_intern.set(key,value),value)}(this,key),value)}delete(key){return super.delete(function intern_delete({_intern:_intern,_key:_key},value){const key=_key(value);_intern.has(key)&&(value=_intern.get(key),_intern.delete(key));return value}(this,key))}}function intern_get({_intern:_intern,_key:_key},value){const key=_key(value);return _intern.has(key)?_intern.get(key):value}function keyof(value){return null!==value&&"object"==typeof value?value.valueOf():value}function identity$9(x2){return x2}function group(values,...keys){return function nest(values,map2,reduce,keys){return function regroup(values2,i){if(i>=keys.length)return reduce(values2);const groups=new InternMap,keyof2=keys[i++];let index2=-1;for(const value of values2){const key=keyof2(value,++index2,values2),group2=groups.get(key);group2?group2.push(value):groups.set(key,[value])}for(const[key,values3]of groups)groups.set(key,regroup(values3,i));return map2(groups)}(values,0)}(values,identity$9,identity$9,keys)}const e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickSpec(start2,stop,count2){const step=(stop-start2)/Math.max(0,count2),power=Math.floor(Math.log10(step)),error=step/Math.pow(10,power),factor=error>=e10?10:error>=e5?5:error>=e2?2:1;let i1,i2,inc;return power<0?(inc=Math.pow(10,-power)/factor,i1=Math.round(start2*inc),i2=Math.round(stop*inc),i1/inc<start2&&++i1,i2/inc>stop&&--i2,inc=-inc):(inc=Math.pow(10,power)*factor,i1=Math.round(start2/inc),i2=Math.round(stop/inc),i1*inc<start2&&++i1,i2*inc>stop&&--i2),i2<i1&&.5<=count2&&count2<2?tickSpec(start2,stop,2*count2):[i1,i2,inc]}function tickIncrement(start2,stop,count2){return tickSpec(start2=+start2,stop=+stop,count2=+count2)[2]}function max$1(values,valueof){let max2;if(void 0===valueof)for(const value of values)null!=value&&(max2<value||void 0===max2&&value>=value)&&(max2=value);else{let index2=-1;for(let value of values)null!=(value=valueof(value,++index2,values))&&(max2<value||void 0===max2&&value>=value)&&(max2=value)}return max2}function min$1(values,valueof){let min2;if(void 0===valueof)for(const value of values)null!=value&&(min2>value||void 0===min2&&value>=value)&&(min2=value);else{let index2=-1;for(let value of values)null!=(value=valueof(value,++index2,values))&&(min2>value||void 0===min2&&value>=value)&&(min2=value)}return min2}function sum(values,valueof){let sum2=0;if(void 0===valueof)for(let value of values)(value=+value)&&(sum2+=value);else{let index2=-1;for(let value of values)(value=+valueof(value,++index2,values))&&(sum2+=value)}return sum2}function identity$8(x2){return x2}function translateX(x2){return"translate("+x2+",0)"}function translateY(y2){return"translate(0,"+y2+")"}function number$1(scale){return d=>+scale(d)}function center$1(scale,offset){return offset=Math.max(0,scale.bandwidth()-2*offset)/2,scale.round()&&(offset=Math.round(offset)),d=>+scale(d)+offset}function entering(){return!this.__axis}function axis(orient,scale){var tickArguments=[],tickValues=null,tickFormat2=null,tickSizeInner=6,tickSizeOuter=6,tickPadding=3,offset="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,k=1===orient||4===orient?-1:1,x2=4===orient||2===orient?"x":"y",transform2=1===orient||3===orient?translateX:translateY;function axis2(context){var values=null==tickValues?scale.ticks?scale.ticks.apply(scale,tickArguments):scale.domain():tickValues,format2=null==tickFormat2?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments):identity$8:tickFormat2,spacing=Math.max(tickSizeInner,0)+tickPadding,range2=scale.range(),range0=+range2[0]+offset,range1=+range2[range2.length-1]+offset,position=(scale.bandwidth?center$1:number$1)(scale.copy(),offset),selection2=context.selection?context.selection():context,path=selection2.selectAll(".domain").data([null]),tick=selection2.selectAll(".tick").data(values,scale).order(),tickExit=tick.exit(),tickEnter=tick.enter().append("g").attr("class","tick"),line2=tick.select("line"),text=tick.select("text");path=path.merge(path.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),tick=tick.merge(tickEnter),line2=line2.merge(tickEnter.append("line").attr("stroke","currentColor").attr(x2+"2",k*tickSizeInner)),text=text.merge(tickEnter.append("text").attr("fill","currentColor").attr(x2,k*spacing).attr("dy",1===orient?"0em":3===orient?"0.71em":"0.32em")),context!==selection2&&(path=path.transition(context),tick=tick.transition(context),line2=line2.transition(context),text=text.transition(context),tickExit=tickExit.transition(context).attr("opacity",1e-6).attr("transform",function(d){return isFinite(d=position(d))?transform2(d+offset):this.getAttribute("transform")}),tickEnter.attr("opacity",1e-6).attr("transform",function(d){var p=this.parentNode.__axis;return transform2((p&&isFinite(p=p(d))?p:position(d))+offset)})),tickExit.remove(),path.attr("d",4===orient||2===orient?tickSizeOuter?"M"+k*tickSizeOuter+","+range0+"H"+offset+"V"+range1+"H"+k*tickSizeOuter:"M"+offset+","+range0+"V"+range1:tickSizeOuter?"M"+range0+","+k*tickSizeOuter+"V"+offset+"H"+range1+"V"+k*tickSizeOuter:"M"+range0+","+offset+"H"+range1),tick.attr("opacity",1).attr("transform",function(d){return transform2(position(d)+offset)}),line2.attr(x2+"2",k*tickSizeInner),text.attr(x2,k*spacing).text(format2),selection2.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===orient?"start":4===orient?"end":"middle"),selection2.each(function(){this.__axis=position})}return axis2.scale=function(_){return arguments.length?(scale=_,axis2):scale},axis2.ticks=function(){return tickArguments=Array.from(arguments),axis2},axis2.tickArguments=function(_){return arguments.length?(tickArguments=null==_?[]:Array.from(_),axis2):tickArguments.slice()},axis2.tickValues=function(_){return arguments.length?(tickValues=null==_?null:Array.from(_),axis2):tickValues&&tickValues.slice()},axis2.tickFormat=function(_){return arguments.length?(tickFormat2=_,axis2):tickFormat2},axis2.tickSize=function(_){return arguments.length?(tickSizeInner=tickSizeOuter=+_,axis2):tickSizeInner},axis2.tickSizeInner=function(_){return arguments.length?(tickSizeInner=+_,axis2):tickSizeInner},axis2.tickSizeOuter=function(_){return arguments.length?(tickSizeOuter=+_,axis2):tickSizeOuter},axis2.tickPadding=function(_){return arguments.length?(tickPadding=+_,axis2):tickPadding},axis2.offset=function(_){return arguments.length?(offset=+_,axis2):offset},axis2}function axisBottom(scale){return axis(3,scale)}function axisLeft(scale){return axis(4,scale)}var noop$1={value:()=>{}};function dispatch(){for(var t,i=0,n=arguments.length,_={};i<n;++i){if(!(t=arguments[i]+"")||t in _||/[\s.]/.test(t))throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function get$1(type,name){for(var c2,i=0,n=type.length;i<n;++i)if((c2=type[i]).name===name)return c2.value}function set$1(type,name,callback){for(var i=0,n=type.length;i<n;++i)if(type[i].name===name){type[i]=noop$1,type=type.slice(0,i).concat(type.slice(i+1));break}return null!=callback&&type.push({name:name,value:callback}),type}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(typename,callback){var t,_=this._,T=function parseTypenames$1(typenames,types){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}})}(typename+"",_),i=-1,n=T.length;if(!(arguments.length<2)){if(null!=callback&&"function"!=typeof callback)throw new Error("invalid callback: "+callback);for(;++i<n;)if(t=(typename=T[i]).type)_[t]=set$1(_[t],typename.name,callback);else if(null==callback)for(t in _)_[t]=set$1(_[t],typename.name,null);return this}for(;++i<n;)if((t=(typename=T[i]).type)&&(t=get$1(_[t],typename.name)))return t},copy:function(){var copy2={},_=this._;for(var t in _)copy2[t]=_[t].slice();return new Dispatch(copy2)},call:function(type,that){if((n=arguments.length-2)>0)for(var n,t,args=new Array(n),i=0;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(i=0,n=(t=this._[type]).length;i<n;++i)t[i].value.apply(that,args)},apply:function(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}};var xhtml="http://www.w3.org/1999/xhtml";const namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(name){var prefix=name+="",i=prefix.indexOf(":");return i>=0&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),namespaces.hasOwnProperty(prefix)?{space:namespaces[prefix],local:name}:name}function creatorInherit(name){return function(){var document2=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document2.documentElement.namespaceURI===xhtml?document2.createElement(name):document2.createElementNS(uri,name)}}function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}function creator(name){var fullname=namespace(name);return(fullname.local?creatorFixed:creatorInherit)(fullname)}function none$2(){}function selector(selector2){return null==selector2?none$2:function(){return this.querySelector(selector2)}}function array$1(x2){return null==x2?[]:Array.isArray(x2)?x2:Array.from(x2)}function empty(){return[]}function selectorAll(selector2){return null==selector2?empty:function(){return this.querySelectorAll(selector2)}}function matcher(selector2){return function(){return this.matches(selector2)}}function childMatcher(selector2){return function(node){return node.matches(selector2)}}var find$1=Array.prototype.find;function childFirst(){return this.firstElementChild}var filter=Array.prototype.filter;function children(){return Array.from(this.children)}function sparse(update){return new Array(update.length)}function EnterNode(parent,datum2){this.ownerDocument=parent.ownerDocument,this.namespaceURI=parent.namespaceURI,this._next=null,this._parent=parent,this.__data__=datum2}function bindIndex(parent,group2,enter,update,exit,data){for(var node,i=0,groupLength=group2.length,dataLength=data.length;i<dataLength;++i)(node=group2[i])?(node.__data__=data[i],update[i]=node):enter[i]=new EnterNode(parent,data[i]);for(;i<groupLength;++i)(node=group2[i])&&(exit[i]=node)}function bindKey(parent,group2,enter,update,exit,data,key){var i,node,keyValue,nodeByKeyValue=new Map,groupLength=group2.length,dataLength=data.length,keyValues=new Array(groupLength);for(i=0;i<groupLength;++i)(node=group2[i])&&(keyValues[i]=keyValue=key.call(node,node.__data__,i,group2)+"",nodeByKeyValue.has(keyValue)?exit[i]=node:nodeByKeyValue.set(keyValue,node));for(i=0;i<dataLength;++i)keyValue=key.call(parent,data[i],i,data)+"",(node=nodeByKeyValue.get(keyValue))?(update[i]=node,node.__data__=data[i],nodeByKeyValue.delete(keyValue)):enter[i]=new EnterNode(parent,data[i]);for(i=0;i<groupLength;++i)(node=group2[i])&&nodeByKeyValue.get(keyValues[i])===node&&(exit[i]=node)}function datum(node){return node.__data__}function arraylike(data){return"object"==typeof data&&"length"in data?data:Array.from(data)}function ascending(a2,b){return a2<b?-1:a2>b?1:a2>=b?0:NaN}function attrRemove$1(name){return function(){this.removeAttribute(name)}}function attrRemoveNS$1(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant$1(name,value){return function(){this.setAttribute(name,value)}}function attrConstantNS$1(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}function attrFunction$1(name,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttribute(name):this.setAttribute(name,v)}}function attrFunctionNS$1(fullname,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttributeNS(fullname.space,fullname.local):this.setAttributeNS(fullname.space,fullname.local,v)}}function defaultView(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView}function styleRemove$1(name){return function(){this.style.removeProperty(name)}}function styleConstant$1(name,value,priority){return function(){this.style.setProperty(name,value,priority)}}function styleFunction$1(name,value,priority){return function(){var v=value.apply(this,arguments);null==v?this.style.removeProperty(name):this.style.setProperty(name,v,priority)}}function styleValue(node,name){return node.style.getPropertyValue(name)||defaultView(node).getComputedStyle(node,null).getPropertyValue(name)}function propertyRemove(name){return function(){delete this[name]}}function propertyConstant(name,value){return function(){this[name]=value}}function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?delete this[name]:this[name]=v}}function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node,this._names=classArray(node.getAttribute("class")||"")}function classedAdd(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.add(names[i])}function classedRemove(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.remove(names[i])}function classedTrue(names){return function(){classedAdd(this,names)}}function classedFalse(names){return function(){classedRemove(this,names)}}function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}function textRemove(){this.textContent=""}function textConstant$1(value){return function(){this.textContent=value}}function textFunction$1(value){return function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}}function htmlRemove(){this.innerHTML=""}function htmlConstant(value){return function(){this.innerHTML=value}}function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function constantNull(){return null}function remove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function selection_cloneShallow(){var clone=this.cloneNode(!1),parent=this.parentNode;return parent?parent.insertBefore(clone,this.nextSibling):clone}function selection_cloneDeep(){var clone=this.cloneNode(!0),parent=this.parentNode;return parent?parent.insertBefore(clone,this.nextSibling):clone}function onRemove(typename){return function(){var on=this.__on;if(on){for(var o,j=0,i=-1,m2=on.length;j<m2;++j)o=on[j],typename.type&&o.type!==typename.type||o.name!==typename.name?on[++i]=o:this.removeEventListener(o.type,o.listener,o.options);++i?on.length=i:delete this.__on}}}function onAdd(typename,value,options){return function(){var o,on=this.__on,listener=function contextListener(listener){return function(event){listener.call(this,event,this.__data__)}}(value);if(on)for(var j=0,m2=on.length;j<m2;++j)if((o=on[j]).type===typename.type&&o.name===typename.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=listener,o.options=options),void(o.value=value);this.addEventListener(typename.type,listener,options),o={type:typename.type,name:typename.name,value:value,listener:listener,options:options},on?on.push(o):this.__on=[o]}}function dispatchEvent(node,type,params){var window2=defaultView(node),event=window2.CustomEvent;"function"==typeof event?event=new event(type,params):(event=window2.document.createEvent("Event"),params?(event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail):event.initEvent(type,!1,!1)),node.dispatchEvent(event)}function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}}function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}EnterNode.prototype={constructor:EnterNode,appendChild:function(child){return this._parent.insertBefore(child,this._next)},insertBefore:function(child,next){return this._parent.insertBefore(child,next)},querySelector:function(selector2){return this._parent.querySelector(selector2)},querySelectorAll:function(selector2){return this._parent.querySelectorAll(selector2)}},ClassList.prototype={add:function(name){this._names.indexOf(name)<0&&(this._names.push(name),this._node.setAttribute("class",this._names.join(" ")))},remove:function(name){var i=this._names.indexOf(name);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(name){return this._names.indexOf(name)>=0}};var root=[null];function Selection$1(groups,parents){this._groups=groups,this._parents=parents}function selection(){return new Selection$1([[document.documentElement]],root)}function select(selector2){return"string"==typeof selector2?new Selection$1([[document.querySelector(selector2)]],[document.documentElement]):new Selection$1([[selector2]],root)}function pointer(event,node){if(event=function sourceEvent(event){let sourceEvent2;for(;sourceEvent2=event.sourceEvent;)event=sourceEvent2;return event}(event),void 0===node&&(node=event.currentTarget),node){var svg=node.ownerSVGElement||node;if(svg.createSVGPoint){var point=svg.createSVGPoint();return point.x=event.clientX,point.y=event.clientY,[(point=point.matrixTransform(node.getScreenCTM().inverse())).x,point.y]}if(node.getBoundingClientRect){var rect=node.getBoundingClientRect();return[event.clientX-rect.left-node.clientLeft,event.clientY-rect.top-node.clientTop]}}return[event.pageX,event.pageY]}function selectAll(selector2){return"string"==typeof selector2?new Selection$1([document.querySelectorAll(selector2)],[document.documentElement]):new Selection$1([array$1(selector2)],root)}Selection$1.prototype=selection.prototype={constructor:Selection$1,select:function selection_select(select2){"function"!=typeof select2&&(select2=selector(select2));for(var groups=this._groups,m2=groups.length,subgroups=new Array(m2),j=0;j<m2;++j)for(var node,subnode,group2=groups[j],n=group2.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group2[i])&&(subnode=select2.call(node,node.__data__,i,group2))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode);return new Selection$1(subgroups,this._parents)},selectAll:function selection_selectAll(select2){select2="function"==typeof select2?function arrayAll(select2){return function(){return array$1(select2.apply(this,arguments))}}(select2):selectorAll(select2);for(var groups=this._groups,m2=groups.length,subgroups=[],parents=[],j=0;j<m2;++j)for(var node,group2=groups[j],n=group2.length,i=0;i<n;++i)(node=group2[i])&&(subgroups.push(select2.call(node,node.__data__,i,group2)),parents.push(node));return new Selection$1(subgroups,parents)},selectChild:function selection_selectChild(match){return this.select(null==match?childFirst:function childFind(match){return function(){return find$1.call(this.children,match)}}("function"==typeof match?match:childMatcher(match)))},selectChildren:function selection_selectChildren(match){return this.selectAll(null==match?children:function childrenFilter(match){return function(){return filter.call(this.children,match)}}("function"==typeof match?match:childMatcher(match)))},filter:function selection_filter(match){"function"!=typeof match&&(match=matcher(match));for(var groups=this._groups,m2=groups.length,subgroups=new Array(m2),j=0;j<m2;++j)for(var node,group2=groups[j],n=group2.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group2[i])&&match.call(node,node.__data__,i,group2)&&subgroup.push(node);return new Selection$1(subgroups,this._parents)},data:function selection_data(value,key){if(!arguments.length)return Array.from(this,datum);var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;"function"!=typeof value&&(value=function constant$6(x2){return function(){return x2}}(value));for(var m2=groups.length,update=new Array(m2),enter=new Array(m2),exit=new Array(m2),j=0;j<m2;++j){var parent=parents[j],group2=groups[j],groupLength=group2.length,data=arraylike(value.call(parent,parent&&parent.__data__,j,parents)),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength);bind(parent,group2,enterGroup,updateGroup,exit[j]=new Array(groupLength),data,key);for(var previous,next,i0=0,i1=0;i0<dataLength;++i0)if(previous=enterGroup[i0]){for(i0>=i1&&(i1=i0+1);!(next=updateGroup[i1])&&++i1<dataLength;);previous._next=next||null}}return(update=new Selection$1(update,parents))._enter=enter,update._exit=exit,update},enter:function selection_enter(){return new Selection$1(this._enter||this._groups.map(sparse),this._parents)},exit:function selection_exit(){return new Selection$1(this._exit||this._groups.map(sparse),this._parents)},join:function selection_join(onenter,onupdate,onexit){var enter=this.enter(),update=this,exit=this.exit();return"function"==typeof onenter?(enter=onenter(enter))&&(enter=enter.selection()):enter=enter.append(onenter+""),null!=onupdate&&(update=onupdate(update))&&(update=update.selection()),null==onexit?exit.remove():onexit(exit),enter&&update?enter.merge(update).order():update},merge:function selection_merge(context){for(var selection2=context.selection?context.selection():context,groups0=this._groups,groups1=selection2._groups,m0=groups0.length,m1=groups1.length,m2=Math.min(m0,m1),merges=new Array(m0),j=0;j<m2;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge2=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge2[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new Selection$1(merges,this._parents)},selection:function selection_selection(){return this},order:function selection_order(){for(var groups=this._groups,j=-1,m2=groups.length;++j<m2;)for(var node,group2=groups[j],i=group2.length-1,next=group2[i];--i>=0;)(node=group2[i])&&(next&&4^node.compareDocumentPosition(next)&&next.parentNode.insertBefore(node,next),next=node);return this},sort:function selection_sort(compare){function compareNode(a2,b){return a2&&b?compare(a2.__data__,b.__data__):!a2-!b}compare||(compare=ascending);for(var groups=this._groups,m2=groups.length,sortgroups=new Array(m2),j=0;j<m2;++j){for(var node,group2=groups[j],n=group2.length,sortgroup=sortgroups[j]=new Array(n),i=0;i<n;++i)(node=group2[i])&&(sortgroup[i]=node);sortgroup.sort(compareNode)}return new Selection$1(sortgroups,this._parents).order()},call:function selection_call(){var callback=arguments[0];return arguments[0]=this,callback.apply(null,arguments),this},nodes:function selection_nodes(){return Array.from(this)},node:function selection_node(){for(var groups=this._groups,j=0,m2=groups.length;j<m2;++j)for(var group2=groups[j],i=0,n=group2.length;i<n;++i){var node=group2[i];if(node)return node}return null},size:function selection_size(){let size=0;for(const node of this)++size;return size},empty:function selection_empty(){return!this.node()},each:function selection_each(callback){for(var groups=this._groups,j=0,m2=groups.length;j<m2;++j)for(var node,group2=groups[j],i=0,n=group2.length;i<n;++i)(node=group2[i])&&callback.call(node,node.__data__,i,group2);return this},attr:function selection_attr(name,value){var fullname=namespace(name);if(arguments.length<2){var node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((null==value?fullname.local?attrRemoveNS$1:attrRemove$1:"function"==typeof value?fullname.local?attrFunctionNS$1:attrFunction$1:fullname.local?attrConstantNS$1:attrConstant$1)(fullname,value))},style:function selection_style(name,value,priority){return arguments.length>1?this.each((null==value?styleRemove$1:"function"==typeof value?styleFunction$1:styleConstant$1)(name,value,null==priority?"":priority)):styleValue(this.node(),name)},property:function selection_property(name,value){return arguments.length>1?this.each((null==value?propertyRemove:"function"==typeof value?propertyFunction:propertyConstant)(name,value)):this.node()[name]},classed:function selection_classed(name,value){var names=classArray(name+"");if(arguments.length<2){for(var list=classList(this.node()),i=-1,n=names.length;++i<n;)if(!list.contains(names[i]))return!1;return!0}return this.each(("function"==typeof value?classedFunction:value?classedTrue:classedFalse)(names,value))},text:function selection_text(value){return arguments.length?this.each(null==value?textRemove:("function"==typeof value?textFunction$1:textConstant$1)(value)):this.node().textContent},html:function selection_html(value){return arguments.length?this.each(null==value?htmlRemove:("function"==typeof value?htmlFunction:htmlConstant)(value)):this.node().innerHTML},raise:function selection_raise(){return this.each(raise)},lower:function selection_lower(){return this.each(lower)},append:function selection_append(name){var create2="function"==typeof name?name:creator(name);return this.select(function(){return this.appendChild(create2.apply(this,arguments))})},insert:function selection_insert(name,before){var create2="function"==typeof name?name:creator(name),select2=null==before?constantNull:"function"==typeof before?before:selector(before);return this.select(function(){return this.insertBefore(create2.apply(this,arguments),select2.apply(this,arguments)||null)})},remove:function selection_remove(){return this.each(remove)},clone:function selection_clone(deep){return this.select(deep?selection_cloneDeep:selection_cloneShallow)},datum:function selection_datum(value){return arguments.length?this.property("__data__",value):this.node().__data__},on:function selection_on(typename,value,options){var i,t,typenames=function parseTypenames(typenames){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");return i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),{type:t,name:name}})}(typename+""),n=typenames.length;if(!(arguments.length<2)){for(on=value?onAdd:onRemove,i=0;i<n;++i)this.each(on(typenames[i],value,options));return this}var on=this.node().__on;if(on)for(var o,j=0,m2=on.length;j<m2;++j)for(i=0,o=on[j];i<n;++i)if((t=typenames[i]).type===o.type&&t.name===o.name)return o.value},dispatch:function selection_dispatch(type,params){return this.each(("function"==typeof params?dispatchFunction:dispatchConstant)(type,params))},[Symbol.iterator]:function*selection_iterator(){for(var groups=this._groups,j=0,m2=groups.length;j<m2;++j)for(var node,group2=groups[j],i=0,n=group2.length;i<n;++i)(node=group2[i])&&(yield node)}};const nonpassive={passive:!1},nonpassivecapture={capture:!0,passive:!1};function nopropagation$1(event){event.stopImmediatePropagation()}function noevent$1(event){event.preventDefault(),event.stopImmediatePropagation()}function dragDisable(view){var root2=view.document.documentElement,selection2=select(view).on("dragstart.drag",noevent$1,nonpassivecapture);"onselectstart"in root2?selection2.on("selectstart.drag",noevent$1,nonpassivecapture):(root2.__noselect=root2.style.MozUserSelect,root2.style.MozUserSelect="none")}function yesdrag(view,noclick){var root2=view.document.documentElement,selection2=select(view).on("dragstart.drag",null);noclick&&(selection2.on("click.drag",noevent$1,nonpassivecapture),setTimeout(function(){selection2.on("click.drag",null)},0)),"onselectstart"in root2?selection2.on("selectstart.drag",null):(root2.style.MozUserSelect=root2.__noselect,delete root2.__noselect)}const constant$5=x2=>()=>x2;function DragEvent(type,{sourceEvent:sourceEvent2,subject:subject,target:target,identifier:identifier,active:active,x:x2,y:y2,dx:dx,dy:dy,dispatch:dispatch2}){Object.defineProperties(this,{type:{value:type,enumerable:!0,configurable:!0},sourceEvent:{value:sourceEvent2,enumerable:!0,configurable:!0},subject:{value:subject,enumerable:!0,configurable:!0},target:{value:target,enumerable:!0,configurable:!0},identifier:{value:identifier,enumerable:!0,configurable:!0},active:{value:active,enumerable:!0,configurable:!0},x:{value:x2,enumerable:!0,configurable:!0},y:{value:y2,enumerable:!0,configurable:!0},dx:{value:dx,enumerable:!0,configurable:!0},dy:{value:dy,enumerable:!0,configurable:!0},_:{value:dispatch2}})}function defaultFilter$1(event){return!event.ctrlKey&&!event.button}function defaultContainer(){return this.parentNode}function defaultSubject(event,d){return null==d?{x:event.x,y:event.y}:d}function defaultTouchable$1(){return navigator.maxTouchPoints||"ontouchstart"in this}function define2(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}DragEvent.prototype.on=function(){var value=this._.on.apply(this._,arguments);return value===this._?this:value};var brighter=1/.7,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color(format2){var m2,l;return format2=(format2+"").trim().toLowerCase(),(m2=reHex.exec(format2))?(l=m2[1].length,m2=parseInt(m2[1],16),6===l?rgbn(m2):3===l?new Rgb(m2>>8&15|m2>>4&240,m2>>4&15|240&m2,(15&m2)<<4|15&m2,1):8===l?rgba(m2>>24&255,m2>>16&255,m2>>8&255,(255&m2)/255):4===l?rgba(m2>>12&15|m2>>8&240,m2>>8&15|m2>>4&240,m2>>4&15|240&m2,((15&m2)<<4|15&m2)/255):null):(m2=reRgbInteger.exec(format2))?new Rgb(m2[1],m2[2],m2[3],1):(m2=reRgbPercent.exec(format2))?new Rgb(255*m2[1]/100,255*m2[2]/100,255*m2[3]/100,1):(m2=reRgbaInteger.exec(format2))?rgba(m2[1],m2[2],m2[3],m2[4]):(m2=reRgbaPercent.exec(format2))?rgba(255*m2[1]/100,255*m2[2]/100,255*m2[3]/100,m2[4]):(m2=reHslPercent.exec(format2))?hsla(m2[1],m2[2]/100,m2[3]/100,1):(m2=reHslaPercent.exec(format2))?hsla(m2[1],m2[2]/100,m2[3]/100,m2[4]):named.hasOwnProperty(format2)?rgbn(named[format2]):"transparent"===format2?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a2){return a2<=0&&(r=g=b=NaN),new Rgb(r,g,b,a2)}function rgb(r,g,b,opacity){return 1===arguments.length?function rgbConvert(o){return o instanceof Color||(o=color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatRgb(){const a2=clampa(this.opacity);return`${1===a2?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${1===a2?")":`, ${a2})`}`}function clampa(opacity){return isNaN(opacity)?1:Math.max(0,Math.min(1,opacity))}function clampi(value){return Math.max(0,Math.min(255,Math.round(value)||0))}function hex(value){return((value=clampi(value))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a2){return a2<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a2)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min2=Math.min(r,g,b),max2=Math.max(r,g,b),h=NaN,s=max2-min2,l=(max2+min2)/2;return s?(h=r===max2?(g-b)/s+6*(g<b):g===max2?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max2+min2:2-max2-min2,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function clamph(value){return(value=(value||0)%360)<0?value+360:value}function clampt(value){return Math.max(0,Math.min(1,value||0))}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define2(Color,color,{copy(channels){return Object.assign(new this.constructor,this,channels)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:function color_formatHex8(){return this.rgb().formatHex8()},formatHsl:function color_formatHsl(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),define2(Rgb,rgb,extend(Color,{brighter(k){return k=null==k?brighter:Math.pow(brighter,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define2(Hsl,function hsl(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)},extend(Color,{brighter(k){return k=null==k?brighter:Math.pow(brighter,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const a2=clampa(this.opacity);return`${1===a2?"hsl(":"hsla("}${clamph(this.h)}, ${100*clampt(this.s)}%, ${100*clampt(this.l)}%${1===a2?")":`, ${a2})`}`}}));const constant$4=x2=>()=>x2;function gamma(y2){return 1===(y2=+y2)?nogamma:function(a2,b){return b-a2?function exponential(a2,b,y2){return a2=Math.pow(a2,y2),b=Math.pow(b,y2)-a2,y2=1/y2,function(t){return Math.pow(a2+t*b,y2)}}(a2,b,y2):constant$4(isNaN(a2)?b:a2)}}function nogamma(a2,b){var d=b-a2;return d?function linear$1(a2,d){return function(t){return a2+t*d}}(a2,d):constant$4(isNaN(a2)?b:a2)}const interpolateRgb=function rgbGamma(y2){var color2=gamma(y2);function rgb$1(start2,end){var r=color2((start2=rgb(start2)).r,(end=rgb(end)).r),g=color2(start2.g,end.g),b=color2(start2.b,end.b),opacity=nogamma(start2.opacity,end.opacity);return function(t){return start2.r=r(t),start2.g=g(t),start2.b=b(t),start2.opacity=opacity(t),start2+""}}return rgb$1.gamma=rgbGamma,rgb$1}(1);function numberArray(a2,b){b||(b=[]);var i,n=a2?Math.min(b.length,a2.length):0,c2=b.slice();return function(t){for(i=0;i<n;++i)c2[i]=a2[i]*(1-t)+b[i]*t;return c2}}function genericArray(a2,b){var i,nb=b?b.length:0,na=a2?Math.min(nb,a2.length):0,x2=new Array(na),c2=new Array(nb);for(i=0;i<na;++i)x2[i]=interpolate$1(a2[i],b[i]);for(;i<nb;++i)c2[i]=b[i];return function(t){for(i=0;i<na;++i)c2[i]=x2[i](t);return c2}}function date(a2,b){var d=new Date;return a2=+a2,b=+b,function(t){return d.setTime(a2*(1-t)+b*t),d}}function interpolateNumber(a2,b){return a2=+a2,b=+b,function(t){return a2*(1-t)+b*t}}function object$1(a2,b){var k,i={},c2={};for(k in null!==a2&&"object"==typeof a2||(a2={}),null!==b&&"object"==typeof b||(b={}),b)k in a2?i[k]=interpolate$1(a2[k],b[k]):c2[k]=b[k];return function(t){for(k in i)c2[k]=i[k](t);return c2}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function interpolateString(a2,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a2+="",b+="";(am=reA.exec(a2))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:interpolateNumber(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function one(b){return function(t){return b(t)+""}}(q[0].x):function zero(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i2=0;i2<b;++i2)s[(o=q[i2]).i]=o.x(t);return s.join("")})}function interpolate$1(a2,b){var c2,t=typeof b;return null==b||"boolean"===t?constant$4(b):("number"===t?interpolateNumber:"string"===t?(c2=color(b))?(b=c2,interpolateRgb):interpolateString:b instanceof color?interpolateRgb:b instanceof Date?date:function isNumberArray(x2){return ArrayBuffer.isView(x2)&&!(x2 instanceof DataView)}(b)?numberArray:Array.isArray(b)?genericArray:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object$1:interpolateNumber)(a2,b)}function interpolateRound(a2,b){return a2=+a2,b=+b,function(t){return Math.round(a2*(1-t)+b*t)}}var svgNode,degrees$1=180/Math.PI,identity$7={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a2,b,c2,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a2*a2+b*b))&&(a2/=scaleX,b/=scaleX),(skewX=a2*c2+b*d)&&(c2-=a2*skewX,d-=b*skewX),(scaleY=Math.sqrt(c2*c2+d*d))&&(c2/=scaleY,d/=scaleY,skewX/=scaleY),a2*d<b*c2&&(a2=-a2,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a2)*degrees$1,skewX:Math.atan(skewX)*degrees$1,scaleX:scaleX,scaleY:scaleY}}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a2,b){var s=[],q=[];return a2=parse(a2),b=parse(b),function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a2.translateX,a2.translateY,b.translateX,b.translateY,s,q),function rotate(a2,b,s,q){a2!==b?(a2-b>180?b+=360:b-a2>180&&(a2+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:interpolateNumber(a2,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a2.rotate,b.rotate,s,q),function skewX(a2,b,s,q){a2!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:interpolateNumber(a2,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a2.skewX,b.skewX,s,q),function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a2.scaleX,a2.scaleY,b.scaleX,b.scaleY,s,q),a2=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(function parseCss(value){const m2=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(value+"");return m2.isIdentity?identity$7:decompose(m2.a,m2.b,m2.c,m2.d,m2.e,m2.f)},"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(function parseSvg(value){return null==value?identity$7:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?decompose((value=value.matrix).a,value.b,value.c,value.d,value.e,value.f):identity$7)},", ",")",")");function cosh(x2){return((x2=Math.exp(x2))+1/x2)/2}const interpolateZoom=function zoomRho(rho,rho2,rho4){function zoom2(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<1e-12)S=Math.log(w1/w0)/rho,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),b1=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/rho,i=function(t){var s=t*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*function tanh(x2){return((x2=Math.exp(2*x2))-1)/(x2+1)}(rho*s+r0)-function sinh(x2){return((x2=Math.exp(x2))-1/x2)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]}}return i.duration=1e3*S*rho/Math.SQRT2,i}return zoom2.rho=function(_){var _1=Math.max(.001,+_),_2=_1*_1;return zoomRho(_1,_2,_2*_2)},zoom2}(Math.SQRT2,2,4);var taskHead,taskTail,frame=0,timeout$1=0,interval=0,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(callback,delay,time){var t=new Timer;return t.restart(callback,delay,time),t}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout$1=0;try{!function timerFlush(){now(),++frame;for(var e,t=taskHead;t;)(e=clockNow-t._time)>=0&&t._call.call(void 0,e),t=t._next;--frame}()}finally{frame=0,function nap(){var t0,t2,t1=taskHead,time=1/0;for(;t1;)t1._call?(time>t1._time&&(time=t1._time),t0=t1,t1=t1._next):(t2=t1._next,t1._next=null,t1=t0?t0._next=t2:taskHead=t2);taskTail=t0,sleep(time)}(),clockNow=0}}function poke(){var now2=clock.now(),delay=now2-clockLast;delay>1e3&&(clockSkew-=delay,clockLast=now2)}function sleep(time){frame||(timeout$1&&(timeout$1=clearTimeout(timeout$1)),time-clockNow>24?(time<1/0&&(timeout$1=setTimeout(wake,time-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,1e3)),frame=1,setFrame(wake)))}function timeout(callback,delay,time){var t=new Timer;return delay=null==delay?0:+delay,t.restart(elapsed=>{t.stop(),callback(elapsed+delay)},delay,time),t}Timer.prototype=timer.prototype={constructor:Timer,restart:function(callback,delay,time){if("function"!=typeof callback)throw new TypeError("callback is not a function");time=(null==time?now():+time)+(null==delay?0:+delay),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=callback,this._time=time,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[];function schedule(node,name,id2,index2,group2,timing){var schedules=node.__transition;if(schedules){if(id2 in schedules)return}else node.__transition={};!function create(node,id2,self2){var tween,schedules=node.__transition;function schedule2(elapsed){self2.state=1,self2.timer.restart(start2,self2.delay,self2.time),self2.delay<=elapsed&&start2(elapsed-self2.delay)}function start2(elapsed){var i,j,n,o;if(1!==self2.state)return stop();for(i in schedules)if((o=schedules[i]).name===self2.name){if(3===o.state)return timeout(start2);4===o.state?(o.state=6,o.timer.stop(),o.on.call("interrupt",node,node.__data__,o.index,o.group),delete schedules[i]):+i<id2&&(o.state=6,o.timer.stop(),o.on.call("cancel",node,node.__data__,o.index,o.group),delete schedules[i])}if(timeout(function(){3===self2.state&&(self2.state=4,self2.timer.restart(tick,self2.delay,self2.time),tick(elapsed))}),self2.state=2,self2.on.call("start",node,node.__data__,self2.index,self2.group),2===self2.state){for(self2.state=3,tween=new Array(n=self2.tween.length),i=0,j=-1;i<n;++i)(o=self2.tween[i].value.call(node,node.__data__,self2.index,self2.group))&&(tween[++j]=o);tween.length=j+1}}function tick(elapsed){for(var t=elapsed<self2.duration?self2.ease.call(null,elapsed/self2.duration):(self2.timer.restart(stop),self2.state=5,1),i=-1,n=tween.length;++i<n;)tween[i].call(node,t);5===self2.state&&(self2.on.call("end",node,node.__data__,self2.index,self2.group),stop())}function stop(){for(var i in self2.state=6,self2.timer.stop(),delete schedules[id2],schedules)return;delete node.__transition}schedules[id2]=self2,self2.timer=timer(schedule2,0,self2.time)}(node,id2,{name:name,index:index2,group:group2,on:emptyOn,tween:emptyTween,time:timing.time,delay:timing.delay,duration:timing.duration,ease:timing.ease,timer:null,state:0})}function init(node,id2){var schedule2=get(node,id2);if(schedule2.state>0)throw new Error("too late; already scheduled");return schedule2}function set(node,id2){var schedule2=get(node,id2);if(schedule2.state>3)throw new Error("too late; already running");return schedule2}function get(node,id2){var schedule2=node.__transition;if(!schedule2||!(schedule2=schedule2[id2]))throw new Error("transition not found");return schedule2}function interrupt(node,name){var schedule2,active,i,schedules=node.__transition,empty2=!0;if(schedules){for(i in name=null==name?null:name+"",schedules)(schedule2=schedules[i]).name===name?(active=schedule2.state>2&&schedule2.state<5,schedule2.state=6,schedule2.timer.stop(),schedule2.on.call(active?"interrupt":"cancel",node,node.__data__,schedule2.index,schedule2.group),delete schedules[i]):empty2=!1;empty2&&delete node.__transition}}function tweenRemove(id2,name){var tween0,tween1;return function(){var schedule2=set(this,id2),tween=schedule2.tween;if(tween!==tween0)for(var i=0,n=(tween1=tween0=tween).length;i<n;++i)if(tween1[i].name===name){(tween1=tween1.slice()).splice(i,1);break}schedule2.tween=tween1}}function tweenFunction(id2,name,value){var tween0,tween1;if("function"!=typeof value)throw new Error;return function(){var schedule2=set(this,id2),tween=schedule2.tween;if(tween!==tween0){tween1=(tween0=tween).slice();for(var t={name:name,value:value},i=0,n=tween1.length;i<n;++i)if(tween1[i].name===name){tween1[i]=t;break}i===n&&tween1.push(t)}schedule2.tween=tween1}}function tweenValue(transition,name,value){var id2=transition._id;return transition.each(function(){var schedule2=set(this,id2);(schedule2.value||(schedule2.value={}))[name]=value.apply(this,arguments)}),function(node){return get(node,id2).value[name]}}function interpolate(a2,b){var c2;return("number"==typeof b?interpolateNumber:b instanceof color?interpolateRgb:(c2=color(b))?(b=c2,interpolateRgb):interpolateString)(a2,b)}function attrRemove(name){return function(){this.removeAttribute(name)}}function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant(name,interpolate2,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=this.getAttribute(name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate2(string00=string0,value1)}}function attrConstantNS(fullname,interpolate2,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=this.getAttributeNS(fullname.space,fullname.local);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate2(string00=string0,value1)}}function attrFunction(name,interpolate2,value){var string00,string10,interpolate0;return function(){var string0,string1,value1=value(this);if(null!=value1)return(string0=this.getAttribute(name))===(string1=value1+"")?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate2(string00=string0,value1));this.removeAttribute(name)}}function attrFunctionNS(fullname,interpolate2,value){var string00,string10,interpolate0;return function(){var string0,string1,value1=value(this);if(null!=value1)return(string0=this.getAttributeNS(fullname.space,fullname.local))===(string1=value1+"")?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate2(string00=string0,value1));this.removeAttributeNS(fullname.space,fullname.local)}}function attrTweenNS(fullname,value){var t0,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t0=(i0=i)&&function attrInterpolateNS(fullname,i){return function(t){this.setAttributeNS(fullname.space,fullname.local,i.call(this,t))}}(fullname,i)),t0}return tween._value=value,tween}function attrTween(name,value){var t0,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t0=(i0=i)&&function attrInterpolate(name,i){return function(t){this.setAttribute(name,i.call(this,t))}}(name,i)),t0}return tween._value=value,tween}function delayFunction(id2,value){return function(){init(this,id2).delay=+value.apply(this,arguments)}}function delayConstant(id2,value){return value=+value,function(){init(this,id2).delay=value}}function durationFunction(id2,value){return function(){set(this,id2).duration=+value.apply(this,arguments)}}function durationConstant(id2,value){return value=+value,function(){set(this,id2).duration=value}}var Selection=selection.prototype.constructor;function styleRemove(name){return function(){this.style.removeProperty(name)}}var id=0;function Transition(groups,parents,name,id2){this._groups=groups,this._parents=parents,this._name=name,this._id=id2}function newId(){return++id}var selection_prototype=selection.prototype;Transition.prototype={constructor:Transition,select:function transition_select(select2){var name=this._name,id2=this._id;"function"!=typeof select2&&(select2=selector(select2));for(var groups=this._groups,m2=groups.length,subgroups=new Array(m2),j=0;j<m2;++j)for(var node,subnode,group2=groups[j],n=group2.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group2[i])&&(subnode=select2.call(node,node.__data__,i,group2))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode,schedule(subgroup[i],name,id2,i,subgroup,get(node,id2)));return new Transition(subgroups,this._parents,name,id2)},selectAll:function transition_selectAll(select2){var name=this._name,id2=this._id;"function"!=typeof select2&&(select2=selectorAll(select2));for(var groups=this._groups,m2=groups.length,subgroups=[],parents=[],j=0;j<m2;++j)for(var node,group2=groups[j],n=group2.length,i=0;i<n;++i)if(node=group2[i]){for(var child,children2=select2.call(node,node.__data__,i,group2),inherit2=get(node,id2),k=0,l=children2.length;k<l;++k)(child=children2[k])&&schedule(child,name,id2,k,children2,inherit2);subgroups.push(children2),parents.push(node)}return new Transition(subgroups,parents,name,id2)},selectChild:selection_prototype.selectChild,selectChildren:selection_prototype.selectChildren,filter:function transition_filter(match){"function"!=typeof match&&(match=matcher(match));for(var groups=this._groups,m2=groups.length,subgroups=new Array(m2),j=0;j<m2;++j)for(var node,group2=groups[j],n=group2.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group2[i])&&match.call(node,node.__data__,i,group2)&&subgroup.push(node);return new Transition(subgroups,this._parents,this._name,this._id)},merge:function transition_merge(transition){if(transition._id!==this._id)throw new Error;for(var groups0=this._groups,groups1=transition._groups,m0=groups0.length,m1=groups1.length,m2=Math.min(m0,m1),merges=new Array(m0),j=0;j<m2;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge2=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge2[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new Transition(merges,this._parents,this._name,this._id)},selection:function transition_selection(){return new Selection(this._groups,this._parents)},transition:function transition_transition(){for(var name=this._name,id0=this._id,id1=newId(),groups=this._groups,m2=groups.length,j=0;j<m2;++j)for(var node,group2=groups[j],n=group2.length,i=0;i<n;++i)if(node=group2[i]){var inherit2=get(node,id0);schedule(node,name,id1,i,group2,{time:inherit2.time+inherit2.delay+inherit2.duration,delay:0,duration:inherit2.duration,ease:inherit2.ease})}return new Transition(groups,this._parents,name,id1)},call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:function transition_on(name,listener){var id2=this._id;return arguments.length<2?get(this.node(),id2).on.on(name):this.each(function onFunction(id2,name,listener){var on0,on1,sit=function start(name){return(name+"").trim().split(/^|\s+/).every(function(t){var i=t.indexOf(".");return i>=0&&(t=t.slice(0,i)),!t||"start"===t})}(name)?init:set;return function(){var schedule2=sit(this,id2),on=schedule2.on;on!==on0&&(on1=(on0=on).copy()).on(name,listener),schedule2.on=on1}}(id2,name,listener))},attr:function transition_attr(name,value){var fullname=namespace(name),i="transform"===fullname?interpolateTransformSvg:interpolate;return this.attrTween(name,"function"==typeof value?(fullname.local?attrFunctionNS:attrFunction)(fullname,i,tweenValue(this,"attr."+name,value)):null==value?(fullname.local?attrRemoveNS:attrRemove)(fullname):(fullname.local?attrConstantNS:attrConstant)(fullname,i,value))},attrTween:function transition_attrTween(name,value){var key="attr."+name;if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;var fullname=namespace(name);return this.tween(key,(fullname.local?attrTweenNS:attrTween)(fullname,value))},style:function transition_style(name,value,priority){var i="transform"==(name+="")?interpolateTransformCss:interpolate;return null==value?this.styleTween(name,function styleNull(name,interpolate2){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),string1=(this.style.removeProperty(name),styleValue(this,name));return string0===string1?null:string0===string00&&string1===string10?interpolate0:interpolate0=interpolate2(string00=string0,string10=string1)}}(name,i)).on("end.style."+name,styleRemove(name)):"function"==typeof value?this.styleTween(name,function styleFunction(name,interpolate2,value){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),value1=value(this),string1=value1+"";return null==value1&&(this.style.removeProperty(name),string1=value1=styleValue(this,name)),string0===string1?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate2(string00=string0,value1))}}(name,i,tweenValue(this,"style."+name,value))).each(function styleMaybeRemove(id2,name){var on0,on1,listener0,remove2,key="style."+name,event="end."+key;return function(){var schedule2=set(this,id2),on=schedule2.on,listener=null==schedule2.value[key]?remove2||(remove2=styleRemove(name)):void 0;on===on0&&listener0===listener||(on1=(on0=on).copy()).on(event,listener0=listener),schedule2.on=on1}}(this._id,name)):this.styleTween(name,function styleConstant(name,interpolate2,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=styleValue(this,name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate2(string00=string0,value1)}}(name,i,value),priority).on("end.style."+name,null)},styleTween:function transition_styleTween(name,value,priority){var key="style."+(name+="");if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,function styleTween(name,value,priority){var t,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t=(i0=i)&&function styleInterpolate(name,i,priority){return function(t){this.style.setProperty(name,i.call(this,t),priority)}}(name,i,priority)),t}return tween._value=value,tween}(name,value,null==priority?"":priority))},text:function transition_text(value){return this.tween("text","function"==typeof value?function textFunction(value){return function(){var value1=value(this);this.textContent=null==value1?"":value1}}(tweenValue(this,"text",value)):function textConstant(value){return function(){this.textContent=value}}(null==value?"":value+""))},textTween:function transition_textTween(value){var key="text";if(arguments.length<1)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,function textTween(value){var t0,i0;function tween(){var i=value.apply(this,arguments);return i!==i0&&(t0=(i0=i)&&function textInterpolate(i){return function(t){this.textContent=i.call(this,t)}}(i)),t0}return tween._value=value,tween}(value))},remove:function transition_remove(){return this.on("end.remove",function removeFunction(id2){return function(){var parent=this.parentNode;for(var i in this.__transition)if(+i!==id2)return;parent&&parent.removeChild(this)}}(this._id))},tween:function transition_tween(name,value){var id2=this._id;if(name+="",arguments.length<2){for(var t,tween=get(this.node(),id2).tween,i=0,n=tween.length;i<n;++i)if((t=tween[i]).name===name)return t.value;return null}return this.each((null==value?tweenRemove:tweenFunction)(id2,name,value))},delay:function transition_delay(value){var id2=this._id;return arguments.length?this.each(("function"==typeof value?delayFunction:delayConstant)(id2,value)):get(this.node(),id2).delay},duration:function transition_duration(value){var id2=this._id;return arguments.length?this.each(("function"==typeof value?durationFunction:durationConstant)(id2,value)):get(this.node(),id2).duration},ease:function transition_ease(value){var id2=this._id;return arguments.length?this.each(function easeConstant(id2,value){if("function"!=typeof value)throw new Error;return function(){set(this,id2).ease=value}}(id2,value)):get(this.node(),id2).ease},easeVarying:function transition_easeVarying(value){if("function"!=typeof value)throw new Error;return this.each(function easeVarying(id2,value){return function(){var v=value.apply(this,arguments);if("function"!=typeof v)throw new Error;set(this,id2).ease=v}}(this._id,value))},end:function transition_end(){var on0,on1,that=this,id2=that._id,size=that.size();return new Promise(function(resolve,reject){var cancel={value:reject},end={value:function(){0===--size&&resolve()}};that.each(function(){var schedule2=set(this,id2),on=schedule2.on;on!==on0&&((on1=(on0=on).copy())._.cancel.push(cancel),on1._.interrupt.push(cancel),on1._.end.push(end)),schedule2.on=on1}),0===size&&resolve()})},[Symbol.iterator]:selection_prototype[Symbol.iterator]};var defaultTiming={time:null,delay:0,duration:250,ease:function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function inherit(node,id2){for(var timing;!(timing=node.__transition)||!(timing=timing[id2]);)if(!(node=node.parentNode))throw new Error(`transition ${id2} not found`);return timing}selection.prototype.interrupt=function selection_interrupt(name){return this.each(function(){interrupt(this,name)})},selection.prototype.transition=function selection_transition(name){var id2,timing;name instanceof Transition?(id2=name._id,name=name._name):(id2=newId(),(timing=defaultTiming).time=now(),name=null==name?null:name+"");for(var groups=this._groups,m2=groups.length,j=0;j<m2;++j)for(var node,group2=groups[j],n=group2.length,i=0;i<n;++i)(node=group2[i])&&schedule(node,name,id2,i,group2,timing||inherit(node,id2));return new Transition(groups,this._parents,name,id2)};const pi$2=Math.PI,tau$2=2*pi$2,tauEpsilon=tau$2-1e-6;function append$1(strings){this._+=strings[0];for(let i=1,n=strings.length;i<n;++i)this._+=arguments[i]+strings[i]}class Path{constructor(digits){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==digits?append$1:function appendRound$1(digits){let d=Math.floor(digits);if(!(d>=0))throw new Error(`invalid digits: ${digits}`);if(d>15)return append$1;const k=10**d;return function(strings){this._+=strings[0];for(let i=1,n=strings.length;i<n;++i)this._+=Math.round(arguments[i]*k)/k+strings[i]}}(digits)}moveTo(x2,y2){this._append`M${this._x0=this._x1=+x2},${this._y0=this._y1=+y2}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(x2,y2){this._append`L${this._x1=+x2},${this._y1=+y2}`}quadraticCurveTo(x12,y12,x2,y2){this._append`Q${+x12},${+y12},${this._x1=+x2},${this._y1=+y2}`}bezierCurveTo(x12,y12,x2,y2,x3,y3){this._append`C${+x12},${+y12},${+x2},${+y2},${this._x1=+x3},${this._y1=+y3}`}arcTo(x12,y12,x2,y2,r){if(x12=+x12,y12=+y12,x2=+x2,y2=+y2,(r=+r)<0)throw new Error(`negative radius: ${r}`);let x02=this._x1,y02=this._y1,x21=x2-x12,y21=y2-y12,x01=x02-x12,y01=y02-y12,l01_2=x01*x01+y01*y01;if(null===this._x1)this._append`M${this._x1=x12},${this._y1=y12}`;else if(l01_2>1e-6)if(Math.abs(y01*x21-y21*x01)>1e-6&&r){let x20=x2-x02,y20=y2-y02,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi$2-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;Math.abs(t01-1)>1e-6&&this._append`L${x12+t01*x01},${y12+t01*y01}`,this._append`A${r},${r},0,0,${+(y01*x20>x01*y20)},${this._x1=x12+t21*x21},${this._y1=y12+t21*y21}`}else this._append`L${this._x1=x12},${this._y1=y12}`;else;}arc(x2,y2,r,a0,a1,ccw){if(x2=+x2,y2=+y2,ccw=!!ccw,(r=+r)<0)throw new Error(`negative radius: ${r}`);let dx=r*Math.cos(a0),dy=r*Math.sin(a0),x02=x2+dx,y02=y2+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;null===this._x1?this._append`M${x02},${y02}`:(Math.abs(this._x1-x02)>1e-6||Math.abs(this._y1-y02)>1e-6)&&this._append`L${x02},${y02}`,r&&(da<0&&(da=da%tau$2+tau$2),da>tauEpsilon?this._append`A${r},${r},0,1,${cw},${x2-dx},${y2-dy}A${r},${r},0,1,${cw},${this._x1=x02},${this._y1=y02}`:da>1e-6&&this._append`A${r},${r},0,${+(da>=pi$2)},${cw},${this._x1=x2+r*Math.cos(a1)},${this._y1=y2+r*Math.sin(a1)}`)}rect(x2,y2,w,h){this._append`M${this._x0=this._x1=+x2},${this._y0=this._y1=+y2}h${w=+w}v${+h}h${-w}Z`}toString(){return this._}}function add(tree,x2,y2,d){if(isNaN(x2)||isNaN(y2))return tree;var parent,xm,ym,xp,yp,right2,bottom2,i,j,node=tree._root,leaf={data:d},x02=tree._x0,y02=tree._y0,x12=tree._x1,y12=tree._y1;if(!node)return tree._root=leaf,tree;for(;node.length;)if((right2=x2>=(xm=(x02+x12)/2))?x02=xm:x12=xm,(bottom2=y2>=(ym=(y02+y12)/2))?y02=ym:y12=ym,parent=node,!(node=node[i=bottom2<<1|right2]))return parent[i]=leaf,tree;if(xp=+tree._x.call(null,node.data),yp=+tree._y.call(null,node.data),x2===xp&&y2===yp)return leaf.next=node,parent?parent[i]=leaf:tree._root=leaf,tree;do{parent=parent?parent[i]=new Array(4):tree._root=new Array(4),(right2=x2>=(xm=(x02+x12)/2))?x02=xm:x12=xm,(bottom2=y2>=(ym=(y02+y12)/2))?y02=ym:y12=ym}while((i=bottom2<<1|right2)==(j=(yp>=ym)<<1|xp>=xm));return parent[j]=node,parent[i]=leaf,tree}function Quad(node,x02,y02,x12,y12){this.node=node,this.x0=x02,this.y0=y02,this.x1=x12,this.y1=y12}function defaultX(d){return d[0]}function defaultY(d){return d[1]}function quadtree(nodes,x2,y2){var tree=new Quadtree(null==x2?defaultX:x2,null==y2?defaultY:y2,NaN,NaN,NaN,NaN);return null==nodes?tree:tree.addAll(nodes)}function Quadtree(x2,y2,x02,y02,x12,y12){this._x=x2,this._y=y2,this._x0=x02,this._y0=y02,this._x1=x12,this._y1=y12,this._root=void 0}function leaf_copy(leaf){for(var copy2={data:leaf.data},next=copy2;leaf=leaf.next;)next=next.next={data:leaf.data};return copy2}var treeProto=quadtree.prototype=Quadtree.prototype;function constant$3(x2){return function(){return x2}}function jiggle(random){return 1e-6*(random()-.5)}function x$2(d){return d.x+d.vx}function y$2(d){return d.y+d.vy}function index$3(d){return d.index}function find(nodeById,nodeId){var node=nodeById.get(nodeId);if(!node)throw new Error("node not found: "+nodeId);return node}function link$1(links){var strengths,distances,nodes,count2,bias,random,id2=index$3,strength=function defaultStrength(link2){return 1/Math.min(count2[link2.source.index],count2[link2.target.index])},distance=constant$3(30),iterations=1;function force(alpha){for(var k=0,n=links.length;k<iterations;++k)for(var link2,source,target,x2,y2,l,b,i=0;i<n;++i)source=(link2=links[i]).source,x2=(target=link2.target).x+target.vx-source.x-source.vx||jiggle(random),y2=target.y+target.vy-source.y-source.vy||jiggle(random),x2*=l=((l=Math.sqrt(x2*x2+y2*y2))-distances[i])/l*alpha*strengths[i],y2*=l,target.vx-=x2*(b=bias[i]),target.vy-=y2*b,source.vx+=x2*(b=1-b),source.vy+=y2*b}function initialize(){if(nodes){var i,link2,n=nodes.length,m2=links.length,nodeById=new Map(nodes.map((d,i2)=>[id2(d,i2,nodes),d]));for(i=0,count2=new Array(n);i<m2;++i)(link2=links[i]).index=i,"object"!=typeof link2.source&&(link2.source=find(nodeById,link2.source)),"object"!=typeof link2.target&&(link2.target=find(nodeById,link2.target)),count2[link2.source.index]=(count2[link2.source.index]||0)+1,count2[link2.target.index]=(count2[link2.target.index]||0)+1;for(i=0,bias=new Array(m2);i<m2;++i)link2=links[i],bias[i]=count2[link2.source.index]/(count2[link2.source.index]+count2[link2.target.index]);strengths=new Array(m2),initializeStrength(),distances=new Array(m2),initializeDistance()}}function initializeStrength(){if(nodes)for(var i=0,n=links.length;i<n;++i)strengths[i]=+strength(links[i],i,links)}function initializeDistance(){if(nodes)for(var i=0,n=links.length;i<n;++i)distances[i]=+distance(links[i],i,links)}return null==links&&(links=[]),force.initialize=function(_nodes,_random){nodes=_nodes,random=_random,initialize()},force.links=function(_){return arguments.length?(links=_,initialize(),force):links},force.id=function(_){return arguments.length?(id2=_,force):id2},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$3(+_),initializeStrength(),force):strength},force.distance=function(_){return arguments.length?(distance="function"==typeof _?_:constant$3(+_),initializeDistance(),force):distance},force}treeProto.copy=function(){var nodes,child,copy2=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),node=this._root;if(!node)return copy2;if(!node.length)return copy2._root=leaf_copy(node),copy2;for(nodes=[{source:node,target:copy2._root=new Array(4)}];node=nodes.pop();)for(var i=0;i<4;++i)(child=node.source[i])&&(child.length?nodes.push({source:child,target:node.target[i]=new Array(4)}):node.target[i]=leaf_copy(child));return copy2},treeProto.add=function tree_add(d){const x2=+this._x.call(null,d),y2=+this._y.call(null,d);return add(this.cover(x2,y2),x2,y2,d)},treeProto.addAll=function addAll(data){var d,i,x2,y2,n=data.length,xz=new Array(n),yz=new Array(n),x02=1/0,y02=1/0,x12=-1/0,y12=-1/0;for(i=0;i<n;++i)isNaN(x2=+this._x.call(null,d=data[i]))||isNaN(y2=+this._y.call(null,d))||(xz[i]=x2,yz[i]=y2,x2<x02&&(x02=x2),x2>x12&&(x12=x2),y2<y02&&(y02=y2),y2>y12&&(y12=y2));if(x02>x12||y02>y12)return this;for(this.cover(x02,y02).cover(x12,y12),i=0;i<n;++i)add(this,xz[i],yz[i],data[i]);return this},treeProto.cover=function tree_cover(x2,y2){if(isNaN(x2=+x2)||isNaN(y2=+y2))return this;var x02=this._x0,y02=this._y0,x12=this._x1,y12=this._y1;if(isNaN(x02))x12=(x02=Math.floor(x2))+1,y12=(y02=Math.floor(y2))+1;else{for(var parent,i,z=x12-x02||1,node=this._root;x02>x2||x2>=x12||y02>y2||y2>=y12;)switch(i=(y2<y02)<<1|x2<x02,(parent=new Array(4))[i]=node,node=parent,z*=2,i){case 0:x12=x02+z,y12=y02+z;break;case 1:x02=x12-z,y12=y02+z;break;case 2:x12=x02+z,y02=y12-z;break;case 3:x02=x12-z,y02=y12-z}this._root&&this._root.length&&(this._root=node)}return this._x0=x02,this._y0=y02,this._x1=x12,this._y1=y12,this},treeProto.data=function tree_data(){var data=[];return this.visit(function(node){if(!node.length)do{data.push(node.data)}while(node=node.next)}),data},treeProto.extent=function tree_extent(_){return arguments.length?this.cover(+_[0][0],+_[0][1]).cover(+_[1][0],+_[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},treeProto.find=function tree_find(x2,y2,radius){var data,x12,y12,x22,y22,q,i,x02=this._x0,y02=this._y0,x3=this._x1,y3=this._y1,quads=[],node=this._root;for(node&&quads.push(new Quad(node,x02,y02,x3,y3)),null==radius?radius=1/0:(x02=x2-radius,y02=y2-radius,x3=x2+radius,y3=y2+radius,radius*=radius);q=quads.pop();)if(!(!(node=q.node)||(x12=q.x0)>x3||(y12=q.y0)>y3||(x22=q.x1)<x02||(y22=q.y1)<y02))if(node.length){var xm=(x12+x22)/2,ym=(y12+y22)/2;quads.push(new Quad(node[3],xm,ym,x22,y22),new Quad(node[2],x12,ym,xm,y22),new Quad(node[1],xm,y12,x22,ym),new Quad(node[0],x12,y12,xm,ym)),(i=(y2>=ym)<<1|x2>=xm)&&(q=quads[quads.length-1],quads[quads.length-1]=quads[quads.length-1-i],quads[quads.length-1-i]=q)}else{var dx=x2-+this._x.call(null,node.data),dy=y2-+this._y.call(null,node.data),d2=dx*dx+dy*dy;if(d2<radius){var d=Math.sqrt(radius=d2);x02=x2-d,y02=y2-d,x3=x2+d,y3=y2+d,data=node.data}}return data},treeProto.remove=function tree_remove(d){if(isNaN(x2=+this._x.call(null,d))||isNaN(y2=+this._y.call(null,d)))return this;var parent,retainer,previous,next,x2,y2,xm,ym,right2,bottom2,i,j,node=this._root,x02=this._x0,y02=this._y0,x12=this._x1,y12=this._y1;if(!node)return this;if(node.length)for(;;){if((right2=x2>=(xm=(x02+x12)/2))?x02=xm:x12=xm,(bottom2=y2>=(ym=(y02+y12)/2))?y02=ym:y12=ym,parent=node,!(node=node[i=bottom2<<1|right2]))return this;if(!node.length)break;(parent[i+1&3]||parent[i+2&3]||parent[i+3&3])&&(retainer=parent,j=i)}for(;node.data!==d;)if(previous=node,!(node=node.next))return this;return(next=node.next)&&delete node.next,previous?(next?previous.next=next:delete previous.next,this):parent?(next?parent[i]=next:delete parent[i],(node=parent[0]||parent[1]||parent[2]||parent[3])&&node===(parent[3]||parent[2]||parent[1]||parent[0])&&!node.length&&(retainer?retainer[j]=node:this._root=node),this):(this._root=next,this)},treeProto.removeAll=function removeAll(data){for(var i=0,n=data.length;i<n;++i)this.remove(data[i]);return this},treeProto.root=function tree_root(){return this._root},treeProto.size=function tree_size(){var size=0;return this.visit(function(node){if(!node.length)do{++size}while(node=node.next)}),size},treeProto.visit=function tree_visit(callback){var q,child,x02,y02,x12,y12,quads=[],node=this._root;for(node&&quads.push(new Quad(node,this._x0,this._y0,this._x1,this._y1));q=quads.pop();)if(!callback(node=q.node,x02=q.x0,y02=q.y0,x12=q.x1,y12=q.y1)&&node.length){var xm=(x02+x12)/2,ym=(y02+y12)/2;(child=node[3])&&quads.push(new Quad(child,xm,ym,x12,y12)),(child=node[2])&&quads.push(new Quad(child,x02,ym,xm,y12)),(child=node[1])&&quads.push(new Quad(child,xm,y02,x12,ym)),(child=node[0])&&quads.push(new Quad(child,x02,y02,xm,ym))}return this},treeProto.visitAfter=function tree_visitAfter(callback){var q,quads=[],next=[];for(this._root&&quads.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));q=quads.pop();){var node=q.node;if(node.length){var child,x02=q.x0,y02=q.y0,x12=q.x1,y12=q.y1,xm=(x02+x12)/2,ym=(y02+y12)/2;(child=node[0])&&quads.push(new Quad(child,x02,y02,xm,ym)),(child=node[1])&&quads.push(new Quad(child,xm,y02,x12,ym)),(child=node[2])&&quads.push(new Quad(child,x02,ym,xm,y12)),(child=node[3])&&quads.push(new Quad(child,xm,ym,x12,y12))}next.push(q)}for(;q=next.pop();)callback(q.node,q.x0,q.y0,q.x1,q.y1);return this},treeProto.x=function tree_x(_){return arguments.length?(this._x=_,this):this._x},treeProto.y=function tree_y(_){return arguments.length?(this._y=_,this):this._y};const m=4294967296;function x$1(d){return d.x}function y$1(d){return d.y}var initialAngle=Math.PI*(3-Math.sqrt(5));function simulation(nodes){var simulation2,alpha=1,alphaMin=.001,alphaDecay=1-Math.pow(alphaMin,1/300),alphaTarget=0,velocityDecay=.6,forces=new Map,stepper=timer(step),event=dispatch("tick","end"),random=function lcg(){let s=1;return()=>(s=(1664525*s+1013904223)%m)/m}();function step(){tick(),event.call("tick",simulation2),alpha<alphaMin&&(stepper.stop(),event.call("end",simulation2))}function tick(iterations){var i,node,n=nodes.length;void 0===iterations&&(iterations=1);for(var k=0;k<iterations;++k)for(alpha+=(alphaTarget-alpha)*alphaDecay,forces.forEach(function(force){force(alpha)}),i=0;i<n;++i)null==(node=nodes[i]).fx?node.x+=node.vx*=velocityDecay:(node.x=node.fx,node.vx=0),null==node.fy?node.y+=node.vy*=velocityDecay:(node.y=node.fy,node.vy=0);return simulation2}function initializeNodes(){for(var node,i=0,n=nodes.length;i<n;++i){if((node=nodes[i]).index=i,null!=node.fx&&(node.x=node.fx),null!=node.fy&&(node.y=node.fy),isNaN(node.x)||isNaN(node.y)){var radius=10*Math.sqrt(.5+i),angle=i*initialAngle;node.x=radius*Math.cos(angle),node.y=radius*Math.sin(angle)}(isNaN(node.vx)||isNaN(node.vy))&&(node.vx=node.vy=0)}}function initializeForce(force){return force.initialize&&force.initialize(nodes,random),force}return null==nodes&&(nodes=[]),initializeNodes(),simulation2={tick:tick,restart:function(){return stepper.restart(step),simulation2},stop:function(){return stepper.stop(),simulation2},nodes:function(_){return arguments.length?(nodes=_,initializeNodes(),forces.forEach(initializeForce),simulation2):nodes},alpha:function(_){return arguments.length?(alpha=+_,simulation2):alpha},alphaMin:function(_){return arguments.length?(alphaMin=+_,simulation2):alphaMin},alphaDecay:function(_){return arguments.length?(alphaDecay=+_,simulation2):+alphaDecay},alphaTarget:function(_){return arguments.length?(alphaTarget=+_,simulation2):alphaTarget},velocityDecay:function(_){return arguments.length?(velocityDecay=1-_,simulation2):1-velocityDecay},randomSource:function(_){return arguments.length?(random=_,forces.forEach(initializeForce),simulation2):random},force:function(name,_){return arguments.length>1?(null==_?forces.delete(name):forces.set(name,initializeForce(_)),simulation2):forces.get(name)},find:function(x2,y2,radius){var dx,dy,d2,node,closest,i=0,n=nodes.length;for(null==radius?radius=1/0:radius*=radius,i=0;i<n;++i)(d2=(dx=x2-(node=nodes[i]).x)*dx+(dy=y2-node.y)*dy)<radius&&(closest=node,radius=d2);return closest},on:function(name,_){return arguments.length>1?(event.on(name,_),simulation2):event.on(name)}}}function formatDecimalParts(x2,p){if((i=(x2=p?x2.toExponential(p-1):x2.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x2.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x2.slice(i+1)]}function exponent(x2){return(x2=formatDecimalParts(Math.abs(x2)))?x2[1]:NaN}var prefixExponent,re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;return new FormatSpecifier({fill:match[1],align:match[2],sign:match[3],symbol:match[4],zero:match[5],width:match[6],comma:match[7],precision:match[8]&&match[8].slice(1),trim:match[9],type:match[10]})}function FormatSpecifier(specifier){this.fill=void 0===specifier.fill?" ":specifier.fill+"",this.align=void 0===specifier.align?">":specifier.align+"",this.sign=void 0===specifier.sign?"-":specifier.sign+"",this.symbol=void 0===specifier.symbol?"":specifier.symbol+"",this.zero=!!specifier.zero,this.width=void 0===specifier.width?void 0:+specifier.width,this.comma=!!specifier.comma,this.precision=void 0===specifier.precision?void 0:+specifier.precision,this.trim=!!specifier.trim,this.type=void 0===specifier.type?"":specifier.type+""}function formatRounded(x2,p){var d=formatDecimalParts(x2,p);if(!d)return x2+"";var coefficient=d[0],exponent2=d[1];return exponent2<0?"0."+new Array(-exponent2).join("0")+coefficient:coefficient.length>exponent2+1?coefficient.slice(0,exponent2+1)+"."+coefficient.slice(exponent2+1):coefficient+new Array(exponent2-coefficient.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const formatTypes={"%":(x2,p)=>(100*x2).toFixed(p),b:x2=>Math.round(x2).toString(2),c:x2=>x2+"",d:function formatDecimal(x2){return Math.abs(x2=Math.round(x2))>=1e21?x2.toLocaleString("en").replace(/,/g,""):x2.toString(10)},e:(x2,p)=>x2.toExponential(p),f:(x2,p)=>x2.toFixed(p),g:(x2,p)=>x2.toPrecision(p),o:x2=>Math.round(x2).toString(8),p:(x2,p)=>formatRounded(100*x2,p),r:formatRounded,s:function formatPrefixAuto(x2,p){var d=formatDecimalParts(x2,p);if(!d)return x2+"";var coefficient=d[0],exponent2=d[1],i=exponent2-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(exponent2/3))))+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimalParts(x2,Math.max(0,p+i-1))[0]},X:x2=>Math.round(x2).toString(16).toUpperCase(),x:x2=>Math.round(x2).toString(16)};function identity$6(x2){return x2}var locale,format,formatPrefix,map=Array.prototype.map,prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(locale2){var group2=void 0===locale2.grouping||void 0===locale2.thousands?identity$6:function formatGroup(grouping,thousands){return function(value,width){for(var i=value.length,t=[],j=0,g=grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=grouping[j=(j+1)%grouping.length];return t.reverse().join(thousands)}}(map.call(locale2.grouping,Number),locale2.thousands+""),currencyPrefix=void 0===locale2.currency?"":locale2.currency[0]+"",currencySuffix=void 0===locale2.currency?"":locale2.currency[1]+"",decimal=void 0===locale2.decimal?".":locale2.decimal+"",numerals=void 0===locale2.numerals?identity$6:function formatNumerals(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}}(map.call(locale2.numerals,String)),percent=void 0===locale2.percent?"%":locale2.percent+"",minus=void 0===locale2.minus?"":locale2.minus+"",nan=void 0===locale2.nan?"NaN":locale2.nan+"";function newFormat(specifier){var fill=(specifier=formatSpecifier(specifier)).fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero2=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;"n"===type?(comma=!0,type="g"):formatTypes[type]||(void 0===precision&&(precision=12),trim=!0,type="g"),(zero2||"0"===fill&&"="===align)&&(zero2=!0,fill="0",align="=");var prefix="$"===symbol?currencyPrefix:"#"===symbol&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix="$"===symbol?currencySuffix:/[%p]/.test(type)?percent:"",formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);function format2(value){var i,n,c2,valuePrefix=prefix,valueSuffix=suffix;if("c"===type)valueSuffix=formatType(value)+valueSuffix,value="";else{var valueNegative=(value=+value)<0||1/value<0;if(value=isNaN(value)?nan:formatType(Math.abs(value),precision),trim&&(value=function formatTrim(s){out:for(var i1,n=s.length,i=1,i0=-1;i<n;++i)switch(s[i]){case".":i0=i1=i;break;case"0":0===i0&&(i0=i),i1=i;break;default:if(!+s[i])break out;i0>0&&(i0=0)}return i0>0?s.slice(0,i0)+s.slice(i1+1):s}(value)),valueNegative&&0===+value&&"+"!==sign&&(valueNegative=!1),valuePrefix=(valueNegative?"("===sign?sign:minus:"-"===sign||"("===sign?"":sign)+valuePrefix,valueSuffix=("s"===type?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&"("===sign?")":""),maybeSuffix)for(i=-1,n=value.length;++i<n;)if(48>(c2=value.charCodeAt(i))||c2>57){valueSuffix=(46===c2?decimal+value.slice(i+1):value.slice(i))+valueSuffix,value=value.slice(0,i);break}}comma&&!zero2&&(value=group2(value,1/0));var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";switch(comma&&zero2&&(value=group2(padding+value,padding.length?width-valueSuffix.length:1/0),padding=""),align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix}return numerals(value)}return precision=void 0===precision?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision)),format2.toString=function(){return specifier+""},format2}return{format:newFormat,formatPrefix:function formatPrefix2(specifier,value){var f=newFormat(((specifier=formatSpecifier(specifier)).type="f",specifier)),e=3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3))),k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value2){return f(k*value2)+prefix}}}}!function defaultLocale(definition){return locale=formatLocale(definition),format=locale.format,formatPrefix=locale.formatPrefix,locale}({thousands:",",grouping:[3],currency:["$",""]});var pi$1=Math.PI,tau$1=2*pi$1,degrees=180/pi$1,radians=pi$1/180,abs$1=Math.abs,cos$1=Math.cos,sin$1=Math.sin,sqrt$2=Math.sqrt;function noop(){}function streamGeometry(geometry,stream){geometry&&streamGeometryType.hasOwnProperty(geometry.type)&&streamGeometryType[geometry.type](geometry,stream)}var streamObjectType={Feature:function(object2,stream){streamGeometry(object2.geometry,stream)},FeatureCollection:function(object2,stream){for(var features=object2.features,i=-1,n=features.length;++i<n;)streamGeometry(features[i].geometry,stream)}},streamGeometryType={Sphere:function(object2,stream){stream.sphere()},Point:function(object2,stream){object2=object2.coordinates,stream.point(object2[0],object2[1],object2[2])},MultiPoint:function(object2,stream){for(var coordinates=object2.coordinates,i=-1,n=coordinates.length;++i<n;)object2=coordinates[i],stream.point(object2[0],object2[1],object2[2])},LineString:function(object2,stream){streamLine(object2.coordinates,stream,0)},MultiLineString:function(object2,stream){for(var coordinates=object2.coordinates,i=-1,n=coordinates.length;++i<n;)streamLine(coordinates[i],stream,0)},Polygon:function(object2,stream){streamPolygon(object2.coordinates,stream)},MultiPolygon:function(object2,stream){for(var coordinates=object2.coordinates,i=-1,n=coordinates.length;++i<n;)streamPolygon(coordinates[i],stream)},GeometryCollection:function(object2,stream){for(var geometries=object2.geometries,i=-1,n=geometries.length;++i<n;)streamGeometry(geometries[i],stream)}};function streamLine(coordinates,stream,closed){var coordinate,i=-1,n=coordinates.length-closed;for(stream.lineStart();++i<n;)coordinate=coordinates[i],stream.point(coordinate[0],coordinate[1],coordinate[2]);stream.lineEnd()}function streamPolygon(coordinates,stream){var i=-1,n=coordinates.length;for(stream.polygonStart();++i<n;)streamLine(coordinates[i],stream,1);stream.polygonEnd()}function geoStream(object2,stream){object2&&streamObjectType.hasOwnProperty(object2.type)?streamObjectType[object2.type](object2,stream):streamGeometry(object2,stream)}function Intersection(point,points,other,entry){this.x=point,this.z=points,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}function clipRejoin(segments,compareIntersection,startInside,interpolate2,stream){var i,n,subject=[],clip=[];if(segments.forEach(function(segment){if(!((n2=segment.length-1)<=0)){var n2,x2,p0=segment[0],p1=segment[n2];if(function pointEqual(a2,b){return abs$1(a2[0]-b[0])<1e-6&&abs$1(a2[1]-b[1])<1e-6}(p0,p1)){if(!p0[2]&&!p1[2]){for(stream.lineStart(),i=0;i<n2;++i)stream.point((p0=segment[i])[0],p0[1]);return void stream.lineEnd()}p1[0]+=2e-6}subject.push(x2=new Intersection(p0,segment,null,!0)),clip.push(x2.o=new Intersection(p0,null,x2,!1)),subject.push(x2=new Intersection(p1,segment,null,!1)),clip.push(x2.o=new Intersection(p1,null,x2,!0))}}),subject.length){for(clip.sort(compareIntersection),link(subject),link(clip),i=0,n=clip.length;i<n;++i)clip[i].e=startInside=!startInside;for(var points,point,start2=subject[0];;){for(var current=start2,isSubject=!0;current.v;)if((current=current.n)===start2)return;points=current.z,stream.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(i=0,n=points.length;i<n;++i)stream.point((point=points[i])[0],point[1]);else interpolate2(current.x,current.n.x,1,stream);current=current.n}else{if(isSubject)for(points=current.p.z,i=points.length-1;i>=0;--i)stream.point((point=points[i])[0],point[1]);else interpolate2(current.x,current.p.x,-1,stream);current=current.p}points=(current=current.o).z,isSubject=!isSubject}while(!current.v);stream.lineEnd()}}}function link(array2){if(n=array2.length){for(var n,b,i=0,a2=array2[0];++i<n;)a2.n=b=array2[i],b.p=a2,a2=b;a2.n=b=array2[0],b.p=a2}}function clipRectangle(x02,y02,x12,y12){function visible(x2,y2){return x02<=x2&&x2<=x12&&y02<=y2&&y2<=y12}function interpolate2(from,to,direction,stream){var a2=0,a1=0;if(null==from||(a2=corner(from,direction))!==(a1=corner(to,direction))||comparePoint(from,to)<0^direction>0)do{stream.point(0===a2||3===a2?x02:x12,a2>1?y12:y02)}while((a2=(a2+direction+4)%4)!==a1);else stream.point(to[0],to[1])}function corner(p,direction){return abs$1(p[0]-x02)<1e-6?direction>0?0:3:abs$1(p[0]-x12)<1e-6?direction>0?2:1:abs$1(p[1]-y02)<1e-6?direction>0?1:0:direction>0?3:2}function compareIntersection(a2,b){return comparePoint(a2.x,b.x)}function comparePoint(a2,b){var ca=corner(a2,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a2[1]:1===ca?a2[0]-b[0]:2===ca?a2[1]-b[1]:b[0]-a2[0]}return function(stream){var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean,activeStream=stream,bufferStream=function clipBuffer(){var line2,lines=[];return{point:function(x2,y2,m2){line2.push([x2,y2,m2])},lineStart:function(){lines.push(line2=[])},lineEnd:noop,rejoin:function(){lines.length>1&&lines.push(lines.pop().concat(lines.shift()))},result:function(){var result=lines;return lines=[],line2=null,result}}}(),clipStream={point:point,lineStart:function lineStart(){clipStream.point=linePoint,polygon&&polygon.push(ring=[]);first=!0,v_=!1,x_=y_=NaN},lineEnd:function lineEnd(){segments&&(linePoint(x__,y__),v__&&v_&&bufferStream.rejoin(),segments.push(bufferStream.result()));clipStream.point=point,v_&&activeStream.lineEnd()},polygonStart:function polygonStart(){activeStream=bufferStream,segments=[],polygon=[],clean=!0},polygonEnd:function polygonEnd(){var startInside=function polygonInside(){for(var winding=0,i=0,n=polygon.length;i<n;++i)for(var a0,a1,ring2=polygon[i],j=1,m2=ring2.length,point2=ring2[0],b0=point2[0],b1=point2[1];j<m2;++j)a0=b0,a1=b1,b0=(point2=ring2[j])[0],b1=point2[1],a1<=y12?b1>y12&&(b0-a0)*(y12-a1)>(b1-a1)*(x02-a0)&&++winding:b1<=y12&&(b0-a0)*(y12-a1)<(b1-a1)*(x02-a0)&&--winding;return winding}(),cleanInside=clean&&startInside,visible2=(segments=function merge(arrays){return Array.from(function*flatten(arrays){for(const array2 of arrays)yield*array2}(arrays))}(segments)).length;(cleanInside||visible2)&&(stream.polygonStart(),cleanInside&&(stream.lineStart(),interpolate2(null,null,1,stream),stream.lineEnd()),visible2&&clipRejoin(segments,compareIntersection,startInside,interpolate2,stream),stream.polygonEnd());activeStream=stream,segments=polygon=ring=null}};function point(x2,y2){visible(x2,y2)&&activeStream.point(x2,y2)}function linePoint(x2,y2){var v=visible(x2,y2);if(polygon&&ring.push([x2,y2]),first)x__=x2,y__=y2,v__=v,first=!1,v&&(activeStream.lineStart(),activeStream.point(x2,y2));else if(v&&v_)activeStream.point(x2,y2);else{var a2=[x_=Math.max(-1e9,Math.min(1e9,x_)),y_=Math.max(-1e9,Math.min(1e9,y_))],b=[x2=Math.max(-1e9,Math.min(1e9,x2)),y2=Math.max(-1e9,Math.min(1e9,y2))];!function clipLine(a2,b,x02,y02,x12,y12){var r,ax=a2[0],ay=a2[1],t0=0,t1=1,dx=b[0]-ax,dy=b[1]-ay;if(r=x02-ax,dx||!(r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x12-ax,dx||!(r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y02-ay,dy||!(r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y12-ay,dy||!(r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return t0>0&&(a2[0]=ax+t0*dx,a2[1]=ay+t0*dy),t1<1&&(b[0]=ax+t1*dx,b[1]=ay+t1*dy),!0}}}}}(a2,b,x02,y02,x12,y12)?v&&(activeStream.lineStart(),activeStream.point(x2,y2),clean=!1):(v_||(activeStream.lineStart(),activeStream.point(a2[0],a2[1])),activeStream.point(b[0],b[1]),v||activeStream.lineEnd(),clean=!1)}x_=x2,y_=y2,v_=v}return clipStream}}const identity$5=x2=>x2;var x00$2,y00$2,x0$3,y0$3,areaSum=new Adder,areaRingSum=new Adder,areaStream={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaStream.lineStart=areaRingStart,areaStream.lineEnd=areaRingEnd},polygonEnd:function(){areaStream.lineStart=areaStream.lineEnd=areaStream.point=noop,areaSum.add(abs$1(areaRingSum)),areaRingSum=new Adder},result:function(){var area2=areaSum/2;return areaSum=new Adder,area2}};function areaRingStart(){areaStream.point=areaPointFirst}function areaPointFirst(x2,y2){areaStream.point=areaPoint,x00$2=x0$3=x2,y00$2=y0$3=y2}function areaPoint(x2,y2){areaRingSum.add(y0$3*x2-x0$3*y2),x0$3=x2,y0$3=y2}function areaRingEnd(){areaPoint(x00$2,y00$2)}var x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream={point:function boundsPoint(x2,y2){x2<x0$2&&(x0$2=x2);x2>x1&&(x1=x2);y2<y0$2&&(y0$2=y2);y2>y1&&(y1=y2)},lineStart:noop,lineEnd:noop,polygonStart:noop,polygonEnd:noop,result:function(){var bounds=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),bounds}};var x00$1,y00$1,x0$1,y0$1,X0=0,Y0=0,Z0=0,X1=0,Y1=0,Z1=0,X2=0,Y2=0,Z2=0,centroidStream={point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart,centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.point=centroidPoint,centroidStream.lineStart=centroidLineStart,centroidStream.lineEnd=centroidLineEnd},result:function(){var centroid=Z2?[X2/Z2,Y2/Z2]:Z1?[X1/Z1,Y1/Z1]:Z0?[X0/Z0,Y0/Z0]:[NaN,NaN];return X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0,centroid}};function centroidPoint(x2,y2){X0+=x2,Y0+=y2,++Z0}function centroidLineStart(){centroidStream.point=centroidPointFirstLine}function centroidPointFirstLine(x2,y2){centroidStream.point=centroidPointLine,centroidPoint(x0$1=x2,y0$1=y2)}function centroidPointLine(x2,y2){var dx=x2-x0$1,dy=y2-y0$1,z=sqrt$2(dx*dx+dy*dy);X1+=z*(x0$1+x2)/2,Y1+=z*(y0$1+y2)/2,Z1+=z,centroidPoint(x0$1=x2,y0$1=y2)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidPointFirstRing}function centroidRingEnd(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(x2,y2){centroidStream.point=centroidPointRing,centroidPoint(x00$1=x0$1=x2,y00$1=y0$1=y2)}function centroidPointRing(x2,y2){var dx=x2-x0$1,dy=y2-y0$1,z=sqrt$2(dx*dx+dy*dy);X1+=z*(x0$1+x2)/2,Y1+=z*(y0$1+y2)/2,Z1+=z,X2+=(z=y0$1*x2-x0$1*y2)*(x0$1+x2),Y2+=z*(y0$1+y2),Z2+=3*z,centroidPoint(x0$1=x2,y0$1=y2)}function PathContext(context){this._context=context}PathContext.prototype={_radius:4.5,pointRadius:function(_){return this._radius=_,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(x2,y2){switch(this._point){case 0:this._context.moveTo(x2,y2),this._point=1;break;case 1:this._context.lineTo(x2,y2);break;default:this._context.moveTo(x2+this._radius,y2),this._context.arc(x2,y2,this._radius,0,tau$1)}},result:noop};var lengthRing,x00,y00,x0,y0,lengthSum=new Adder,lengthStream={point:noop,lineStart:function(){lengthStream.point=lengthPointFirst},lineEnd:function(){lengthRing&&lengthPoint(x00,y00),lengthStream.point=noop},polygonStart:function(){lengthRing=!0},polygonEnd:function(){lengthRing=null},result:function(){var length=+lengthSum;return lengthSum=new Adder,length}};function lengthPointFirst(x2,y2){lengthStream.point=lengthPoint,x00=x0=x2,y00=y0=y2}function lengthPoint(x2,y2){x0-=x2,y0-=y2,lengthSum.add(sqrt$2(x0*x0+y0*y0)),x0=x2,y0=y2}let cacheDigits,cacheAppend,cacheRadius,cacheCircle;class PathString{constructor(digits){this._append=null==digits?append:function appendRound(digits){const d=Math.floor(digits);if(!(d>=0))throw new RangeError(`invalid digits: ${digits}`);if(d>15)return append;if(d!==cacheDigits){const k=10**d;cacheDigits=d,cacheAppend=function append2(strings){let i=1;this._+=strings[0];for(const j=strings.length;i<j;++i)this._+=Math.round(arguments[i]*k)/k+strings[i]}}return cacheAppend}(digits),this._radius=4.5,this._=""}pointRadius(_){return this._radius=+_,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(x2,y2){switch(this._point){case 0:this._append`M${x2},${y2}`,this._point=1;break;case 1:this._append`L${x2},${y2}`;break;default:if(this._append`M${x2},${y2}`,this._radius!==cacheRadius||this._append!==cacheAppend){const r=this._radius,s=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,cacheRadius=r,cacheAppend=this._append,cacheCircle=this._,this._=s}this._+=cacheCircle}}result(){const result=this._;return this._="",result.length?result:null}}function append(strings){let i=1;this._+=strings[0];for(const j=strings.length;i<j;++i)this._+=arguments[i]+strings[i]}function index$2(projection,context){let projectionStream,contextStream,digits=3,pointRadius=4.5;function path(object2){return object2&&("function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments)),geoStream(object2,projectionStream(contextStream))),contextStream.result()}return path.area=function(object2){return geoStream(object2,projectionStream(areaStream)),areaStream.result()},path.measure=function(object2){return geoStream(object2,projectionStream(lengthStream)),lengthStream.result()},path.bounds=function(object2){return geoStream(object2,projectionStream(boundsStream)),boundsStream.result()},path.centroid=function(object2){return geoStream(object2,projectionStream(centroidStream)),centroidStream.result()},path.projection=function(_){return arguments.length?(projectionStream=null==_?(projection=null,identity$5):(projection=_).stream,path):projection},path.context=function(_){return arguments.length?(contextStream=null==_?(context=null,new PathString(digits)):new PathContext(context=_),"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius),path):context},path.pointRadius=function(_){return arguments.length?(pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_),path):pointRadius},path.digits=function(_){if(!arguments.length)return digits;if(null==_)digits=null;else{const d=Math.floor(_);if(!(d>=0))throw new RangeError(`invalid digits: ${_}`);digits=d}return null===context&&(contextStream=new PathString(digits)),path},path.projection(projection).digits(digits).context(context)}function TransformStream(){}function fit(projection,fitBounds,object2){var clip=projection.clipExtent&&projection.clipExtent();return projection.scale(150).translate([0,0]),null!=clip&&projection.clipExtent(null),geoStream(object2,projection.stream(boundsStream)),fitBounds(boundsStream.result()),null!=clip&&projection.clipExtent(clip),projection}function fitExtent(projection,extent2,object2){return fit(projection,function(b){var w=extent2[1][0]-extent2[0][0],h=extent2[1][1]-extent2[0][1],k=Math.min(w/(b[1][0]-b[0][0]),h/(b[1][1]-b[0][1])),x2=+extent2[0][0]+(w-k*(b[1][0]+b[0][0]))/2,y2=+extent2[0][1]+(h-k*(b[1][1]+b[0][1]))/2;projection.scale(150*k).translate([x2,y2])},object2)}function identity$4(){var ca,sa,y02,x12,y12,cache,cacheStream,k=1,tx=0,ty=0,sx=1,sy=1,alpha=0,x02=null,kx=1,ky=1,transform2=function transformer$2(methods){return function(stream){var s=new TransformStream;for(var key in methods)s[key]=methods[key];return s.stream=stream,s}}({point:function(x2,y2){var p=projection([x2,y2]);this.stream.point(p[0],p[1])}}),postclip=identity$5;function reset(){return kx=k*sx,ky=k*sy,cache=cacheStream=null,projection}function projection(p){var x2=p[0]*kx,y2=p[1]*ky;if(alpha){var t=y2*ca-x2*sa;x2=x2*ca+y2*sa,y2=t}return[x2+tx,y2+ty]}return projection.invert=function(p){var x2=p[0]-tx,y2=p[1]-ty;if(alpha){var t=y2*ca+x2*sa;x2=x2*ca-y2*sa,y2=t}return[x2/kx,y2/ky]},projection.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transform2(postclip(cacheStream=stream))},projection.postclip=function(_){return arguments.length?(postclip=_,x02=y02=x12=y12=null,reset()):postclip},projection.clipExtent=function(_){return arguments.length?(postclip=null==_?(x02=y02=x12=y12=null,identity$5):clipRectangle(x02=+_[0][0],y02=+_[0][1],x12=+_[1][0],y12=+_[1][1]),reset()):null==x02?null:[[x02,y02],[x12,y12]]},projection.scale=function(_){return arguments.length?(k=+_,reset()):k},projection.translate=function(_){return arguments.length?(tx=+_[0],ty=+_[1],reset()):[tx,ty]},projection.angle=function(_){return arguments.length?(sa=sin$1(alpha=_%360*radians),ca=cos$1(alpha),reset()):alpha*degrees},projection.reflectX=function(_){return arguments.length?(sx=_?-1:1,reset()):sx<0},projection.reflectY=function(_){return arguments.length?(sy=_?-1:1,reset()):sy<0},projection.fitExtent=function(extent2,object2){return fitExtent(projection,extent2,object2)},projection.fitSize=function(size,object2){return function fitSize(projection,size,object2){return fitExtent(projection,[[0,0],size],object2)}(projection,size,object2)},projection.fitWidth=function(width,object2){return function fitWidth(projection,width,object2){return fit(projection,function(b){var w=+width,k=w/(b[1][0]-b[0][0]),x2=(w-k*(b[1][0]+b[0][0]))/2,y2=-k*b[0][1];projection.scale(150*k).translate([x2,y2])},object2)}(projection,width,object2)},projection.fitHeight=function(height,object2){return function fitHeight(projection,height,object2){return fit(projection,function(b){var h=+height,k=h/(b[1][1]-b[0][1]),x2=-k*b[0][0],y2=(h-k*(b[1][1]+b[0][1]))/2;projection.scale(150*k).translate([x2,y2])},object2)}(projection,height,object2)},projection}function count(node){var sum2=0,children2=node.children,i=children2&&children2.length;if(i)for(;--i>=0;)sum2+=children2[i].value;else sum2=1;node.value=sum2}function hierarchy(data,children2){data instanceof Map?(data=[void 0,data],void 0===children2&&(children2=mapChildren)):void 0===children2&&(children2=objectChildren);for(var node,child,childs,i,n,root2=new Node(data),nodes=[root2];node=nodes.pop();)if((childs=children2(node.data))&&(n=(childs=Array.from(childs)).length))for(node.children=childs,i=n-1;i>=0;--i)nodes.push(child=childs[i]=new Node(childs[i])),child.parent=node,child.depth=node.depth+1;return root2.eachBefore(computeHeight)}function objectChildren(d){return d.children}function mapChildren(d){return Array.isArray(d)?d[1]:null}function copyData(node){void 0!==node.data.value&&(node.value=node.data.value),node.data=node.data.data}function computeHeight(node){var height=0;do{node.height=height}while((node=node.parent)&&node.height<++height)}function Node(data){this.data=data,this.depth=this.height=0,this.parent=null}function constantZero(){return 0}function constant$2(x2){return function(){return x2}}function roundNode(node){node.x0=Math.round(node.x0),node.y0=Math.round(node.y0),node.x1=Math.round(node.x1),node.y1=Math.round(node.y1)}function treemapDice(parent,x02,y02,x12,y12){for(var node,nodes=parent.children,i=-1,n=nodes.length,k=parent.value&&(x12-x02)/parent.value;++i<n;)(node=nodes[i]).y0=y02,node.y1=y12,node.x0=x02,node.x1=x02+=node.value*k}function treemapSlice(parent,x02,y02,x12,y12){for(var node,nodes=parent.children,i=-1,n=nodes.length,k=parent.value&&(y12-y02)/parent.value;++i<n;)(node=nodes[i]).x0=x02,node.x1=x12,node.y0=y02,node.y1=y02+=node.value*k}TransformStream.prototype={constructor:TransformStream,point:function(x2,y2){this.stream.point(x2,y2)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Node.prototype=hierarchy.prototype={constructor:Node,count:function node_count(){return this.eachAfter(count)},each:function node_each(callback,that){let index2=-1;for(const node of this)callback.call(that,node,++index2,this);return this},eachAfter:function node_eachAfter(callback,that){for(var children2,i,n,node=this,nodes=[node],next=[],index2=-1;node=nodes.pop();)if(next.push(node),children2=node.children)for(i=0,n=children2.length;i<n;++i)nodes.push(children2[i]);for(;node=next.pop();)callback.call(that,node,++index2,this);return this},eachBefore:function node_eachBefore(callback,that){for(var children2,i,node=this,nodes=[node],index2=-1;node=nodes.pop();)if(callback.call(that,node,++index2,this),children2=node.children)for(i=children2.length-1;i>=0;--i)nodes.push(children2[i]);return this},find:function node_find(callback,that){let index2=-1;for(const node of this)if(callback.call(that,node,++index2,this))return node},sum:function node_sum(value){return this.eachAfter(function(node){for(var sum2=+value(node.data)||0,children2=node.children,i=children2&&children2.length;--i>=0;)sum2+=children2[i].value;node.value=sum2})},sort:function node_sort(compare){return this.eachBefore(function(node){node.children&&node.children.sort(compare)})},path:function node_path(end){for(var start2=this,ancestor=function leastCommonAncestor(a2,b){if(a2===b)return a2;var aNodes=a2.ancestors(),bNodes=b.ancestors(),c2=null;a2=aNodes.pop(),b=bNodes.pop();for(;a2===b;)c2=a2,a2=aNodes.pop(),b=bNodes.pop();return c2}(start2,end),nodes=[start2];start2!==ancestor;)start2=start2.parent,nodes.push(start2);for(var k=nodes.length;end!==ancestor;)nodes.splice(k,0,end),end=end.parent;return nodes},ancestors:function node_ancestors(){for(var node=this,nodes=[node];node=node.parent;)nodes.push(node);return nodes},descendants:function node_descendants(){return Array.from(this)},leaves:function node_leaves(){var leaves=[];return this.eachBefore(function(node){node.children||leaves.push(node)}),leaves},links:function node_links(){var root2=this,links=[];return root2.each(function(node){node!==root2&&links.push({source:node.parent,target:node})}),links},copy:function node_copy(){return hierarchy(this).eachBefore(copyData)},[Symbol.iterator]:function*node_iterator(){var current,children2,i,n,node=this,next=[node];do{for(current=next.reverse(),next=[];node=current.pop();)if(yield node,children2=node.children)for(i=0,n=children2.length;i<n;++i)next.push(children2[i])}while(next.length)}};const squarify=function custom(ratio){function squarify2(parent,x02,y02,x12,y12){!function squarifyRatio(ratio,parent,x02,y02,x12,y12){for(var row,nodeValue,dx,dy,sumValue,minValue,maxValue,newRatio,minRatio,alpha,beta,rows=[],nodes=parent.children,i0=0,i1=0,n=nodes.length,value=parent.value;i0<n;){dx=x12-x02,dy=y12-y02;do{sumValue=nodes[i1++].value}while(!sumValue&&i1<n);for(minValue=maxValue=sumValue,beta=sumValue*sumValue*(alpha=Math.max(dy/dx,dx/dy)/(value*ratio)),minRatio=Math.max(maxValue/beta,beta/minValue);i1<n;++i1){if(sumValue+=nodeValue=nodes[i1].value,nodeValue<minValue&&(minValue=nodeValue),nodeValue>maxValue&&(maxValue=nodeValue),beta=sumValue*sumValue*alpha,(newRatio=Math.max(maxValue/beta,beta/minValue))>minRatio){sumValue-=nodeValue;break}minRatio=newRatio}rows.push(row={value:sumValue,dice:dx<dy,children:nodes.slice(i0,i1)}),row.dice?treemapDice(row,x02,y02,x12,value?y02+=dy*sumValue/value:y12):treemapSlice(row,x02,y02,value?x02+=dx*sumValue/value:x12,y12),value-=sumValue,i0=i1}return rows}(ratio,parent,x02,y02,x12,y12)}return squarify2.ratio=function(x2){return custom((x2=+x2)>1?x2:1)},squarify2}((1+Math.sqrt(5))/2);function index$1(){var tile=squarify,round=!1,dx=1,dy=1,paddingStack=[0],paddingInner=constantZero,paddingTop=constantZero,paddingRight=constantZero,paddingBottom=constantZero,paddingLeft=constantZero;function treemap(root2){return root2.x0=root2.y0=0,root2.x1=dx,root2.y1=dy,root2.eachBefore(positionNode),paddingStack=[0],round&&root2.eachBefore(roundNode),root2}function positionNode(node){var p=paddingStack[node.depth],x02=node.x0+p,y02=node.y0+p,x12=node.x1-p,y12=node.y1-p;x12<x02&&(x02=x12=(x02+x12)/2),y12<y02&&(y02=y12=(y02+y12)/2),node.x0=x02,node.y0=y02,node.x1=x12,node.y1=y12,node.children&&(p=paddingStack[node.depth+1]=paddingInner(node)/2,x02+=paddingLeft(node)-p,y02+=paddingTop(node)-p,(x12-=paddingRight(node)-p)<x02&&(x02=x12=(x02+x12)/2),(y12-=paddingBottom(node)-p)<y02&&(y02=y12=(y02+y12)/2),tile(node,x02,y02,x12,y12))}return treemap.round=function(x2){return arguments.length?(round=!!x2,treemap):round},treemap.size=function(x2){return arguments.length?(dx=+x2[0],dy=+x2[1],treemap):[dx,dy]},treemap.tile=function(x2){return arguments.length?(tile=function required(f){if("function"!=typeof f)throw new Error;return f}(x2),treemap):tile},treemap.padding=function(x2){return arguments.length?treemap.paddingInner(x2).paddingOuter(x2):treemap.paddingInner()},treemap.paddingInner=function(x2){return arguments.length?(paddingInner="function"==typeof x2?x2:constant$2(+x2),treemap):paddingInner},treemap.paddingOuter=function(x2){return arguments.length?treemap.paddingTop(x2).paddingRight(x2).paddingBottom(x2).paddingLeft(x2):treemap.paddingTop()},treemap.paddingTop=function(x2){return arguments.length?(paddingTop="function"==typeof x2?x2:constant$2(+x2),treemap):paddingTop},treemap.paddingRight=function(x2){return arguments.length?(paddingRight="function"==typeof x2?x2:constant$2(+x2),treemap):paddingRight},treemap.paddingBottom=function(x2){return arguments.length?(paddingBottom="function"==typeof x2?x2:constant$2(+x2),treemap):paddingBottom},treemap.paddingLeft=function(x2){return arguments.length?(paddingLeft="function"==typeof x2?x2:constant$2(+x2),treemap):paddingLeft},treemap}function binary(parent,x02,y02,x12,y12){var i,sum2,nodes=parent.children,n=nodes.length,sums=new Array(n+1);for(sums[0]=sum2=i=0;i<n;++i)sums[i+1]=sum2+=nodes[i].value;!function partition(i2,j,value,x03,y03,x13,y13){if(i2>=j-1){var node=nodes[i2];return node.x0=x03,node.y0=y03,node.x1=x13,void(node.y1=y13)}var valueOffset=sums[i2],valueTarget=value/2+valueOffset,k=i2+1,hi=j-1;for(;k<hi;){var mid=k+hi>>>1;sums[mid]<valueTarget?k=mid+1:hi=mid}valueTarget-sums[k-1]<sums[k]-valueTarget&&i2+1<k&&--k;var valueLeft=sums[k]-valueOffset,valueRight=value-valueLeft;if(x13-x03>y13-y03){var xk=value?(x03*valueRight+x13*valueLeft)/value:x13;partition(i2,k,valueLeft,x03,y03,xk,y13),partition(k,j,valueRight,xk,y03,x13,y13)}else{var yk=value?(y03*valueRight+y13*valueLeft)/value:y13;partition(i2,k,valueLeft,x03,y03,x13,yk),partition(k,j,valueRight,x03,yk,x13,y13)}}(0,n,parent.value,x02,y02,x12,y12)}function initRange(domain,range2){switch(arguments.length){case 0:break;case 1:this.range(domain);break;default:this.range(range2).domain(domain)}return this}function initInterpolator(domain,interpolator){switch(arguments.length){case 0:break;case 1:"function"==typeof domain?this.interpolator(domain):this.range(domain);break;default:this.domain(domain),"function"==typeof interpolator?this.interpolator(interpolator):this.range(interpolator)}return this}const implicit=Symbol("implicit");function ordinal(){var index2=new InternMap,domain=[],range2=[],unknown=implicit;function scale(d){let i=index2.get(d);if(void 0===i){if(unknown!==implicit)return unknown;index2.set(d,i=domain.push(d)-1)}return range2[i%range2.length]}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index2=new InternMap;for(const value of _)index2.has(value)||index2.set(value,domain.push(value)-1);return scale},scale.range=function(_){return arguments.length?(range2=Array.from(_),scale):range2.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return ordinal(domain,range2).unknown(unknown)},initRange.apply(scale,arguments),scale}function band(){var step,bandwidth,scale=ordinal().unknown(void 0),domain=scale.domain,ordinalRange=scale.range,r0=0,r1=1,round=!1,paddingInner=0,paddingOuter=0,align=.5;function rescale(){var n=domain().length,reverse2=r1<r0,start2=reverse2?r1:r0,stop=reverse2?r0:r1;step=(stop-start2)/Math.max(1,n-paddingInner+2*paddingOuter),round&&(step=Math.floor(step)),start2+=(stop-start2-step*(n-paddingInner))*align,bandwidth=step*(1-paddingInner),round&&(start2=Math.round(start2),bandwidth=Math.round(bandwidth));var values=function range(start2,stop,step){start2=+start2,stop=+stop,step=(n=arguments.length)<2?(stop=start2,start2=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start2)/step)),range2=new Array(n);++i<n;)range2[i]=start2+i*step;return range2}(n).map(function(i){return start2+step*i});return ordinalRange(reverse2?values.reverse():values)}return delete scale.unknown,scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.range=function(_){return arguments.length?([r0,r1]=_,r0=+r0,r1=+r1,rescale()):[r0,r1]},scale.rangeRound=function(_){return[r0,r1]=_,r0=+r0,r1=+r1,round=!0,rescale()},scale.bandwidth=function(){return bandwidth},scale.step=function(){return step},scale.round=function(_){return arguments.length?(round=!!_,rescale()):round},scale.padding=function(_){return arguments.length?(paddingInner=Math.min(1,paddingOuter=+_),rescale()):paddingInner},scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.min(1,_),rescale()):paddingInner},scale.paddingOuter=function(_){return arguments.length?(paddingOuter=+_,rescale()):paddingOuter},scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align},scale.copy=function(){return band(domain(),[r0,r1]).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)},initRange.apply(rescale(),arguments)}function number(x2){return+x2}var unit=[0,1];function identity$3(x2){return x2}function normalize(a2,b){return(b-=a2=+a2)?function(x2){return(x2-a2)/b}:function constants(x2){return function(){return x2}}(isNaN(b)?NaN:.5)}function bimap(domain,range2,interpolate2){var d0=domain[0],d1=domain[1],r0=range2[0],r1=range2[1];return d1<d0?(d0=normalize(d1,d0),r0=interpolate2(r1,r0)):(d0=normalize(d0,d1),r0=interpolate2(r0,r1)),function(x2){return r0(d0(x2))}}function polymap(domain,range2,interpolate2){var j=Math.min(domain.length,range2.length)-1,d=new Array(j),r=new Array(j),i=-1;for(domain[j]<domain[0]&&(domain=domain.slice().reverse(),range2=range2.slice().reverse());++i<j;)d[i]=normalize(domain[i],domain[i+1]),r[i]=interpolate2(range2[i],range2[i+1]);return function(x2){var i2=bisectRight(domain,x2,1,j)-1;return r[i2](d[i2](x2))}}function copy$1(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp()).unknown(source.unknown())}function transformer$1(){var transform2,untransform,unknown,piecewise,output,input,domain=unit,range2=unit,interpolate2=interpolate$1,clamp=identity$3;function rescale(){var n=Math.min(domain.length,range2.length);return clamp!==identity$3&&(clamp=function clamper(a2,b){var t;return a2>b&&(t=a2,a2=b,b=t),function(x2){return Math.max(a2,Math.min(b,x2))}}(domain[0],domain[n-1])),piecewise=n>2?polymap:bimap,output=input=null,scale}function scale(x2){return null==x2||isNaN(x2=+x2)?unknown:(output||(output=piecewise(domain.map(transform2),range2,interpolate2)))(transform2(clamp(x2)))}return scale.invert=function(y2){return clamp(untransform((input||(input=piecewise(range2,domain.map(transform2),interpolateNumber)))(y2)))},scale.domain=function(_){return arguments.length?(domain=Array.from(_,number),rescale()):domain.slice()},scale.range=function(_){return arguments.length?(range2=Array.from(_),rescale()):range2.slice()},scale.rangeRound=function(_){return range2=Array.from(_),interpolate2=interpolateRound,rescale()},scale.clamp=function(_){return arguments.length?(clamp=!!_||identity$3,rescale()):clamp!==identity$3},scale.interpolate=function(_){return arguments.length?(interpolate2=_,rescale()):interpolate2},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t,u){return transform2=t,untransform=u,rescale()}}function tickFormat(start2,stop,count2,specifier){var precision,step=function tickStep(start2,stop,count2){count2=+count2;const reverse2=(stop=+stop)<(start2=+start2),inc=reverse2?tickIncrement(stop,start2,count2):tickIncrement(start2,stop,count2);return(reverse2?-1:1)*(inc<0?1/-inc:inc)}(start2,stop,count2);switch((specifier=formatSpecifier(null==specifier?",f":specifier)).type){case"s":var value=Math.max(Math.abs(start2),Math.abs(stop));return null!=specifier.precision||isNaN(precision=function precisionPrefix(step,value){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))-exponent(Math.abs(step)))}(step,value))||(specifier.precision=precision),formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":null!=specifier.precision||isNaN(precision=function precisionRound(step,max2){return step=Math.abs(step),max2=Math.abs(max2)-step,Math.max(0,exponent(max2)-exponent(step))+1}(step,Math.max(Math.abs(start2),Math.abs(stop))))||(specifier.precision=precision-("e"===specifier.type));break;case"f":case"%":null!=specifier.precision||isNaN(precision=function precisionFixed(step){return Math.max(0,-exponent(Math.abs(step)))}(step))||(specifier.precision=precision-2*("%"===specifier.type))}return format(specifier)}function linearish(scale){var domain=scale.domain;return scale.ticks=function(count2){var d=domain();return function ticks(start2,stop,count2){if(!((count2=+count2)>0))return[];if((start2=+start2)===(stop=+stop))return[start2];const reverse2=stop<start2,[i1,i2,inc]=reverse2?tickSpec(stop,start2,count2):tickSpec(start2,stop,count2);if(!(i2>=i1))return[];const n=i2-i1+1,ticks2=new Array(n);if(reverse2)if(inc<0)for(let i=0;i<n;++i)ticks2[i]=(i2-i)/-inc;else for(let i=0;i<n;++i)ticks2[i]=(i2-i)*inc;else if(inc<0)for(let i=0;i<n;++i)ticks2[i]=(i1+i)/-inc;else for(let i=0;i<n;++i)ticks2[i]=(i1+i)*inc;return ticks2}(d[0],d[d.length-1],null==count2?10:count2)},scale.tickFormat=function(count2,specifier){var d=domain();return tickFormat(d[0],d[d.length-1],null==count2?10:count2,specifier)},scale.nice=function(count2){null==count2&&(count2=10);var prestep,step,d=domain(),i0=0,i1=d.length-1,start2=d[i0],stop=d[i1],maxIter=10;for(stop<start2&&(step=start2,start2=stop,stop=step,step=i0,i0=i1,i1=step);maxIter-- >0;){if((step=tickIncrement(start2,stop,count2))===prestep)return d[i0]=start2,d[i1]=stop,domain(d);if(step>0)start2=Math.floor(start2/step)*step,stop=Math.ceil(stop/step)*step;else{if(!(step<0))break;start2=Math.ceil(start2*step)/step,stop=Math.floor(stop*step)/step}prestep=step}return scale},scale}function linear(){var scale=function continuous(){return transformer$1()(identity$3,identity$3)}();return scale.copy=function(){return copy$1(scale,linear())},initRange.apply(scale,arguments),linearish(scale)}function transformPow(exponent2){return function(x2){return x2<0?-Math.pow(-x2,exponent2):Math.pow(x2,exponent2)}}function transformSqrt(x2){return x2<0?-Math.sqrt(-x2):Math.sqrt(x2)}function transformSquare(x2){return x2<0?-x2*x2:x2*x2}function powish(transform2){var scale=transform2(identity$3,identity$3),exponent2=1;return scale.exponent=function(_){return arguments.length?(exponent2=+_,function rescale(){return 1===exponent2?transform2(identity$3,identity$3):.5===exponent2?transform2(transformSqrt,transformSquare):transform2(transformPow(exponent2),transformPow(1/exponent2))}()):exponent2},linearish(scale)}function pow(){var scale=powish(transformer$1());return scale.copy=function(){return copy$1(scale,pow()).exponent(scale.exponent())},initRange.apply(scale,arguments),scale}function sqrt$1(){return pow.apply(null,arguments).exponent(.5)}function sequential(){var scale=linearish(function transformer(){var t0,t1,k10,transform2,unknown,x02=0,x12=1,interpolator=identity$3,clamp=!1;function scale(x2){return null==x2||isNaN(x2=+x2)?unknown:interpolator(0===k10?.5:(x2=(transform2(x2)-t0)*k10,clamp?Math.max(0,Math.min(1,x2)):x2))}function range2(interpolate2){return function(_){var r0,r1;return arguments.length?([r0,r1]=_,interpolator=interpolate2(r0,r1),scale):[interpolator(0),interpolator(1)]}}return scale.domain=function(_){return arguments.length?([x02,x12]=_,t0=transform2(x02=+x02),t1=transform2(x12=+x12),k10=t0===t1?0:1/(t1-t0),scale):[x02,x12]},scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.range=range2(interpolate$1),scale.rangeRound=range2(interpolateRound),scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t){return transform2=t,t0=t(x02),t1=t(x12),k10=t0===t1?0:1/(t1-t0),scale}}()(identity$3));return scale.copy=function(){return function copy(source,target){return target.domain(source.domain()).interpolator(source.interpolator()).clamp(source.clamp()).unknown(source.unknown())}(scale,sequential())},initInterpolator.apply(scale,arguments)}function colors(specifier){for(var n=specifier.length/6|0,colors2=new Array(n),i=0;i<n;)colors2[i]="#"+specifier.slice(6*i,6*++i);return colors2}const category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ramp(range2){var n=range2.length;return function(t){return range2[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}const viridis=ramp(colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));function constant$1(x2){return function constant2(){return x2}}ramp(colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ramp(colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ramp(colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const abs=Math.abs,atan2=Math.atan2,cos=Math.cos,max=Math.max,min=Math.min,sin=Math.sin,sqrt=Math.sqrt,pi=Math.PI,halfPi=pi/2,tau=2*pi;function asin(x2){return x2>=1?halfPi:x2<=-1?-halfPi:Math.asin(x2)}function withPath(shape){let digits=3;return shape.digits=function(_){if(!arguments.length)return digits;if(null==_)digits=null;else{const d=Math.floor(_);if(!(d>=0))throw new RangeError(`invalid digits: ${_}`);digits=d}return shape},()=>new Path(digits)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function cornerTangents(x02,y02,x12,y12,r1,rc,cw){var x01=x02-x12,y01=y02-y12,lo=(cw?rc:-rc)/sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x02+ox,y11=y02+oy,x10=x12+ox,y10=y12+oy,x002=(x11+x10)/2,y002=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt(max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x002,dy0=cy0-y002,dx1=cx1-x002,dy1=cy1-y002;return dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1&&(cx0=cx1,cy0=cy1),{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}function arc(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=constant$1(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null,path=withPath(arc2);function arc2(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=abs(a1-a0),cw=a1>a0;if(context||(context=buffer=path()),r1<r0&&(r=r1,r1=r0,r0=r),r1>1e-12)if(da>tau-1e-12)context.moveTo(r1*cos(a0),r1*sin(a0)),context.arc(0,0,r1,a0,a1,!cw),r0>1e-12&&(context.moveTo(r0*cos(a1),r0*sin(a1)),context.arc(0,0,r0,a1,a0,cw));else{var t0,t1,a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>1e-12&&(padRadius?+padRadius.apply(this,arguments):sqrt(r0*r0+r1*r1)),rc=min(abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc;if(rp>1e-12){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));(da0-=2*p0)>1e-12?(a00+=p0*=cw?1:-1,a10-=p0):(da0=0,a00=a10=(a0+a1)/2),(da1-=2*p1)>1e-12?(a01+=p1*=cw?1:-1,a11-=p1):(da1=0,a01=a11=(a0+a1)/2)}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>1e-12){var oc,x11=r1*cos(a11),y11=r1*sin(a11),x002=r0*cos(a00),y002=r0*sin(a00);if(da<pi)if(oc=function intersect(x02,y02,x12,y12,x2,y2,x3,y3){var x10=x12-x02,y10=y12-y02,x32=x3-x2,y32=y3-y2,t=y32*x10-x32*y10;if(!(t*t<1e-12))return[x02+(t=(x32*(y02-y2)-y32*(x02-x2))/t)*x10,y02+t*y10]}(x01,y01,x002,y002,x11,y11,x10,y10)){var ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(function acos(x2){return x2>1?0:x2<-1?pi:Math.acos(x2)}((ax*bx+ay*by)/(sqrt(ax*ax+ay*ay)*sqrt(bx*bx+by*by)))/2),lc=sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=min(rc,(r0-lc)/(kc-1)),rc1=min(rc,(r1-lc)/(kc+1))}else rc0=rc1=0}da1>1e-12?rc1>1e-12?(t0=cornerTangents(x002,y002,x01,y01,r1,rc1,cw),t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw),context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01),rc1<rc?context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw),context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):(context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw)):context.moveTo(x01,y01),r0>1e-12&&da0>1e-12?rc0>1e-12?(t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw),t1=cornerTangents(x01,y01,x002,y002,r0,-rc0,cw),context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01),rc0<rc?context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw),context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):context.arc(0,0,r0,a10,a00,cw):context.lineTo(x10,y10)}else context.moveTo(0,0);if(context.closePath(),buffer)return context=null,buffer+""||null}return arc2.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a2=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi/2;return[cos(a2)*r,sin(a2)*r]},arc2.innerRadius=function(_){return arguments.length?(innerRadius="function"==typeof _?_:constant$1(+_),arc2):innerRadius},arc2.outerRadius=function(_){return arguments.length?(outerRadius="function"==typeof _?_:constant$1(+_),arc2):outerRadius},arc2.cornerRadius=function(_){return arguments.length?(cornerRadius="function"==typeof _?_:constant$1(+_),arc2):cornerRadius},arc2.padRadius=function(_){return arguments.length?(padRadius=null==_?null:"function"==typeof _?_:constant$1(+_),arc2):padRadius},arc2.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant$1(+_),arc2):startAngle},arc2.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant$1(+_),arc2):endAngle},arc2.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:constant$1(+_),arc2):padAngle},arc2.context=function(_){return arguments.length?(context=null==_?null:_,arc2):context},arc2}function array(x2){return"object"==typeof x2&&"length"in x2?x2:Array.from(x2)}function Linear(context){this._context=context}function curveLinear(context){return new Linear(context)}function x(p){return p[0]}function y(p){return p[1]}function line(x$12,y$12){var defined=constant$1(!0),context=null,curve=curveLinear,output=null,path=withPath(line2);function line2(data){var i,d,buffer,n=(data=array(data)).length,defined0=!1;for(null==context&&(output=curve(buffer=path())),i=0;i<=n;++i)!(i<n&&defined(d=data[i],i,data))===defined0&&((defined0=!defined0)?output.lineStart():output.lineEnd()),defined0&&output.point(+x$12(d,i,data),+y$12(d,i,data));if(buffer)return output=null,buffer+""||null}return x$12="function"==typeof x$12?x$12:void 0===x$12?x:constant$1(x$12),y$12="function"==typeof y$12?y$12:void 0===y$12?y:constant$1(y$12),line2.x=function(_){return arguments.length?(x$12="function"==typeof _?_:constant$1(+_),line2):x$12},line2.y=function(_){return arguments.length?(y$12="function"==typeof _?_:constant$1(+_),line2):y$12},line2.defined=function(_){return arguments.length?(defined="function"==typeof _?_:constant$1(!!_),line2):defined},line2.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),line2):curve},line2.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),line2):context},line2}function area(x02,y02,y12){var x12=null,defined=constant$1(!0),context=null,curve=curveLinear,output=null,path=withPath(area2);function area2(data){var i,j,k,d,buffer,n=(data=array(data)).length,defined0=!1,x0z=new Array(n),y0z=new Array(n);for(null==context&&(output=curve(buffer=path())),i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0)if(defined0=!defined0)j=i,output.areaStart(),output.lineStart();else{for(output.lineEnd(),output.lineStart(),k=i-1;k>=j;--k)output.point(x0z[k],y0z[k]);output.lineEnd(),output.areaEnd()}defined0&&(x0z[i]=+x02(d,i,data),y0z[i]=+y02(d,i,data),output.point(x12?+x12(d,i,data):x0z[i],y12?+y12(d,i,data):y0z[i]))}if(buffer)return output=null,buffer+""||null}function arealine(){return line().defined(defined).curve(curve).context(context)}return x02="function"==typeof x02?x02:void 0===x02?x:constant$1(+x02),y02="function"==typeof y02?y02:constant$1(void 0===y02?0:+y02),y12="function"==typeof y12?y12:void 0===y12?y:constant$1(+y12),area2.x=function(_){return arguments.length?(x02="function"==typeof _?_:constant$1(+_),x12=null,area2):x02},area2.x0=function(_){return arguments.length?(x02="function"==typeof _?_:constant$1(+_),area2):x02},area2.x1=function(_){return arguments.length?(x12=null==_?null:"function"==typeof _?_:constant$1(+_),area2):x12},area2.y=function(_){return arguments.length?(y02="function"==typeof _?_:constant$1(+_),y12=null,area2):y02},area2.y0=function(_){return arguments.length?(y02="function"==typeof _?_:constant$1(+_),area2):y02},area2.y1=function(_){return arguments.length?(y12=null==_?null:"function"==typeof _?_:constant$1(+_),area2):y12},area2.lineX0=area2.lineY0=function(){return arealine().x(x02).y(y02)},area2.lineY1=function(){return arealine().x(x02).y(y12)},area2.lineX1=function(){return arealine().x(x12).y(y02)},area2.defined=function(_){return arguments.length?(defined="function"==typeof _?_:constant$1(!!_),area2):defined},area2.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),area2):curve},area2.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),area2):context},area2}function descending(a2,b){return b<a2?-1:b>a2?1:b>=a2?0:NaN}function identity$2(d){return d}function none$1(series,order){if((n=series.length)>1)for(var j,s0,n,i=1,s1=series[order[0]],m2=s1.length;i<n;++i)for(s0=s1,s1=series[order[i]],j=0;j<m2;++j)s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}function none(series){for(var n=series.length,o=new Array(n);--n>=0;)o[n]=n;return o}function stackValue(d,key){return d[key]}function stackSeries(key){const series=[];return series.key=key,series}function stack(){var keys=constant$1([]),order=none,offset=none$1,value=stackValue;function stack2(data){var i,oz,sz=Array.from(keys.apply(this,arguments),stackSeries),n=sz.length,j=-1;for(const d of data)for(i=0,++j;i<n;++i)(sz[i][j]=[0,+value(d,sz[i].key,j,data)]).data=d;for(i=0,oz=array(order(sz));i<n;++i)sz[oz[i]].index=i;return offset(sz,oz),sz}return stack2.keys=function(_){return arguments.length?(keys="function"==typeof _?_:constant$1(Array.from(_)),stack2):keys},stack2.value=function(_){return arguments.length?(value="function"==typeof _?_:constant$1(+_),stack2):value},stack2.order=function(_){return arguments.length?(order=null==_?none:"function"==typeof _?_:constant$1(Array.from(_)),stack2):order},stack2.offset=function(_){return arguments.length?(offset=null==_?none$1:_,stack2):offset},stack2}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x2,y2){switch(x2=+x2,y2=+y2,this._point){case 0:this._point=1,this._line?this._context.lineTo(x2,y2):this._context.moveTo(x2,y2);break;case 1:this._point=2;default:this._context.lineTo(x2,y2)}}};const constant=x2=>()=>x2;function ZoomEvent(type,{sourceEvent:sourceEvent2,target:target,transform:transform2,dispatch:dispatch2}){Object.defineProperties(this,{type:{value:type,enumerable:!0,configurable:!0},sourceEvent:{value:sourceEvent2,enumerable:!0,configurable:!0},target:{value:target,enumerable:!0,configurable:!0},transform:{value:transform2,enumerable:!0,configurable:!0},_:{value:dispatch2}})}function Transform(k,x2,y2){this.k=k,this.x=x2,this.y=y2}Transform.prototype={constructor:Transform,scale:function(k){return 1===k?this:new Transform(this.k*k,this.x,this.y)},translate:function(x2,y2){return 0===x2&0===y2?this:new Transform(this.k,this.x+this.k*x2,this.y+this.k*y2)},apply:function(point){return[point[0]*this.k+this.x,point[1]*this.k+this.y]},applyX:function(x2){return x2*this.k+this.x},applyY:function(y2){return y2*this.k+this.y},invert:function(location){return[(location[0]-this.x)/this.k,(location[1]-this.y)/this.k]},invertX:function(x2){return(x2-this.x)/this.k},invertY:function(y2){return(y2-this.y)/this.k},rescaleX:function(x2){return x2.copy().domain(x2.range().map(this.invertX,this).map(x2.invert,x2))},rescaleY:function(y2){return y2.copy().domain(y2.range().map(this.invertY,this).map(y2.invert,y2))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var identity$1=new Transform(1,0,0);function nopropagation(event){event.stopImmediatePropagation()}function noevent(event){event.preventDefault(),event.stopImmediatePropagation()}function defaultFilter(event){return!(event.ctrlKey&&"wheel"!==event.type||event.button)}function defaultExtent(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function defaultTransform(){return this.__zoom||identity$1}function defaultWheelDelta(event){return-event.deltaY*(1===event.deltaMode?.05:event.deltaMode?1:.002)*(event.ctrlKey?10:1)}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function defaultConstrain(transform2,extent2,translateExtent){var dx0=transform2.invertX(extent2[0][0])-translateExtent[0][0],dx1=transform2.invertX(extent2[1][0])-translateExtent[1][0],dy0=transform2.invertY(extent2[0][1])-translateExtent[0][1],dy1=transform2.invertY(extent2[1][1])-translateExtent[1][1];return transform2.translate(dx1>dx0?(dx0+dx1)/2:Math.min(0,dx0)||Math.max(0,dx1),dy1>dy0?(dy0+dy1)/2:Math.min(0,dy0)||Math.max(0,dy1))}function zoom(){var touchstarting,touchfirst,touchending,filter2=defaultFilter,extent2=defaultExtent,constrain=defaultConstrain,wheelDelta=defaultWheelDelta,touchable=defaultTouchable,scaleExtent=[0,1/0],translateExtent=[[-1/0,-1/0],[1/0,1/0]],duration=250,interpolate2=interpolateZoom,listeners=dispatch("start","zoom","end"),clickDistance2=0,tapDistance=10;function zoom2(selection2){selection2.property("__zoom",defaultTransform).on("wheel.zoom",wheeled,{passive:!1}).on("mousedown.zoom",mousedowned).on("dblclick.zoom",dblclicked).filter(touchable).on("touchstart.zoom",touchstarted).on("touchmove.zoom",touchmoved).on("touchend.zoom touchcancel.zoom",touchended).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function scale(transform2,k){return(k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],k)))===transform2.k?transform2:new Transform(k,transform2.x,transform2.y)}function translate(transform2,p0,p1){var x2=p0[0]-p1[0]*transform2.k,y2=p0[1]-p1[1]*transform2.k;return x2===transform2.x&&y2===transform2.y?transform2:new Transform(transform2.k,x2,y2)}function centroid(extent3){return[(+extent3[0][0]+ +extent3[1][0])/2,(+extent3[0][1]+ +extent3[1][1])/2]}function schedule2(transition,transform2,point,event){transition.on("start.zoom",function(){gesture(this,arguments).event(event).start()}).on("interrupt.zoom end.zoom",function(){gesture(this,arguments).event(event).end()}).tween("zoom",function(){var args=arguments,g=gesture(this,args).event(event),e=extent2.apply(this,args),p=null==point?centroid(e):"function"==typeof point?point.apply(this,args):point,w=Math.max(e[1][0]-e[0][0],e[1][1]-e[0][1]),a2=this.__zoom,b="function"==typeof transform2?transform2.apply(this,args):transform2,i=interpolate2(a2.invert(p).concat(w/a2.k),b.invert(p).concat(w/b.k));return function(t){if(1===t)t=b;else{var l=i(t),k=w/l[2];t=new Transform(k,p[0]-l[0]*k,p[1]-l[1]*k)}g.zoom(null,t)}})}function gesture(that,args,clean){return!clean&&that.__zooming||new Gesture(that,args)}function Gesture(that,args){this.that=that,this.args=args,this.active=0,this.sourceEvent=null,this.extent=extent2.apply(that,args),this.taps=0}function wheeled(event,...args){if(filter2.apply(this,arguments)){var g=gesture(this,args).event(event),t=this.__zoom,k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],t.k*Math.pow(2,wheelDelta.apply(this,arguments)))),p=pointer(event);if(g.wheel)g.mouse[0][0]===p[0]&&g.mouse[0][1]===p[1]||(g.mouse[1]=t.invert(g.mouse[0]=p)),clearTimeout(g.wheel);else{if(t.k===k)return;g.mouse=[p,t.invert(p)],interrupt(this),g.start()}noevent(event),g.wheel=setTimeout(function wheelidled(){g.wheel=null,g.end()},150),g.zoom("mouse",constrain(translate(scale(t,k),g.mouse[0],g.mouse[1]),g.extent,translateExtent))}}function mousedowned(event,...args){if(!touchending&&filter2.apply(this,arguments)){var currentTarget=event.currentTarget,g=gesture(this,args,!0).event(event),v=select(event.view).on("mousemove.zoom",function mousemoved(event2){if(noevent(event2),!g.moved){var dx=event2.clientX-x02,dy=event2.clientY-y02;g.moved=dx*dx+dy*dy>clickDistance2}g.event(event2).zoom("mouse",constrain(translate(g.that.__zoom,g.mouse[0]=pointer(event2,currentTarget),g.mouse[1]),g.extent,translateExtent))},!0).on("mouseup.zoom",function mouseupped(event2){v.on("mousemove.zoom mouseup.zoom",null),yesdrag(event2.view,g.moved),noevent(event2),g.event(event2).end()},!0),p=pointer(event,currentTarget),x02=event.clientX,y02=event.clientY;dragDisable(event.view),nopropagation(event),g.mouse=[p,this.__zoom.invert(p)],interrupt(this),g.start()}}function dblclicked(event,...args){if(filter2.apply(this,arguments)){var t0=this.__zoom,p0=pointer(event.changedTouches?event.changedTouches[0]:event,this),p1=t0.invert(p0),k1=t0.k*(event.shiftKey?.5:2),t1=constrain(translate(scale(t0,k1),p0,p1),extent2.apply(this,args),translateExtent);noevent(event),duration>0?select(this).transition().duration(duration).call(schedule2,t1,p0,event):select(this).call(zoom2.transform,t1,p0,event)}}function touchstarted(event,...args){if(filter2.apply(this,arguments)){var started,i,t,p,touches=event.touches,n=touches.length,g=gesture(this,args,event.changedTouches.length===n).event(event);for(nopropagation(event),i=0;i<n;++i)p=[p=pointer(t=touches[i],this),this.__zoom.invert(p),t.identifier],g.touch0?g.touch1||g.touch0[2]===p[2]||(g.touch1=p,g.taps=0):(g.touch0=p,started=!0,g.taps=1+!!touchstarting);touchstarting&&(touchstarting=clearTimeout(touchstarting)),started&&(g.taps<2&&(touchfirst=p[0],touchstarting=setTimeout(function(){touchstarting=null},500)),interrupt(this),g.start())}}function touchmoved(event,...args){if(this.__zooming){var i,t,p,l,g=gesture(this,args).event(event),touches=event.changedTouches,n=touches.length;for(noevent(event),i=0;i<n;++i)p=pointer(t=touches[i],this),g.touch0&&g.touch0[2]===t.identifier?g.touch0[0]=p:g.touch1&&g.touch1[2]===t.identifier&&(g.touch1[0]=p);if(t=g.that.__zoom,g.touch1){var p0=g.touch0[0],l0=g.touch0[1],p1=g.touch1[0],l1=g.touch1[1],dp=(dp=p1[0]-p0[0])*dp+(dp=p1[1]-p0[1])*dp,dl=(dl=l1[0]-l0[0])*dl+(dl=l1[1]-l0[1])*dl;t=scale(t,Math.sqrt(dp/dl)),p=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2],l=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2]}else{if(!g.touch0)return;p=g.touch0[0],l=g.touch0[1]}g.zoom("touch",constrain(translate(t,p,l),g.extent,translateExtent))}}function touchended(event,...args){if(this.__zooming){var i,t,g=gesture(this,args).event(event),touches=event.changedTouches,n=touches.length;for(nopropagation(event),touchending&&clearTimeout(touchending),touchending=setTimeout(function(){touchending=null},500),i=0;i<n;++i)t=touches[i],g.touch0&&g.touch0[2]===t.identifier?delete g.touch0:g.touch1&&g.touch1[2]===t.identifier&&delete g.touch1;if(g.touch1&&!g.touch0&&(g.touch0=g.touch1,delete g.touch1),g.touch0)g.touch0[1]=this.__zoom.invert(g.touch0[0]);else if(g.end(),2===g.taps&&(t=pointer(t,this),Math.hypot(touchfirst[0]-t[0],touchfirst[1]-t[1])<tapDistance)){var p=select(this).on("dblclick.zoom");p&&p.apply(this,arguments)}}}return zoom2.transform=function(collection,transform2,point,event){var selection2=collection.selection?collection.selection():collection;selection2.property("__zoom",defaultTransform),collection!==selection2?schedule2(collection,transform2,point,event):selection2.interrupt().each(function(){gesture(this,arguments).event(event).start().zoom(null,"function"==typeof transform2?transform2.apply(this,arguments):transform2).end()})},zoom2.scaleBy=function(selection2,k,p,event){zoom2.scaleTo(selection2,function(){return this.__zoom.k*("function"==typeof k?k.apply(this,arguments):k)},p,event)},zoom2.scaleTo=function(selection2,k,p,event){zoom2.transform(selection2,function(){var e=extent2.apply(this,arguments),t0=this.__zoom,p0=null==p?centroid(e):"function"==typeof p?p.apply(this,arguments):p,p1=t0.invert(p0),k1="function"==typeof k?k.apply(this,arguments):k;return constrain(translate(scale(t0,k1),p0,p1),e,translateExtent)},p,event)},zoom2.translateBy=function(selection2,x2,y2,event){zoom2.transform(selection2,function(){return constrain(this.__zoom.translate("function"==typeof x2?x2.apply(this,arguments):x2,"function"==typeof y2?y2.apply(this,arguments):y2),extent2.apply(this,arguments),translateExtent)},null,event)},zoom2.translateTo=function(selection2,x2,y2,p,event){zoom2.transform(selection2,function(){var e=extent2.apply(this,arguments),t=this.__zoom,p0=null==p?centroid(e):"function"==typeof p?p.apply(this,arguments):p;return constrain(identity$1.translate(p0[0],p0[1]).scale(t.k).translate("function"==typeof x2?-x2.apply(this,arguments):-x2,"function"==typeof y2?-y2.apply(this,arguments):-y2),e,translateExtent)},p,event)},Gesture.prototype={event:function(event){return event&&(this.sourceEvent=event),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(key,transform2){return this.mouse&&"mouse"!==key&&(this.mouse[1]=transform2.invert(this.mouse[0])),this.touch0&&"touch"!==key&&(this.touch0[1]=transform2.invert(this.touch0[0])),this.touch1&&"touch"!==key&&(this.touch1[1]=transform2.invert(this.touch1[0])),this.that.__zoom=transform2,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(type){var d=select(this.that).datum();listeners.call(type,this.that,new ZoomEvent(type,{sourceEvent:this.sourceEvent,target:zoom2,transform:this.that.__zoom,dispatch:listeners}),d)}},zoom2.wheelDelta=function(_){return arguments.length?(wheelDelta="function"==typeof _?_:constant(+_),zoom2):wheelDelta},zoom2.filter=function(_){return arguments.length?(filter2="function"==typeof _?_:constant(!!_),zoom2):filter2},zoom2.touchable=function(_){return arguments.length?(touchable="function"==typeof _?_:constant(!!_),zoom2):touchable},zoom2.extent=function(_){return arguments.length?(extent2="function"==typeof _?_:constant([[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]]),zoom2):extent2},zoom2.scaleExtent=function(_){return arguments.length?(scaleExtent[0]=+_[0],scaleExtent[1]=+_[1],zoom2):[scaleExtent[0],scaleExtent[1]]},zoom2.translateExtent=function(_){return arguments.length?(translateExtent[0][0]=+_[0][0],translateExtent[1][0]=+_[1][0],translateExtent[0][1]=+_[0][1],translateExtent[1][1]=+_[1][1],zoom2):[[translateExtent[0][0],translateExtent[0][1]],[translateExtent[1][0],translateExtent[1][1]]]},zoom2.constrain=function(_){return arguments.length?(constrain=_,zoom2):constrain},zoom2.duration=function(_){return arguments.length?(duration=+_,zoom2):duration},zoom2.interpolate=function(_){return arguments.length?(interpolate2=_,zoom2):interpolate2},zoom2.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?zoom2:value},zoom2.clickDistance=function(_){return arguments.length?(clickDistance2=(_=+_)*_,zoom2):Math.sqrt(clickDistance2)},zoom2.tapDistance=function(_){return arguments.length?(tapDistance=+_,zoom2):tapDistance},zoom2}Transform.prototype;let tooltipStylesInjected=!1,currentTooltipFont=null;function showTooltip(event,content,fontFamily,fontSize){let explicitTooltipBg=null;try{const target=event&&event.target?event.target:document.elementFromPoint(event.clientX,event.clientY),ttEl=target&&target.closest?target.closest("[data-d3po-tooltips]"):null;ttEl&&(explicitTooltipBg=ttEl.getAttribute("data-d3po-tooltips"))}catch(e){explicitTooltipBg=null}!function injectTooltipStyles(fontFamily,fontSize,explicitTooltipBg){const newFont=`${fontFamily}-${fontSize}-${explicitTooltipBg?`explicit-${explicitTooltipBg}`:"auto"}`;if(tooltipStylesInjected&&currentTooltipFont===newFont)return;const oldStyle=document.getElementById("d3po-tooltip-styles");oldStyle&&oldStyle.remove();const bg=explicitTooltipBg||"white",border=explicitTooltipBg?color(bg).darker(1).toString():"#999",text=explicitTooltipBg?"white"===getTextColor(bg)?"#eee":"#111":"#333",arrowInner=bg,arrowBorder=border,style=document.createElement("style");style.id="d3po-tooltip-styles",style.textContent=`\n    .d3po-tooltip {\n      position: absolute;\n      background: ${bg};\n      border: 1px solid ${border};\n      color: ${text};\n      padding: 8px 10px;\n      border-radius: 4px;\n      pointer-events: none;\n      font-family: ${fontFamily||'"Noto Sans", "Fira Sans", sans-serif'};\n      font-size: ${fontSize||12}px;\n      line-height: 1.6;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n      z-index: 1000;\n      max-width: 200px;\n    }\n    \n    .d3po-tooltip::after {\n      content: '';\n      position: absolute;\n      bottom: -6px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 6px solid transparent;\n      border-right: 6px solid transparent;\n      border-top: 6px solid ${arrowInner};\n    }\n    \n    .d3po-tooltip::before {\n      content: '';\n      position: absolute;\n      bottom: -7px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 0;\n      height: 0;\n      border-left: 7px solid transparent;\n      border-right: 7px solid transparent;\n      border-top: 7px solid ${arrowBorder};\n    }\n    \n    .d3po-tooltip strong {\n      display: block;\n      margin-bottom: 4px;\n      color: ${text};\n    }\n  `,document.head.appendChild(style),tooltipStylesInjected=!0,currentTooltipFont=newFont}(fontFamily,fontSize,explicitTooltipBg),selectAll(".d3po-tooltip").remove();const tooltip=select("body").append("div").attr("class","d3po-tooltip").html(content),tooltipNode=tooltip.node(),tooltipHeight=tooltipNode.offsetHeight,tooltipWidth=tooltipNode.offsetWidth;return tooltip.style("left",event.pageX-tooltipWidth/2+"px").style("top",event.pageY-tooltipHeight-15+"px"),tooltip}function normalizeColorString(s){if("string"!=typeof s)return s;const m2=s.match(/^#([0-9a-fA-F]{8})$/);if(!m2)return s;const hex2=m2[1],r=parseInt(hex2.slice(0,2),16),g=parseInt(hex2.slice(2,4),16),b=parseInt(hex2.slice(4,6),16),a2=parseInt(hex2.slice(6,8),16)/255;return`rgba(${r}, ${g}, ${b}, ${Number(a2.toFixed(3))})`}function hideTooltip(){selectAll(".d3po-tooltip").remove()}function resolveTooltipFormatter(instanceTooltip,optionsTooltip){return"function"==typeof instanceTooltip?instanceTooltip:"function"==typeof optionsTooltip?optionsTooltip:"string"==typeof optionsTooltip?maybeEvalJSFormatter(optionsTooltip):null}function showTooltipWithFormatter(event,formatter,value,row,fontFamily,fontSize,fallback){try{if("function"==typeof formatter){const out=formatter(value,row);if(null!=out)return showTooltip(event,out,fontFamily,fontSize)}}catch(err){console.error("Tooltip formatter error",err)}return showTooltip(event,"function"==typeof fallback?fallback(value,row):String(fallback||""),fontFamily,fontSize)}function validateData(data,requiredFields){if(!Array.isArray(data)||0===data.length)throw new Error("Data must be a non-empty array");const firstItem=data[0],missingFields=requiredFields.filter(field=>!(field in firstItem));if(missingFields.length>0)throw new Error(`Missing required fields: ${missingFields.join(", ")}`)}function escapeHtml(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function getTextColor(bgColor){try{const rgb$1=rgb(bgColor),r=rgb$1.r/255,g=rgb$1.g/255,b=rgb$1.b/255,[rL,gL,bL]=[r,g,b].map(c2=>c2<=.03928?c2/12.92:Math.pow((c2+.055)/1.055,2.4));return.2126*rL+.7152*gL+.0722*bL>.5?"black":"white"}catch(e){return"black"}}function calculateBoxStats(values){const sorted=values.slice().sort((a2,b)=>a2-b),n=sorted.length;if(0===n)return{min:null,q1:null,median:null,q3:null,max:null,whiskerMin:null,whiskerMax:null,outliers:[]};const quantile=(arr,p)=>{const idx=(arr.length-1)*p,lower2=Math.floor(idx),upper=Math.ceil(idx),weight=idx%1;return arr[lower2]*(1-weight)+arr[upper]*weight},q1=quantile(sorted,.25),q3=quantile(sorted,.75),iqr=q3-q1,lowerBound=q1-1.5*iqr,upperBound=q3+1.5*iqr;let whiskerMin=sorted[0];for(let i=0;i<n;i++)if(sorted[i]>=lowerBound){whiskerMin=sorted[i];break}let whiskerMax=sorted[n-1];for(let i=n-1;i>=0;i--)if(sorted[i]<=upperBound){whiskerMax=sorted[i];break}const outliers=sorted.filter(v=>v<lowerBound||v>upperBound);return{min:sorted[0],q1:q1,median:quantile(sorted,.5),q3:q3,max:sorted[n-1],whiskerMin:whiskerMin,whiskerMax:whiskerMax,outliers:outliers}}function triggerDownload(blob,filename){const url=URL.createObjectURL(blob),link2=document.createElement("a");link2.href=url,link2.download=filename,link2.style.display="none",document.body.appendChild(link2),setTimeout(()=>{link2.click(),setTimeout(()=>{document.body.removeChild(link2),URL.revokeObjectURL(url)},100)},0)}function getHighlightColor(baseColor){let color$1=null;try{color$1=color(baseColor)}catch(e){color$1=null}color$1||(color$1=color("#999"));const luminance=.2126*(color$1.r||0)+.7152*(color$1.g||0)+.0722*(color$1.b||0);try{return luminance>180?color$1.darker(.3).toString():color$1.brighter(.5).toString()}catch(e){return color$1.toString()}}function tintColor(baseColor,factor=.15){try{const c2=color(baseColor);if(!c2)return baseColor;const r=c2.r,g=c2.g,b=c2.b,f=Math.max(0,Math.min(1,Number(factor)||0)),nr=Math.round(r+(255-r)*f),ng=Math.round(g+(255-g)*f);return`rgb(${nr}, ${ng}, ${Math.round(b+(255-b)*f)})`}catch(e){return baseColor}}function maybeEvalJSFormatter(opt){if("function"==typeof opt)return opt;if("string"!=typeof opt)return null;if(0!==opt.indexOf("JS.")&&0!==opt.indexOf("JS("))return null;var expr;if(0===opt.indexOf("JS."))expr=opt.slice(3).trim();else{var first=opt.indexOf("("),last=opt.lastIndexOf(")");expr=first>=0&&last>first?opt.substring(first+1,last).trim():opt.slice(3).trim()}var m2=expr.match(/^([A-Za-z0-9_\-]+)\s*\((.*)\)$/);if(m2){var name=m2[1],args=m2[2]||"";try{return new Function("value","row",'return window.d3po.format["'+name+'"]('+args+");")}catch(e){return console.warn("d3po: failed compiling simple formatter",opt,e),null}}try{return new Function("value","row","with (window.d3po) { return ("+expr+"); }")}catch(e){return console.warn("d3po: failed compiling JS formatter expression:",opt,e),null}}window.d3po=window.d3po||{},window.d3po.format=window.d3po.format||{},window.d3po.format["format-as-billion"]=function(value,decimals){return null==value||isNaN(value)?"":(value/1e9).toFixed(decimals="number"==typeof decimals?decimals:2)+"B"},window.d3po.format["format-as-percentage"]=function(value,decimals){return null==value||isNaN(value)?"":(100*value).toFixed(decimals="number"==typeof decimals?decimals:0)+"%"},window.d3po.format.formatAsBillion=window.d3po.format["format-as-billion"],window.d3po.format.formatAsPercentage=window.d3po.format["format-as-percentage"];class D3po{constructor(container,options={}){if(this.container="string"==typeof container?document.querySelector(container):container,!this.container)throw new Error("Container element not found");if(this.options={width:options.width||this.container.clientWidth||800,height:options.height||this.container.clientHeight||600,margin:options.margin||{top:60,right:40,bottom:80,left:60},title:options.title||"",background:options.background||"#ffffff",fontFamily:options.fontFamily||'"Noto Sans", "Fira Sans", sans-serif',fontSize:options.fontSize||12,download:void 0===options.download||options.download,...options},this.data=null,this.svg=null,this.chart=null,this.tooltip=options.tooltip||null,this.axisFormatters=options.axisFormatters||null,void 0!==options.axis_x){this.options.axisFormatters=this.options.axisFormatters||{};const fx=maybeEvalJSFormatter(options.axis_x);this.options.axisFormatters.x=fx||null}if(void 0!==options.axis_y){this.options.axisFormatters=this.options.axisFormatters||{};const fy=maybeEvalJSFormatter(options.axis_y);this.options.axisFormatters.y=fy||null}if(void 0!==options.tooltip){const tf=maybeEvalJSFormatter(options.tooltip);if(tf)this.tooltip=tf;else if("string"==typeof options.tooltip&&options.tooltip.indexOf("{")>=0){const template=options.tooltip;this.tooltip=function(_v,row){return row?template.replace(/\{([^}]+)\}/g,function(_,key){var val=row[key];return null==val?"":escapeHtml(String(val))}):""}}else this.tooltip=null}void 0!==options.formattedCols&&(this.options.formattedCols=options.formattedCols),void 0!==options.axisLabels&&(this.options.xLabel||void 0===options.axisLabels.x||(this.options.xLabel=options.axisLabels.x),this.options.yLabel||void 0===options.axisLabels.y||(this.options.yLabel=options.axisLabels.y),this.options.axisLabels=options.axisLabels),this.axisFormatters=this.options.axisFormatters||this.axisFormatters,this._initializeSVG()}_initializeSVG(){select(this.container).selectAll("*").remove(),this.svg=select(this.container).append("svg").attr("width",this.options.width).attr("height",this.options.height).style("background",this.options.background).style("font-family",this.options.fontFamily).style("font-size",`${this.options.fontSize}px`);let bg=this.options.background;if(!bg)try{bg=window.getComputedStyle(this.container).backgroundColor||bg}catch(e){bg=bg||"#ffffff"}try{const rgb$1=color(bg)||rgb("#ffffff"),luminance=(.2126*rgb$1.r+.7152*rgb$1.g+.0722*rgb$1.b)/255;this.isDark=luminance<=.5}catch(e){this.isDark=!1}if(this.options&&this.options.theme){this.explicitTheme=this.options.theme;try{if(this.explicitTheme.axis){const c2=color(this.explicitTheme.axis);if(c2){const luminanceA=(.2126*c2.r+.7152*c2.g+.0722*c2.b)/255;this.isDark=luminanceA<=.5}}}catch(e){}}try{const theme=this.isDark?"dark":"light";if(this.svg.attr("data-d3po-theme",theme),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-theme",theme),this.explicitTheme)try{this.explicitTheme.axis&&(this.svg.attr("data-d3po-axis",this.explicitTheme.axis),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-axis",this.explicitTheme.axis)),this.explicitTheme.tooltips&&(this.svg.attr("data-d3po-tooltips",this.explicitTheme.tooltips),this.container&&this.container.setAttribute&&this.container.setAttribute("data-d3po-tooltips",this.explicitTheme.tooltips))}catch(e){}}catch(e){}try{this._injectThemeStyles()}catch(e){}try{if(this.explicitTheme&&this.explicitTheme.axis&&this.svg&&this.svg.node){this._applyExplicitAxisColors(this.explicitTheme.axis);const svgNode2=this.svg.node(),mo=new MutationObserver(muts=>{this._applyExplicitAxisColors(this.explicitTheme.axis)});mo.observe(svgNode2,{childList:!0,subtree:!0}),this._axisMutationObserver=mo}}catch(e){}if(this.options.title){const t=this.svg.append("text").attr("class","title").attr("x",this.options.width/2).attr("y",this.options.margin.top/2).attr("text-anchor","middle").style("font-size",1.5*this.options.fontSize+"px").style("font-weight","bold").text(this.options.title);try{this.explicitTheme&&this.explicitTheme.axis?t.style("fill",this.explicitTheme.axis):t.style("fill",this.isDark?"#eee":"#111")}catch(e){}}this.chart=this.svg.append("g").attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`),this.options.download&&this._addDownloadButtons()}_injectThemeStyles(){const id2="d3po-explicit-theme-styles",existing=document.getElementById(id2);existing&&existing.remove();const style=document.createElement("style");style.id=id2;const explicitAxis=this.explicitTheme&&this.explicitTheme.axis||null,explicitTooltips=this.explicitTheme&&this.explicitTheme.tooltips||null,lightAxis=explicitAxis||"#333",darkAxis=explicitAxis||"rgba(255,255,255,0.85)",lightText=explicitAxis||"#111",darkText=explicitAxis||"#eee",tooltipBg=explicitTooltips||(this.isDark?"#252543":"white"),tooltipText=explicitTooltips?"white"===getTextColor(tooltipBg)?"#eee":"#111":this.isDark?"#eee":"#333";style.textContent=`\n      /* Axis and ticks */\n      [data-d3po-theme="light"] .axis path,\n      [data-d3po-theme="light"] .axis line,\n      [data-d3po-theme="light"] g.tick line,\n      [data-d3po-theme="light"] path.domain {\n        stroke: ${lightAxis} !important;\n      }\n      [data-d3po-theme="light"] g.tick text,\n      [data-d3po-theme="light"] .x-axis-label,\n      [data-d3po-theme="light"] .y-axis-label,\n  [data-d3po-theme="light"] .title,\n  [data-d3po-theme="light"] .treemap-subtitle,\n  [data-d3po-theme="light"] .treemap-back {\n        fill: ${lightText} !important;\n      }\n\n      [data-d3po-theme="dark"] .axis path,\n      [data-d3po-theme="dark"] .axis line,\n      [data-d3po-theme="dark"] g.tick line,\n      [data-d3po-theme="dark"] path.domain {\n        stroke: ${darkAxis} !important;\n      }\n      [data-d3po-theme="dark"] g.tick text,\n      [data-d3po-theme="dark"] .x-axis-label,\n      [data-d3po-theme="dark"] .y-axis-label,\n  [data-d3po-theme="dark"] .title,\n  [data-d3po-theme="dark"] .treemap-subtitle,\n  [data-d3po-theme="dark"] .treemap-back {\n        fill: ${darkText} !important;\n      }\n\n      /* Force menu/tooltip text color for SVG-attached menus */\n      .d3po-menu text { fill: ${tooltipText} !important; }\n      .d3po-menu rect { fill: ${tooltipBg} !important; }\n    `,document.head.appendChild(style)}_applyExplicitAxisColors(color2){try{if(!color2||!this.svg)return;const svgNode2=this.svg.node();if(!svgNode2)return;svgNode2.querySelectorAll(".axis path, .axis line, g.tick line, path.domain").forEach(el=>{try{el.setAttribute("stroke",color2),el.style.stroke=color2}catch(e){}});svgNode2.querySelectorAll("g.tick text, .x-axis-label, .y-axis-label, .title").forEach(el=>{try{el.setAttribute("fill",color2),el.style.fill=color2}catch(e){}})}catch(e){}}_addDownloadButtons(){const self2=this,buttonGroup=this.svg.append("g").attr("class","d3po-download-buttons").attr("transform",`translate(${this.options.width-40}, 20)`),hamburger=buttonGroup.append("g").attr("class","d3po-hamburger").style("cursor","pointer");hamburger.append("rect").attr("x",-12).attr("y",-12).attr("width",24).attr("height",24).style("fill","transparent").style("stroke","none");[-4,0,4].forEach(y2=>{hamburger.append("line").attr("x1",-6).attr("x2",6).attr("y1",y2).attr("y2",y2).style("stroke","#666").style("stroke-width","2px").style("stroke-linecap","round").style("pointer-events","none")});const menu=buttonGroup.append("g").attr("class","d3po-menu").attr("transform","translate(-80, 20)").style("opacity",0).style("pointer-events","none"),tooltipBg=this.explicitTheme&&this.explicitTheme.tooltips||(this.isDark?"#252543":"white");let tooltipStroke;try{tooltipStroke=this.explicitTheme&&this.explicitTheme.tooltips?color(tooltipBg).darker(.8).toString():this.isDark?"rgba(255,255,255,0.08)":"#999"}catch(e){tooltipStroke=this.isDark?"rgba(255,255,255,0.08)":"#999"}const tooltipTextColor=this.explicitTheme&&this.explicitTheme.tooltips?"white"===getTextColor(tooltipBg)?"#eee":"#111":this.isDark?"#eee":"#333";menu.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",60).attr("rx",4).style("fill",tooltipBg).style("stroke",tooltipStroke).style("stroke-width","1px").style("filter","drop-shadow(0 2px 4px rgba(0,0,0,0.2))");const svgItem=menu.append("g").attr("class","d3po-menu-item").attr("transform","translate(0, 0)").style("cursor","pointer");svgItem.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",30).style("fill","transparent"),svgItem.append("text").attr("x",10).attr("y",20).style("font-size","12px").style("fill",tooltipTextColor).style("user-select","none").text(" SVG"),svgItem.on("click",function(event){event.stopPropagation(),self2.downloadSVG(),self2._hideMenu()}).on("mouseover",function(){try{const hoverFill=self2.explicitTheme&&self2.explicitTheme.tooltips?color(tooltipBg).brighter(.5).toString():self2.isDark?"#3a3a5a":"#f0f0f0";select(this).select("rect").style("fill",hoverFill)}catch(e){select(this).select("rect").style("fill","#f0f0f0")}}).on("mouseout",function(){select(this).select("rect").style("fill","transparent")});const pngItem=menu.append("g").attr("class","d3po-menu-item").attr("transform","translate(0, 30)").style("cursor","pointer");pngItem.append("rect").attr("x",0).attr("y",0).attr("width",90).attr("height",30).style("fill","transparent"),pngItem.append("text").attr("x",10).attr("y",20).style("font-size","12px").style("fill",tooltipTextColor).style("user-select","none").text(" PNG"),pngItem.on("click",function(event){event.stopPropagation(),self2.downloadPNG(),self2._hideMenu()}).on("mouseover",function(){try{const hoverFill=self2.explicitTheme&&self2.explicitTheme.tooltips?color(tooltipBg).brighter(.5).toString():self2.isDark?"#3a3a5a":"#f0f0f0";select(this).select("rect").style("fill",hoverFill)}catch(e){select(this).select("rect").style("fill","#f0f0f0")}}).on("mouseout",function(){select(this).select("rect").style("fill","transparent")}),hamburger.on("mouseenter",function(event){event.stopPropagation(),select(this).selectAll("line").style("stroke","#333"),self2._showMenu()}).on("mouseleave",function(){select(this).selectAll("line").style("stroke","#666"),setTimeout(()=>{self2._isMouseOverMenu||self2._hideMenu()},100)}),menu.on("mouseenter",function(){self2._isMouseOverMenu=!0}).on("mouseleave",function(){self2._isMouseOverMenu=!1,self2._hideMenu()}),this._isMouseOverMenu=!1,this.menu=menu}_showMenu(){this.menu&&this.menu.transition().duration(200).style("opacity",1).style("pointer-events","all")}_hideMenu(){this.menu&&this.menu.transition().duration(200).style("opacity",0).style("pointer-events","none")}getInnerWidth(){return this.options.width-this.options.margin.left-this.options.margin.right}getInnerHeight(){return this.options.height-this.options.margin.top-this.options.margin.bottom}setData(data){return validateData(data,[]),this.data=data,this}setTitle(title){return this.options.title=title,this.svg.select(".title").text(title),this}setBackground(color2){return this.options.background=color2,this.svg.style("background",color2),this}setFont(fontFamily,fontSize){return this.options.fontFamily=fontFamily,this.options.fontSize=fontSize,this.svg.style("font-family",fontFamily).style("font-size",`${fontSize}px`),this}setDownload(show){return this.options.download=show,this.svg.select(".d3po-download-buttons").remove(),show&&this._addDownloadButtons(),this}downloadSVG(){try{const clonedSvg=this.svg.node().cloneNode(!0);clonedSvg.setAttribute("xmlns","http://www.w3.org/2000/svg"),clonedSvg.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const downloadButtons=clonedSvg.querySelector(".d3po-download-buttons");downloadButtons&&downloadButtons.remove();const svgData='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+(new XMLSerializer).serializeToString(clonedSvg);triggerDownload(new Blob([svgData],{type:"image/svg+xml;charset=utf-8"}),"d3po-chart.svg")}catch(error){console.error("Error in downloadSVG:",error),alert("Failed to download SVG: "+error.message)}}downloadPNG(){try{const clonedSvg=this.svg.node().cloneNode(!0);clonedSvg.setAttribute("xmlns","http://www.w3.org/2000/svg"),clonedSvg.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const downloadButtons=clonedSvg.querySelector(".d3po-download-buttons");downloadButtons&&downloadButtons.remove();const svgData=(new XMLSerializer).serializeToString(clonedSvg),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),img=new Image;canvas.width=this.options.width,canvas.height=this.options.height,img.onload=()=>{try{ctx.fillStyle=this.options.background||"white",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(img,0,0),canvas.toBlob(blob=>{blob?triggerDownload(blob,"d3po-chart.png"):(console.error("Failed to create blob from canvas"),alert("PNG export failed: Could not create image blob"))},"image/png")}catch(error){console.error("Error converting to PNG:",error),alert("PNG export failed: "+error.message)}},img.onerror=error=>{console.error("Failed to load SVG into image:",error),alert("PNG export failed. Please try SVG export instead.")};const base64=btoa(encodeURIComponent(svgData).replace(/%([0-9A-F]{2})/g,(match,p1)=>String.fromCharCode("0x"+p1)));img.src="data:image/svg+xml;base64,"+base64}catch(error){console.error("Error in downloadPNG:",error),alert("Failed to download PNG: "+error.message)}}render(){throw new Error("render() must be implemented by subclass")}resize(width,height){return this.options.width=width,this.options.height=height,this.chart.selectAll("*").remove(),this.svg.attr("width",width).attr("height",height),this.options.title&&this.svg.select(".title").attr("x",width/2),this.svg.select(".d3po-download-buttons").attr("transform",`translate(${width-40}, 20)`),this.data&&this.render(),this}destroy(){select(this.container).selectAll("*").remove(),this.data=null,this.svg=null,this.chart=null,this.menu=null,this._isMouseOverMenu=!1}}function identity(x2){return x2}function feature$1(topology,o){var id2=o.id,bbox=o.bbox,properties=null==o.properties?{}:o.properties,geometry=function object(topology,o){var transformPoint=function transform(transform2){if(null==transform2)return identity;var x02,y02,kx=transform2.scale[0],ky=transform2.scale[1],dx=transform2.translate[0],dy=transform2.translate[1];return function(input,i){i||(x02=y02=0);var j=2,n=input.length,output=new Array(n);for(output[0]=(x02+=input[0])*kx+dx,output[1]=(y02+=input[1])*ky+dy;j<n;)output[j]=input[j],++j;return output}}(topology.transform),arcs=topology.arcs;function arc2(i,points){points.length&&points.pop();for(var a2=arcs[i<0?~i:i],k=0,n=a2.length;k<n;++k)points.push(transformPoint(a2[k],k));i<0&&function reverse(array2,n){for(var t,j=array2.length,i=j-n;i<--j;)t=array2[i],array2[i++]=array2[j],array2[j]=t}(points,n)}function point(p){return transformPoint(p)}function line2(arcs2){for(var points=[],i=0,n=arcs2.length;i<n;++i)arc2(arcs2[i],points);return points.length<2&&points.push(points[0]),points}function ring(arcs2){for(var points=line2(arcs2);points.length<4;)points.push(points[0]);return points}function polygon(arcs2){return arcs2.map(ring)}function geometry(o2){var coordinates,type=o2.type;switch(type){case"GeometryCollection":return{type:type,geometries:o2.geometries.map(geometry)};case"Point":coordinates=point(o2.coordinates);break;case"MultiPoint":coordinates=o2.coordinates.map(point);break;case"LineString":coordinates=line2(o2.arcs);break;case"MultiLineString":coordinates=o2.arcs.map(line2);break;case"Polygon":coordinates=polygon(o2.arcs);break;case"MultiPolygon":coordinates=o2.arcs.map(polygon);break;default:return null}return{type:type,coordinates:coordinates}}return geometry(o)}(topology,o);return null==id2&&null==bbox?{type:"Feature",properties:properties,geometry:geometry}:null==bbox?{type:"Feature",id:id2,properties:properties,geometry:geometry}:{type:"Feature",id:id2,bbox:bbox,properties:properties,geometry:geometry}}const index={D3po:D3po,BoxPlot:class BoxPlot extends D3po{constructor(container,options){if(super(container,options),!options.x||!options.y)throw new Error("Box plot requires x and y fields");this.xField=options.x,this.yField=options.y,this.colorField=options.color}render(){if(!this.data)throw new Error("No data provided");validateData(this.data,[this.xField,this.yField]);const isHorizontal="string"==typeof this.data[0][this.yField],categoryField=isHorizontal?this.yField:this.xField,valueField=isHorizontal?this.xField:this.yField,formattedCols=this.options&&this.options.formattedCols?this.options.formattedCols:null,resolveFormattedField=field=>formattedCols?formattedCols[field]?formattedCols[field]:field===this.xField&&formattedCols.x?formattedCols.x:field===this.yField&&formattedCols.y?formattedCols.y:null:null;let grouped;grouped=function groupBy(data,field){return data.reduce((acc,item)=>{const key=item[field];return acc[key]||(acc[key]=[]),acc[key].push(item),acc},{})}(this.data,categoryField);const DEFAULT_PALETTE=["#74c0e2","#406662","#549e95","#8abdb6","#bcd8af","#a8c380","#ede788","#d6c650","#dc8e7a","#d05555","#bf3251","#872a41","#993f7b","#7454a6","#a17cb0","#d1a1bc","#a1aafb","#5c57d9","#1c26b3","#4d6fd0","#7485aa","#d3d3d3"],groupKeys=Object.keys(grouped);let paletteMap=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const paletteArr=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),palette=paletteArr.length?paletteArr:DEFAULT_PALETTE;paletteMap={},groupKeys.forEach((g,i)=>{paletteMap[g]=normalizeColorString(palette[i%palette.length])})}else if(!this.colorField){const palette=DEFAULT_PALETTE;paletteMap={},groupKeys.forEach((g,i)=>{paletteMap[g]=normalizeColorString(palette[i%palette.length])})}const boxData=Object.entries(grouped).map(([key,values])=>({group:key,label:(()=>{const ff=resolveFormattedField(categoryField);return ff&&void 0!==values[0][ff]?values[0][ff]:key})(),stats:calculateBoxStats(values.map(d=>d[valueField])),color:paletteMap?paletteMap[key]:this.colorField?values[0][this.colorField]:category10[0]}));let categoryScale,valueScale;const xLabelText=this.options&&(this.options.xLabel||this.options.axisLabels&&this.options.axisLabels.x)?this.options.xLabel||this.options.axisLabels.x:this.xField?String(this.xField):"",yLabelText=this.options&&(this.options.yLabel||this.options.axisLabels&&this.options.axisLabels.y)?this.options.yLabel||this.options.axisLabels.y:this.yField?String(this.yField):"";isHorizontal?(categoryScale=band().domain(boxData.map(d=>d.label)).range([0,this.getInnerHeight()]).padding(.2),valueScale=linear().domain([min$1(boxData,d=>d.stats.min),max$1(boxData,d=>d.stats.max)]).nice().range([0,this.getInnerWidth()])):(categoryScale=band().domain(boxData.map(d=>d.label)).range([0,this.getInnerWidth()]).padding(.2),valueScale=linear().domain([min$1(boxData,d=>d.stats.min),max$1(boxData,d=>d.stats.max)]).nice().range([this.getInnerHeight(),0]));let bottomAxis=null,leftAxis=null;isHorizontal?(bottomAxis=axisBottom(valueScale),this.options&&this.options.axisFormatters&&this.options.axisFormatters.x&&bottomAxis.tickFormat(this.options.axisFormatters.x),leftAxis=axisLeft(categoryScale),formattedCols&&formattedCols[categoryField]&&leftAxis.tickFormat(d=>{const found=boxData.find(b=>b.group===d);return found?found.label:d})):(bottomAxis=axisBottom(categoryScale),formattedCols&&formattedCols[categoryField]&&bottomAxis.tickFormat(d=>{const found=boxData.find(b=>b.group===d);return found?found.label:d}),this.options&&this.options.axisFormatters&&this.options.axisFormatters.x&&bottomAxis.tickFormat(this.options.axisFormatters.x),leftAxis=axisLeft(valueScale),this.options&&this.options.axisFormatters&&this.options.axisFormatters.y&&leftAxis.tickFormat(this.options.axisFormatters.y));let measuredMaxTickWidth=0,measuredLabelBBoxHeight=0,effectiveInnerWidth=this.getInnerWidth(),effectiveInnerHeight=this.getInnerHeight();const useLeftMarginSpace=this.options&&!1!==this.options.useLeftMarginSpace;try{const probe=this.svg.append("g").attr("class","d3po-probe");probe.call(leftAxis);try{const ticks2=probe.selectAll(".tick text").nodes();ticks2&&ticks2.length&&(measuredMaxTickWidth=max$1(ticks2,n=>n.getBBox().width)||0)}catch(e){}probe.remove();try{const lab=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(isHorizontal?this.xField:this.yField);measuredLabelBBoxHeight=lab.node().getBBox().height||0,lab.remove()}catch(e){measuredLabelBBoxHeight=14}const gap=void 0!==this.yLabelGap?this.yLabelGap:12,requiredLeft=Math.ceil(measuredMaxTickWidth+gap+measuredLabelBBoxHeight+8);requiredLeft>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin=this.options.margin||{},this.options.margin.left=requiredLeft,effectiveInnerWidth=this.getInnerWidth(),effectiveInnerHeight=this.getInnerHeight(),categoryScale&&categoryScale.range&&(isHorizontal?categoryScale.range([0,effectiveInnerHeight]):categoryScale.range([0,effectiveInnerWidth])),valueScale&&valueScale.range&&(isHorizontal?valueScale.range([0,effectiveInnerWidth]):valueScale.range([effectiveInnerHeight,0])),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(e){}if(useLeftMarginSpace&&measuredMaxTickWidth>0){const gap=void 0!==this.yLabelGap?this.yLabelGap:12,measuredRequiredLeft=Math.ceil(measuredMaxTickWidth+gap+measuredLabelBBoxHeight+8),marginLeft=this.options&&this.options.margin&&this.options.margin.left||60,safetyBuffer=4,targetLeft=Math.max(0,(measuredRequiredLeft||0)+safetyBuffer),delta=marginLeft-targetLeft,baseInner=this.getInnerWidth();effectiveInnerWidth=Math.max(20,Math.round(baseInner+Math.max(0,delta))),effectiveInnerHeight=this.getInnerHeight(),categoryScale&&categoryScale.range&&(isHorizontal?categoryScale.range([0,effectiveInnerHeight]):categoryScale.range([0,effectiveInnerWidth])),valueScale&&valueScale.range&&(isHorizontal?valueScale.range([0,effectiveInnerWidth]):valueScale.range([effectiveInnerHeight,0]));const translateX2=targetLeft;this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${translateX2},${this.options.margin.top})`)}const xg=this.chart.append("g").attr("transform",`translate(0,${effectiveInnerHeight})`).call(bottomAxis);try{const xTicks=xg.selectAll(".tick text").nodes();let maxTickWidth=0,maxTickHeight=0;xTicks&&xTicks.length&&(maxTickWidth=max$1(xTicks,n=>n.getBBox().width)||0,maxTickHeight=max$1(xTicks,n=>n.getBBox().height)||0);let rotateX=!1;if(categoryScale&&categoryScale.bandwidth){maxTickWidth>.9*categoryScale.bandwidth()&&(rotateX=!0)}else if(xTicks&&xTicks.length){maxTickWidth>.9*Math.max(10,effectiveInnerWidth/xTicks.length)&&(rotateX=!0)}rotateX&&xg.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end");const xLabelPadding=Math.max(8,maxTickHeight+8);this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",effectiveInnerWidth/2).attr("y",effectiveInnerHeight+xLabelPadding+(rotateX?36:24)).style("font-size","14px").text(xLabelText)}catch(e){this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",effectiveInnerWidth/2).attr("y",effectiveInnerHeight+(isHorizontal?45:65)).style("font-size","14px").text(xLabelText)}const yg=this.chart.append("g").call(leftAxis);try{const yTicks=yg.selectAll(".tick text").nodes(),yMaxTickWidth=yTicks&&yTicks.length?max$1(yTicks,n=>n.getBBox().width):measuredMaxTickWidth,labelGap=void 0!==this.yLabelGap?this.yLabelGap:12,measuredLabelH=measuredLabelBBoxHeight||14,labelBaseline=Math.max(yMaxTickWidth+labelGap,measuredLabelH+labelGap);let labelOffset=labelBaseline+Math.min(36,Math.max(4,Math.round(.08*yMaxTickWidth)))+10;const measuredRequiredLeft=yMaxTickWidth>0?Math.ceil(yMaxTickWidth+labelGap+measuredLabelH+8):null;let maxAllowed=(this.options&&this.options.margin&&this.options.margin.left||60)-4;maxAllowed=null!=measuredRequiredLeft?Math.max(10,Math.min(maxAllowed,measuredRequiredLeft)):Math.max(10,maxAllowed),labelOffset>maxAllowed&&(labelOffset=maxAllowed),yg.append("text").attr("class","y-axis-label").attr("transform",`translate(${-labelOffset},${effectiveInnerHeight/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(yLabelText)}catch(e){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-effectiveInnerHeight/2).attr("y",isHorizontal?-70:-40).style("font-size","14px").text(yLabelText),this.options&&this.options.title&&this.chart.append("text").attr("class","title").attr("text-anchor","middle").attr("x",effectiveInnerWidth/2).attr("y",this.options.titleOffsetY?this.options.titleOffsetY:-10).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.titleFontSize?`${this.options.titleFontSize}px`:"16px").text(String(this.options.title))}const boxWidth=categoryScale.bandwidth(),boxes=this.chart.selectAll(".box").data(boxData).enter().append("g").attr("class","box").attr("transform",d=>isHorizontal?`translate(0,${categoryScale(d.label)})`:`translate(${categoryScale(d.label)},0)`);isHorizontal?(boxes.append("line").attr("x1",d=>valueScale(d.stats.whiskerMin)).attr("x2",d=>valueScale(d.stats.q1)).attr("y1",boxWidth/2).attr("y2",boxWidth/2).attr("stroke","black").attr("stroke-width",1.5),boxes.append("line").attr("x1",d=>valueScale(d.stats.q3)).attr("x2",d=>valueScale(d.stats.whiskerMax)).attr("y1",boxWidth/2).attr("y2",boxWidth/2).attr("stroke","black").attr("stroke-width",1.5),boxes.append("line").attr("x1",d=>valueScale(d.stats.whiskerMin)).attr("x2",d=>valueScale(d.stats.whiskerMin)).attr("y1",.25*boxWidth).attr("y2",.75*boxWidth).attr("stroke","black").attr("stroke-width",1.5),boxes.append("line").attr("x1",d=>valueScale(d.stats.whiskerMax)).attr("x2",d=>valueScale(d.stats.whiskerMax)).attr("y1",.25*boxWidth).attr("y2",.75*boxWidth).attr("stroke","black").attr("stroke-width",1.5),boxes.append("rect").attr("x",d=>valueScale(d.stats.q1)).attr("y",0).attr("width",d=>valueScale(d.stats.q3)-valueScale(d.stats.q1)).attr("height",boxWidth).attr("fill",d=>d.color).attr("stroke","black").attr("stroke-width",1.5).style("opacity",1),boxes.append("line").attr("x1",d=>valueScale(d.stats.median)).attr("x2",d=>valueScale(d.stats.median)).attr("y1",0).attr("y2",boxWidth).attr("stroke","black").attr("stroke-width",2),boxes.each(function(d){d.stats.min<d.stats.whiskerMin&&select(this).append("circle").attr("cx",valueScale(d.stats.min)).attr("cy",boxWidth/2).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),boxes.each(function(d){d.stats.max>d.stats.whiskerMax&&select(this).append("circle").attr("cx",valueScale(d.stats.max)).attr("cy",boxWidth/2).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),boxes.each(function(d){d.stats.outliers.forEach(outlier=>{select(this).append("circle").attr("cx",valueScale(outlier)).attr("cy",boxWidth/2).attr("r",4).attr("fill","black").style("opacity",1)})})):(boxes.append("line").attr("x1",boxWidth/2).attr("x2",boxWidth/2).attr("y1",d=>valueScale(d.stats.whiskerMax)).attr("y2",d=>valueScale(d.stats.q3)).attr("stroke","black").attr("stroke-width",1.5),boxes.append("line").attr("x1",boxWidth/2).attr("x2",boxWidth/2).attr("y1",d=>valueScale(d.stats.q1)).attr("y2",d=>valueScale(d.stats.whiskerMin)).attr("stroke","black").attr("stroke-width",1.5),boxes.append("line").attr("x1",.25*boxWidth).attr("x2",.75*boxWidth).attr("y1",d=>valueScale(d.stats.whiskerMax)).attr("y2",d=>valueScale(d.stats.whiskerMax)).attr("stroke","black").attr("stroke-width",1.5),boxes.append("line").attr("x1",.25*boxWidth).attr("x2",.75*boxWidth).attr("y1",d=>valueScale(d.stats.whiskerMin)).attr("y2",d=>valueScale(d.stats.whiskerMin)).attr("stroke","black").attr("stroke-width",1.5),boxes.append("rect").attr("x",0).attr("y",d=>valueScale(d.stats.q3)).attr("width",boxWidth).attr("height",d=>valueScale(d.stats.q1)-valueScale(d.stats.q3)).attr("fill",d=>d.color).attr("stroke","black").attr("stroke-width",1.5).style("opacity",1),boxes.append("line").attr("x1",0).attr("x2",boxWidth).attr("y1",d=>valueScale(d.stats.median)).attr("y2",d=>valueScale(d.stats.median)).attr("stroke","black").attr("stroke-width",2),boxes.each(function(d){d.stats.min<d.stats.whiskerMin&&select(this).append("circle").attr("cx",boxWidth/2).attr("cy",valueScale(d.stats.min)).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),boxes.each(function(d){d.stats.max>d.stats.whiskerMax&&select(this).append("circle").attr("cx",boxWidth/2).attr("cy",valueScale(d.stats.max)).attr("r",4).attr("fill","black").attr("stroke","white").attr("stroke-width",1)}),boxes.each(function(d){d.stats.outliers.forEach(outlier=>{select(this).append("circle").attr("cx",boxWidth/2).attr("cy",valueScale(outlier)).attr("r",4).attr("fill","black").style("opacity",1)})}));const fontFamily=this.options.fontFamily,fontSize=this.options.fontSize;var tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip);return boxes.on("mouseover",function(event,d){const rect=select(this).select("rect"),highlightColor=getHighlightColor(rect.attr("fill"));if(rect.attr("fill",highlightColor),tooltipFormatter){const fallback=()=>`<strong>${escapeHtml(d.label||d.group)}</strong>Percentile 0th (Min): ${d.stats.min.toFixed(2)}<br/>Percentile 25th: ${d.stats.q1.toFixed(2)}<br/>Percentile 50th (Median): ${d.stats.median.toFixed(2)}<br/>Percentile 75th: ${d.stats.q3.toFixed(2)}<br/>Percentile 100th (Max): ${d.stats.max.toFixed(2)}<br/>Outliers: ${d.stats.outliers.length}`;showTooltipWithFormatter(event,tooltipFormatter,null,{group:d.group,label:d.label||d.group,stats:d.stats},fontFamily,fontSize,fallback)}else{showTooltip(event,`<strong>${d.label||d.group}</strong>Percentile 0th (Min): ${d.stats.min.toFixed(2)}<br/>Percentile 25th: ${d.stats.q1.toFixed(2)}<br/>Percentile 50th (Median): ${d.stats.median.toFixed(2)}<br/>Percentile 75th: ${d.stats.q3.toFixed(2)}<br/>Percentile 100th (Max): ${d.stats.max.toFixed(2)}<br/>Outliers: ${d.stats.outliers.length}`,fontFamily,fontSize)}}).on("mouseout",function(event,d){select(this).select("rect").attr("fill",d.color),hideTooltip()}),this}},BarChart:class BarChart extends D3po{constructor(container,options){if(super(container,options),!options.x||!options.y)throw new Error("Bar chart requires x and y fields");this.xField=options.x,this.yField=options.y,this.colorField=options.color,this.groupField=options.group}render(){if(!this.data)throw new Error("No data provided");validateData(this.data,[this.xField,this.yField]);const isHorizontal="string"==typeof this.data[0][this.yField];let effectiveInnerWidth=this.getInnerWidth(),effectiveInnerHeight=this.getInnerHeight();const useLeftMarginSpace=this.options&&!1!==this.options.useLeftMarginSpace,stacked=!(!this.options||!0!==this.options.stack&&"stacked"!==this.options.type),groupField=null!=this.groupField?this.groupField:null,categoryField=isHorizontal?this.yField:this.xField,valueField=isHorizontal?this.xField:this.yField,categories=Array.from(new Set(this.data.map(d=>null==d[categoryField]?"":String(d[categoryField])))),sortSpec=this.options&&this.options.sort?String(this.options.sort):null,applyCategorySort=orderArr=>{categories.splice(0,categories.length,...orderArr)},aggregateByCategory=()=>{const m2=new Map;return this.data.forEach(d=>{const cat=null==d[categoryField]?"":String(d[categoryField]),val=Number(d[valueField])||0;m2.set(cat,(m2.get(cat)||0)+val)}),Array.from(m2.entries())};let requestedSort=null;if(sortSpec&&!stacked){const m2=sortSpec.match(/^(asc|desc)-([xy])$/);m2&&(requestedSort={dir:m2[1],axis:m2[2]})}const groups=groupField?Array.from(new Set(this.data.map(d=>null==d[groupField]?"":String(d[groupField])))):[];let groupingActive=!1;if(groupField&&!stacked){const perCat=new Map;this.data.forEach(d=>{const cat=null==d[categoryField]?"":String(d[categoryField]),g=null==d[groupField]?"":String(d[groupField]);perCat.has(cat)||perCat.set(cat,new Set),perCat.get(cat).add(g)});for(const s of perCat.values())if(s.size>1){groupingActive=!0;break}}let xScale,yScale,innerBand=null;const colorScale=function createColorScale(data,colorField,colorScale){const DEFAULT_PALETTE=["#74c0e2","#406662","#549e95","#8abdb6","#bcd8af","#a8c380","#ede788","#d6c650","#dc8e7a","#d05555","#bf3251","#872a41","#993f7b","#7454a6","#a17cb0","#d1a1bc","#a1aafb","#5c57d9","#1c26b3","#4d6fd0","#7485aa","#d3d3d3"],providedPalette=(input=>{if(!input)return null;if(Array.isArray(input))return input.length?input:null;if("object"==typeof input){const vals=Object.values(input);return vals.length?vals:null}return null})(colorField);if(providedPalette){const palette=providedPalette.length?providedPalette:DEFAULT_PALETTE,keyForRow=row=>{if(!row||"object"!=typeof row)return String(row);if(void 0!==row.group)return String(row.group);for(const k of Object.keys(row))if("string"==typeof row[k]||"number"==typeof row[k])return String(row[k]);try{return JSON.stringify(row)}catch(e){return String(row)}},mapping={};let idx=0;return data.forEach(r=>{const k=keyForRow(r);k in mapping||(mapping[k]=normalizeColorString(palette[idx%palette.length]),idx+=1)}),d=>{const k=keyForRow(d);return mapping[k]||palette[0]}}if(!colorField){const palette=DEFAULT_PALETTE,keyForRow=row=>{if(!row||"object"!=typeof row)return String(row);if(void 0!==row.group)return String(row.group);for(const k of Object.keys(row))if("string"==typeof row[k]||"number"==typeof row[k])return String(row[k]);try{return JSON.stringify(row)}catch(e){return String(row)}},mapping={};let idx=0;return data.forEach(r=>{const k=keyForRow(r);k in mapping||(mapping[k]=normalizeColorString(palette[idx%palette.length]),idx+=1)}),d=>{const k=keyForRow(d);return mapping[k]||palette[0]}}const uniqueValues=[...new Set(data.map(d=>d[colorField]))],colors2={};return uniqueValues.forEach((value,i)=>{colors2[value]=(data.find(d=>d[colorField]===value)||{}).color||colorScale(i/uniqueValues.length)}),d=>colors2[d[colorField]]||colorScale(0)}(this.data,this.colorField,viridis);let bars=null;const groupToColor=new Map;if(stacked&&groupField){this.colorField&&this.data.forEach(d=>{const g=null==d[groupField]?"":String(d[groupField]);groupToColor.has(g)||null==d[this.colorField]||groupToColor.set(g,d[this.colorField])});const stackRows=categories.map(cat=>{const obj={__cat:cat};return groups.forEach(g=>{obj[g]=0}),obj.__total=0,obj}),rowByCat=new Map(stackRows.map(r=>[r.__cat,r]));this.data.forEach(d=>{const cat=null==d[categoryField]?"":String(d[categoryField]),g=null==d[groupField]?"":String(d[groupField]),val=Number(d[valueField])||0,row=rowByCat.get(cat);row&&(row[g]=(row[g]||0)+val,row.__total=(row.__total||0)+val)});const maxTotal=max$1(stackRows,r=>r.__total)||0;if(isHorizontal?(yScale=band().domain(categories).range([0,effectiveInnerHeight]).padding(.2),xScale=linear().domain([0,maxTotal]).nice().range([0,effectiveInnerWidth])):(xScale=band().domain(categories).range([0,effectiveInnerWidth]).padding(.2),yScale=linear().domain([0,maxTotal]).nice().range([effectiveInnerHeight,0])),sortSpec){const m2=sortSpec.match(/^(asc|desc)-([xy])$/);if(m2){const dir=m2[1];stackRows.sort((a2,b)=>"desc"===dir?b.__total-a2.__total:a2.__total-b.__total);const sortedCats=stackRows.map(r=>r.__cat);if(-1!==sortedCats.indexOf("Rest of the world")){applyCategorySort(sortedCats.filter(x2=>"Rest of the world"!==x2).concat(["Rest of the world"]))}else applyCategorySort(sortedCats);isHorizontal?yScale.domain(categories):xScale.domain(categories)}}const series=stack().keys(groups)(stackRows),seriesG=this.chart.selectAll(".series").data(series).enter().append("g").attr("class","series");isHorizontal?seriesG.selectAll("rect").data(d=>d).enter().append("rect").attr("y",(d,i)=>yScale(stackRows[i].__cat)).attr("x",d=>xScale(d[0])).attr("width",d=>Math.max(0,xScale(d[1])-xScale(d[0]))).attr("height",yScale.bandwidth()).attr("fill",(d,i,nodes)=>{const parentDatum=select(nodes[i].parentNode).datum(),grp=parentDatum&&parentDatum.key?parentDatum.key:null;if(this.colorField&&groupToColor.has(grp)){const colorValue=groupToColor.get(grp);return colorScale({[this.colorField]:colorValue})}return colorScale({[this.colorField]:grp})}):seriesG.selectAll("rect").data(d=>d).enter().append("rect").attr("x",(d,i)=>xScale(stackRows[i].__cat)).attr("y",d=>yScale(d[1])).attr("height",d=>Math.max(0,yScale(d[0])-yScale(d[1]))).attr("width",xScale.bandwidth()).attr("fill",(d,i,nodes)=>{const parentDatum=select(nodes[i].parentNode).datum(),grp=parentDatum&&parentDatum.key?parentDatum.key:null;if(this.colorField&&groupToColor.has(grp)){const colorValue=groupToColor.get(grp);return colorScale({[this.colorField]:colorValue})}return colorScale({[this.colorField]:grp})}),bars=this.chart.selectAll(".series").selectAll("rect")}else if(groupingActive)isHorizontal?(xScale=linear().domain([0,max$1(this.data,d=>Number(d[valueField])||0)]).nice().range([0,effectiveInnerWidth]),yScale=band().domain(categories).range([0,effectiveInnerHeight]).padding(.12),innerBand=band().domain(groups).range([0,yScale.bandwidth()]).padding(.05)):(xScale=band().domain(categories).range([0,effectiveInnerWidth]).padding(.12),yScale=linear().domain([0,max$1(this.data,d=>Number(d[valueField])||0)]).nice().range([effectiveInnerHeight,0]),innerBand=band().domain(groups).range([0,xScale.bandwidth()]).padding(.05)),bars=this.chart.selectAll(".bar").data(this.data).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",d=>colorScale(d)),isHorizontal?bars.attr("x",0).attr("y",d=>yScale(String(null==d[categoryField]?"":d[categoryField]))+innerBand(String(null==d[groupField]?"":d[groupField]))).attr("width",d=>xScale(Number(d[valueField])||0)).attr("height",()=>innerBand.bandwidth()):bars.attr("x",d=>xScale(String(null==d[categoryField]?"":d[categoryField]))+innerBand(String(null==d[groupField]?"":d[groupField]))).attr("y",d=>yScale(Number(d[valueField])||0)).attr("width",()=>innerBand.bandwidth()).attr("height",d=>Math.max(0,effectiveInnerHeight-yScale(Number(d[valueField])||0)));else{const rowsByCat=new Map;if(this.data.forEach(d=>{const cat=null==d[categoryField]?"":String(d[categoryField]);rowsByCat.has(cat)||rowsByCat.set(cat,[]),rowsByCat.get(cat).push(d)}),requestedSort){const dir=requestedSort.dir,axis2=requestedSort.axis;if("x"===axis2){const entries=aggregateByCategory();entries.sort((a2,b)=>"desc"===dir?b[1]-a2[1]:a2[1]-b[1]);let sortedCats=entries.map(e=>e[0]);-1!==sortedCats.indexOf("Rest of the world")&&(sortedCats=sortedCats.filter(x2=>"Rest of the world"!==x2).concat(["Rest of the world"])),applyCategorySort(sortedCats)}else if("y"===axis2){const sortedCats=Array.from(categories).sort((a2,b)=>(null==a2&&(a2=""),null==b&&(b=""),a2<b?"asc"===dir?-1:1:a2>b?"asc"===dir?1:-1:0));if(-1!==sortedCats.indexOf("Rest of the world")){applyCategorySort(sortedCats.filter(x2=>"Rest of the world"!==x2).concat(["Rest of the world"]))}else applyCategorySort(sortedCats)}}isHorizontal?(xScale=linear().domain([0,max$1(this.data,d=>Number(d[this.xField])||0)]).nice().range([0,effectiveInnerWidth]),yScale=band().domain(categories).range([0,effectiveInnerHeight]).padding(.2),bars=this.chart.selectAll(".bar").data(categories).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",cat=>{const row=(rowsByCat.get(cat)||[])[0]||{};return colorScale(row)}).attr("x",0).attr("y",cat=>yScale(cat)).attr("width",cat=>{const row=(rowsByCat.get(cat)||[])[0]||{};return xScale(Number(row[this.xField])||0)}).attr("height",()=>yScale.bandwidth()),bars.each(function(cat,i,nodes){const row=(rowsByCat.get(cat)||[])[0]||{[categoryField]:cat};select(nodes[i]).datum(row)})):(xScale=band().domain(categories).range([0,effectiveInnerWidth]).padding(.2),yScale=linear().domain([0,max$1(this.data,d=>Number(d[this.yField])||0)]).nice().range([effectiveInnerHeight,0]),bars=this.chart.selectAll(".bar").data(categories).enter().append("rect").attr("class","bar").style("opacity",1).attr("fill",cat=>{const row=(rowsByCat.get(cat)||[])[0]||{};return colorScale(row)}).attr("x",cat=>xScale(cat)).attr("y",cat=>{const row=(rowsByCat.get(cat)||[])[0]||{};return yScale(Number(row[this.yField])||0)}).attr("width",()=>xScale.bandwidth()).attr("height",cat=>{const row=(rowsByCat.get(cat)||[])[0]||{};return Math.max(0,effectiveInnerHeight-yScale(Number(row[this.yField])||0))}),bars.each(function(cat,i,nodes){const row=(rowsByCat.get(cat)||[])[0]||{[categoryField]:cat};select(nodes[i]).datum(row)}))}let measuredMaxTickWidth=0,measuredLabelBBoxHeight=0;try{const probe=this.svg.append("g").attr("class","d3po-probe"),axis2=axisLeft(yScale);this.options.axisFormatters&&this.options.axisFormatters.y&&axis2.tickFormat(this.options.axisFormatters.y),probe.call(axis2);try{const ticks2=probe.selectAll(".tick text").nodes();ticks2&&ticks2.length&&(measuredMaxTickWidth=max$1(ticks2,n=>n.getBBox().width)||0)}catch(e){}probe.remove();try{const lab=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);measuredLabelBBoxHeight=lab.node().getBBox().height||0,lab.remove()}catch(e){measuredLabelBBoxHeight=14}const gap=void 0!==this.yLabelGap?this.yLabelGap:12,requiredLeft=Math.ceil(measuredMaxTickWidth+gap+measuredLabelBBoxHeight+8);requiredLeft>(this.options&&this.options.margin&&this.options.margin.left||60)&&(this.options.margin.left=requiredLeft,effectiveInnerWidth=this.getInnerWidth(),effectiveInnerHeight=this.getInnerHeight(),xScale&&xScale.range&&(xScale.bandwidth,xScale.range([0,effectiveInnerWidth])),yScale&&yScale.range&&(yScale.bandwidth?yScale.range([0,effectiveInnerHeight]):yScale.range([effectiveInnerHeight,0])),this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`))}catch(e){}if(useLeftMarginSpace&&measuredMaxTickWidth>0){const gap=void 0!==this.yLabelGap?this.yLabelGap:12,measuredRequiredLeft=Math.ceil(measuredMaxTickWidth+gap+measuredLabelBBoxHeight+8),marginLeft=this.options&&this.options.margin&&this.options.margin.left||60,safetyBuffer=4,targetLeft=Math.max(0,(measuredRequiredLeft||0)+safetyBuffer),delta=marginLeft-targetLeft,baseInner=this.getInnerWidth();effectiveInnerWidth=Math.max(20,Math.round(baseInner+Math.max(0,delta))),xScale&&xScale.range&&(xScale.bandwidth,xScale.range([0,effectiveInnerWidth])),yScale&&yScale.range&&(yScale.bandwidth?yScale.range([0,effectiveInnerHeight]):yScale.range([effectiveInnerHeight,0]));const translateX2=targetLeft;this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${translateX2},${this.options.margin.top})`)}const fontFamily=this.options.fontFamily,fontSize=this.options.fontSize,tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip),sanitizeTooltipElement=(tooltipSel,stripAllNumeric=!1)=>{if(!tooltipSel||!tooltipSel.node)return;const node=tooltipSel.node();if(node)try{const isNumericIndexText=txt=>{if(!txt)return!1;const t=String(txt).trim();return""!==t&&(!!/^\d+[.)]?$/.test(t)||!!/^-?\d+(?:\.\d+)?$/.test(t))};if(stripAllNumeric){const removeIfNumeric=el=>{if(!el||!el.childNodes)return;const children2=Array.from(el.childNodes);for(const child of children2){const txt=(child.textContent||"").trim();if(""===txt||isNumericIndexText(txt))try{el.removeChild(child)}catch(e){}else 1===child.nodeType&&child.childNodes&&child.childNodes.length&&removeIfNumeric(child)}};for(removeIfNumeric(node);node.firstChild&&""===(node.firstChild.textContent||"").trim();)node.removeChild(node.firstChild);return}for(;node.firstChild;){const first=node.firstChild,txt=(first.textContent||"").trim();if(""!==txt){if(!isNumericIndexText(txt))break;for(node.removeChild(first);node.firstChild&&""===(node.firstChild.textContent||"").trim();)node.removeChild(node.firstChild)}else node.removeChild(first)}}catch(e){}},toTitleCase=s=>{if(null==s)return s;return String(s).replace(/\w\S*/g,txt=>txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase())},maybeFormat=v=>"number"==typeof v&&Number.isFinite(v)?v.toFixed(2):v,xField=this.xField,yField=this.yField,colorFieldName=this.colorField,includeGroupInTooltip=null!=groupField&&(groupingActive||stacked);bars.on("mouseover",function(event,d){let row=d,seriesKey=null,stackValue2=null;if(Array.isArray(d)&&d.data){row=d.data;const parent=select(this.parentNode).datum();seriesKey=parent&&parent.key?parent.key:null,stackValue2=d[1]-d[0]}const baseColor=select(this).attr("fill");if(select(this).attr("fill",getHighlightColor(baseColor)),tooltipFormatter){const tt=showTooltipWithFormatter(event,(value,r)=>{const out=tooltipFormatter(value,r);return"string"==typeof out?"string"!=typeof(html=out)?html:html=(html=html.replace(/^(?:\s*\d+(?:[.)]\s*)?\r?\n)+/,"")).replace(/^\s*\r?\n+/,""):out;var html},null,row,fontFamily,fontSize,()=>{let categoryVal,groupVal=null;seriesKey?groupVal=seriesKey:includeGroupInTooltip&&groupField&&row&&groupField in row&&(groupVal=row[groupField]),null!=groupVal&&""===String(groupVal).trim()&&(groupVal=null),categoryVal=stacked&&row&&null!=row.__cat?row.__cat:row&&row[isHorizontal?yField:xField];let measureVal;measureVal=stacked&&null!=stackValue2?stackValue2:row&&row[isHorizontal?xField:yField];const lines=[];return groupVal?lines.push(`<strong>${escapeHtml(String(categoryVal))}</strong> ${escapeHtml(String(toTitleCase(groupVal)))}`):lines.push(`<strong>${escapeHtml(String(categoryVal))}</strong>`),lines.push(`Value: ${escapeHtml(String(maybeFormat(measureVal)))}`),lines.join("<br/>")});sanitizeTooltipElement(tt,!includeGroupInTooltip)}else{let categoryVal;categoryVal=stacked&&row&&null!=row.__cat?row.__cat:row&&row[isHorizontal?yField:xField];let measureVal;measureVal=stacked&&null!=stackValue2?stackValue2:row&&row[isHorizontal?xField:yField];let groupVal=null;seriesKey?groupVal=seriesKey:includeGroupInTooltip&&groupField&&row&&groupField in row&&(groupVal=row[groupField]),null!=groupVal&&""===String(groupVal).trim()&&(groupVal=null);const lines=[];groupVal?lines.push(`<strong>${escapeHtml(String(categoryVal))}</strong> ${escapeHtml(String(toTitleCase(groupVal)))}`):lines.push(`<strong>${escapeHtml(String(categoryVal))}</strong>`),lines.push(`Value: ${escapeHtml(String(maybeFormat(measureVal)))}`);const tt2=showTooltip(event,lines.join("<br/>"),fontFamily,fontSize);sanitizeTooltipElement(tt2,!includeGroupInTooltip)}}).on("mouseout",function(){const bound=select(this).datum();if(Array.isArray(bound)&&bound.data){const parent=select(this.parentNode).datum(),seriesKey=parent&&parent.key?parent.key:null;if(stacked&&groupField&&colorFieldName&&groupToColor&&groupToColor.has(seriesKey)){const colorValue=groupToColor.get(seriesKey),restoreObj={};restoreObj[colorFieldName]=colorValue,select(this).attr("fill",colorScale(restoreObj))}else{const restoreObj={};restoreObj[colorFieldName]=seriesKey,select(this).attr("fill",colorScale(restoreObj))}}else select(this).attr("fill",colorScale(bound));hideTooltip()});let xAxis=axisBottom(xScale),yAxis=axisLeft(yScale);this.options.axisFormatters&&this.options.axisFormatters.x&&xAxis.tickFormat(this.options.axisFormatters.x),this.options.axisFormatters&&this.options.axisFormatters.y&&yAxis.tickFormat(this.options.axisFormatters.y);const xg=this.chart.append("g").attr("transform",`translate(0,${effectiveInnerHeight})`).call(xAxis);try{const xTicks=xg.selectAll(".tick text").nodes();let maxTickWidth=0,maxTickHeight=0;xTicks&&xTicks.length&&(maxTickWidth=max$1(xTicks,n=>n.getBBox().width)||0,maxTickHeight=max$1(xTicks,n=>n.getBBox().height)||0);let rotateX=!1;if(xScale.bandwidth){maxTickWidth>.9*xScale.bandwidth()&&(rotateX=!0)}else if(xTicks&&xTicks.length){maxTickWidth>.9*Math.max(10,effectiveInnerWidth/xTicks.length)&&(rotateX=!0)}rotateX&&xg.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end");const xLabelPadding=Math.max(8,maxTickHeight+8);this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",effectiveInnerWidth/2).attr("y",effectiveInnerHeight+xLabelPadding+(rotateX?36:24)).style("font-size","14px").text(this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"")}catch(e){}const yg=this.chart.append("g").call(yAxis);try{const yTicks=yg.selectAll(".tick text").nodes(),yMaxTickWidth=yTicks&&yTicks.length?max$1(yTicks,n=>n.getBBox().width):measuredMaxTickWidth,labelGap=void 0!==this.yLabelGap?this.yLabelGap:12,measuredLabelH=measuredLabelBBoxHeight||14,labelBaseline=Math.max(yMaxTickWidth+labelGap,measuredLabelH+labelGap);let labelOffset=labelBaseline+Math.min(36,Math.max(4,Math.round(.08*yMaxTickWidth)))+10;const measuredRequiredLeft=yMaxTickWidth>0?Math.ceil(yMaxTickWidth+labelGap+measuredLabelH+8):null;let maxAllowed=(this.options&&this.options.margin&&this.options.margin.left||60)-4;maxAllowed=null!=measuredRequiredLeft?Math.max(10,Math.min(maxAllowed,measuredRequiredLeft)):Math.max(10,maxAllowed),labelOffset>maxAllowed&&(labelOffset=maxAllowed),yg.append("text").attr("class","y-axis-label").attr("transform",`translate(${-labelOffset},${effectiveInnerHeight/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"")}catch(e){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-effectiveInnerHeight/2).attr("y",-40).attr("fill","black").style("font-size","14px").text(this.yField)}return this}},Treemap:class Treemap extends D3po{constructor(container,options){if(super(container,options),!options.size||!options.group)throw new Error("Treemap requires size and group fields");this.sizeField=options.size,this.groupField=options.group,this.colorField=options.color,this.subgroupField=options.subgroup,"string"==typeof options.tile?this.tile="binary"===options.tile?binary:squarify:this.tile=options.tile||squarify,this.labels=options.labels&&"object"==typeof options.labels?options.labels:{align:"left",valign:"top"},this.labelsOption=null,options.labels&&(this.labelsOption=options.labels.fields||options.labels.formatter||options.labels),this.labelsFormatter=maybeEvalJSFormatter(this.labelsOption),this.labelMode=options.labelMode||"percent",this.subtitleOption=options.labels&&options.labels.subtitle?options.labels.subtitle:null,this.subtitleFormatter=maybeEvalJSFormatter(this.subtitleOption),this.getSubtitleText=(mode,node)=>{if(this.subtitleFormatter)try{const ctx={mode:mode,nodeName:node&&node.data&&node.data.name?node.data.name:null,groupField:this.groupField,subgroupField:this.subgroupField},out=this.subtitleFormatter(null,ctx);if(null!=out)return out}catch(err){console.error("Subtitle formatter error",err)}return"aggregated"===mode||"flat"===mode?this.groupField:this.subgroupField||this.groupField},this.tooltipFormatter=resolveTooltipFormatter(this.tooltip,options&&options.tooltip)}render(){if(!this.data)throw new Error("No data provided");let hierarchyData;if(validateData(this.data,[this.sizeField,this.groupField]),this.subgroupField){const map2=new Map;this.data.forEach(d=>{const g=d[this.groupField],sg=d[this.subgroupField]||"None",color2=this.colorField?d[this.colorField]:null,key=`${g}|||${sg}`;map2.has(key)||map2.set(key,{group:g,subgroup:sg,color:color2,value:0,rows:[]});const entry=map2.get(key);entry.value+=Number(d[this.sizeField])||0,entry.rows.push(d)});const groups=new Map;for(const entry of map2.values())groups.has(entry.group)||groups.set(entry.group,{name:entry.group,children:[]}),groups.get(entry.group).children.push({name:entry.subgroup,value:entry.value,color:entry.color,__rows:entry.rows});hierarchyData={children:Array.from(groups.values())}}else hierarchyData={children:this.data.map(d=>({name:d[this.groupField],value:d[this.sizeField],color:this.colorField?d[this.colorField]:null,__row:d}))};const fullRoot=hierarchy(hierarchyData).sum(d=>d.value),treemap=index$1().tile(this.tile).size([this.getInnerWidth(),this.getInnerHeight()]).padding(2).round(!0);let groupRoot=null;if(this.subgroupField){const aggregated=hierarchyData.children.map(g=>{const sum2=(g.children||[]).reduce((s,c2)=>s+(c2.value||0),0),color2=g.children&&g.children.length&&g.children[0].color?g.children[0].color:null;return{name:g.name,value:sum2,color:color2,isAggregated:!0}});groupRoot=hierarchy({children:aggregated}).sum(d=>d.value||0),treemap(groupRoot)}treemap(fullRoot);let currentRoot=groupRoot||fullRoot;const total=fullRoot.value,getTextStroke=bgColor=>"black"===getTextColor(bgColor)?"white":"black";let initialNodes;initialNodes=this.subgroupField&&groupRoot&&groupRoot.children?groupRoot.children:fullRoot.leaves(),initialNodes.forEach(d=>{d._originalColor||(d._originalColor=d.data.color||viridis(Math.random()))});const cells=this.chart.selectAll(".cell").data(initialNodes).enter().append("g").attr("class","cell").attr("transform",d=>`translate(${d.x0},${d.y0})`);cells.append("rect").attr("width",d=>d.x1-d.x0).attr("height",d=>d.y1-d.y0).attr("fill",d=>d._originalColor).attr("stroke","white").attr("stroke-width",2).style("opacity",1),this.chart.selectAll(".treemap-subtitle").remove(),this.chart.selectAll(".treemap-back").remove();const subtitle=this.chart.append("text").attr("class","treemap-subtitle").attr("x",this.getInnerWidth()/2).attr("y",-10).attr("text-anchor","middle").attr("font-size",.9*this.options.fontSize+"px").attr("font-family",this.options.fontFamily).style("display",this.subgroupField?null:"none").text(this.groupField),backBtn=this.chart.append("text").attr("class","treemap-back").attr("x",0).attr("y",-10).attr("font-size",.9*this.options.fontSize+"px").attr("font-family",this.options.fontFamily).attr("fill","currentColor").attr("cursor","pointer").style("display","none").text(" Back").on("click",()=>{currentRoot=groupRoot||fullRoot,update(currentRoot)}),fontFamily=this.options.fontFamily,fontSize=this.options.fontSize,tooltipFormatter=this.tooltipFormatter;cells.selectAll("rect").on("mouseover",(event,d)=>{const highlightColor=getHighlightColor(d._originalColor);select(event.currentTarget).attr("fill",highlightColor);const percentageNum=d.value/total*100,percentage=percentageNum.toFixed(1);if(tooltipFormatter)try{let rowObj2=d.data&&d.data.__row?d.data.__row:d.data&&d.data.__rows?d.data.__rows[0]:null;const isAggregated2=!(!groupRoot||!(d.parent===groupRoot||d.data&&d.data.isAggregated));rowObj2||(isAggregated2?(rowObj2={[this.groupField]:d.data.name,count:d.value,color:d.data.color},rowObj2[this.groupField]=d.data.name,rowObj2.name=d.data.name):rowObj2={name:d.data.name,value:d.value,color:d.data.color}),null==rowObj2.count&&(rowObj2.count=null!=rowObj2.value?rowObj2.value:d.value);const out=tooltipFormatter(percentageNum,rowObj2);if(null!=out)return void showTooltip(event,out,fontFamily,fontSize)}catch(err){console.error("Tooltip formatter error",err)}const displayName=d.data&&d.data.name?this.subgroupField&&d.parent&&d.parent.data&&d.parent.data.name?`${d.parent.data.name} ${d.data.name}`:d.data.name:"";let rowObj=null;d.data&&d.data.__row?rowObj=d.data.__row:d.data&&d.data.__rows&&d.data.__rows.length&&(rowObj=d.data.__rows[0]);const isAggregated=!(!groupRoot||!(d.parent===groupRoot||d.data&&d.data.isAggregated));if(rowObj||(rowObj={},rowObj[this.groupField]=d.data&&d.data.name?d.data.name:null,this.subgroupField&&!isAggregated&&(rowObj[this.subgroupField]=d.data&&d.data.name?d.data.name:null),rowObj.count=d.value,rowObj.color=d.data&&d.data.color?d.data.color:null,rowObj.name=d.data&&d.data.name?d.data.name:null),null==rowObj.count&&(rowObj.count=d.value),tooltipFormatter)try{const out=tooltipFormatter(percentageNum,rowObj);if(null!=out)return void showTooltip(event,out,fontFamily,fontSize)}catch(err){console.error("Tooltip formatter error",err)}showTooltip(event,`<strong>${escapeHtml(displayName)}</strong>Value: ${escapeHtml(String(rowObj.count))}<br/>Percentage: ${percentage}%`,fontFamily,fontSize)}).on("mouseout",(event,d)=>{select(event.currentTarget).attr("fill",d._originalColor),hideTooltip()}),cells.selectAll("rect").on("click",(event,d)=>{if(groupRoot&&(d.parent===groupRoot||d.data.isAggregated)){const name=d.data.name,target=fullRoot.children.find(ch=>ch.data.name===name);return void(target&&(currentRoot=target,update(currentRoot)))}d.children&&d.children.length&&(currentRoot=d,update(currentRoot))});const update=newRoot=>{if(this.chart.selectAll(".cell").remove(),this.subgroupField&&newRoot===groupRoot){treemap(groupRoot);const nodesToShow=groupRoot.children||[];nodesToShow.forEach(d=>{d._originalColor||(d._originalColor=d.data.color||viridis(Math.random()))});const newCells2=this.chart.selectAll(".cell").data(nodesToShow).enter().append("g").attr("class","cell").attr("transform",d=>`translate(${d.x0},${d.y0})`);return newCells2.append("rect").attr("width",d=>d.x1-d.x0).attr("height",d=>d.y1-d.y0).attr("fill",d=>d._originalColor).attr("stroke","white").attr("stroke-width",2),addLabelsToCells(newCells2,1,1),newCells2.selectAll("rect").on("mouseover",(event,d)=>{const highlightColor=getHighlightColor(d._originalColor);select(event.currentTarget).attr("fill",highlightColor);const percentageNum=d.value/total*100,percentage=percentageNum.toFixed(1),displayName=d.data&&d.data.name?this.subgroupField&&d.parent&&d.parent.data&&d.parent.data.name?`${d.parent.data.name} ${d.data.name}`:d.data.name:"";if(tooltipFormatter)try{let rowObj=d.data&&d.data.__row?d.data.__row:d.data&&d.data.__rows?d.data.__rows[0]:null;const isAggregated=!(!groupRoot||!(d.parent===groupRoot||d.data&&d.data.isAggregated));rowObj||(isAggregated?(rowObj={[this.groupField]:d.data.name,count:d.value,color:d.data.color},rowObj.name=d.data.name):rowObj={name:d.data.name,value:d.value,color:d.data.color}),null==rowObj.count&&(rowObj.count=null!=rowObj.value?rowObj.value:d.value);const out=tooltipFormatter(percentageNum,rowObj);if(null!=out)return void showTooltip(event,out,fontFamily,fontSize)}catch(err){console.error("Tooltip formatter error",err)}showTooltip(event,`<strong>${escapeHtml(displayName)}</strong>Value: ${escapeHtml(String(d.value))}<br/>Percentage: ${percentage}%`,fontFamily,fontSize)}).on("mouseout",(event,d)=>{select(event.currentTarget).attr("fill",d._originalColor),hideTooltip()}).on("click",(event,d)=>{const name=d.data.name,target=fullRoot.children&&fullRoot.children.find(ch=>ch.data.name===name);target&&(currentRoot=target,update(currentRoot))}),backBtn.style("display","none"),void subtitle.text(this.getSubtitleText("aggregated",null))}if(!this.subgroupField&&newRoot===fullRoot){treemap(fullRoot);const nodesToShow=fullRoot.leaves();nodesToShow.forEach(d=>{d._originalColor||(d._originalColor=d.data.color||viridis(Math.random()))});const newCells2=this.chart.selectAll(".cell").data(nodesToShow).enter().append("g").attr("class","cell").attr("transform",d=>`translate(${d.x0},${d.y0})`);return newCells2.append("rect").attr("width",d=>d.x1-d.x0).attr("height",d=>d.y1-d.y0).attr("fill",d=>d._originalColor).attr("stroke","white").attr("stroke-width",2),addLabelsToCells(newCells2,1,1),newCells2.selectAll("rect").on("click",(event,d)=>{d.children&&d.children.length&&(currentRoot=d,update(currentRoot))}),backBtn.style("display","none"),void subtitle.text(this.getSubtitleText("flat",null))}const subtreeRoot=hierarchy(JSON.parse(JSON.stringify(newRoot.data))).sum(d=>d.value||0);treemap.size([this.getInnerWidth(),this.getInnerHeight()]),treemap(subtreeRoot);const leaves=subtreeRoot.leaves();leaves.forEach(d=>{if(!d._originalColor){const match=fullRoot.leaves().find(f=>f.data&&d.data&&f.data.name===d.data.name&&f.value===d.value);d._originalColor=match&&match._originalColor?match._originalColor:d.data&&d.data.color||viridis(Math.random())}});const newCells=this.chart.selectAll(".cell").data(leaves).enter().append("g").attr("class","cell").attr("transform",d=>`translate(${d.x0},${d.y0})`);newCells.append("rect").attr("width",d=>d.x1-d.x0).attr("height",d=>d.y1-d.y0).attr("fill",d=>d._originalColor).attr("stroke","white").attr("stroke-width",2),addLabelsToCells(newCells,1,1),newCells.selectAll("rect").on("mouseover",(event,d)=>{const highlightColor=getHighlightColor(d._originalColor);select(event.currentTarget).attr("fill",highlightColor);const percentageNum=d.value/total*100,percentage=percentageNum.toFixed(1),displayName=d.data&&d.data.name?this.subgroupField&&d.parent&&d.parent.data&&d.parent.data.name?`${d.parent.data.name} ${d.data.name}`:d.data.name:"";let rowObj=d.data&&d.data.__row?d.data.__row:d.data&&d.data.__rows?d.data.__rows[0]:null;const isAggregated=!(!groupRoot||!(d.parent===groupRoot||d.data&&d.data.isAggregated));if(rowObj||(isAggregated?(rowObj={[this.groupField]:d.data.name,count:d.value,color:d.data.color},rowObj.name=d.data.name):rowObj={name:d.data.name,value:d.value,color:d.data.color}),null==rowObj.count&&(rowObj.count=null!=rowObj.value?rowObj.value:d.value),tooltipFormatter)try{const out=tooltipFormatter(percentageNum,rowObj);if(null!=out)return void showTooltip(event,out,fontFamily,fontSize)}catch(err){console.error("Tooltip formatter error",err)}showTooltip(event,`<strong>${escapeHtml(displayName)}</strong>Value: ${escapeHtml(String(d.data.value||d.value))}<br/>Percentage: ${percentage}%`,fontFamily,fontSize)}).on("mouseout",(event,d)=>{select(event.currentTarget).attr("fill",d._originalColor),hideTooltip()}),backBtn.style("display",null),subtitle.text(this.getSubtitleText("drilled",newRoot))};this.subgroupField&&groupRoot?subtitle.text(this.getSubtitleText("aggregated",null)):subtitle.text(this.getSubtitleText("flat",null));const getLabelX=(d,align,scaleX=1)=>{const cellWidth=(d.x1-d.x0)*scaleX;switch(align){case"center":case"middle":return cellWidth/2;case"right":case"end":return cellWidth-5;default:return 5}},getLabelY=(d,valign,lineNumber=0,totalLines=2,scaleY=1)=>{const cellHeight=(d.y1-d.y0)*scaleY,lineHeight=1.4*this.options.fontSize,totalTextHeight=totalLines*lineHeight,baseY=lineNumber*lineHeight;switch(valign){case"middle":return(cellHeight-totalTextHeight)/2+this.options.fontSize+baseY;case"bottom":return cellHeight-5-lineHeight*(totalLines-lineNumber);default:return this.options.fontSize+4+baseY}},getTextAnchor=align=>{switch(align){case"center":case"middle":return"middle";case"right":case"end":return"end";default:return"start"}},labels=this.labels,addLabelsToCells=(selection2,scaleX=1,scaleY=1)=>{const self2=this;selection2.each(function(d){const group2=select(this),cellWidth=(d.x1-d.x0)*scaleX,cellHeight=(d.y1-d.y0)*scaleY,totalTextHeight=2*(1.4*self2.options.fontSize),checkTextFits=(text,lineNumber)=>{if(!labels)return!1;const x2=getLabelX(d,labels.align,scaleX),y2=getLabelY(d,labels.valign,lineNumber,2,scaleY),textAnchor=getTextAnchor(labels.align);if("middle"===labels.valign){if(totalTextHeight>cellHeight)return!1}else if(y2+self2.options.fontSize>cellHeight||y2<self2.options.fontSize)return!1;const tempText=self2.chart.append("text").attr("x",x2).attr("y",y2).text(text).attr("font-size",`${self2.options.fontSize}px`).attr("font-family",self2.options.fontFamily).attr("font-weight","bold").attr("text-anchor",textAnchor).style("visibility","hidden"),bbox=tempText.node().getBBox();tempText.remove();let left2,right2;return"start"===textAnchor?(left2=x2,right2=x2+bbox.width):"end"===textAnchor?(left2=x2-bbox.width,right2=x2):(left2=x2-bbox.width/2,right2=x2+bbox.width/2),left2>=5&&right2<=cellWidth-5},truncateToFit=(text,lineNumber)=>{if(!text)return"";if(checkTextFits(text,lineNumber))return text;let low=0,high=text.length,best="";for(;low<high;){const mid=Math.ceil((low+high)/2),candidate=text.slice(0,mid).trim()+"...";checkTextFits(candidate,lineNumber)?(best=candidate,low=mid):high=mid-1}if(!best)for(let i=Math.min(text.length,20);i>0;i--){const candidate=text.slice(0,i).trim()+"...";if(checkTextFits(candidate,lineNumber)){best=candidate;break}}return best||""};let rowObj=d.data&&d.data.__row?d.data.__row:d.data&&d.data.__rows?d.data.__rows[0]:null;const isAggregated=!(!groupRoot||!(d.parent===groupRoot||d.data&&d.data.isAggregated));rowObj||(rowObj={},rowObj[self2.groupField]=d.data&&d.data.name?d.data.name:null,self2.subgroupField&&!isAggregated&&(rowObj[self2.subgroupField]=d.data&&d.data.name?d.data.name:null),rowObj.count=d.value,rowObj.color=d.data&&d.data.color?d.data.color:null,rowObj.name=d.data&&d.data.name?d.data.name:null),null==rowObj.count&&(rowObj.count=null!=rowObj.value?rowObj.value:d.value);let categoryName=d.data.name;self2.subgroupField&&d.parent&&d.parent.data&&d.parent.data.name&&(categoryName=`${d.parent.data.name} ${d.data.name}`);const percentage=(d.value/total*100).toFixed(1)+"%",countText=null!=d.data.value?d.data.value.toLocaleString():"";if(self2.labelsFormatter)try{const labOut=self2.labelsFormatter(d.value/total*100,rowObj);if(null!=labOut){let lines=[];if(lines=Array.isArray(labOut)?labOut.map(String):"string"==typeof labOut?labOut.split(/<br\s*\/?\s*>/i).map(s=>s.replace(/<[^>]*>/g,"").trim()).filter(Boolean):[String(labOut)],lines.length>0){const localTotalLines=Math.max(1,lines.length);for(let i=0;i<lines.length;i++){const text=lines[i];if(text)if(checkTextFits(text,i))group2.append("text").attr("x",getLabelX(d,labels.align,scaleX)).attr("y",getLabelY(d,labels.valign,i,localTotalLines,scaleY)).text(text).attr("font-size",`${self2.options.fontSize}px`).attr("font-family",self2.options.fontFamily).attr("font-weight","bold").attr("text-anchor",getTextAnchor(labels.align)).attr("fill",getTextColor(d.data.color||"#999")).attr("stroke",getTextStroke(d.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none");else{const t=truncateToFit(text,i);t&&group2.append("text").attr("x",getLabelX(d,labels.align,scaleX)).attr("y",getLabelY(d,labels.valign,i,localTotalLines,scaleY)).text(t).attr("font-size",`${self2.options.fontSize}px`).attr("font-family",self2.options.fontFamily).attr("font-weight","bold").attr("text-anchor",getTextAnchor(labels.align)).attr("fill",getTextColor(d.data.color||"#999")).attr("stroke",getTextStroke(d.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none")}}return}}}catch(err){console.error("Labels formatter error",err)}const tryAndAppendLabel=text=>{if(!text)return!1;if(checkTextFits(text,0))return group2.append("text").attr("x",getLabelX(d,labels.align,scaleX)).attr("y",getLabelY(d,labels.valign,0,2,scaleY)).text(text).attr("font-size",`${self2.options.fontSize}px`).attr("font-family",self2.options.fontFamily).attr("font-weight","bold").attr("text-anchor",getTextAnchor(labels.align)).attr("fill",getTextColor(d.data.color||"#999")).attr("stroke",getTextStroke(d.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none"),!0;const truncated=truncateToFit(text,0);return!!truncated&&(group2.append("text").attr("x",getLabelX(d,labels.align,scaleX)).attr("y",getLabelY(d,labels.valign,0,2,scaleY)).text(truncated).attr("font-size",`${self2.options.fontSize}px`).attr("font-family",self2.options.fontFamily).attr("font-weight","bold").attr("text-anchor",getTextAnchor(labels.align)).attr("fill",getTextColor(d.data.color||"#999")).attr("stroke",getTextStroke(d.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none"),!0)};if(!tryAndAppendLabel(categoryName)){const punctMatch=categoryName&&categoryName.split(/[,;]+/)[0];if(!tryAndAppendLabel(punctMatch&&punctMatch.trim()&&punctMatch.trim().length<categoryName.length?`${punctMatch.trim()}...`:null)){const words=categoryName?categoryName.trim().split(/\s+/):[];if(words.length>1){tryAndAppendLabel(`${words.slice(0,2).join(" ")}...`)}}}const secondLine="count"===self2.labelMode?countText:percentage;secondLine&&checkTextFits(secondLine,1)&&group2.append("text").attr("x",getLabelX(d,labels.align,scaleX)).attr("y",getLabelY(d,labels.valign,1,2,scaleY)).text(secondLine).attr("font-size",`${self2.options.fontSize}px`).attr("font-family",self2.options.fontFamily).attr("font-weight","bold").attr("text-anchor",getTextAnchor(labels.align)).attr("fill",getTextColor(d.data.color||"#999")).attr("stroke",getTextStroke(d.data.color||"#999")).attr("stroke-width",0).attr("paint-order","stroke").attr("pointer-events","none")})};return addLabelsToCells(cells,1,1),this}},PieChart:class PieChart extends D3po{constructor(container,options){if(super(container,options),!options.size||!options.group)throw new Error("Pie chart requires size and group fields");this.sizeField=options.size,this.groupField=options.group,this.colorField=options.color,this.donut=options.donut||!1,this.innerRadiusRatio=void 0!==options.innerRadius?options.innerRadius:this.donut?.5:0,this.startAngle=void 0!==options.startAngle?options.startAngle:0,this.endAngle=void 0!==options.endAngle?options.endAngle:2*Math.PI,this.labelMode=options.labelMode||"percent"}render(){if(!this.data)throw new Error("No data provided");validateData(this.data,[this.sizeField,this.groupField]);const width=this.getInnerWidth(),height=this.getInnerHeight();if(width<=0||height<=0||isNaN(width)||isNaN(height))return console.error("Invalid chart dimensions:",{width:width,height:height}),this;const radius=Math.min(width,height)/2,totalAngle=this.endAngle-this.startAngle,isHalfChart=totalAngle<=Math.PI,centerX=this.options.margin.left+width/2;let centerY;centerY=isHalfChart?this.startAngle<0&&this.endAngle>0?this.options.margin.top+radius:this.startAngle>=0&&this.endAngle<=Math.PI?this.options.margin.top+height-radius:this.options.margin.top+height/2:this.options.margin.top+height/2,this.chart.attr("transform",`translate(${centerX},${centerY})`),this.options&&this.options.title&&this.chart.append("text").attr("class","title").attr("text-anchor","middle").attr("x",0).attr("y",this.options.titleOffsetY?this.options.titleOffsetY:-radius-10).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.titleFontSize?`${this.options.titleFontSize}px`:this.options&&this.options.fontSize?`${Number(this.options.fontSize)+2}px`:"16px").text(String(this.options.title));const pie$1=function pie(){var value=identity$2,sortValues=descending,sort=null,startAngle=constant$1(0),endAngle=constant$1(tau),padAngle=constant$1(0);function pie2(data){var i,j,k,a1,v,n=(data=array(data)).length,sum2=0,index2=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(tau,Math.max(-tau,endAngle.apply(this,arguments)-a0)),p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1);for(i=0;i<n;++i)(v=arcs[index2[i]=i]=+value(data[i],i,data))>0&&(sum2+=v);for(null!=sortValues?index2.sort(function(i2,j2){return sortValues(arcs[i2],arcs[j2])}):null!=sort&&index2.sort(function(i2,j2){return sort(data[i2],data[j2])}),i=0,k=sum2?(da-n*pa)/sum2:0;i<n;++i,a0=a1)j=index2[i],a1=a0+((v=arcs[j])>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p};return arcs}return pie2.value=function(_){return arguments.length?(value="function"==typeof _?_:constant$1(+_),pie2):value},pie2.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie2):sortValues},pie2.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie2):sort},pie2.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant$1(+_),pie2):startAngle},pie2.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant$1(+_),pie2):endAngle},pie2.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:constant$1(+_),pie2):padAngle},pie2}().value(d=>d[this.sizeField]).sort(null).startAngle(this.startAngle).endAngle(this.endAngle),arc$1=arc().innerRadius(radius*this.innerRadiusRatio).outerRadius(radius),labelArc=arc().innerRadius(.7*radius).outerRadius(.7*radius),groupField=this.groupField,sizeField=this.sizeField,colorField=this.colorField,self2=this;let paletteMap=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const paletteArr=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),palette=paletteArr.length?paletteArr:null;if(palette){paletteMap={};[...new Set(this.data.map(d=>d[groupField]))].forEach((g,i)=>{paletteMap[g]=normalizeColorString(palette[i%palette.length])})}}const slices=this.chart.selectAll(".slice").data(pie$1(this.data)).enter().append("g").attr("class","slice"),arcs=slices.append("path").attr("d",arc$1).attr("fill",d=>paletteMap?paletteMap[d.data[groupField]]||Object.values(paletteMap)[0]:colorField&&"string"==typeof colorField?normalizeColorString(d.data[colorField]):viridis(Math.random())).each(function(d){d._originalColor=paletteMap?paletteMap[d.data[groupField]]:colorField&&"string"==typeof colorField?normalizeColorString(d.data[colorField]):select(this).attr("fill")}).attr("stroke","white").attr("stroke-width",2).style("opacity",1),fontFamily=this.options.fontFamily,fontSize=this.options.fontSize;var tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip);arcs.on("mouseover",function(event,d){const highlightColor=getHighlightColor(d._originalColor);if(select(this).attr("fill",highlightColor),tooltipFormatter)try{var pct=0;try{var total=0;Array.isArray(d.data.__pie_source__)?total=d.data.__pie_source__.reduce((s,x2)=>s+(x2[sizeField]||0),0):this&&this.data?total=this.data.reduce((s,x2)=>s+(x2[sizeField]||0),0):pct=(d.endAngle-d.startAngle)/totalAngle*100,total>0&&(pct=d.data[sizeField]/total*100)}catch(e){pct=(d.endAngle-d.startAngle)/totalAngle*100}const fallback=()=>`<strong>${d.data[groupField]}</strong>Value: ${d.data[sizeField]}<br/>Percentage: ${((d.endAngle-d.startAngle)/totalAngle*100).toFixed(1)}%`;return void showTooltipWithFormatter(event,tooltipFormatter,pct,d.data,fontFamily,fontSize,fallback)}catch(e){console.warn("PieChart: tooltip formatter failed",e)}showTooltip(event,`<strong>${d.data[groupField]}</strong>Value: ${d.data[sizeField]}<br/>Percentage: ${((d.endAngle-d.startAngle)/totalAngle*100).toFixed(1)}%`,fontFamily,fontSize)}).on("mouseout",function(event,d){select(this).attr("fill",d._originalColor),hideTooltip()});return slices.append("text").attr("transform",d=>{const[x2,y2]=labelArc.centroid(d);return`translate(${x2},${y2})`}).attr("text-anchor","middle").attr("font-size","14px").attr("fill",d=>getTextColor(colorField?d.data[colorField]:"#999")).style("font-weight","bold").each(function(d){const node=select(this),percent=(d.endAngle-d.startAngle)/totalAngle*100;node.selectAll("*").remove(),"count"===self2.labelMode?(node.append("tspan").attr("x",0).attr("dy","-6").text(d.data[groupField]||""),node.append("tspan").attr("x",0).attr("dy","14").text(null!=d.data[sizeField]?d.data[sizeField].toString():"")):percent>5&&(node.append("tspan").attr("x",0).attr("dy","-6").text(d.data[groupField]||""),node.append("tspan").attr("x",0).attr("dy","14").text(`${percent.toFixed(1)}%`));try{const textWidth=node.node().getBBox().width||0,labelRadius=.7*radius;textWidth>.9*((d.endAngle-d.startAngle)*labelRadius)&&node.style("display","none")}catch(e){}}),this}},LineChart:class LineChart extends D3po{constructor(container,options){if(super(container,options),!options.x||!options.y)throw new Error("Line chart requires x and y fields");this.xField=options.x,this.yField=options.y,this.groupField=options.group,this.colorField=options.color,this.area=options.area||!1,this.stacked=options.stacked||!1}render(){if(!this.data)throw new Error("No data provided");validateData(this.data,[this.xField,this.yField]);let series=[this.data];if(this.groupField){const grouped=group(this.data,d=>d[this.groupField]);series=Array.from(grouped.values())}const innerHeight=this.options.height-this.options.margin.top-this.options.margin.bottom,yScale=linear().domain([0,max$1(this.data,d=>d[this.yField])]).nice().range([innerHeight,0]),yAxisProbe=axisLeft(yScale);this.options.axisFormatters&&this.options.axisFormatters.y&&yAxisProbe.tickFormat(this.options.axisFormatters.y);const probeGroup=this.svg.append("g").attr("class","d3po-probe-group");probeGroup.call(yAxisProbe);let maxTickWidth=0;try{const yTicksProbe=probeGroup.selectAll(".tick text").nodes();yTicksProbe&&yTicksProbe.length&&(maxTickWidth=max$1(yTicksProbe,n=>n.getBBox().width)||0)}catch(e){}probeGroup.remove();const gap=void 0!==this.yLabelGap?this.yLabelGap:12;let labelBBoxHeight=0;try{const probeLabel=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"");labelBBoxHeight=probeLabel.node().getBBox().height||0,probeLabel.remove()}catch(e){labelBBoxHeight=14}const requiredLeft=Math.ceil(maxTickWidth+gap+labelBBoxHeight+8),currentLeft=this.options&&this.options.margin&&this.options.margin.left||60;let usedLeft=Math.max(currentLeft,requiredLeft);if(usedLeft!==currentLeft){this.options.margin.left=usedLeft;try{this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`)}catch(e){}}const xScale=linear().domain(extent(this.data,d=>d[this.xField])).nice().range([0,this.getInnerWidth()]);yScale.range([this.getInnerHeight(),0]);var xAxis=axisBottom(xScale);this.options.axisFormatters&&this.options.axisFormatters.x&&xAxis.tickFormat(this.options.axisFormatters.x);var yAxis=axisLeft(yScale);this.options.axisFormatters&&this.options.axisFormatters.y&&yAxis.tickFormat(this.options.axisFormatters.y);const xg=this.chart.append("g").attr("transform",`translate(0,${this.getInnerHeight()})`).call(xAxis);let maxTickHeight=0;try{const xTicks=xg.selectAll(".tick text").nodes();xTicks&&xTicks.length&&(maxTickHeight=max$1(xTicks,n=>n.getBBox().height)||0)}catch(e){}const xLabelPadding=Math.max(8,maxTickHeight+8),xLabelText=this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"",yLabelText=this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"";xg.append("text").attr("class","x-axis-label").attr("x",this.getInnerWidth()/2).attr("y",xLabelPadding+24).attr("text-anchor","middle").style("font-size","14px").text(xLabelText);const yg=this.chart.append("g").call(yAxis);let labelOffset=maxTickWidth+(void 0!==this.yLabelGap?this.yLabelGap:12);const marginLeft=this.options&&this.options.margin&&this.options.margin.left||60,maxAllowed=Math.max(10,marginLeft-4);labelOffset>maxAllowed&&(labelOffset=maxAllowed),yg.append("text").attr("class","y-axis-label").attr("transform",`translate(${-labelOffset},${this.getInnerHeight()/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(yLabelText),this.chart.append("g").attr("class","grid").call(axisLeft(yScale).ticks(6).tickSize(-this.getInnerWidth()).tickFormat("")).attr("opacity",.08);const line$1=line().x(d=>xScale(d[this.xField])).y(d=>yScale(d[this.yField])).curve(curveLinear),area$1=area().x(d=>xScale(d[this.xField])).y0(this.getInnerHeight()).y1(d=>yScale(d[this.yField])).curve(curveLinear),colorScale=ordinal(category10).domain(series.map((_,i)=>i));let paletteMap=null;if(Array.isArray(this.colorField)||this.colorField&&"object"==typeof this.colorField){const paletteArr=Array.isArray(this.colorField)?this.colorField:Object.values(this.colorField||{}),palette=paletteArr.length?paletteArr:null;palette&&(paletteMap={},series.forEach((s,idx)=>{const groupVal=this.groupField?s[0][this.groupField]:idx;paletteMap[groupVal]=normalizeColorString(palette[idx%palette.length])}))}return series.forEach((data,i)=>{const groupValue=this.groupField?data[0][this.groupField]:i,color2=paletteMap?paletteMap[groupValue]:this.colorField?normalizeColorString(data[0][this.colorField]):colorScale(i);this.area&&this.chart.append("path").datum(data).attr("class","area").attr("d",area$1).attr("fill",color2).style("opacity",1),this.chart.append("path").datum(data).attr("class","line").attr("d",line$1).attr("fill","none").attr("stroke",color2).attr("stroke-width",2);var tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip);this.chart.selectAll(`.point-${i}`).data(data).enter().append("circle").attr("class",`point-${i}`).attr("cx",d=>xScale(d[this.xField])).attr("cy",d=>yScale(d[this.yField])).attr("r",4).attr("fill",color2).attr("stroke","#fff").attr("stroke-width",1.2).on("mouseover",(event,d)=>{const circle=select(event.currentTarget),highlightColor=getHighlightColor(color2);if(circle.raise().attr("r",8).attr("fill",highlightColor),tooltipFormatter){const fallback=()=>(this.groupField&&groupValue?`<strong>${groupValue}</strong>`:"")+`${this.xField}: ${d[this.xField]}<br/>${this.yField}: ${d[this.yField]}`;showTooltipWithFormatter(event,tooltipFormatter,null,d,this.options.fontFamily,this.options.fontSize,fallback)}else showTooltip(event,(this.groupField&&groupValue?`<strong>${groupValue}</strong>`:"")+`${this.xField}: ${d[this.xField]}<br/>${this.yField}: ${d[this.yField]}`,this.options.fontFamily,this.options.fontSize)}).on("mouseout",event=>{select(event.currentTarget).attr("r",4).attr("fill",color2),hideTooltip()})}),this}},AreaChart:class AreaChart extends D3po{constructor(container,options){if(super(container,options),!options||!options.x||!options.y)throw new Error("Area chart requires x and y fields");this.xField=options.x,this.yField=options.y,this.groupField=options.group,this.colorField=options.color}render(){if(!this.data)throw new Error("No data provided");validateData(this.data,[this.xField,this.yField]);const useStack=!(!this.options||!0!==this.options.stack&&"stacked"!==this.options.type),xVals=Array.from(new Set(this.data.map(d=>d[this.xField]))).sort((a2,b)=>a2-b),xScale=linear().domain(extent(xVals)).nice().range([0,this.getInnerWidth()]);let seriesStack=null,groups=[],yMax=max$1(this.data,d=>+d[this.yField]||0)||0;if(useStack&&this.groupField){groups=Array.from(new Set(this.data.map(d=>String(null==d[this.groupField]?"":d[this.groupField]))));const rows=xVals.map(x2=>{const r={[this.xField]:x2};return groups.forEach(g=>r[g]=0),r}),byX=new Map(rows.map(r=>[String(r[this.xField]),r]));this.data.forEach(d=>{const x2=d[this.xField],g=String(null==d[this.groupField]?"":d[this.groupField]),v=Number(d[this.yField])||0,r=byX.get(String(x2));r&&(r[g]=(r[g]||0)+v)}),seriesStack=stack().keys(groups)(rows),groups=seriesStack.map(s=>String(s.key)),yMax=max$1(rows,r=>groups.reduce((a2,g)=>a2+(r[g]||0),0))||0}const yScale=linear().domain([0,yMax]).nice().range([this.getInnerHeight(),0]),xAxis=axisBottom(xScale),yAxis=axisLeft(yScale);this.options&&this.options.axisFormatters&&(this.options.axisFormatters.x&&xAxis.tickFormat(this.options.axisFormatters.x),this.options.axisFormatters.y&&yAxis.tickFormat(this.options.axisFormatters.y));const xLabelText=this.options&&(this.options.xLabel||this.options.axisLabels&&this.options.axisLabels.x)?this.options.xLabel||this.options.axisLabels.x:this.xField?String(this.xField):"",yLabelText=this.options&&(this.options.yLabel||this.options.axisLabels&&this.options.axisLabels.y)?this.options.yLabel||this.options.axisLabels.y:this.yField?String(this.yField):"";this.chart.append("g").attr("transform",`translate(0,${this.getInnerHeight()})`).call(xAxis),this.chart.append("g").call(yAxis),xLabelText&&this.chart.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",this.getInnerWidth()/2).attr("y",this.getInnerHeight()+(this.options&&this.options.axisLabelOffsetY?this.options.axisLabelOffsetY:30)).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.fontSize?`${this.options.fontSize}px`:null).text(String(xLabelText)),yLabelText&&this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform",`translate(-40,${this.getInnerHeight()/2}) rotate(-90)`).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.fontSize?`${this.options.fontSize}px`:null).text(String(yLabelText)),this.options&&this.options.title&&this.chart.append("text").attr("class","title").attr("text-anchor","middle").attr("x",this.getInnerWidth()/2).attr("y",this.options.titleOffsetY?this.options.titleOffsetY:-10).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.titleFontSize?`${this.options.titleFontSize}px`:this.options&&this.options.fontSize?`${Number(this.options.fontSize)+2}px`:null).text(String(this.options.title));const tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip),colorScale=ordinal(category10),toTitleCase=s=>null==s?s:String(s).replace(/\w\S*/g,txt=>txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase());if(useStack&&this.groupField&&seriesStack){const stackArea=area().x(d=>xScale(d.data[this.xField])).y0(d=>yScale(d[0])).y1(d=>yScale(d[1])).curve(curveLinear);seriesStack.forEach((s,i)=>{const key=groups[i],fill=this.colorField?(this.data.find(r=>String(r[this.groupField])===key)||{})[this.colorField]:colorScale(key),stackFillOpacityExplicit=this.options&&null!=this.options.stackFillOpacity,stackTint=this.options&&null!=this.options.stackTint?Number(this.options.stackTint):.3,computedFill=stackFillOpacityExplicit?fill||colorScale(key):tintColor(fill||colorScale(key),stackTint);this.chart.append("path").datum(s).attr("d",stackArea).attr("fill",computedFill).attr("fill-opacity",stackFillOpacityExplicit?this.options.stackFillOpacity:1);const topLine=line().x(d=>xScale(d.data[this.xField])).y(d=>yScale(d[1])).curve(curveLinear);this.chart.append("path").datum(s).attr("d",topLine).attr("fill","none").attr("stroke",fill||colorScale(key)).attr("stroke-width",1.5)});const pointsLayer=this.chart.append("g").attr("class","points-layer");seriesStack.forEach((s,i)=>{const key=groups[i],fill=this.colorField?(this.data.find(r=>String(r[this.groupField])===key)||{})[this.colorField]:colorScale(key);pointsLayer.selectAll(`.point-stack-${i}`).data(s).enter().append("circle").attr("cx",d=>xScale(d.data[this.xField])).attr("cy",d=>yScale(d[1])).attr("r",4).attr("fill",fill||colorScale(key)).attr("stroke","#fff").each(function(){this.__origR=+select(this).attr("r"),this.__origFill=select(this).attr("fill")}).on("mouseover",(event,d)=>{const sel=select(event.currentTarget),baseColor=sel.attr("fill")||fill||colorScale(key);sel.raise().attr("r",8).attr("fill",getHighlightColor(baseColor));const rowObj=d.data||d;showTooltipWithFormatter(event,tooltipFormatter,null,rowObj,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`<strong>${escapeHtml(String(toTitleCase(key)))}</strong>${escapeHtml(String(toTitleCase(this.xField)))}: ${escapeHtml(String(d.data[this.xField]))}<br/>Value: ${escapeHtml(String((d[1]-d[0]).toFixed?(d[1]-d[0]).toFixed(6):d[1]-d[0]))}`)}).on("mouseout",function(){const sel=select(this);null!=this.__origR&&sel.attr("r",this.__origR),null!=this.__origFill&&sel.attr("fill",this.__origFill),hideTooltip()})})}else{let series=[this.data];if(this.groupField){const grouped=group(this.data,d=>d[this.groupField]);series=Array.from(grouped.values()),series=series.map(s=>({series:s,total:sum(s,d=>Number(d[this.yField])||0)})),series.sort((a2,b)=>b.total-a2.total),series=series.map(s=>s.series)}const area$1=area().x(d=>xScale(d[this.xField])).y0(this.getInnerHeight()).y1(d=>yScale(d[this.yField])).curve(curveLinear),line$1=line().x(d=>xScale(d[this.xField])).y(d=>yScale(d[this.yField])).curve(curveLinear);series.forEach((s,i)=>{const col=this.colorField&&s[0]?s[0][this.colorField]:colorScale(i),areaFillOpacityExplicit=this.options&&null!=this.options.areaFillOpacity,areaTint=this.options&&null!=this.options.areaTint?Number(this.options.areaTint):.12,computedAreaFill=areaFillOpacityExplicit?col:tintColor(col,areaTint);this.chart.append("path").datum(s).attr("d",area$1).attr("fill",computedAreaFill).attr("fill-opacity",areaFillOpacityExplicit?this.options.areaFillOpacity:1).attr("stroke",col).attr("stroke-width",1).style("pointer-events","none"),this.chart.append("path").datum(s).attr("d",line$1).attr("fill","none").attr("stroke",col).attr("stroke-width",1.5).style("pointer-events","none")});const pointsLayer=this.chart.append("g").attr("class","points-layer");series.forEach((s,i)=>{const col=this.colorField&&s[0]?s[0][this.colorField]:colorScale(i);pointsLayer.selectAll(`.point-${i}`).data(s).enter().append("circle").attr("cx",d=>xScale(d[this.xField])).attr("cy",d=>yScale(d[this.yField])).attr("r",4).attr("fill",col).attr("stroke","#fff").style("cursor","pointer").style("pointer-events","all").each(function(){this.__origR=+select(this).attr("r"),this.__origFill=select(this).attr("fill")}).on("mouseover",(event,d)=>{const sel=select(event.currentTarget),baseColor=sel.attr("fill")||col;sel.raise().attr("r",8).attr("fill",getHighlightColor(baseColor));showTooltipWithFormatter(event,tooltipFormatter,null,d||null,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`${this.groupField&&s[0]&&null!=s[0][this.groupField]?`<strong>${escapeHtml(String(toTitleCase(d[this.groupField]||s[0][this.groupField])))}</strong>`:""}${escapeHtml(String(toTitleCase(this.xField)))}: ${escapeHtml(String(d[this.xField]))}<br/>${escapeHtml(String(toTitleCase(this.yField)))}: ${escapeHtml(String(d[this.yField]))}`)}).on("click",(event,d)=>{showTooltipWithFormatter(event,tooltipFormatter,null,d||null,this.options&&this.options.fontFamily,this.options&&this.options.fontSize,()=>`${this.groupField&&s[0]&&null!=s[0][this.groupField]?`<strong>${escapeHtml(String(toTitleCase(d[this.groupField]||s[0][this.groupField])))}</strong><br/>`:""}${escapeHtml(String(toTitleCase(this.xField)))}: ${escapeHtml(String(d[this.xField]))}<br/>${escapeHtml(String(toTitleCase(this.yField)))}: ${escapeHtml(String(d[this.yField]))}`)}).on("mouseout",function(){const sel=select(this);null!=this.__origR&&sel.attr("r",this.__origR),null!=this.__origFill&&sel.attr("fill",this.__origFill),hideTooltip()})})}return this}},ScatterPlot:class ScatterPlot extends D3po{constructor(container,options){if(super(container,options),!options.x||!options.y)throw new Error("Scatter plot requires x and y fields");this.xField=options.x,this.yField=options.y,this.sizeField=options.size,this.groupField=options.group,this.colorField=options.color}render(){if(!this.data)throw new Error("No data provided");validateData(this.data,[this.xField,this.yField]);const innerHeight=this.options.height-this.options.margin.top-this.options.margin.bottom,yScale=linear().domain(extent(this.data,d=>d[this.yField])).nice().range([innerHeight,0]),yAxisProbe=axisLeft(yScale);this.options.axisFormatters&&this.options.axisFormatters.y&&yAxisProbe.tickFormat(this.options.axisFormatters.y);const probeGroup=this.svg.append("g").attr("class","d3po-probe-group");probeGroup.call(yAxisProbe);let maxTickWidth=0;try{const yTicksProbe=probeGroup.selectAll(".tick text").nodes();yTicksProbe&&yTicksProbe.length&&(maxTickWidth=max$1(yTicksProbe,n=>n.getBBox().width)||0)}catch(e){}probeGroup.remove();let labelBBoxHeight=0;try{const probeLabel=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);labelBBoxHeight=probeLabel.node().getBBox().height||0,probeLabel.remove()}catch(e){labelBBoxHeight=14}const gap=void 0!==this.yLabelGap?this.yLabelGap:12,requiredLeft=Math.ceil(maxTickWidth+gap+labelBBoxHeight+8),currentLeft=this.options&&this.options.margin&&this.options.margin.left||60;let usedLeft=Math.max(currentLeft,requiredLeft);if(usedLeft!==currentLeft){this.options.margin.left=usedLeft;try{this.chart&&this.chart.attr&&this.chart.attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`)}catch(e){}}const xScale=linear().domain(extent(this.data,d=>d[this.xField])).nice().range([0,this.getInnerWidth()]);yScale.range([this.getInnerHeight(),0]);const sizeScale=this.sizeField?sqrt$1().domain(extent(this.data,d=>d[this.sizeField])).range([3,20]):()=>5;var xAxis=axisBottom(xScale);this.options.axisFormatters&&this.options.axisFormatters.x&&xAxis.tickFormat(this.options.axisFormatters.x);var yAxis=axisLeft(yScale);this.options.axisFormatters&&this.options.axisFormatters.y&&yAxis.tickFormat(this.options.axisFormatters.y);const xg=this.chart.append("g").attr("transform",`translate(0,${this.getInnerHeight()})`).call(xAxis);let maxTickHeight=0;try{const xTicks=xg.selectAll(".tick text").nodes();xTicks&&xTicks.length&&(maxTickHeight=max$1(xTicks,n=>n.getBBox().height)||0)}catch(e){}const xLabelPadding=Math.max(8,maxTickHeight+8),xLabelText=this.options&&this.options.xLabel?this.options.xLabel:this.xField?String(this.xField):"",yLabelText=this.options&&this.options.yLabel?this.options.yLabel:this.yField?String(this.yField):"";this.chart.append("text").attr("class","x-axis-label").attr("x",this.getInnerWidth()/2).attr("y",this.getInnerHeight()+xLabelPadding+24).attr("text-anchor","middle").style("font-size","14px").text(xLabelText);const yg=this.chart.append("g").call(yAxis);try{const yTicks=yg.selectAll(".tick text").nodes(),yMaxTickWidth=yTicks&&yTicks.length?max$1(yTicks,n=>n.getBBox().width):0;let measuredLabelBBoxHeight=14;try{const lab=this.svg.append("text").attr("x",-9999).attr("y",-9999).style("font-size","14px").text(this.yField);measuredLabelBBoxHeight=lab.node().getBBox().height||14,lab.remove()}catch(e){measuredLabelBBoxHeight=14}const labelGap=void 0!==this.yLabelGap?this.yLabelGap:12,labelBaseline=Math.max(yMaxTickWidth+labelGap,measuredLabelBBoxHeight+labelGap);let labelOffset=labelBaseline+Math.min(36,Math.max(4,Math.round(.08*yMaxTickWidth)))+10;const measuredRequiredLeft=yMaxTickWidth>0?Math.ceil(yMaxTickWidth+labelGap+measuredLabelBBoxHeight+8):null;let maxAllowed=(this.options&&this.options.margin&&this.options.margin.left||60)-4;maxAllowed=null!=measuredRequiredLeft?Math.max(10,Math.min(maxAllowed,measuredRequiredLeft)):Math.max(10,maxAllowed),labelOffset>maxAllowed&&(labelOffset=maxAllowed),yg.append("text").attr("class","y-axis-label").attr("transform",`translate(${-labelOffset},${this.getInnerHeight()/2}) rotate(-90)`).attr("x",0).attr("y",0).attr("text-anchor","middle").style("font-size","14px").text(yLabelText)}catch(e){this.chart.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-this.getInnerHeight()/2).attr("y",-40).attr("fill","black").style("font-size","14px").text(this.yField)}const xField=this.xField,yField=this.yField,sizeField=this.sizeField,groupField=this.groupField,self2=this,circles=this.chart.selectAll(".point").data(this.data).enter().append("circle").attr("class","point").attr("cx",d=>xScale(d[xField])).attr("cy",d=>yScale(d[yField])).attr("r",d=>sizeField?sizeScale(d[sizeField]):5).each(function(d){d._originalRadius=sizeField?sizeScale(d[sizeField]):5,d._originalColor=self2.colorField?d[self2.colorField]:viridis(Math.random())}).attr("fill",d=>this.colorField?d[this.colorField]:viridis(Math.random())).attr("stroke","white").attr("stroke-width",1).style("opacity",1),fontFamily=this.options.fontFamily,fontSize=this.options.fontSize;var tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip);const maybeFormat=v=>"number"==typeof v&&Number.isFinite(v)?v.toFixed(2):v;return circles.on("mouseover",function(event,d){const highlightColor=getHighlightColor(d._originalColor);if(select(this).raise().attr("r",2*d._originalRadius).attr("fill",highlightColor),tooltipFormatter){showTooltipWithFormatter(event,tooltipFormatter,null,d,fontFamily,fontSize,()=>(groupField&&d&&d[groupField]?`<strong>${escapeHtml(String(d[groupField]))}</strong>`:"")+`${escapeHtml(String(xField))}: ${escapeHtml(String(maybeFormat(d[xField])))}<br/>${escapeHtml(String(yField))}: ${escapeHtml(String(maybeFormat(d[yField])))}`+(sizeField?`<br/>size: ${escapeHtml(String(maybeFormat(d[sizeField])))}`:""))}else{showTooltip(event,(groupField&&d&&d[groupField]?`<strong>${escapeHtml(String(d[groupField]))}</strong>`:"")+`${escapeHtml(String(xField))}: ${escapeHtml(String(maybeFormat(d[xField])))}<br/>${escapeHtml(String(yField))}: ${escapeHtml(String(maybeFormat(d[yField])))}`+(sizeField?`<br/>size: ${escapeHtml(String(maybeFormat(d[sizeField])))}`:""),fontFamily,fontSize)}}).on("mouseout",function(event,d){select(this).attr("r",d._originalRadius).attr("fill",d._originalColor),hideTooltip()}),this}},GeoMap:class GeoMap extends D3po{constructor(container,options){super(container,options),this.geom=options&&options.geomap_data?options.geomap_data:null,this.groupField=options.group,this.sizeField=options.size,this.tooltipField=options.tooltip,this.colorField=options.color}render(){var _a,_b;const width=this.getInnerWidth(),height=this.getInnerHeight(),geo=this.options.geomap_data||this.geom||this.data&&this.data.geomap_data||null;if(!geo)return console.warn("[GeoMap] No geo data found"),this;console.log("[GeoMap] Geo data received:",geo),console.log("[GeoMap] Type:",geo.type),console.log("[GeoMap] Has features?",!!geo.features),console.log("[GeoMap] Has objects?",!!geo.objects),this.chart.selectAll("*").remove();let features=geo.features;if(!features&&geo.objects){const keys=Object.keys(geo.objects);console.log("[GeoMap] TopoJSON objects keys:",keys),keys.length>0&&(features=function feature(topology,o){return"string"==typeof o&&(o=topology.objects[o]),"GeometryCollection"===o.type?{type:"FeatureCollection",features:o.geometries.map(function(o2){return feature$1(topology,o2)})}:feature$1(topology,o)}(geo,geo.objects[keys[0]]).features)}if(!features)return console.warn("[GeoMap] No features found after processing"),this;console.log("[GeoMap] Number of features:",features.length),features.length>0&&(console.log("[GeoMap] First feature:",features[0]),console.log("[GeoMap] First feature geometry type:",null==(_a=features[0].geometry)?void 0:_a.type),console.log("[GeoMap] First feature properties:",features[0].properties),console.log("[GeoMap] All feature names:"),features.forEach((f,i)=>{var _a2,_b2,_c,_d,_e,_f;const name=(null==(_a2=f.properties)?void 0:_a2.region)||(null==(_b2=f.properties)?void 0:_b2.name)||(null==(_c=f.properties)?void 0:_c.region_iso)||"unknown",geomType=null==(_d=f.geometry)?void 0:_d.type,coordsLength=null==(_f=null==(_e=f.geometry)?void 0:_e.coordinates)?void 0:_f.length;console.log(`  [${i}] ${name} (${geomType}, ${coordsLength} coord arrays)`)}),(null==(_b=features[0].geometry)?void 0:_b.coordinates)&&(console.log("[GeoMap] First feature coords structure:",Array.isArray(features[0].geometry.coordinates)?`Array length: ${features[0].geometry.coordinates.length}`:"Not an array"),Array.isArray(features[0].geometry.coordinates)&&features[0].geometry.coordinates.length>0&&console.log("[GeoMap] First coordinate element type:",Array.isArray(features[0].geometry.coordinates[0])?`Array length: ${features[0].geometry.coordinates[0].length}`:typeof features[0].geometry.coordinates[0])));const featureCollection={type:"FeatureCollection",features:features};console.log("[GeoMap] Creating projection with manual bounds calculation"),console.log("[GeoMap] Inner width:",width,"Inner height:",height),console.log("[GeoMap] Number of features to render:",features.length);const bounds=index$2().projection(null).bounds(featureCollection),dx=bounds[1][0]-bounds[0][0],dy=bounds[1][1]-bounds[0][1],x2=(bounds[0][0]+bounds[1][0])/2,y2=(bounds[0][1]+bounds[1][1])/2,scale=.9/Math.max(dx/width,dy/height),translate=[width/2-scale*x2,height/2-scale*y2];console.log("[GeoMap] Bounds:",bounds),console.log("[GeoMap] Scale:",scale,"Translate:",translate);const projection=identity$4().scale(scale).translate(translate),pathGen=index$2().projection(projection);if(features.length>0){const testPath1=pathGen(features[0]);console.log("[GeoMap] Test path for first feature (first 400 chars):",null==testPath1?void 0:testPath1.substring(0,400)),console.log("[GeoMap] Test path for first feature (FULL LENGTH):",null==testPath1?void 0:testPath1.length);const mCount=((null==testPath1?void 0:testPath1.match(/M/g))||[]).length;console.log("[GeoMap] Number of M commands in first feature path:",mCount)}const dataMap=new Map;let colorScale;if(this.data&&this.groupField&&(this.data.forEach(row=>{const key=row[this.groupField];null!=key&&dataMap.set(String(key),row)}),console.log("[GeoMap] Data map created with",dataMap.size,"entries")),this.options.gradient&&this.sizeField&&this.data){const extent$1=extent(this.data.map(d=>d[this.sizeField]).filter(v=>null!=v));colorScale=sequential(viridis).domain(extent$1),console.log("[GeoMap] Using gradient scale, domain:",extent$1)}else if(this.colorField&&this.data){const uniqueValues=[...new Set(this.data.map(d=>d[this.colorField]))];colorScale=ordinal(category10).domain(uniqueValues),console.log("[GeoMap] Using color field scale")}else if(this.groupField&&this.data){const uniqueGroups=[...new Set(this.data.map(d=>d[this.groupField]))];colorScale=ordinal(category10).domain(uniqueGroups),console.log("[GeoMap] Using default group-based coloring")}const g=this.chart.append("g").attr("class","map"),zoom$1=zoom().scaleExtent([1,8]).on("zoom",event=>{g.attr("transform",event.transform)});this.svg.call(zoom$1);const regions=g.selectAll("path").data(features).enter().append("path").attr("d",(d,i)=>{var _a2,_b2;const path=pathGen(d);if(i<3){const name=(null==(_a2=d.properties)?void 0:_a2.region)||(null==(_b2=d.properties)?void 0:_b2.name)||"unknown";console.log(`[GeoMap] Path ${i} (${name}):`),console.log(`  Length: ${(null==path?void 0:path.length)||0}`),console.log(`  First 300 chars: ${null==path?void 0:path.substring(0,300)}`),console.log(`  Last 300 chars: ${null==path?void 0:path.substring(Math.max(0,((null==path?void 0:path.length)||0)-300))}`);const mCount=((null==path?void 0:path.match(/M/g))||[]).length;console.log(`  M commands (polygons): ${mCount}`)}return path}).attr("fill",d=>{var _a2,_b2,_c,_d;const identifier=(null==(_a2=d.properties)?void 0:_a2[this.groupField])||(null==(_b2=d.properties)?void 0:_b2.region_iso)||(null==(_c=d.properties)?void 0:_c.name)||(null==(_d=d.properties)?void 0:_d.NAME),dataRow=dataMap.get(String(identifier));if(colorScale){if(this.options.gradient&&this.sizeField&&dataRow)return colorScale(dataRow[this.sizeField]);if(this.colorField&&dataRow)return colorScale(dataRow[this.colorField]);if(identifier)return colorScale(identifier)}return this.options.fill||"#cce5df"}).attr("stroke",this.options.stroke||"#333").attr("stroke-width",1).style("cursor","pointer");if(console.log("[GeoMap] Number of path elements created:",regions.size()),console.log("[GeoMap] Total paths in chart after render:",this.chart.selectAll("path").size()),this.options.gradient&&colorScale&&this.sizeField){const legendWidth=20,legendHeight=200,legendX=width-legendWidth-10,legendY=20,legend=this.chart.append("g").attr("class","legend").attr("transform",`translate(${legendX}, ${legendY})`),linearGradient=this.svg.append("defs").append("linearGradient").attr("id",`gradient-${this.container.id}`).attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%"),stops=10;for(let i=0;i<=stops;i++){const t=i/stops;linearGradient.append("stop").attr("offset",100*t+"%").attr("stop-color",colorScale(colorScale.domain()[0]+t*(colorScale.domain()[1]-colorScale.domain()[0])))}legend.append("rect").attr("width",legendWidth).attr("height",legendHeight).style("fill",`url(#gradient-${this.container.id})`).style("stroke","#333").style("stroke-width",1);const legendAxis=function axisRight(scale){return axis(2,scale)}(linear().domain(colorScale.domain()).range([legendHeight,0])).ticks(5).tickFormat(format(".0f"));legend.append("g").attr("transform",`translate(${legendWidth}, 0)`).call(legendAxis).style("font-size",this.options.fontSize||"12px").style("font-family",this.options.fontFamily||"sans-serif")}const fontFamily=this.options.fontFamily,fontSize=this.options.fontSize,self2=this;return regions.on("mouseover",function(event,d){const el=select(this),highlight=getHighlightColor(el.attr("fill"));el.attr("fill",highlight);const identifier=d.properties&&(d.properties[self2.groupField]||d.properties.region_iso||d.properties.name||d.properties.NAME||d.properties.id)||"Region",dataRow=dataMap.get(String(identifier)),displayName=dataRow&&self2.tooltipField&&dataRow[self2.tooltipField]?dataRow[self2.tooltipField]:identifier;let content=`<strong>${escapeHtml(String(displayName))}</strong>`;dataRow&&self2.sizeField&&null!=dataRow[self2.sizeField]&&(content+=`<br/>Value: ${escapeHtml(String(dataRow[self2.sizeField]))}`),showTooltip(event,content,fontFamily,fontSize)}).on("mouseout",function(){select(this).attr("fill",self2.options.fill||"#cce5df"),hideTooltip()}),this}},Network:class Network extends D3po{constructor(container,options){if(super(container,options),!options.nodes||!options.links)throw new Error("Network requires nodes and links");this.nodes=options.nodes,this.links=options.links,this.sizeField=options.size,this.colorField=options.color,this.layout=options.layout||"force",this.movable=void 0!==options.move&&options.move}render(){const width=this.getInnerWidth(),height=this.getInnerHeight(),clipId=`clip-${Math.random().toString(36).substr(2,9)}`;this.svg.append("defs").append("clipPath").attr("id",clipId).append("rect").attr("x",0).attr("y",0).attr("width",width).attr("height",height),this.chart.attr("clip-path",`url(#${clipId})`);const sizeScale=this.sizeField?sqrt$1().domain(extent(this.nodes,d=>d[this.sizeField])).range([5,20]):()=>8,isManualLayout="manual"===this.options.layout;if(isManualLayout){const xExtent=extent(this.nodes,d=>d.x),yExtent=extent(this.nodes,d=>d.y),xRange=xExtent[1]-xExtent[0],yRange=yExtent[1]-yExtent[0];if(xRange<.5*width||yRange<.5*height){const xPadding=Math.max(.15*xRange,.5),yPadding=Math.max(.15*yRange,.5),xScale=linear().domain([xExtent[0]-xPadding,xExtent[1]+xPadding]).range([80,width-80]),yScale=linear().domain([yExtent[0]-yPadding,yExtent[1]+yPadding]).range([80,height-80]);this.nodes.forEach(d=>{void 0===d.x||void 0===d.y?(d.x=width/2,d.y=height/2):(d.x=xScale(d.x),d.y=yScale(d.y)),d.fx=d.x,d.fy=d.y})}else this.nodes.forEach(d=>{void 0!==d.x&&void 0!==d.y||(d.x=width/2,d.y=height/2),d.fx=d.x,d.fy=d.y})}const simulation$1=simulation(this.nodes);isManualLayout?(simulation$1.force("link",link$1(this.links).id(d=>d.id).distance(0).strength(0)),simulation$1.tick(),simulation$1.stop()):simulation$1.force("link",link$1(this.links).id(d=>d.id).distance(100)).force("charge",function manyBody(){var nodes,node,random,alpha,strengths,strength=constant$3(-30),distanceMin2=1,distanceMax2=1/0,theta2=.81;function force(_){var i,n=nodes.length,tree=quadtree(nodes,x$1,y$1).visitAfter(accumulate);for(alpha=_,i=0;i<n;++i)node=nodes[i],tree.visit(apply)}function initialize(){if(nodes){var i,node2,n=nodes.length;for(strengths=new Array(n),i=0;i<n;++i)node2=nodes[i],strengths[node2.index]=+strength(node2,i,nodes)}}function accumulate(quad){var q,c2,x2,y2,i,strength2=0,weight=0;if(quad.length){for(x2=y2=i=0;i<4;++i)(q=quad[i])&&(c2=Math.abs(q.value))&&(strength2+=q.value,weight+=c2,x2+=c2*q.x,y2+=c2*q.y);quad.x=x2/weight,quad.y=y2/weight}else{(q=quad).x=q.data.x,q.y=q.data.y;do{strength2+=strengths[q.data.index]}while(q=q.next)}quad.value=strength2}function apply(quad,x12,_,x2){if(!quad.value)return!0;var x3=quad.x-node.x,y2=quad.y-node.y,w=x2-x12,l=x3*x3+y2*y2;if(w*w/theta2<l)return l<distanceMax2&&(0===x3&&(l+=(x3=jiggle(random))*x3),0===y2&&(l+=(y2=jiggle(random))*y2),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)),node.vx+=x3*quad.value*alpha/l,node.vy+=y2*quad.value*alpha/l),!0;if(!(quad.length||l>=distanceMax2)){(quad.data!==node||quad.next)&&(0===x3&&(l+=(x3=jiggle(random))*x3),0===y2&&(l+=(y2=jiggle(random))*y2),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)));do{quad.data!==node&&(w=strengths[quad.data.index]*alpha/l,node.vx+=x3*w,node.vy+=y2*w)}while(quad=quad.next)}}return force.initialize=function(_nodes,_random){nodes=_nodes,random=_random,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$3(+_),initialize(),force):strength},force.distanceMin=function(_){return arguments.length?(distanceMin2=_*_,force):Math.sqrt(distanceMin2)},force.distanceMax=function(_){return arguments.length?(distanceMax2=_*_,force):Math.sqrt(distanceMax2)},force.theta=function(_){return arguments.length?(theta2=_*_,force):Math.sqrt(theta2)},force}().strength(-300)).force("center",function center(x2,y2){var nodes,strength=1;function force(){var i,node,n=nodes.length,sx=0,sy=0;for(i=0;i<n;++i)sx+=(node=nodes[i]).x,sy+=node.y;for(sx=(sx/n-x2)*strength,sy=(sy/n-y2)*strength,i=0;i<n;++i)(node=nodes[i]).x-=sx,node.y-=sy}return null==x2&&(x2=0),null==y2&&(y2=0),force.initialize=function(_){nodes=_},force.x=function(_){return arguments.length?(x2=+_,force):x2},force.y=function(_){return arguments.length?(y2=+_,force):y2},force.strength=function(_){return arguments.length?(strength=+_,force):strength},force}(width/2,height/2)).force("collision",function collide(radius){var nodes,radii,random,strength=1,iterations=1;function force(){for(var i,tree,node,xi,yi,ri,ri2,n=nodes.length,k=0;k<iterations;++k)for(tree=quadtree(nodes,x$2,y$2).visitAfter(prepare),i=0;i<n;++i)node=nodes[i],ri=radii[node.index],ri2=ri*ri,xi=node.x+node.vx,yi=node.y+node.vy,tree.visit(apply);function apply(quad,x02,y02,x12,y12){var data=quad.data,rj=quad.r,r=ri+rj;if(!data)return x02>xi+r||x12<xi-r||y02>yi+r||y12<yi-r;if(data.index>node.index){var x2=xi-data.x-data.vx,y2=yi-data.y-data.vy,l=x2*x2+y2*y2;l<r*r&&(0===x2&&(l+=(x2=jiggle(random))*x2),0===y2&&(l+=(y2=jiggle(random))*y2),l=(r-(l=Math.sqrt(l)))/l*strength,node.vx+=(x2*=l)*(r=(rj*=rj)/(ri2+rj)),node.vy+=(y2*=l)*r,data.vx-=x2*(r=1-r),data.vy-=y2*r)}}}function prepare(quad){if(quad.data)return quad.r=radii[quad.data.index];for(var i=quad.r=0;i<4;++i)quad[i]&&quad[i].r>quad.r&&(quad.r=quad[i].r)}function initialize(){if(nodes){var i,node,n=nodes.length;for(radii=new Array(n),i=0;i<n;++i)node=nodes[i],radii[node.index]=+radius(node,i,nodes)}}return"function"!=typeof radius&&(radius=constant$3(null==radius?1:+radius)),force.initialize=function(_nodes,_random){nodes=_nodes,random=_random,initialize()},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength=+_,force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant$3(+_),initialize(),force):radius},force}().radius(d=>sizeScale(d[this.sizeField]||8)+5));const link2=this.chart.selectAll(".link").data(this.links).enter().append("line").attr("class","link").attr("stroke","#999").attr("stroke-opacity",1).attr("stroke-width",2),sizeField=this.sizeField,colorField=this.colorField;let paletteMap=null;if(Array.isArray(colorField)||colorField&&"object"==typeof colorField){const paletteArr=Array.isArray(colorField)?colorField:Object.values(colorField||{}),palette=paletteArr.length?paletteArr:null;palette&&(paletteMap={},this.nodes.forEach((node2,i)=>{paletteMap[node2.id]=normalizeColorString(palette[i%palette.length])}))}const node=this.chart.selectAll(".node").data(this.nodes).enter().append("circle").attr("class","node").attr("r",d=>sizeScale(d[this.sizeField]||8)).attr("fill",d=>paletteMap?paletteMap[d.id]||"#69b3a2":"string"==typeof colorField?d[colorField]||"#69b3a2":viridis(Math.random())).each(function(d){d._originalColor=paletteMap?paletteMap[d.id]:"string"==typeof colorField?d[colorField]:viridis(Math.random())}).attr("stroke","white").attr("stroke-width",2).style("cursor",this.movable?"move":"pointer");this.movable&&node.call(function drag(){var mousedownx,mousedowny,mousemoving,touchending,filter2=defaultFilter$1,container=defaultContainer,subject=defaultSubject,touchable=defaultTouchable$1,gestures={},listeners=dispatch("start","drag","end"),active=0,clickDistance2=0;function drag2(selection2){selection2.on("mousedown.drag",mousedowned).filter(touchable).on("touchstart.drag",touchstarted).on("touchmove.drag",touchmoved,nonpassive).on("touchend.drag touchcancel.drag",touchended).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function mousedowned(event,d){if(!touchending&&filter2.call(this,event,d)){var gesture=beforestart(this,container.call(this,event,d),event,d,"mouse");gesture&&(select(event.view).on("mousemove.drag",mousemoved,nonpassivecapture).on("mouseup.drag",mouseupped,nonpassivecapture),dragDisable(event.view),nopropagation$1(event),mousemoving=!1,mousedownx=event.clientX,mousedowny=event.clientY,gesture("start",event))}}function mousemoved(event){if(noevent$1(event),!mousemoving){var dx=event.clientX-mousedownx,dy=event.clientY-mousedowny;mousemoving=dx*dx+dy*dy>clickDistance2}gestures.mouse("drag",event)}function mouseupped(event){select(event.view).on("mousemove.drag mouseup.drag",null),yesdrag(event.view,mousemoving),noevent$1(event),gestures.mouse("end",event)}function touchstarted(event,d){if(filter2.call(this,event,d)){var i,gesture,touches=event.changedTouches,c2=container.call(this,event,d),n=touches.length;for(i=0;i<n;++i)(gesture=beforestart(this,c2,event,d,touches[i].identifier,touches[i]))&&(nopropagation$1(event),gesture("start",event,touches[i]))}}function touchmoved(event){var i,gesture,touches=event.changedTouches,n=touches.length;for(i=0;i<n;++i)(gesture=gestures[touches[i].identifier])&&(noevent$1(event),gesture("drag",event,touches[i]))}function touchended(event){var i,gesture,touches=event.changedTouches,n=touches.length;for(touchending&&clearTimeout(touchending),touchending=setTimeout(function(){touchending=null},500),i=0;i<n;++i)(gesture=gestures[touches[i].identifier])&&(nopropagation$1(event),gesture("end",event,touches[i]))}function beforestart(that,container2,event,d,identifier,touch){var dx,dy,s,dispatch2=listeners.copy(),p=pointer(touch||event,container2);if(null!=(s=subject.call(that,new DragEvent("beforestart",{sourceEvent:event,target:drag2,identifier:identifier,active:active,x:p[0],y:p[1],dx:0,dy:0,dispatch:dispatch2}),d)))return dx=s.x-p[0]||0,dy=s.y-p[1]||0,function gesture(type,event2,touch2){var n,p0=p;switch(type){case"start":gestures[identifier]=gesture,n=active++;break;case"end":delete gestures[identifier],--active;case"drag":p=pointer(touch2||event2,container2),n=active}dispatch2.call(type,that,new DragEvent(type,{sourceEvent:event2,subject:s,target:drag2,identifier:identifier,active:n,x:p[0]+dx,y:p[1]+dy,dx:p[0]-p0[0],dy:p[1]-p0[1],dispatch:dispatch2}),d)}}return drag2.filter=function(_){return arguments.length?(filter2="function"==typeof _?_:constant$5(!!_),drag2):filter2},drag2.container=function(_){return arguments.length?(container="function"==typeof _?_:constant$5(_),drag2):container},drag2.subject=function(_){return arguments.length?(subject="function"==typeof _?_:constant$5(_),drag2):subject},drag2.touchable=function(_){return arguments.length?(touchable="function"==typeof _?_:constant$5(!!_),drag2):touchable},drag2.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?drag2:value},drag2.clickDistance=function(_){return arguments.length?(clickDistance2=(_=+_)*_,drag2):Math.sqrt(clickDistance2)},drag2}().on("start",(event,d)=>{event.active||simulation$1.alphaTarget(.3).restart(),d.fx=d.x,d.fy=d.y}).on("drag",(event,d)=>{d.fx=event.x,d.fy=event.y}).on("end",event=>{event.active||simulation$1.alphaTarget(0)}));const fontFamily=this.options.fontFamily,fontSize=this.options.fontSize;let tooltipFormatter=resolveTooltipFormatter(this.tooltip,this.options&&this.options.tooltip);node.on("mouseover",function(event,d){const highlightColor=getHighlightColor(d._originalColor);if(select(this).attr("fill",highlightColor),tooltipFormatter)try{const out=tooltipFormatter(null,d);if(null!=out)return void showTooltip(event,out,fontFamily,fontSize)}catch(e){}const typeLabel=escapeHtml(d.id||"Node"),numericFieldCandidates=[];sizeField&&numericFieldCandidates.push(sizeField),numericFieldCandidates.push("value","size","count");let chosenField=null,chosenValue=null;for(const f of numericFieldCandidates)if(null!=d[f]){chosenField=f,chosenValue=d[f];break}let tooltipContent=`<strong>${typeLabel}</strong>`;null!=chosenField&&(tooltipContent+=`${escapeHtml(String(chosenField))}: ${escapeHtml(String(chosenValue))}`),showTooltip(event,tooltipContent,fontFamily,fontSize)}).on("mouseout",function(event,d){select(this).attr("fill",d._originalColor),hideTooltip()});const labels=this.chart.selectAll(".label").data(this.nodes).enter().append("text").attr("class","label").attr("text-anchor","middle").attr("dy",4).attr("font-size","10px").attr("pointer-events","none").text(d=>d.id||"");if(this.options&&this.options.title){const existingChartTitle=this.chart.select("text.title");existingChartTitle.empty()?this.chart.append("text").attr("class","title").attr("text-anchor","middle").attr("x",this.getInnerWidth()/2).attr("y",this.options.titleOffsetY?this.options.titleOffsetY:-10).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.titleFontSize?`${this.options.titleFontSize}px`:this.options&&this.options.fontSize?`${Number(this.options.fontSize)+2}px`:"16px").text(String(this.options.title)):existingChartTitle.attr("text-anchor","middle").attr("x",this.getInnerWidth()/2).attr("y",this.options.titleOffsetY?this.options.titleOffsetY:-10).style("font-family",this.options&&this.options.fontFamily?this.options.fontFamily:null).style("font-size",this.options&&this.options.titleFontSize?`${this.options.titleFontSize}px`:this.options&&this.options.fontSize?`${Number(this.options.fontSize)+2}px`:"16px").text(String(this.options.title))}simulation$1.on("tick",()=>{link2.attr("x1",d=>d.source.x).attr("y1",d=>d.source.y).attr("x2",d=>d.target.x).attr("y2",d=>d.target.y),node.attr("cx",d=>d.x).attr("cy",d=>d.y),labels.attr("x",d=>d.x).attr("y",d=>d.y)}),isManualLayout&&(link2.attr("x1",d=>d.source.x).attr("y1",d=>d.source.y).attr("x2",d=>d.target.x).attr("y2",d=>d.target.y),node.attr("cx",d=>d.x).attr("cy",d=>d.y),labels.attr("x",d=>d.x).attr("y",d=>d.y));const zoom$1=zoom().scaleExtent([.5,5]).on("zoom",event=>{link2.attr("transform",event.transform),node.attr("transform",event.transform),labels.attr("transform",event.transform)});return this.svg.call(zoom$1),this}}};return index});
//# sourceMappingURL=d3po.min.js.map
