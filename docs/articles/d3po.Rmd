---
title: Introduction to d3po
output: 
  github_document: default
description: |
  Start here if this is your first time using d3po. You'll learn the basic    philosophy, and (hopefully) you'll realize it integrates well with the pipe,  `%>%`, and the Tidyverse.
always_allow_html: yes
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 10,
  fig.height = 5
)
```

The package `d3po` integrates well with `dplyr`. All the examples here use the 
pipe, `%>%`, both to filter/summarise data and create the charts.

These examples are the same as in the documentation but with some extended comments.

# Setup

Let's start by loading packages.

```{r pkgs, message=FALSE, warning=FALSE}
library(dplyr)
library(d3po)
library(d3pomaps)
library(freedomhouse)
```

# Freedom House dataset

The included dataset `country_rating_statuses` includes a detailed documentation but let's explore the data structure:
```{r}
glimpse(country_rating_statuses)
```
```

# Box and Whiskers

To plot the distribution of civil liberties in 2023 by continent, we need to indicate the variables 
for the axis, group, and (optionally) color:
```{r box1, fig.height=7}
dout <- country_rating_statuses %>%
  filter(year == 2023)

d3po(dout) %>%
  po_box(daes(x = continent, y = civil_liberties, group = country, color = color)) %>%
  po_title("Civil Liberties Distribution by Continent")
```

# Bar

To plot the evolution of country status in time, we need to indicate the variables for the axis
and, group, and (optionally) color:
```{r bar1}
dout <- country_rating_statuses %>%
  filter(year >= 2010) %>%
  group_by(year, status, color) %>%
  count()

d3po(dout) %>%
  po_bar(
    daes(x = year, y = n, group = status, color = color)
  ) %>%
  po_title("Evolution of Country Status in Time")
```

# Treemap

To plot the share of countries by status in 2023, we need to indicate the variables for the
size, group, and (optionally) color:
```{r}
dout <- country_rating_statuses %>%
  filter(year == 2023) %>%
  group_by(status, color) %>%
  count()

d3po(dout) %>%
  po_treemap(
    daes(size = n, group = status, color = color)
  ) %>%
  po_title("Count of Countries by Continent and Status")
```

# Pie

Use these plots with caution because polar coordinates has major perceptual 
problems. Use with *EXTREME* caution.

This method is exactly the same as `treemap` but calling a different function:
```{r}
d3po(dout) %>%
  po_pie(
    daes(size = n, group = status, color = color)
  ) %>%
  po_title("Share of Pokemon by Type")
```

# Donut

Use these plots with caution because polar coordinates has major perceptual 
problems. Use with *EXTREME* caution.

This method is exactly the same as `treemap` but calling a different function:
```{r}
d3po(dout) %>%
  po_donut(
    daes(size = n, group = status, color = color)
  ) %>%
  po_title("Share of Pokemon by Type")
```

# Line

To plot the evolution of country status in time, we need to indicate the variables for the axis, group, and (optionally) color:
```{r line1}
dout <- country_rating_statuses %>%
  group_by(year, status, color) %>%
  count()

d3po(dout) %>%
  po_line(
    daes(x = year, y = n, group = status, color = color)
  ) %>%
  po_title("Evolution of Country Status in Time")
```

# Area

This method is exactly the same as `treemap` but calling a different function and
with the option of stacking the areas:
```{r area1}
d3po(dout) %>%
  po_area(
    daes(x = year, y = n, group = status, color = color),
    stack = TRUE
  ) %>%
  po_title("Evolution of Country Status in Time")
```

# Scatterplot

This method is exactly the same as `treemap` but calling a different function:
```{r scatterplot1}
dout <- country_rating_statuses %>%
  filter(
    year %in% c(1975, 1985, 1995, 2005, 2015),
    country == "Chile"
  ) %>%
  mutate(
    inv_civil_liberties = sqrt(1 / civil_liberties),
    inv_political_rights = sqrt(1 / political_rights)
  )

d3po(dout) %>%
  po_scatter(
    daes(
      x = inv_civil_liberties, y = inv_political_rights,
      group = year, color = color
    )
  ) %>%
  po_title("Evolution of Chile in Time")
```

# Geomap

This method is very similar to all the others but we need to specify the map.
In this case, we are going to use the map of South America from the `d3pomaps`
package:
```{r}
dout <- country_rating_statuses %>%
  filter(year == 2023, !is.na(iso2c)) %>%
  select(id = iso2c, status, color)

d3po(dout) %>%
  po_geomap(
    daes(group = id, color = color, size = status, tooltip = status),
    map = d3pomaps::maps$south_america$continent
  )
```

# Network

This method is very similar to all the others but, unlike the others, 
it needs an igraph object as input, and with the option of using a specific
layout:
```{r}
d3po(country_exports_similarity) %>%
  po_network(daes(
    size = exports, color = color,
    tooltip = status, layout = "kk"
  )) %>%
  po_title("Network of countries by Freedom House status and exports")
```

# Aesthetics

Going back to the treemap example, it is possible to move the labels and
also use any font that you like:
```{r}
dout <- country_rating_statuses %>%
  filter(year == 2022) %>%
  group_by(status, color) %>%
  count()

d3po(dout) %>%
  po_treemap(
    daes(size = n, group = status, color = color)
  ) %>%
  po_title("Count of Countries by Continent and Status") %>%
  po_font("Comic Sans MS", 20, "uppercase") %>%
  po_labels("left", "top", F)
```
